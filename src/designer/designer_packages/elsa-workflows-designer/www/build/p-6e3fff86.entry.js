import{h as t,r as e,c as s,H as i,a as n}from"./p-a7a3baa1.js";import{E as l,D as o}from"./p-2e503831.js";import{l as a}from"./p-e71312f9.js";import{D as h}from"./p-e1532f4a.js";import{B as r,P as c,O as w}from"./p-c63782c8.js";import{Z as u,aa as d,ab as p,a3 as f,C as b,Y as x,ac as m,A as k}from"./p-691e5295.js";import"./p-219f806a.js";import"./p-b6964c5d.js";import{g as y}from"./p-e754efd8.js";import"./p-72dc819a.js";import"./p-144a434e.js";import"./p-ddecd487.js";const g=()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"tw-h-5 tw-w-5 tw-text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"}));const v=()=>t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"tw-h-5 tw-w-5 tw-text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"}));const C=()=>t("svg",{class:"tw-h-5 tw-w-5 tw-text-gray-400",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},t("path",{d:"M16.6582 9.28638C18.098 10.1862 18.8178 10.6361 19.0647 11.2122C19.2803 11.7152 19.2803 12.2847 19.0647 12.7878C18.8178 13.3638 18.098 13.8137 16.6582 14.7136L9.896 18.94C8.29805 19.9387 7.49907 20.4381 6.83973 20.385C6.26501 20.3388 5.73818 20.0469 5.3944 19.584C5 19.053 5 18.1108 5 16.2264V7.77357C5 5.88919 5 4.94701 5.3944 4.41598C5.73818 3.9531 6.26501 3.66111 6.83973 3.6149C7.49907 3.5619 8.29805 4.06126 9.896 5.05998L16.6582 9.28638Z","stroke-width":"2","stroke-linejoin":"round"}));const S=({onSearch:e,displayText:s})=>{const i=t=>{t.preventDefault();const s=t.target;const i=new FormData(s);const n=i.get("searchTerm").toString();e(n)};const n=a.debounce(e,200);const l=t=>{const e=t.target.value;n(e)};return t("div",{class:"tw-relative tw-z-10 tw-flex-shrink-0 tw-flex tw-h-16 tw-bg-white tw-border-b tw-border-gray-200"},t("div",{class:"tw-flex-1 tw-px-4 tw-flex tw-justify-between sm:tw-px-6 lg:tw-px-8"},t("div",{class:"tw-flex-1 tw-flex"},t("form",{class:"tw-w-full tw-flex md:tw-ml-0",onSubmit:i},t("label",{htmlFor:"search_field",class:"tw-sr-only"},s),t("div",{class:"tw-relative tw-w-full tw-text-gray-400 focus-within:tw-text-gray-600"},t("div",{class:"tw-absolute tw-inset-y-0 tw-left-0 tw-flex tw-items-center tw-pointer-events-none"},t("svg",{class:"tw-h-5 tw-w-5",fill:"currentColor",viewBox:"0 0 20 20"},t("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"}))),t("input",{name:"searchTerm",onKeyUp:l,class:"tw-block tw-w-full tw-h-full tw-pl-8 tw-pr-3 tw-py-2 tw-rounded-md tw-text-gray-900 tw-placeholder-cool-gray-500 focus:tw-placeholder-cool-gray-400 sm:tw-text-sm tw-border-0 focus:tw-outline-none focus:tw-ring-0",placeholder:s,type:"search"}))))))};const T=({pageSizeFilter:e,orderByFilter:s,onBulkDelete:i,onBulkPublish:n,onBulkUnpublish:l,labelFilter:o,bulkActionsText:a,bulkDeleteText:h,bulkPublishText:r,bulkUnpublishText:c})=>t("div",{class:"tw-p-8 tw-flex tw-content-end tw-justify-right tw-bg-white tw-space-x-4"},t("div",{class:"tw-flex-shrink-0"},t(B,{onBulkDelete:i,onBulkPublish:n,onBulkUnpublish:l,bulkActionsText:a,bulkDeleteText:h,bulkPublishText:r,bulkUnpublishText:c})),t("div",{class:"tw-flex-1"},"Â "),t(j,Object.assign({},e)),t(D,Object.assign({},s)));const B=({onBulkDelete:e,onBulkPublish:s,onBulkUnpublish:i,bulkActionsText:n,bulkDeleteText:l,bulkPublishText:o,bulkUnpublishText:a})=>{const c=[{text:l,name:"Delete"},{text:o,name:"Publish"},{text:a,name:"Unpublish"}];const w=t=>{const n=t.detail;switch(n.name){case"Delete":e();break;case"Publish":s();break;case"Unpublish":i();break;default:n.handler()}};return t("elsa-dropdown-button",{text:n,items:c,theme:"Secondary",icon:t(r,null),origin:h.TopLeft,onItemSelected:w})};const j=({selectedPageSize:e,onChange:s,pageSizeText:i})=>{const n=`${i}: ${e}`;const l=[5,10,15,20,30,50,100];const o=l.map((t=>{const s=""+t;return{text:s,isSelected:t==e,value:t}}));const a=t=>s(parseInt(t.detail.value));return t("elsa-dropdown-button",{text:n,items:o,theme:"Secondary",icon:t(c,null),origin:h.TopRight,onItemSelected:a})};const D=({selectedOrderBy:e,onChange:s,orderByText:i})=>{const n=!!e?`${i}: ${e}`:i;const l=[u.Name,u.Created];const o=l.map((t=>({text:t,value:t,isSelected:t==e})));const a=t=>s(t.detail.value);return t("elsa-dropdown-button",{text:n,items:o,theme:"Secondary",icon:t(w,null),origin:h.TopRight,onItemSelected:a})};function P(t,e,s){const i=e.items.filter((t=>!t.isReadonly)).map((t=>t.definitionId));return t?s.concat(i.filter((t=>!s.includes(t)))):s.filter((t=>!i.includes(t)))}const A="LS/wfDefinitionBrowser";function U(){var t=localStorage.getItem(A);if(!t)return;return JSON.parse(t)}function z(t){localStorage.setItem(A,JSON.stringify(t))}const I=class{constructor(t){e(this,t);this.workflowDefinitionSelected=s(this,"workflowDefinitionSelected",7);this.workflowInstancesSelected=s(this,"workflowInstancesSelected",7);this.workflowInstanceStarted=s(this,"workflowInstanceStarted",7);this.newWorkflowDefinitionSelected=s(this,"newWorkflowDefinitionSelected",7);this.onNewDefinitionClick=async()=>{this.newWorkflowDefinitionSelected.emit()};this.onSearch=async t=>{this.searchTerm=t;this.resetPagination();await this.loadWorkflowDefinitions()};this.onDeleteManyClick=async()=>{if(this.selectedWorkflowDefinitionIds.length==0)return;this.modalDialogService.show((()=>d.Warning("Are you sure you want to delete selected workflow definitions?")),{actions:[p.Delete((async()=>{await this.api.deleteMany({definitionIds:this.selectedWorkflowDefinitionIds});await this.loadWorkflowDefinitions();await this.activityDescriptorManager.refresh()})),p.Cancel()],modalType:f.Confirmation})};this.onPublishManyClick=async()=>{if(this.selectedWorkflowDefinitionIds.length==0)return;this.modalDialogService.show((()=>d.Warning("Are you sure you want to publish selected workflow definitions?")),{actions:[p.Publish((async()=>{await this.api.publishMany({definitionIds:this.selectedWorkflowDefinitionIds});await this.loadWorkflowDefinitions()})),p.Cancel()],modalType:f.Confirmation})};this.onUnpublishManyClick=async()=>{if(this.selectedWorkflowDefinitionIds.length==0)return;this.modalDialogService.show((()=>d.Warning("Are you sure you want to unpublish selected workflow definitions?")),{actions:[p.Unpublish((async()=>{await this.api.unpublishMany({definitionIds:this.selectedWorkflowDefinitionIds});await this.loadWorkflowDefinitions()})),p.Cancel()],modalType:f.Confirmation})};this.onWorkflowDefinitionClick=async(t,e)=>{t.preventDefault();this.workflowDefinitionSelected.emit(e)};this.onWorkflowInstanceStarted=async(t,e)=>{t.preventDefault();await this.onWorkflowStartClick(t,e);this.workflowInstanceStarted.emit(e)};this.onWorkflowInstancesClick=async(t,e)=>{t.preventDefault();this.workflowInstancesSelected.emit(e)};this.onPaginated=async t=>{this.currentPage=t.detail.page;await this.loadWorkflowDefinitions()};this.onPageSizeChanged=async t=>{this.currentPageSize=t;this.resetPagination();await this.loadWorkflowDefinitions()};this.onOrderByChanged=async t=>{this.orderBy=t;await this.loadWorkflowDefinitions()};this.onLabelChange=async t=>{this.labels=t.detail;await this.loadWorkflowDefinitions()};this.resetPagination=()=>{this.currentPage=0;this.selectedWorkflowDefinitionIds=[]};this.getSelectAllState=()=>{const{items:t}=this.workflowDefinitions;const e=this.selectedWorkflowDefinitionIds;return t.findIndex((t=>!e.includes(t.definitionId)))<0};this.setSelectAllIndeterminateState=()=>{if(this.selectAllCheckbox){const t=this.workflowDefinitions.items.filter((t=>this.selectedWorkflowDefinitionIds.includes(t.definitionId)));this.selectAllCheckbox.indeterminate=t.length!=0&&t.length!=this.workflowDefinitions.items.length}};this.customActions=[];this.workflowDefinitions={items:[],totalCount:0};this.publishedWorkflowDefinitions={items:[],totalCount:0};this.selectedWorkflowDefinitionIds=[];this.currentPage=0;this.currentPageSize=I.DEFAULT_PAGE_SIZE;this.orderBy=undefined;this.labels=undefined;this.selectAllChecked=undefined;this.searchTerm=undefined;this.api=b.get(x);this.modalDialogService=b.get(m);this.activityDescriptorManager=b.get(k)}async componentWillLoad(){this.strings=await y(this.element);const t=U();if(t){this.currentPage=t.page;this.currentPageSize=t.pageSize;this.orderBy=t.orderBy}await this.loadWorkflowDefinitions()}async onPublishClick(t,e){await this.api.publish(e);await this.loadWorkflowDefinitions()}async onUnPublishClick(t,e){await this.api.retract(e);await this.loadWorkflowDefinitions()}async onWorkflowStartClick(t,e){await this.api.execute(e.definitionId);await this.loadWorkflowDefinitions()}async onDeleteClick(t,e){this.modalDialogService.show((()=>d.Warning("Are you sure you want to delete this workflow definition?")),{actions:[p.Delete((async()=>{await this.api.delete(e);await this.loadWorkflowDefinitions();await this.activityDescriptorManager.refresh()})),p.Cancel()],modalType:f.Confirmation})}async loadWorkflowDefinitions(){const t="Json";const e={searchTerm:this.searchTerm,materializerName:t,page:this.currentPage,pageSize:this.currentPageSize,versionOptions:{isLatest:true},orderBy:this.orderBy,label:this.labels};z(e);const s=await this.api.list(e);const i=s.items.filter((t=>!t.isPublished)).map((t=>t.definitionId));this.publishedWorkflowDefinitions=await this.api.list({materializerName:t,definitionIds:i,versionOptions:{isPublished:true}});this.workflowDefinitions=s}onWorkflowDefinitionCheckChange(t,e){const s=t.target;const i=s.checked;if(i)this.selectedWorkflowDefinitionIds=[...this.selectedWorkflowDefinitionIds,e.definitionId];else this.selectedWorkflowDefinitionIds=this.selectedWorkflowDefinitionIds.filter((t=>t!=e.definitionId));this.setSelectAllIndeterminateState()}onSelectAllCheckChange(t){const e=t.target;const s=e.checked;this.selectAllChecked=s;this.selectedWorkflowDefinitionIds=P(s,this.workflowDefinitions,this.selectedWorkflowDefinitionIds)}render(){const e=this.workflowDefinitions;const s=this.publishedWorkflowDefinitions.items;const n=e.totalCount;const a={pageSizeFilter:{selectedPageSize:this.currentPageSize,onChange:this.onPageSizeChanged,pageSizeText:this.strings.pageSize},orderByFilter:{selectedOrderBy:this.orderBy,onChange:this.onOrderByChanged,orderByText:this.strings.orderBy},labelFilter:{selectedLabels:this.labels,onSelectedLabelsChanged:this.onLabelChange,buttonClass:"tw-text-gray-500 hover:tw-text-gray-300",containerClass:"tw-mt-1.5"},onBulkDelete:this.onDeleteManyClick,onBulkPublish:this.onPublishManyClick,onBulkUnpublish:this.onUnpublishManyClick,bulkActionsText:this.strings.bulkActions,bulkDeleteText:this.strings.bulkDelete,bulkPublishText:this.strings.bulkPublish,bulkUnpublishText:this.strings.bulkUnpublish};return t(i,{class:"tw-block"},t("div",{class:"tw-pt-4"},t("h2",{class:"tw-text-lg tw-font-medium tw-ml-4 tw-mb-2"},this.strings.title),t(S,{onSearch:this.onSearch,displayText:this.strings.search}),t(T,Object.assign({},a)),t("div",{class:"tw-align-middle tw-inline-block tw-min-w-full tw-border-b tw-border-gray-200"},t("table",{class:"default-table"},t("thead",null,t("tr",null,t("th",null,t("input",{type:"checkbox",value:"true",checked:this.getSelectAllState(),onChange:t=>this.onSelectAllCheckChange(t),ref:t=>this.selectAllCheckbox=t})),t("th",null,t("span",{class:"lg:tw-pl-2"},this.strings.name)),t("th",null,this.strings.instances),t("th",{class:"tw-text-center"},this.strings.latestVersion),t("th",{class:"tw-text-center"},this.strings.publishedVersion),t("th",null))),t("tbody",null,e.items.map((e=>{const i=e.version;const{isPublished:n}=e;const a=n?e:s.find((t=>t.definitionId==e.definitionId));const h=!!a?a.version:"-";const r=e.isReadonly;const c=this.selectedWorkflowDefinitionIds.findIndex((t=>t===e.definitionId))>=0;let w=e.name;if(!w||w.trim().length==0)w="Untitled";return t("tr",null,t("td",null,t("input",{disabled:r,type:"checkbox",value:e.definitionId,checked:c,onChange:t=>this.onWorkflowDefinitionCheckChange(t,e)})),t("td",null,t("div",{class:"tw-flex tw-items-center tw-space-x-3 lg:tw-pl-2"},t("a",{onClick:t=>this.onWorkflowDefinitionClick(t,e),href:"#",class:"tw-truncate hover:tw-text-gray-600"},t("span",null,w)))),t("td",null,t("div",{class:"tw-flex tw-items-center tw-space-x-3 lg:tw-pl-2"},t("a",{onClick:t=>this.onWorkflowInstancesClick(t,e),href:"#",class:"tw-truncate hover:tw-text-gray-600"},"Instances"))),t("td",{class:"tw-text-center"},i),t("td",{class:"tw-text-center"},h),t("td",{class:"tw-pr-6"},r?"":t("elsa-context-menu",{menuItems:[{text:"Start",handler:t=>this.onWorkflowInstanceStarted(t,e),icon:t(C,null)},{text:this.strings.buttonEdit,handler:t=>this.onWorkflowDefinitionClick(t,e),icon:t(l,null)},n?{text:"Unpublish",handler:t=>this.onUnPublishClick(t,e),icon:t(v,null)}:{text:this.strings.buttonPublish,handler:t=>this.onPublishClick(t,e),icon:t(g,null)},{text:this.strings.buttonDelete,handler:t=>this.onDeleteClick(t,e),icon:t(o,null)}].concat(...this.customActions.map((t=>({text:t.text,handler:s=>t.callbackFn(e),icon:null}))))})))})))),t("elsa-pager",{page:this.currentPage,pageSize:this.currentPageSize,totalCount:n,onPaginated:this.onPaginated}))))}get element(){return n(this)}};I.DEFAULT_PAGE_SIZE=15;I.MIN_PAGE_SIZE=5;I.MAX_PAGE_SIZE=100;I.START_PAGE=0;export{I as elsa_workflow_definition_browser};
//# sourceMappingURL=p-6e3fff86.entry.js.map