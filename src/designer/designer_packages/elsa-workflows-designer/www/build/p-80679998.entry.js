import{r as t,c as i,h as s,a as o}from"./p-a7a3baa1.js";import{l as n}from"./p-e71312f9.js";import{ah as e,o as a,C as l,D as r,B as c,ai as h,N as d,aj as u,Y as v}from"./p-691e5295.js";import"./p-219f806a.js";import{s as w}from"./p-b6964c5d.js";import{C as p,F as f}from"./p-b15e4c38.js";import{I as y}from"./p-e7fbf459.js";import{g as m}from"./p-e754efd8.js";import{I as b}from"./p-6e6754a9.js";import{W as k}from"./p-e75c6668.js";import"./p-72dc819a.js";import"./p-144a434e.js";import"./p-ddecd487.js";import"./p-ec4413cd.js";import"./p-37e9f5c1.js";const g=class{constructor(o){t(this,o);this.activityUpdated=i(this,"activityUpdated",7);this.deleteActivityRequested=i(this,"deleteActivityRequested",7);this.getSelectedTabIndex=t=>{let i=this.selectedTabIndex;if(i>=t.length)i=t.length-1;if(i<0)i=0;return i};this.createTabs=()=>{const t=this.findActivityDescriptor();const i=t.kind==d.Task;const s={displayText:this.strings.generalTab,order:0,content:()=>this.renderCommonTab()};const o={displayText:this.strings.settingsTab,order:10,content:()=>this.renderInputTab()};const n=!!t?[o,s]:[];if(t.outputs.length>0){const t={displayText:this.strings.outputTab,order:11,content:()=>this.renderOutputTab()};n.push(t)}if(i){const t={displayText:this.strings.taskTab,order:12,content:()=>this.renderTaskTab()};n.push(t)}return n};this.createInputs=()=>{const t=this.activity;const i=t.id;const o=this.findActivityDescriptor();const n=this.inputDriverRegistry;const e=s=>this.activityUpdated.emit({newId:i,originalId:i,activity:t,activityDescriptor:o});const a=o.inputs.filter((t=>t.isBrowsable));return a.map((i=>{const a={activity:t,activityDescriptor:o,inputDescriptor:i,notifyInputChanged:()=>e(),inputChanged:(t,s)=>this.onInputPropertyEditorChanged(i,t,s)};const l=n.get(a);const r=this.workflowDefinitionId;const c=o.typeName;const h=i.name;const d=s(y.Provider,{state:{workflowDefinitionId:r,activityType:c,propertyName:h}},l===null||l===void 0?void 0:l.renderInput(a));return{inputContext:a,inputControl:d}}))};this.findActivityDescriptor=()=>!!this.activity?w.activityDescriptors.find((t=>t.typeName==this.activity.type&&t.version==this.activity.version)):null;this.onSelectedTabIndexChanged=t=>this.selectedTabIndex=t.detail.selectedTabIndex;this.onActivityIdChanged=t=>{const i=this.activity;const s=i.id;const o=t.target;const n=o.value;const e=this.findActivityDescriptor();i.id=n;this.activityUpdated.emit({newId:n,originalId:s,activity:i,activityDescriptor:e})};this.onInputPropertyEditorChanged=(t,i,s)=>{const o=this.activity;const a=t.name;const l=t.isWrapped;const r=n.camelCase(a);console.log(a,i,s);if(l){let n=o[r];const a={type:s,value:i};if(!n){n={typeName:t.typeName,memoryReference:{id:e()},expression:a}}n.expression=a;o[r]=n}else{o[r]=i}this.updateActivity(a)};this.onOutputPropertyEditorChanged=(t,i)=>{const s=this.activity;const o=t.name;const e=n.camelCase(o);const a=i.split("::");const l=a[1];const r={typeName:t.typeName,memoryReference:{id:l}};s[e]=r;this.updateActivity(o)};this.updateActivity=(t,i)=>{const s=this.findActivityDescriptor();const o=this.activity;const n=o.id;console.log(`Activity ${n} updated.`);this.activityUpdated.emit({newId:n,originalId:n,activity:o,activityDescriptor:s})};this.renderCommonTab=()=>{var t,i,o,n,e,a,l;const{activity:r}=this.renderContext;const c=r.id;const h=(i=(t=r.metadata)===null||t===void 0?void 0:t.displayText)!==null&&i!==void 0?i:"";const d=(l=(a=(n=(o=r.customProperties)===null||o===void 0?void 0:o.canStartWorkflow)!==null&&n!==void 0?n:(e=r===null||r===void 0?void 0:r.customProperties)===null||e===void 0?void 0:e.CanStartWorkflow)!==null&&a!==void 0?a:r.canStartWorkflow)!==null&&l!==void 0?l:false;const u=`${c}`;return s("div",{key:u},s(f,{fieldId:"ActivityId",label:this.strings.activityId,hint:this.strings.activityHint},s("input",{type:"text",name:"ActivityId",id:"ActivityId",value:c,onChange:t=>this.onActivityIdChanged(t)})),s(f,{fieldId:"ActivityDisplayText",label:this.strings.activityDisplayText,hint:this.strings.activityDisplayHint},s("input",{type:"text",name:"ActivityDisplayText",id:"ActivityDisplayText",value:h,onChange:t=>this.onActivityDisplayTextChanged(t)})),s(p,{fieldId:"CanStartWorkflow",label:this.strings.activityCanStartWorkflow,hint:this.strings.activityCanStartWorkflowHint},s("input",{type:"checkbox",name:"CanStartWorkflow",id:"CanStartWorkflow",value:"true",checked:d,onChange:t=>this.onCanStartWorkflowChanged(t)})))};this.renderInputTab=()=>{console.log("renderInputTab");const{activity:t,inputs:i}=this.renderContext;const o=t.id;const n=`${o}`;return s("div",{key:n},i.filter((t=>!!t.inputControl)).map((i=>{const o=`${t.id}-${i.inputContext.inputDescriptor.name}`;console.log(o);return s("div",{key:o},i.inputControl)})))};this.renderOutputTab=()=>{const{activity:t,activityDescriptor:i}=this.renderContext;const o=i.outputs;const e=this.variables||[];const l=t.id;const r=`${l}`;const c=[null];if(e.length>0){c.push({label:"Variables",items:[...e.map((t=>({value:t.id,name:t.name})))],kind:"variable"})}return s("div",{key:r},o.map((i=>{var o;const e=`${t.id}-${i.name}`;const l=a(i.displayName)?i.name:i.displayName;const r=n.camelCase(i.name);const h=t[r];const d=i.typeName;const u=w.variableDescriptors.find((t=>t.typeName==d));const v=(o=u===null||u===void 0?void 0:u.displayName)!==null&&o!==void 0?o:d;return s("div",{key:e},s(f,{fieldId:e,label:l,hint:i.description},s("div",{class:"tw-relative"},s("select",{onChange:t=>this.onOutputPropertyEditorChanged(i,t.currentTarget.value)},c.map((t=>{var i;if(!t){return s("option",{value:"",selected:!((i=h===null||h===void 0?void 0:h.memoryReference)===null||i===void 0?void 0:i.id)},"-")}const o=t.items;return s("optgroup",{label:t.label},o.map((i=>{var o;const n=((o=h===null||h===void 0?void 0:h.memoryReference)===null||o===void 0?void 0:o.id)==i.value;return s("option",{value:`${t.kind}::${i.value}`,selected:n},i.name)})))}))),s("div",{class:"tw-pointer-events-none tw-absolute tw-inset-y-0 tw-right-0 tw-flex tw-items-center pr-10"},s("span",{class:"tw-text-gray-500 sm:tw-text-sm"},v)))))})))};this.renderTaskTab=()=>{var t,i,o;const{activity:n}=this.renderContext;const e=n.id;const a=(o=(i=(t=n.customProperties)===null||t===void 0?void 0:t.RunAsynchronously)!==null&&i!==void 0?i:n.runAsynchronously)!==null&&o!==void 0?o:false;const l=`${e}:task`;return s("div",{key:l},s(p,{fieldId:"RunAsynchronously",label:this.strings.taskExecuteAsynchronously,hint:this.strings.taskExecuteAsynchronouslyHint},s("input",{type:"checkbox",name:"RunAsynchronously",id:"RunAsynchronously",value:"true",checked:a,onChange:t=>this.onRunAsynchronouslyChanged(t)})))};this.workflowDefinitionId=undefined;this.activity=undefined;this.variables=[];this.outputs=[];this.isReadonly=undefined;this.selectedTabIndex=0;this.inputDriverRegistry=l.get(r);this.eventBus=l.get(c)}async show(){await this.slideOverPanel.show()}async hide(){await this.slideOverPanel.hide()}async componentWillRender(){var t,i;this.strings=await m(this.element);const s=this.activity;const o=this.findActivityDescriptor();const n=(i=(t=o===null||o===void 0?void 0:o.displayName)!==null&&t!==void 0?t:o===null||o===void 0?void 0:o.typeName)!==null&&i!==void 0?i:"Unknown Activity";const e=this.createInputs();const a=this.createTabs();const l=()=>this.activityUpdated.emit({activity:s,activityDescriptor:o});this.renderContext={activity:s,activityDescriptor:o,title:n,inputs:e,tabs:a,notifyActivityChanged:()=>l()};await this.eventBus.emit(h.Displaying,this,this.renderContext)}render(){const{activity:t,activityDescriptor:i,tabs:o}=this.renderContext;const n=[];const e=t.id;const a=i.displayName;const l=this.getSelectedTabIndex(o);return s("elsa-form-panel",{isReadonly:this.isReadonly,mainTitle:e,subTitle:a,orientation:"Landscape",tabs:o,selectedTabIndex:l,onSelectedTabIndexChanged:t=>this.onSelectedTabIndexChanged(t),actions:n})}onActivityDisplayTextChanged(t){const i=this.activity;const s=t.target;i.metadata=Object.assign(Object.assign({},i.metadata),{displayText:s.value});this.updateActivity()}onCanStartWorkflowChanged(t){const i=this.activity;const s=t.target;i.customProperties.canStartWorkflow=s.checked;this.updateActivity()}onRunAsynchronouslyChanged(t){const i=this.activity;const s=t.target;i.customProperties.RunAsynchronously=s.checked;this.updateActivity()}get element(){return o(this)}};const x=class{constructor(s){t(this,s);this.autoLayout=i(this,"autoLayout",7);this.zoomToFit=undefined}render(){const t=[{text:"Horizontally",handler:()=>this.autoLayout.emit("LR")},{text:"Vertically",handler:()=>this.autoLayout.emit("TB")}];return s("div",{class:"elsa-panel-toolbar tw-flex tw-justify-center tw-absolute tw-border-b tw-border-gray-200 tw-top-0 tw-px-1 tw-pl-4 tw-pb-2 tw-text-sm tw-bg-white tw-z-10 tw-space-x-2"},s("elsa-dropdown-button",{text:"Auto-layout",theme:"Primary",items:t,class:"tw-mt-2"}),s("button",{onClick:this.zoomToFit,class:"elsa-btn elsa-btn-primary"},"Zoom to fit"))}};const C=class{constructor(i){t(this,i);this.onTabSelected=(t,i)=>{t.preventDefault();this.selectedTabIndex=i};this.graph=undefined;this.isReadonly=undefined;this.selectedTabIndex=0}render(){const t=this.selectedTabIndex;const i="tw-border-blue-500 tw-text-blue-600";const o="tw-border-transparent tw-text-gray-500 hover:tw-text-gray-700 hover:tw-border-gray-300";const n=t==0?i:o;return s("div",{class:"activity-list tw-absolute tw-inset-0 tw-overflow-hidden"},s("div",{class:"tw-h-full tw-flex tw-flex-col"},s("div",{class:"tw-border-b tw-border-gray-200"},s("nav",{class:"-tw-mb-px tw-flex","aria-label":"Tabs"},s("a",{href:"#",onClick:t=>this.onTabSelected(t,0),class:`${n} tw-w-1/2 tw-py-4 tw-px-1 tw-text-center tw-border-b-2 tw-font-medium tw-text-sm`},"Activities"))),s("div",{class:"tw-flex-1 tw-relative"},s("div",{class:"tw-absolute tw-inset-0 tw-overflow-y-scroll"},s("elsa-workflow-definition-editor-toolbox-activities",{isReadonly:this.isReadonly,graph:this.graph,class:t==0?"":"hidden"})))))}};const I=class{constructor(o){t(this,o);this.workflowPropsUpdated=i(this,"workflowPropsUpdated",7);this.versionSelected=i(this,"versionSelected",7);this.deleteVersionClicked=i(this,"deleteVersionClicked",7);this.revertVersionClicked=i(this,"revertVersionClicked",7);this.createModel=async()=>{var t,i,o;const n={tabModels:[]};const e=this.workflowDefinition;const l=e.options||{};const r=(t=l.autoUpdateConsumingWorkflows)!==null&&t!==void 0?t:false;const c=(i=l.usableAsActivity)!==null&&i!==void 0?i:false;if(!e){this.model=n;return}const h={name:"properties",tab:null,Widgets:[{name:"workflowName",content:()=>{const t=this.workflowDefinition;return s(f,{label:this.strings.propertiesWorkflowName,fieldId:"workflowName",hint:this.strings.propertiesWorkflowNameHint},s("input",{type:"text",name:"workflowName",id:"workflowName",value:t.name,onChange:t=>this.onPropertyEditorChanged((i=>i.name=t.target.value))}))},order:0},{name:"workflowDescription",content:()=>{const t=this.workflowDefinition;return s(f,{label:this.strings.propertiesWorkflowDescription,fieldId:"workflowDescription",hint:this.strings.propertiesWorkflowDescriptionHint},s("textarea",{name:"workflowDescription",id:"workflowDescription",value:t.description,rows:6,onChange:t=>this.onPropertyEditorChanged((i=>i.description=t.target.value))}))},order:5},{name:"workflowInfo",content:()=>{const t=this.workflowDefinition;const i={[this.strings.propertiesDefitionId]:a(t.definitionId)?this.strings.propertiesNew:t.definitionId,[this.strings.propertiesVersionId]:a(t.id)?this.strings.propertiesNew:t.id,[this.strings.propertiesVersion]:t.version.toString(),[this.strings.propertiesStatus]:t.isPublished?this.strings.propertiesPublished:this.strings.propertiesDraft,[this.strings.propertiesReadOnly]:t.isReadonly?this.strings.propertiesYes:this.strings.propertiesNo};return s(b,{title:"Information",dictionary:i})},order:10}]};h.tab={displayText:this.strings.propertiesTab,order:0,content:()=>this.renderPropertiesTab(h)};const d={name:"variables",tab:{displayText:this.strings.variablesTab,order:5,content:()=>this.renderVariablesTab()}};const v=w.workflowActivationStrategyDescriptors;const y=v.length>0?v[0]:null;const m=(o=y===null||y===void 0?void 0:y.description)!==null&&o!==void 0?o:"";const k=[{name:"workflowActivationValidator",order:0,content:()=>s(f,{label:this.strings.settingsActivitationStrategy,fieldId:"workflowActivationStrategyType",hint:m},s("select",{name:"workflowActivationStrategyType",onChange:t=>this.onPropertyEditorChanged((i=>{const s=t.target;l.activationStrategyType=s.value;i.options=l;const o=s.closest(".form-entry").getElementsByClassName("form-field-hint")[0];const n=v.find((t=>t.typeName==s.value));o.innerText=n.description}))},v.map((t=>s("option",{value:t.typeName,selected:t.typeName==l.activationStrategyType},t.displayName)))))},{name:"usableAsActivity",order:0,content:()=>s(p,{label:this.strings.settingsUsableAsActivity,fieldId:"UsableAsActivity",hint:this.strings.settingsUsableAsActivityHint},s("input",{type:"checkbox",id:"UsableAsActivity",name:"UsableAsActivity",checked:c,onChange:t=>this.onPropertyEditorChanged((i=>{const s=t.target;i.options.usableAsActivity=s.checked;this.createModel()}))}))},{name:"autoUpdateConsumingWorkflows",order:0,content:()=>s(p,{fieldId:"UpdateConsumingWorkflows",label:this.strings.settingsAutoUpdateConsumingWorkflows,hint:this.strings.settingsAutoUpdateConsumingWorkflowsHint},s("input",{type:"checkbox",name:"UpdateConsumingWorkflows",id:"UpdateConsumingWorkflows",checked:r,onChange:t=>this.onPropertyEditorChanged((i=>{const s=t.target;l.autoUpdateConsumingWorkflows=s.checked;i.options=l}))}))}];const g={name:"settings",tab:{displayText:this.strings.settingsTab,order:10,content:()=>s("elsa-widgets",{widgets:k})}};const x={name:"input-output",tab:{displayText:this.strings.inputOutputTab,order:15,content:()=>this.renderInputOutputTab()}};const C={name:"versionHistory",tab:{displayText:this.strings.versionHistoryTab,order:20,content:()=>this.renderVersionHistoryTab()}};n.tabModels=[h,d,g,C,x];const I={workflowDefinition:e,model:n,notifyWorkflowDefinitionChanged:()=>this.onWorkflowDefinitionUpdated()};await this.eventBus.emit(u.Displaying,this,I);this.model=n};this.renderPropertiesTab=t=>s("elsa-widgets",{widgets:t.Widgets});this.renderVariablesTab=()=>{var t,i;const o=(i=(t=this.workflowDefinition)===null||t===void 0?void 0:t.variables)!==null&&i!==void 0?i:[];return s("div",null,s("elsa-variables-editor",{variables:o,onVariablesChanged:t=>this.onVariablesUpdated(t)}))};this.renderInputOutputTab=()=>{var t,i,o,n,e,a;const l=(i=(t=this.workflowDefinition)===null||t===void 0?void 0:t.inputs)!==null&&i!==void 0?i:[];const r=(n=(o=this.workflowDefinition)===null||o===void 0?void 0:o.outputs)!==null&&n!==void 0?n:[];const c=(a=(e=this.workflowDefinition)===null||e===void 0?void 0:e.outcomes)!==null&&a!==void 0?a:[];return s("div",null,s("elsa-workflow-definition-input-output-settings",{inputs:l,outputs:r,outcomes:c,onInputsChanged:t=>this.onInputsUpdated(t),onOutputsChanged:t=>this.onOutputsUpdated(t),onOutcomesChanged:t=>this.onOutcomesUpdated(t)}))};this.renderVersionHistoryTab=()=>s("div",null,s("elsa-workflow-definition-version-history",{selectedVersion:this.workflowDefinition,workflowVersions:this.workflowVersions}));this.onSelectedTabIndexChanged=t=>this.selectedTabIndex=t.detail.selectedTabIndex;this.onPropertyEditorChanged=t=>{const i=this.workflowDefinition;t(i);this.workflowPropsUpdated.emit({workflowDefinition:i})};this.onVariablesUpdated=async t=>this.onPropsUpdated("variables",t.detail);this.onInputsUpdated=async t=>this.onPropsUpdated("inputs",t.detail);this.onOutputsUpdated=async t=>this.onPropsUpdated("outputs",t.detail);this.onOutcomesUpdated=async t=>this.onPropsUpdated("outcomes",t.detail);this.onPropsUpdated=async(t,i)=>{const s=this.workflowDefinition;if(!s||!s.isLatest){console.debug("onPropsUpdated: workflowDefinition is not latest");return}s[t]=i;const o=this.getPropEditorSectionByPropName(t);this.workflowPropsUpdated.emit({workflowDefinition:s,updatedTab:o});await this.createModel()};this.onWorkflowDefinitionUpdated=()=>{const t=this.workflowDefinition;this.workflowPropsUpdated.emit({workflowDefinition:t})};this.workflowDefinition=undefined;this.workflowVersions=undefined;this.readonly=undefined;this.model=undefined;this.selectedTabIndex=0;this.eventBus=l.get(c);this.workflowDefinitionApi=l.get(v);this.model={tabModels:[]}}async show(){await this.slideOverPanel.show()}async hide(){await this.slideOverPanel.hide()}async onWorkflowDefinitionChanged(){await this.createModel()}async onWorkflowVersionsChanged(){await this.createModel()}async componentWillLoad(){this.strings=await m(this.element);await this.createModel()}render(){var t;const i=this.workflowDefinition;const o=(t=i===null||i===void 0?void 0:i.name)!==null&&t!==void 0?t:"Untitled";const n="Workflow Definition";const e=this.model.tabModels.map((t=>t.tab));return s("elsa-form-panel",{isReadonly:this.readonly,mainTitle:o,subTitle:n,tabs:e,selectedTabIndex:this.selectedTabIndex,onSelectedTabIndexChanged:t=>this.onSelectedTabIndexChanged(t)})}getPropEditorSectionByPropName(t){const i=Object.keys(k).find((i=>k[i]===t));if(i){return k[i]}return null}get element(){return o(this)}static get watchers(){return{workflowDefinition:["onWorkflowDefinitionChanged"],workflowVersions:["onWorkflowVersionsChanged"]}}};export{g as elsa_activity_properties_editor,x as elsa_workflow_definition_editor_toolbar,C as elsa_workflow_definition_editor_toolbox,I as elsa_workflow_definition_properties_editor};
//# sourceMappingURL=p-80679998.entry.js.map