{"version":3,"file":"label-picker.js","sourceRoot":"","sources":["../../../src/modules/labels/label-picker.tsx"],"names":[],"mappings":"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","sourcesContent":["import {Component, h, Listen, Prop, State, Element, Event, EventEmitter, Watch} from \"@stencil/core\";\r\nimport {TinyColor} from \"@ctrl/tinycolor\";\r\nimport {debounce} from 'lodash';\r\nimport {leave, toggle, enter} from 'el-transition';\r\nimport {Label} from \"./models\";\r\nimport labelStore from './label-store';\r\nimport {Badge} from \"../../components/shared/badge/badge\";\r\nimport {ConfigIcon} from \"../../components/icons/tooling/config\";\r\nimport {TickIcon} from \"../../components/icons/tooling/tick\";\r\nimport {isNullOrWhitespace} from \"../../utils\";\r\n\r\n@Component({\r\n  tag: 'elsa-label-picker',\r\n  shadow: false,\r\n})\r\nexport class LabelPicker {\r\n  @Element() private element: HTMLElement;\r\n  private searchTextElement: HTMLInputElement;\r\n  private flyoutPanel: HTMLElement;\r\n  private readonly filterLabelsDebounced: () => void;\r\n\r\n  constructor() {\r\n    this.filterLabelsDebounced = debounce(this.filterLabels, 200);\r\n    this.filteredLabels = labelStore.labels;\r\n  }\r\n\r\n  @Prop() public selectedLabels: Array<string> = [];\r\n  @Prop() public buttonClass?: string = 'tw-text-blue-500 hover:tw-text-blue-300';\r\n  @Prop() public containerClass?: string;\r\n\r\n  @Event() public selectedLabelsChanged: EventEmitter<Array<string>>;\r\n\r\n  @State() private selectedLabelsState: Array<string> = [];\r\n  @State() private searchText?: string;\r\n  @State() private filteredLabels: Array<Label>;\r\n\r\n  @Listen('click', {target: 'window'})\r\n  private onWindowClicked(event: Event) {\r\n    const target = event.target as HTMLElement;\r\n\r\n    if (!this.element.contains(target))\r\n      this.closeFlyoutPanel();\r\n  }\r\n\r\n  public render() {\r\n    const selectedLabels = this.getFilteredSelectedLabels();\r\n\r\n    return <div class={`tw-flex ${this.containerClass}`}>\r\n      <div class=\"tw-flex tw-flex-grow\">\r\n        {selectedLabels.map(this.renderLabel)}\r\n      </div>\r\n      <div class=\"tw-relative\">\r\n        <button onClick={e => this.toggleFlyoutPanel()} class={this.buttonClass}>\r\n          <ConfigIcon/>\r\n        </button>\r\n        {this.renderFlyout()}\r\n      </div>\r\n    </div>\r\n  }\r\n\r\n  private renderFlyout = () => {\r\n    const selectedLabels = this.selectedLabels;\r\n    const labels = this.filteredLabels;\r\n    const searchText = this.searchText;\r\n\r\n    return <div ref={el => this.flyoutPanel = el} class=\"tw-absolute tw-z-10 tw-right-0 tw-transform tw-mt-3 tw-px-2 tw-w-screen tw-max-w-md tw-px-0 hidden\"\r\n                data-transition-enter=\"tw-transition tw-ease-out tw-duration-200\"\r\n                data-transition-enter-start=\"tw-opacity-0 tw-translate-y-1\"\r\n                data-transition-enter-end=\"tw-opacity-100 tw-translate-y-0\"\r\n                data-transition-leave=\"tw-transition tw-ease-in tw-duration-150\"\r\n                data-transition-leave-start=\"tw-opacity-100 tw-translate-y-0\"\r\n                data-transition-leave-end=\"tw-opacity-0 tw-translate-y-1\"\r\n    >\r\n      <div class=\"tw-rounded-lg tw-shadow-lg tw-ring-1 tw-ring-black tw-ring-opacity-5 tw-overflow-hidden\">\r\n        <div class=\"tw-mx-auto tw-max-w-3xl tw-transform tw-divide-y tw-divide-gray-100 tw-overflow-hidden tw-rounded-xl tw-bg-white tw-shadow-2xl tw-ring-1 tw-ring-black tw-ring-opacity-5 tw-transition-all tw-opacity-100 tw-scale-100\">\r\n          <div class=\"tw-relative\">\r\n            <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" aria-hidden=\"true\" class=\"tw-pointer-events-none tw-absolute top-3.5 left-4 tw-h-5 tw-w-5 tw-text-gray-400\">\r\n              <path fill-rule=\"evenodd\" d=\"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z\" clip-rule=\"evenodd\"/>\r\n            </svg>\r\n            <input class=\"tw-h-12 tw-w-full tw-border-0 tw-bg-transparent tw-pl-11 tw-pr-4 tw-text-gray-800 tw-placeholder-gray-400 focus:tw-ring-0 sm:tw-text-sm\"\r\n                   placeholder=\"Search...\"\r\n                   role=\"combobox\"\r\n                   type=\"text\"\r\n                   ref={el => this.searchTextElement = el}\r\n                   onInput={e => this.onSearchTextChanged(e)}\r\n                   value={searchText}/></div>\r\n\r\n          <ul class=\"tw-max-h-96 tw-scroll-py-3 tw-overflow-y-auto tw-p-1\" role=\"listbox\">\r\n            {labels.map(label => {\r\n\r\n              const color = new TinyColor(label.color).lighten(40).toHexString();\r\n              const colorStyle = {backgroundColor: color};\r\n              const isSelected = !!selectedLabels.find(x => x == label.id);\r\n\r\n              return (\r\n                <li role=\"option\" tab-index=\"-1\">\r\n                  <a class=\"tw-block tw-select-none tw-rounded-xl tw-p-3 tw-bg-white hover:tw-bg-gray-100\" href=\"#\" onClick={e => this.onLabelClick(e, label)}>\r\n                    <div class=\"tw-flex tw-justify-start tw-gap-1.5\">\r\n                      <div class=\"tw-flex-none tw-w-8\">\r\n                        {isSelected ? <TickIcon/> : undefined}\r\n                      </div>\r\n                      <div class=\"tw-flex-grow \">\r\n                        <div class=\"tw-flex tw-gap-1.5\">\r\n                          <div class=\"tw-flex-shrink-0 tw-flex tw-flex-col tw-justify-center \">\r\n                            <div class=\"tw-w-4 tw-h-4 tw-rounded-full\" style={colorStyle} aria-hidden=\"true\"/>\r\n                          </div>\r\n                          <div class=\"tw-flex-grow\">\r\n                            <p class=\"tw-text-sm tw-font-medium tw-text-gray-900 tw-font-bold\">{label.name}</p>\r\n                          </div>\r\n                        </div>\r\n                        <div>\r\n                          <p class=\"tw-text-sm tw-font-normal tw-text-gray-500\">{label.description}</p>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </a>\r\n                </li>\r\n              );\r\n            })}\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    </div>;\r\n  };\r\n\r\n  private renderLabel = (labelId: string) => {\r\n    const label = labelStore.labels.find(x => x.id == labelId);\r\n    return <div class=\"tw-mr-2\">\r\n      <Badge text={label.name} color={label.color}/>\r\n    </div>\r\n  };\r\n\r\n  private closeFlyoutPanel = () => {\r\n    if (!!this.flyoutPanel)\r\n      leave(this.flyoutPanel);\r\n  };\r\n\r\n  private toggleFlyoutPanel = () => {\r\n    this.filterLabelsDebounced();\r\n    this.searchText = null;\r\n    toggle(this.flyoutPanel);\r\n\r\n    if (!!this.searchTextElement)\r\n      this.searchTextElement.value = '';\r\n      this.searchTextElement.focus();\r\n  };\r\n\r\n  private filterLabels = () => {\r\n    const searchText = this.searchText;\r\n\r\n    if (isNullOrWhitespace(searchText)) {\r\n      this.filteredLabels = labelStore.labels;\r\n      return;\r\n    }\r\n\r\n    const s = searchText.toLocaleLowerCase();\r\n    this.filteredLabels = labelStore.labels.filter(x => x.name.toLocaleLowerCase().includes(s) || x.description.toLocaleLowerCase().includes(s));\r\n  };\r\n\r\n  private getFilteredSelectedLabels = (): Array<string> => {\r\n    const labels = labelStore.labels;\r\n    return this.selectedLabels.filter(labelId => !!labels.find(x => x.id == labelId));\r\n  };\r\n\r\n  private onLabelClick = (e: Event, label: Label) => {\r\n    if (!this.selectedLabels.find(x => x == label.id))\r\n      this.selectedLabels = [...this.selectedLabels, label.id];\r\n    else\r\n      this.selectedLabels = this.selectedLabels.filter(x => x != label.id);\r\n\r\n    const selectedLabels = this.getFilteredSelectedLabels();\r\n    this.selectedLabels = selectedLabels;\r\n    this.selectedLabelsChanged.emit(selectedLabels);\r\n  };\r\n\r\n  private onSearchTextChanged = (e: Event) => {\r\n    const value = (e.target as HTMLInputElement).value.trim();\r\n    this.searchText = value;\r\n\r\n    this.filterLabelsDebounced();\r\n  };\r\n}\r\n\r\n\r\n"]}