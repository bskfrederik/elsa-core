{"version":3,"file":"toolbox-activities.js","sourceRoot":"","sources":["../../../../src/modules/workflow-definitions/components/toolbox-activities.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Element, h, Prop, State, Watch } from '@stencil/core';\nimport { Addon, Graph } from '@antv/x6';\nimport groupBy from 'lodash/groupBy';\nimport uniqBy from 'lodash/uniqBy';\nimport { Container } from 'typedi';\nimport { ActivityDescriptor } from '../../../models';\nimport descriptorsStore from '../../../data/descriptors-store';\nimport { ActivityDescriptorManager, ActivityDriverRegistry } from '../../../services';\nimport { getLocaleComponentStrings } from '../../../utils/locale';\n\ninterface ActivityCategoryModel {\n  category: string;\n  activities: Array<ActivityDescriptor>;\n  expanded: boolean;\n}\n\n@Component({\n  tag: 'elsa-workflow-definition-editor-toolbox-activities',\n})\nexport class ToolboxActivities {\n  @Prop() graph: Graph;\n  @Prop() isReadonly: boolean;\n  private dnd: Addon.Dnd;\n  @State() private expandedCategories: Array<string> = [];\n\n  @State() private categoryModels: Array<any> = [];\n  @State() private renderedActivities: any = [];\n\n  @Element() element: HTMLElement;\n  strings!: any;\n\n  @Watch('graph')\n  handleGraphChanged(value: Graph) {\n    if (this.dnd) this.dnd.dispose();\n\n    this.dnd = new Addon.Dnd({\n      target: value,\n      scaled: false,\n      animation: true,\n    });\n  }\n\n  async componentWillLoad() {\n    this.strings = await getLocaleComponentStrings(this.element);\n    const activityDescriptorManager = Container.get(ActivityDescriptorManager);\n    activityDescriptorManager.onActivityDescriptorsUpdated(this.buildModel);\n\n    this.buildModel();\n  }\n\n  private static onActivityStartDrag(e: DragEvent, activityDescriptor: ActivityDescriptor) {\n    const json = JSON.stringify(activityDescriptor);\n    e.dataTransfer.setData('activity-descriptor', json);\n  }\n\n  private onToggleActivityCategory(categoryModel: ActivityCategoryModel) {\n    const category = categoryModel.category;\n    const expandedCategories = this.expandedCategories;\n    const isExpanded = !!expandedCategories.find(x => x == category);\n\n    if (isExpanded) this.expandedCategories = expandedCategories.filter(x => x != category);\n    else this.expandedCategories = [...expandedCategories, category];\n    categoryModel.expanded = !categoryModel.expanded;\n  }\n\n  buildModel = (searchVal: string = ''): any => {\n    let browsableDescriptors = uniqBy(\n      descriptorsStore.activityDescriptors.filter(x => x.isBrowsable !== false).sort((a, b) => (a.version > b.version ? 1 : -1)),\n      x => `${x.typeName}:${x.version}`,\n    );\n\n    if (searchVal) {\n      browsableDescriptors = browsableDescriptors.filter(activity => activity.displayName.toLocaleLowerCase().includes(searchVal.toLocaleLowerCase()));\n    }\n\n    const categorizedActivitiesLookup = groupBy(browsableDescriptors, x => x.category);\n    const categories = Object.keys(categorizedActivitiesLookup).sort((a, b) => a.localeCompare(b));\n    const renderedActivities: Map<string, string> = new Map<string, string>();\n\n    // Group activities by category\n    const activityCategoryModels = categories.map(x => {\n      const model: ActivityCategoryModel = {\n        category: x,\n        expanded: !!this.expandedCategories.find(c => c == x),\n        activities: categorizedActivitiesLookup[x],\n      };\n\n      return model;\n    });\n\n    // Render activities.\n    const activityDriverRegistry = Container.get(ActivityDriverRegistry);\n\n    for (const activityDescriptor of browsableDescriptors) {\n      const activityType = activityDescriptor.typeName;\n      const driver = activityDriverRegistry.createDriver(activityType);\n      const html = driver.display({ displayType: 'picker', activityDescriptor: activityDescriptor });\n\n      renderedActivities.set(activityType, html);\n    }\n\n    this.categoryModels = activityCategoryModels;\n    this.renderedActivities = renderedActivities;\n\n    return {\n      categories: activityCategoryModels,\n      activities: renderedActivities,\n    };\n  };\n\n  filterActivities(ev: any) {\n    let val = ev.target?.value || '';\n    this.buildModel(val);\n  }\n\n  render() {\n    return (\n      <nav class=\"tw-flex-1 tw-px-2 tw-space-y-1 tw-font-sans tw-text-sm tw-text-gray-600\">\n        <input class=\"tw-my-1\" placeholder={this.strings.searchActivities} type=\"text\" name=\"activity-search\" id=\"activitySearch\" onInput={this.filterActivities.bind(this)} />\n\n        {this.categoryModels.map(categoryModel => {\n          const category = categoryModel.category;\n          const activityDescriptors: Array<ActivityDescriptor> = categoryModel.activities;\n          const categoryButtonClass = categoryModel.expanded ? 'tw-rotate-90' : '';\n          const categoryContentClass = categoryModel.expanded ? '' : 'hidden';\n\n          return (\n            <div class=\"tw-space-y-1\">\n              <button\n                type=\"button\"\n                onClick={() => this.onToggleActivityCategory(categoryModel)}\n                class=\"tw-text-gray-600 hover:tw-bg-gray-50 hover:tw-text-gray-900 tw-group tw-w-full tw-flex tw-items-center tw-pr-2 tw-py-2 tw-text-left tw-text-sm tw-font-medium tw-rounded-md focus:tw-outline-none\"\n              >\n                <svg\n                  class={`${categoryButtonClass} tw-text-gray-300 tw-mr-2 tw-flex-shrink-0 tw-h-5 tw-w-5 tw-transform group-hover:tw-text-gray-400 tw-transition-colors tw-ease-in-out tw-duration-150`}\n                  viewBox=\"0 0 20 20\"\n                  aria-hidden=\"true\"\n                >\n                  <path d=\"M6 6L14 10L6 14V6Z\" fill=\"currentColor\" />\n                </svg>\n                {category}\n              </button>\n\n              <div class={`tw-space-y-0.5 ${categoryContentClass}`}>\n                {activityDescriptors.map(activityDescriptor => {\n                  const activityHtml = this.renderedActivities.get(activityDescriptor.typeName);\n                  return (\n                    <div class=\"tw-w-full tw-flex tw-items-center tw-pl-10 tw-pr-2 tw-py-2\">\n                      <div class=\"tw-relative tw-cursor-move\" onDragStart={e => ToolboxActivities.onActivityStartDrag(e, activityDescriptor)}>\n                        <elsa-tooltip tooltipPosition=\"right\" tooltipContent={activityDescriptor.description}>\n                          <div innerHTML={activityHtml} draggable={!this.isReadonly} />\n                        </elsa-tooltip>\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            </div>\n          );\n        })}\n      </nav>\n    );\n  }\n}\n"]}