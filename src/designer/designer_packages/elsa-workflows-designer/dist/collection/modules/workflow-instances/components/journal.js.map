{"version":3,"file":"journal.js","sourceRoot":"","sources":["../../../../src/modules/workflow-instances/components/journal.tsx"],"names":[],"mappings":"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","sourcesContent":["import {Component, h, Prop, State, Watch, Event, EventEmitter, Method, Element} from \"@stencil/core\";\nimport {Activity, Workflow, WorkflowExecutionLogRecord, WorkflowInstance} from \"../../../models\";\nimport {Container} from \"typedi\";\nimport {ActivityIconRegistry, ActivityNode, flatten, walkActivities} from \"../../../services\";\nimport {durationToString, formatTime, getDuration, Hash, isNullOrWhitespace} from \"../../../utils\";\nimport {ActivityExecutionEventBlock, WorkflowJournalModel} from \"../models\";\nimport {ActivityIconSize} from \"../../../components/icons/activities\";\nimport {WorkflowInstancesApi} from \"../services/workflow-instances-api\";\nimport {JournalItemSelectedArgs} from \"../events\";\nimport { getLocaleComponentStrings } from \"../../../utils/locale\";\n\n// TODO: Implement dynamic loading of records.\nconst PAGE_SIZE: number = 10000;\n\n@Component({\n  tag: 'elsa-workflow-journal',\n  shadow: false,\n  styleUrl: 'journal.scss'\n})\nexport class Journal {\n  private readonly iconRegistry: ActivityIconRegistry;\n  private readonly workflowInstancesApi: WorkflowInstancesApi;\n\n  constructor() {\n    this.iconRegistry = Container.get(ActivityIconRegistry);\n    this.workflowInstancesApi = Container.get(WorkflowInstancesApi);\n  }\n\n  @Prop() model: WorkflowJournalModel;\n  @State() workflowExecutionLogRecords: Array<WorkflowExecutionLogRecord> = [];\n  @State() blocks: Array<ActivityExecutionEventBlock> = [];\n  @State() rootBlocks: Array<ActivityExecutionEventBlock> = [];\n  @State() expandedBlocks: Array<ActivityExecutionEventBlock> = [];\n  @State() journalActivityMap: Set<ActivityNode> = new Set<ActivityNode>();\n  @Event() journalItemSelected: EventEmitter<JournalItemSelectedArgs>;\n\n  @Watch('model')\n  async onWorkflowInstanceModelChanged(oldValue: WorkflowJournalModel, newValue: WorkflowJournalModel) {\n    if(oldValue.workflowInstance.id != newValue.workflowInstance.id)\n      await this.refresh();\n  }\n\n  @Element() element: HTMLElement;\n  strings!: any;\n\n  async componentWillLoad(): Promise<void> {\n    this.strings = await getLocaleComponentStrings(this.element);\n    await this.refresh();\n  }\n\n  @Method()\n  async refresh() {\n    this.rootBlocks = [];\n    await this.loadJournalPage(0);\n    this.createActivityMapForJournal();\n  }\n\n  render() {\n    return (\n\n      <div class=\"tw-absolute tw-inset-0 tw-overflow-hidden\">\n        <div class=\"tw-h-full tw-flex tw-flex-col tw-bg-white tw-shadow-xl\">\n          <div class=\"tw-flex tw-flex-col tw-flex-1\">\n\n            <div class=\"tw-px-4 tw-py-6 tw-bg-gray-50 sm:tw-px-6\">\n              <div class=\"tw-flex tw-items-start tw-justify-between tw-space-x-3\">\n                <div class=\"tw-space-y-1\">\n                  <h2 class=\"tw-text-lg tw-font-medium tw-text-gray-900\">\n                    {this.strings.worfklowJournal}\n                  </h2>\n                </div>\n              </div>\n            </div>\n\n            <div class=\"tw-flex-1 tw-relative\">\n              <div class=\"tw-absolute tw-inset-0 tw-overflow-y-scroll\">\n\n                <table class=\"workflow-journal-table\">\n                  <thead>\n                  <tr>\n                    <th class=\"tw-w-1\"/>\n                    <th>{this.strings.time}</th>\n                    <th class=\"tw-min-w-full\">{this.strings.activity}</th>\n                    <th>{this.strings.status}</th>\n                    <th>{this.strings.duration}</th>\n                  </tr>\n                  </thead>\n\n                  <tbody class=\"tw-bg-white tw-divide-y tw-divide-gray-100\">\n                  {this.renderBlocks(this.rootBlocks)}\n                  </tbody>\n                </table>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  private renderBlocks = (blocks: Array<ActivityExecutionEventBlock>) => {\n    const journalActivityMap = this.journalActivityMap;\n    const iconRegistry = this.iconRegistry;\n    const expandedBlocks = this.expandedBlocks;\n    const sortedBlocks = this.sortByTimestamp(blocks);\n\n    return sortedBlocks.map((block) => {\n      const activityNode = journalActivityMap[block.nodeId];\n\n      if (activityNode == null)\n        debugger\n\n      const activity = activityNode.activity;\n\n      if (activity.type == \"Elsa.Workflow\" || activity.type == \"Elsa.Flowchart\")\n        return this.renderBlocks(block.children);\n\n      const activityMetadata = activity.metadata;\n      const activityDisplayText = isNullOrWhitespace(activityMetadata.displayText) ? activity.id : activityMetadata.displayText;\n      const duration = durationToString(block.duration);\n      const status = block.completed ? 'Completed' : block.suspended ? 'Suspended' : block.faulted ? 'Faulted' : 'Started';\n      const icon = iconRegistry.getOrDefault(activity.type)({size: ActivityIconSize.Small});\n      const expanded = !!expandedBlocks.find(x => x == block);\n      const statusColor = block.completed ? \"tw-bg-blue-100\" : block.faulted ? \"tw-bg-red-100\" : \"tw-bg-green-100\";\n\n      const toggleIcon = expanded\n        ? (\n          <svg class=\"tw-h-6 tw-w-6 tw-text-gray-500\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <path stroke=\"none\" d=\"M0 0h24v24H0z\"/>\n            <rect x=\"4\" y=\"4\" width=\"16\" height=\"16\" rx=\"2\"/>\n            <line x1=\"9\" y1=\"12\" x2=\"15\" y2=\"12\"/>\n          </svg>\n        )\n        : (\n          <svg class=\"tw-h-6 tw-w-6 tw-text-gray-500\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n            <path stroke=\"none\" d=\"M0 0h24v24H0z\"/>\n            <rect x=\"4\" y=\"4\" width=\"16\" height=\"16\" rx=\"2\"/>\n            <line x1=\"9\" y1=\"12\" x2=\"15\" y2=\"12\"/>\n            <line x1=\"12\" y1=\"9\" x2=\"12\" y2=\"15\"/>\n          </svg>\n        );\n\n      return (\n        [<tr>\n          <td class=\"tw-w-1\">\n            {block.children.length > 0 ? (<a href=\"#\" onClick={e => this.onBlockClick(e, block)}>\n              {toggleIcon}\n            </a>) : undefined}\n          </td>\n          <td>\n            <a href=\"#\" onClick={e => this.onJournalItemClick(e, block, activity)}>{formatTime(block.timestamp)}</a>\n          </td>\n          <td class=\"tw-min-w-full\">\n            <div class=\"tw-flex tw-items-center tw-space-x-1\">\n              <div class=\"tw-flex-shrink\">\n                <div class=\"tw-bg-blue-500 tw-rounded tw-p-1\">\n                  <a href=\"#\" onClick={e => this.onJournalItemClick(e, block, activity)}>{icon}</a>\n                </div>\n              </div>\n              <div><a href=\"#\" onClick={e => this.onJournalItemClick(e, block, activity)}>{activityDisplayText}</a></div>\n            </div>\n          </td>\n          <td>\n            <a href=\"#\" onClick={e => this.onJournalItemClick(e, block, activity)} class={`tw-inline-flex tw-rounded-full ${statusColor} tw-px-2 tw-text-xs tw-font-semibold tw-leading-5 tw-text-green-800`}>{status}</a>\n          </td>\n          <td><a href=\"#\" onClick={e => this.onJournalItemClick(e, block, activity)}>{duration}</a></td>\n        </tr>, expanded ? this.renderBlocks(block.children) : undefined]\n      );\n    }).filter(x => !!x);\n  }\n\n  private loadJournalPage = async (page: number): Promise<void> => {\n    if (!this.model)\n      return;\n\n    const workflowInstance = this.model.workflowInstance;\n    const workflowInstanceId = workflowInstance.id;\n    const pageOfRecords = await this.workflowInstancesApi.getJournal({page, pageSize: PAGE_SIZE, workflowInstanceId: workflowInstanceId});\n    const blocks = this.createBlocks(pageOfRecords.items);\n    const rootBlocks = blocks.filter(x => !x.parentActivityInstanceId);\n    this.workflowExecutionLogRecords = [...this.workflowExecutionLogRecords, ...pageOfRecords.items];\n    this.rootBlocks = rootBlocks;\n    this.blocks = this.sortByTimestamp(blocks);\n  }\n\n  private createBlocks = (records: Array<WorkflowExecutionLogRecord>): Array<ActivityExecutionEventBlock> => {\n    const startedEvents = records.filter(x => x.eventName == 'Started');\n    const completedEvents = records.filter(x => x.eventName == 'Completed');\n    const faultedEvents = records.filter(x => x.eventName == 'Faulted');\n    const suspendedEvents = records.filter(x => x.eventName == 'Suspended');\n\n    const blocks = startedEvents.map(startedRecord => {\n      const completedRecord = completedEvents.find(x => x.activityInstanceId == startedRecord.activityInstanceId);\n      const faultedRecord = faultedEvents.find(x => x.activityInstanceId == startedRecord.activityInstanceId);\n      const suspendedRecord = suspendedEvents.find(x => x.activityInstanceId == startedRecord.activityInstanceId);\n      const duration = !!completedRecord ? getDuration(completedRecord.timestamp, startedRecord.timestamp) : null;\n\n      return {\n        nodeId: startedRecord.nodeId,\n        activityId: startedRecord.activityId,\n        activityInstanceId: startedRecord.activityInstanceId,\n        parentActivityInstanceId: startedRecord.parentActivityInstanceId,\n        completed: !!completedRecord,\n        faulted: !!faultedRecord,\n        suspended: !!suspendedRecord,\n        timestamp: startedRecord.timestamp,\n        duration: duration,\n        startedRecord: startedRecord,\n        completedRecord: completedRecord,\n        faultedRecord: faultedRecord,\n        suspendedRecord: suspendedRecord,\n        children: []\n      };\n    });\n\n    for (const block of blocks)\n      block.children = this.findChildBlocks(blocks, block.activityInstanceId);\n\n    return blocks;\n  };\n\n  private findChildBlocks = (blocks: Array<ActivityExecutionEventBlock>, parentActivityInstanceId?: string): Array<ActivityExecutionEventBlock> => {\n    if (blocks.length == 0)\n      return [];\n\n    return !!parentActivityInstanceId\n      ? blocks.filter(x => x.parentActivityInstanceId == parentActivityInstanceId)\n      : blocks.filter(x => !x.parentActivityInstanceId);\n  }\n\n  private onBlockClick = (e: MouseEvent, block: ActivityExecutionEventBlock) => {\n    e.preventDefault();\n\n    const existingBlock = this.expandedBlocks.find(x => x == block);\n    this.expandedBlocks = existingBlock ? this.expandedBlocks.filter(x => x != existingBlock) : [...this.expandedBlocks, block];\n  };\n\n  private onJournalItemClick = async (e: MouseEvent, block: ActivityExecutionEventBlock, activity: Activity) => {\n    e.preventDefault();\n    this.journalItemSelected.emit({activity: activity, executionEventBlock: block, activityNode: this.journalActivityMap[block.nodeId]});\n  };\n\n  private sortByTimestamp(blocks: ActivityExecutionEventBlock[]) {\n    return blocks.sort(function (x, y) {\n      if (x.timestamp > y.timestamp)\n        return 1;\n      return -1;\n    });\n  }\n\n  private createActivityMapForJournal() {\n    const workflowDefinition = this.model.workflowDefinition;\n\n    // Create dummy root workflow to match structure of workflow execution log entries in order to generate the right node IDs.\n    const workflow: Workflow = {\n      type: 'Elsa.Workflow',\n      version: workflowDefinition.version,\n      id: \"Workflow1\",\n      root: workflowDefinition.root,\n      variables: workflowDefinition.variables,\n      metadata: {},\n      customProperties: {}\n    }\n\n    const graph = walkActivities(workflow);\n    const nodes = flatten(graph);\n    const map = new Set<ActivityNode>();\n\n    for (const node of nodes)\n      map[node.nodeId] = node;\n\n    this.journalActivityMap = map;\n    this.blocks = this.blocks.filter(x => !!map[x.nodeId]);\n  }\n}\n"]}