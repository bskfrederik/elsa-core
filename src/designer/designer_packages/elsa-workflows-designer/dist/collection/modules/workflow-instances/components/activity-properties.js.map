{"version":3,"file":"activity-properties.js","sourceRoot":"","sources":["../../../../src/modules/workflow-instances/components/activity-properties.tsx"],"names":[],"mappings":"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","sourcesContent":["import {Component, Element, h, Method, Prop, State, Watch} from '@stencil/core';\nimport {camelCase} from 'lodash';\nimport {\n  Activity,\n  ActivityDescriptor,\n  Lookup,\n  TabChangedArgs,\n  TabDefinition,\n  WorkflowExecutionLogRecord\n} from '../../../models';\nimport {InfoList} from \"../../../components/shared/forms/info-list\";\nimport descriptorsStore from \"../../../data/descriptors-store\";\nimport moment from 'moment';\nimport Container from 'typedi';\nimport { ActivityIconRegistry } from '../../../services';\nimport {ActivityIconSize} from \"../../../components/icons/activities\";\nimport { getLocaleComponentStrings } from '../../../utils/locale';\n\n@Component({\n  tag: 'elsa-activity-properties',\n})\nexport class ActivityProperties {\n  private slideOverPanel: HTMLElsaSlideOverPanelElement;\n  private readonly iconRegistry: ActivityIconRegistry;\n\n  constructor() {\n    this.iconRegistry = Container.get(ActivityIconRegistry);\n  }\n\n  @Prop({mutable: true}) public activity?: Activity;\n  @Prop() activityExecutionLog: WorkflowExecutionLogRecord;\n  @Prop() activityPropertyTabIndex?: number;\n  @State() private selectedTabIndex: number = 0;\n\n  @Element() element: HTMLElement;\n  strings!: any;\n\n  @Method()\n  async show(): Promise<void> {\n    await this.slideOverPanel.show();\n  }\n\n  @Method()\n  async hide(): Promise<void> {\n    await this.slideOverPanel.hide();\n  }\n\n  @Method()\n  async updateSelectedTab(tabIndex : number): Promise<void> {\n    this.selectedTabIndex = tabIndex;\n  }\n\n  @Watch('activity')\n\n\n  async componentWillLoad(): Promise<void> {\n    this.strings = await getLocaleComponentStrings(this.element);\n    console.log(this.strings);\n    if(this.activityPropertyTabIndex != null) {\n      this.selectedTabIndex = this.activityPropertyTabIndex;\n    }\n  }\n\n  render() {\n    const activity = this.activity;\n    const activityDescriptor = this.findActivityDescriptor();\n\n    const propertiesTab: TabDefinition = {\n      displayText: this.strings.propertiesTab,\n      content: () => this.renderPropertiesTab()\n    };\n\n    const commonTab: TabDefinition = {\n      displayText: this.strings.commonTab,\n      content: () => this.renderCommonTab()\n    };\n\n    const journalTab: TabDefinition = {\n      displayText: this.strings.journalTab,\n      content: () => this.renderJournalTab()\n    };\n\n    const tabs = !!activityDescriptor ? [propertiesTab, commonTab, journalTab] : [];\n    const mainTitle = activity.id;\n    const subTitle = activityDescriptor.displayName;\n\n    return (\n      <elsa-form-panel\n        mainTitle={mainTitle}\n        subTitle={subTitle}\n        tabs={tabs}\n        selectedTabIndex={this.selectedTabIndex}\n        onSelectedTabIndexChanged={e => this.onSelectedTabIndexChanged(e)}\n      />\n    );\n  }\n\n  private findActivityDescriptor = (): ActivityDescriptor => {\n    const activity = this.activity;\n\n    if(!activity) return null;\n\n    const descriptor = descriptorsStore.activityDescriptors.find(x => x.typeName == activity.type && x.version == activity.version);\n    return descriptor ?? descriptorsStore.activityDescriptors.sort((a, b) => b.version - a.version).find(x => x.typeName == this.activity.type);\n  };\n  private onSelectedTabIndexChanged = (e: CustomEvent<TabChangedArgs>) => this.selectedTabIndex = e.detail.selectedTabIndex\n\n  private renderPropertiesTab = () => {\n    const activity = this.activity;\n    const activityDescriptor = this.findActivityDescriptor();\n    const properties = activityDescriptor.inputs.filter(x => x.isBrowsable);\n    const activityId = activity.id;\n    const displayText: string = activity.metadata?.displayText ?? '';\n    const executionLogEntry = this.activityExecutionLog;\n    const activityState = executionLogEntry?.activityState ?? {};\n\n    const propertyDetails: Lookup<string> = {\n      [this.strings.propertiesTabActivityId]: activityId,\n      [this.strings.propertiesTabDisplayText]: displayText\n    };\n\n    for (const property of properties) {\n      const loggedPropName = property.name;\n      const propertyValue = activityState[loggedPropName];\n      const propertyValueText = (propertyValue !== null && typeof propertyValue === 'object') ? JSON.stringify(propertyValue) : (propertyValue != null ? propertyValue.toString() : '');\n      propertyDetails[property.displayName] = propertyValueText;\n    }\n\n    return <div>\n      <InfoList title={this.strings.propertiesTab} dictionary={propertyDetails}/>\n    </div>\n  };\n\n  private renderCommonTab = () => {\n    return <div>\n    </div>\n  };\n\n  private renderJournalTab = () => {\n    const log = this.activityExecutionLog;\n    if(log == null) return;\n\n    const exception = log.payload?.exception;\n    const statusColor = log.eventName == \"Completed\" ? \"tw-bg-blue-100\" : log.eventName == \"Faulted\" ? \"tw-bg-red-100\" : \"tw-bg-green-100\";\n    const icon = this.iconRegistry.getOrDefault(log.activityType)({size: ActivityIconSize.Small});\n    return (\n      <div class=\"tw-border-2 tw-cursor-pointer tw-p-4 tw-rounded\">\n        <div class=\"tw-relative tw-pb-10\">\n          <div class=\"tw-relative tw-flex tw-space-x-3\">\n            <div>\n              <span class={`tw-h-8 tw-w-8 tw-rounded tw-p-1 tw-bg-blue-500 tw-flex tw-items-center tw-justify-center tw-ring-8 tw-ring-white tw-mr-1`}>\n                {icon}\n              </span>\n            </div>\n            <div class=\"tw-min-w-0 tw-flex-1 tw-pt-1.5 tw-flex tw-justify-between tw-space-x-4\">\n              <div>\n                <h3 class=\"tw-text-lg tw-leading-6 tw-font-medium tw-text-gray-900\">\n                  {log.activityType}\n                </h3>\n              </div>\n              <div>\n                <span\n                  class={`tw-relative tw-inline-flex tw-items-center tw-rounded-full ${statusColor} tw-border tw-border-gray-300 tw-px-3 tw-py-0.5 tw-text-sm`}>\n                  <span class=\"tw-absolute tw-flex-shrink-0 tw-flex tw-items-center tw-justify-center\">\n                    <span class={`tw-h-1.5 tw-w-1.5 tw-rounded-full`} aria-hidden=\"true\"/>\n                  </span>\n                  <span class=\"tw-font-medium tw-text-gray-900\">{log.eventName}</span>\n                </span>\n              </div>\n              <div class=\"tw-text-right tw-text-sm tw-whitespace-nowrap tw-text-gray-500\">\n                <span>{moment(log.timestamp).format('DD-MM-YYYY HH:mm:ss')}</span>\n              </div>\n            </div>\n          </div>\n          <div class=\"tw-ml-12 tw-mt-2\">\n            <dl class=\"sm:tw-divide-y sm:tw-divide-gray-200\">\n              <div class=\"tw-grid tw-grid-cols-2 tw-gap-x-4 tw-gap-y-8 sm:tw-grid-cols-2\">\n                <div class=\"sm:tw-col-span-2\">\n                  <dt class=\"tw-text-sm tw-font-medium tw-text-gray-500\">\n                    <span>{this.strings.journalTabActivityId}</span>\n                    <copy-button value={log.activityId}/>\n                  </dt>\n                  <dd class=\"tw-mt-1 tw-text-sm tw-text-gray-900 tw-mb-2\">{log.activityId}</dd>\n                </div>\n                {!!exception ? (\n                  [<div class=\"sm:tw-col-span-2\">\n                    <dt class=\"tw-text-sm tw-font-medium tw-text-gray-500\">\n                      <span>{this.strings.journalTabException}</span>\n                      <copy-button value={exception.Type + '\\n' + exception.Message}/>\n                    </dt>\n                    <dd class=\"tw-mt-1 tw-text-sm tw-text-gray-900\">\n                      {exception.message}\n                    </dd>\n                  </div>,\n                    <div class=\"sm:tw-col-span-2\">\n                      <dt class=\"tw-text-sm tw-font-medium tw-text-gray-500\">\n                        <span>Exception Details</span>\n                        <copy-button value={JSON.stringify(exception, null, 1)}/>\n                      </dt>\n                      <dd class=\"tw-mt-1 tw-text-sm tw-text-gray-900 tw-overflow-x-auto\">\n                        <pre>{JSON.stringify(exception, null, 1)}</pre>\n                      </dd>\n                    </div>]\n                ) : undefined}\n              </div>\n            </dl>\n          </div>\n        </div>\n      </div>\n    )\n  };\n}\n"]}