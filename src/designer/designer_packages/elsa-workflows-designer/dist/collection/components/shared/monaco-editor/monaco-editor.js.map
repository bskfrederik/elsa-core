{"version":3,"file":"monaco-editor.js","sourceRoot":"","sources":["../../../../src/components/shared/monaco-editor/monaco-editor.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Event, EventEmitter, h, Host, Method, Prop, Watch } from '@stencil/core';\r\nimport { initializeMonacoWorker, Monaco, EditorVariables } from \"./utils\";\r\nimport monacoStore from '../../../data/monaco-store';\r\n\r\nexport interface MonacoValueChangedArgs {\r\n  value: string;\r\n  markers: Array<any>;\r\n}\r\n\r\n@Component({\r\n  tag: 'elsa-monaco-editor',\r\n  styleUrl: 'monaco-editor.scss',\r\n  shadow: false\r\n})\r\nexport class ElsaMonaco {\r\n  private monaco: Monaco;\r\n\r\n  @Prop({ attribute: 'editor-height', reflect: true }) editorHeight: string = '5em';\r\n  @Prop() value: string;\r\n  @Prop() language: string;\r\n  @Prop({ attribute: 'single-line', reflect: true }) singleLineMode: boolean = false;\r\n  @Prop() padding: string;\r\n  @Event({ eventName: 'valueChanged' }) valueChanged: EventEmitter<MonacoValueChangedArgs>;\r\n\r\n  container: HTMLElement;\r\n  editor: any;\r\n\r\n  @Watch('language')\r\n  async languageChangeHandler(newValue: string) {\r\n    if (!this.editor)\r\n      return;\r\n\r\n    const model = this.editor.getModel();\r\n    const monaco = await this.getMonaco();\r\n    monaco.editor.setModelLanguage(model, this.language);\r\n  }\r\n\r\n  @Method()\r\n  async setValue(value: string) {\r\n    if (!this.editor)\r\n      return;\r\n\r\n    const model = this.editor.getModel();\r\n    model.setValue(value || '');\r\n  }\r\n\r\n  @Method()\r\n  async addJavaScriptLib(libSource: string, libUri: string) {\r\n    const monaco = await this.getMonaco();\r\n\r\n    monaco.languages.typescript.javascriptDefaults.setExtraLibs([{\r\n      filePath: \"lib.es5.d.ts\"\r\n    }, {\r\n      content: libSource,\r\n      filePath: libUri\r\n    }]);\r\n\r\n    const oldModel = monaco.editor.getModel(libUri);\r\n\r\n    if (oldModel)\r\n      oldModel.dispose();\r\n\r\n    const newModel = monaco.editor.createModel(libSource, 'typescript', monaco.Uri.parse(libUri));\r\n    const matches = libSource.matchAll(/declare const (\\w+): (string|number)/g);\r\n\r\n    EditorVariables.splice(0, EditorVariables.length);\r\n\r\n    for(const match of matches) {\r\n      EditorVariables.push({variableName: match[1], type: match[2] });\r\n    }\r\n  }\r\n\r\n  async componentDidLoad() {\r\n    const monaco = await this.getMonaco();\r\n    const language = this.language;\r\n\r\n    // Validation settings.\r\n    monaco.languages.typescript.javascriptDefaults.setDiagnosticsOptions({\r\n      noSemanticValidation: true,\r\n      noSyntaxValidation: false,\r\n    });\r\n\r\n    // Compiler options.\r\n    monaco.languages.typescript.javascriptDefaults.setCompilerOptions({\r\n      target: monaco.languages.typescript.ScriptTarget.ES2020,\r\n      lib: [],\r\n      allowNonTsExtensions: true\r\n    });\r\n\r\n    monaco.languages.typescript.javascriptDefaults.setEagerModelSync(true);\r\n\r\n    const defaultOptions = {\r\n      value: this.value,\r\n      language: language,\r\n      fontFamily: \"Roboto Mono, monospace\",\r\n      renderLineHighlight: 'none',\r\n      minimap: {\r\n        enabled: false\r\n      },\r\n      automaticLayout: true,\r\n      lineNumbers: \"on\",\r\n      theme: \"vs\",\r\n      roundedSelection: true,\r\n      scrollBeyondLastLine: false,\r\n      readOnly: false,\r\n      overviewRulerLanes: 0,\r\n      overviewRulerBorder: false,\r\n      lineDecorationsWidth: 0,\r\n      hideCursorInOverviewRuler: true,\r\n      glyphMargin: false\r\n    };\r\n\r\n    let options = defaultOptions;\r\n\r\n    if (this.singleLineMode) {\r\n      options = {\r\n        ...defaultOptions, ...{\r\n          wordWrap: 'off',\r\n          lineNumbers: 'off',\r\n          lineNumbersMinChars: 0,\r\n          folding: false,\r\n          scrollBeyondLastColumn: 0,\r\n          scrollbar: { horizontal: 'hidden', vertical: 'hidden' },\r\n          find: { addExtraSpaceOnTop: false, autoFindInSelection: 'never', seedSearchStringFromSelection: false },\r\n        }\r\n      }\r\n    }\r\n\r\n    this.editor = monaco.editor.create(this.container, options);\r\n\r\n    this.editor.onDidChangeModelContent(e => {\r\n      const value = this.editor.getValue();\r\n      const markers = monaco.editor.getModelMarkers({ owner: language });\r\n      this.valueChanged.emit({ value: value, markers: markers });\r\n    });\r\n\r\n    if (this.singleLineMode) {\r\n      this.editor.onKeyDown(e => {\r\n        if (e.keyCode == monaco.KeyCode.Enter) {\r\n          // We only prevent enter when the suggest model is not active\r\n          if (this.editor.getContribution('editor.contrib.suggestController').model.state == 0) {\r\n            e.preventDefault();\r\n          }\r\n        }\r\n      });\r\n\r\n      this.editor.onDidPaste(e => {\r\n        if (e.range.endLineNumber > 1) {\r\n          let newContent = \"\";\r\n          const model = this.editor.getModel();\r\n          let lineCount = model.getLineCount();\r\n          for (let i = 0; i < lineCount; i++) {\r\n            newContent += model.getLineContent(i + 1);\r\n          }\r\n          model.setValue(newContent);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  private async getMonaco() {\r\n    if(!!this.monaco)\r\n      return this.monaco;\r\n\r\n    const monacoLibPath = monacoStore.monacoLibPath;\r\n    return this.monaco = await initializeMonacoWorker(monacoLibPath);\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    const editor = this.editor;\r\n\r\n    if (!!editor)\r\n      editor.dispose();\r\n  }\r\n\r\n  render() {\r\n    const padding = this.padding || 'tw-pt-1.5 tw-pl-1';\r\n    return (\r\n      <Host\r\n        class=\"monaco-editor-host tw-border focus:tw-ring-blue-500 focus:tw-border-blue-500 tw-block tw-w-full tw-min-w-0 tw-rounded-md sm:tw-text-sm tw-border-gray-300 tw-p-4\"\r\n        style={{ 'min-height': this.editorHeight }}>\r\n        <div ref={el => this.container = el} class={`monaco-editor-container ${padding}`} />\r\n      </Host>\r\n    )\r\n  }\r\n}\r\n"]}