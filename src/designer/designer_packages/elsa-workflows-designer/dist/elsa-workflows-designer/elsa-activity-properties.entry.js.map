{"file":"elsa-activity-properties.entry.esm.js","mappings":"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","names":["descriptorsStore","moment"],"sources":["./src/modules/workflow-instances/components/activity-properties.tsx"],"sourcesContent":["import {Component, h, Method, Prop, State, Watch} from '@stencil/core';\r\nimport {camelCase} from 'lodash';\r\nimport {\r\n  Activity,\r\n  ActivityDescriptor,\r\n  Lookup,\r\n  TabChangedArgs,\r\n  TabDefinition,\r\n  WorkflowExecutionLogRecord\r\n} from '../../../models';\r\nimport {InfoList} from \"../../../components/shared/forms/info-list\";\r\nimport descriptorsStore from \"../../../data/descriptors-store\";\r\nimport moment from 'moment';\r\nimport Container from 'typedi';\r\nimport { ActivityIconRegistry } from '../../../services';\r\nimport {ActivityIconSize} from \"../../../components/icons/activities\";\r\n\r\n@Component({\r\n  tag: 'elsa-activity-properties',\r\n})\r\nexport class ActivityProperties {\r\n  private slideOverPanel: HTMLElsaSlideOverPanelElement;\r\n  private readonly iconRegistry: ActivityIconRegistry;\r\n\r\n  constructor() {\r\n    this.iconRegistry = Container.get(ActivityIconRegistry);\r\n  }\r\n\r\n  @Prop({mutable: true}) public activity?: Activity;\r\n  @Prop() activityExecutionLog: WorkflowExecutionLogRecord;\r\n  @Prop() activityPropertyTabIndex?: number;\r\n  @State() private selectedTabIndex: number = 0;\r\n\r\n  @Method()\r\n  async show(): Promise<void> {\r\n    await this.slideOverPanel.show();\r\n  }\r\n\r\n  @Method()\r\n  async hide(): Promise<void> {\r\n    await this.slideOverPanel.hide();\r\n  }\r\n\r\n  @Method()\r\n  async updateSelectedTab(tabIndex : number): Promise<void> {\r\n    this.selectedTabIndex = tabIndex;\r\n  }\r\n\r\n  @Watch('activity')\r\n\r\n\r\n  async componentWillLoad(): Promise<void> {\r\n    if(this.activityPropertyTabIndex != null) {\r\n      this.selectedTabIndex = this.activityPropertyTabIndex;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const activity = this.activity;\r\n    const activityDescriptor = this.findActivityDescriptor();\r\n\r\n    const propertiesTab: TabDefinition = {\r\n      displayText: 'Properties',\r\n      content: () => this.renderPropertiesTab()\r\n    };\r\n\r\n    const commonTab: TabDefinition = {\r\n      displayText: 'Common',\r\n      content: () => this.renderCommonTab()\r\n    };\r\n\r\n    const journalTab: TabDefinition = {\r\n      displayText: 'Journal',\r\n      content: () => this.renderJournalTab()\r\n    };\r\n\r\n    const tabs = !!activityDescriptor ? [propertiesTab, commonTab, journalTab] : [];\r\n    const mainTitle = activity.id;\r\n    const subTitle = activityDescriptor.displayName;\r\n\r\n    return (\r\n      <elsa-form-panel\r\n        mainTitle={mainTitle}\r\n        subTitle={subTitle}\r\n        tabs={tabs}\r\n        selectedTabIndex={this.selectedTabIndex}\r\n        onSelectedTabIndexChanged={e => this.onSelectedTabIndexChanged(e)}\r\n      />\r\n    );\r\n  }\r\n\r\n  private findActivityDescriptor = (): ActivityDescriptor => {\r\n    const activity = this.activity;\r\n\r\n    if(!activity) return null;\r\n\r\n    const descriptor = descriptorsStore.activityDescriptors.find(x => x.typeName == activity.type && x.version == activity.version);\r\n    return descriptor ?? descriptorsStore.activityDescriptors.sort((a, b) => b.version - a.version).find(x => x.typeName == this.activity.type);\r\n  };\r\n  private onSelectedTabIndexChanged = (e: CustomEvent<TabChangedArgs>) => this.selectedTabIndex = e.detail.selectedTabIndex\r\n\r\n  private renderPropertiesTab = () => {\r\n    const activity = this.activity;\r\n    const activityDescriptor = this.findActivityDescriptor();\r\n    const properties = activityDescriptor.inputs.filter(x => x.isBrowsable);\r\n    const activityId = activity.id;\r\n    const displayText: string = activity.metadata?.displayText ?? '';\r\n    const executionLogEntry = this.activityExecutionLog;\r\n    const activityState = executionLogEntry?.activityState ?? {};\r\n\r\n    const propertyDetails: Lookup<string> = {\r\n      'Activity ID': activityId,\r\n      'Display Text': displayText\r\n    };\r\n\r\n    for (const property of properties) {\r\n      const loggedPropName = property.name;\r\n      const propertyValue = activityState[loggedPropName];\r\n      const propertyValueText = (propertyValue !== null && typeof propertyValue === 'object') ? JSON.stringify(propertyValue) : (propertyValue != null ? propertyValue.toString() : '');\r\n      propertyDetails[property.displayName] = propertyValueText;\r\n    }\r\n\r\n    return <div>\r\n      <InfoList title=\"Properties\" dictionary={propertyDetails}/>\r\n    </div>\r\n  };\r\n\r\n  private renderCommonTab = () => {\r\n    return <div>\r\n    </div>\r\n  };\r\n\r\n  private renderJournalTab = () => {\r\n    const log = this.activityExecutionLog;\r\n    if(log == null) return;\r\n\r\n    const exception = log.payload?.exception;\r\n    const statusColor = log.eventName == \"Completed\" ? \"tw-bg-blue-100\" : log.eventName == \"Faulted\" ? \"tw-bg-red-100\" : \"tw-bg-green-100\";\r\n    const icon = this.iconRegistry.getOrDefault(log.activityType)({size: ActivityIconSize.Small});\r\n    return (\r\n      <div class=\"tw-border-2 tw-cursor-pointer tw-p-4 tw-rounded\">\r\n        <div class=\"tw-relative tw-pb-10\">\r\n          <div class=\"tw-relative tw-flex tw-space-x-3\">\r\n            <div>\r\n              <span class={`tw-h-8 tw-w-8 tw-rounded tw-p-1 tw-bg-blue-500 tw-flex tw-items-center tw-justify-center tw-ring-8 tw-ring-white tw-mr-1`}>\r\n                {icon}\r\n              </span>\r\n            </div>\r\n            <div class=\"tw-min-w-0 tw-flex-1 tw-pt-1.5 tw-flex tw-justify-between tw-space-x-4\">\r\n              <div>\r\n                <h3 class=\"tw-text-lg tw-leading-6 tw-font-medium tw-text-gray-900\">\r\n                  {log.activityType}\r\n                </h3>\r\n              </div>\r\n              <div>\r\n                <span\r\n                  class={`tw-relative tw-inline-flex tw-items-center tw-rounded-full ${statusColor} tw-border tw-border-gray-300 tw-px-3 tw-py-0.5 tw-text-sm`}>\r\n                  <span class=\"tw-absolute tw-flex-shrink-0 tw-flex tw-items-center tw-justify-center\">\r\n                    <span class={`tw-h-1.5 tw-w-1.5 tw-rounded-full`} aria-hidden=\"true\"/>\r\n                  </span>\r\n                  <span class=\"tw-font-medium tw-text-gray-900\">{log.eventName}</span>\r\n                </span>\r\n              </div>\r\n              <div class=\"tw-text-right tw-text-sm tw-whitespace-nowrap tw-text-gray-500\">\r\n                <span>{moment(log.timestamp).format('DD-MM-YYYY HH:mm:ss')}</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"tw-ml-12 tw-mt-2\">\r\n            <dl class=\"sm:tw-divide-y sm:tw-divide-gray-200\">\r\n              <div class=\"tw-grid tw-grid-cols-2 tw-gap-x-4 tw-gap-y-8 sm:tw-grid-cols-2\">\r\n                <div class=\"sm:tw-col-span-2\">\r\n                  <dt class=\"tw-text-sm tw-font-medium tw-text-gray-500\">\r\n                    <span>Activity ID</span>\r\n                    <copy-button value={log.activityId}/>\r\n                  </dt>\r\n                  <dd class=\"tw-mt-1 tw-text-sm tw-text-gray-900 tw-mb-2\">{log.activityId}</dd>\r\n                </div>\r\n                {!!exception ? (\r\n                  [<div class=\"sm:tw-col-span-2\">\r\n                    <dt class=\"tw-text-sm tw-font-medium tw-text-gray-500\">\r\n                      <span>Exception</span>\r\n                      <copy-button value={exception.Type + '\\n' + exception.Message}/>\r\n                    </dt>\r\n                    <dd class=\"tw-mt-1 tw-text-sm tw-text-gray-900\">\r\n                      {exception.message}\r\n                    </dd>\r\n                  </div>,\r\n                    <div class=\"sm:tw-col-span-2\">\r\n                      <dt class=\"tw-text-sm tw-font-medium tw-text-gray-500\">\r\n                        <span>Exception Details</span>\r\n                        <copy-button value={JSON.stringify(exception, null, 1)}/>\r\n                      </dt>\r\n                      <dd class=\"tw-mt-1 tw-text-sm tw-text-gray-900 tw-overflow-x-auto\">\r\n                        <pre>{JSON.stringify(exception, null, 1)}</pre>\r\n                      </dd>\r\n                    </div>]\r\n                ) : undefined}\r\n              </div>\r\n            </dl>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  };\r\n}\r\n"],"version":3}