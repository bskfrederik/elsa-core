{"file":"elsa-workflow-instance-properties.entry.esm.js","mappings":"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","names":[],"sources":["./src/modules/workflow-instances/models.ts","./src/modules/workflow-instances/components/properties.tsx"],"sourcesContent":["import {TabDefinition, WorkflowExecutionLogRecord, WorkflowInstance} from \"../../models\";\r\nimport moment from \"moment\";\r\nimport {WorkflowDefinition} from \"../workflow-definitions/models/entities\";\r\n\r\nexport const WorkflowInstanceViewerEventTypes = {\r\n  WorkflowDefinition: {\r\n    Imported: 'workflow-instance-viewer:workflow-instance:imported'\r\n  },\r\n  WorkflowInstanceViewer: {\r\n    Ready: 'workflow-instance-viewer:ready'\r\n  }\r\n}\r\n\r\nexport const WorkflowInstancePropertiesEventTypes = {\r\n  Displaying: 'workflow-instance-properties:displaying'\r\n}\r\n\r\nexport interface WorkflowInstancePropertiesDisplayingArgs {\r\n  model: WorkflowInstancePropertiesViewerModel;\r\n}\r\n\r\nexport interface TabModel {\r\n  name: string;\r\n  tab: TabDefinition;\r\n}\r\n\r\nexport interface Widget {\r\n  name: string;\r\n  content: () => any;\r\n  order?: number;\r\n}\r\n\r\nexport interface PropertiesTabModel extends TabModel {\r\n  Widgets: Array<Widget>;\r\n}\r\n\r\nexport interface WorkflowInstancePropertiesViewerModel {\r\n  tabModels: Array<TabModel>;\r\n}\r\n\r\nexport interface ActivityExecutionEventBlock {\r\n  nodeId: string;\r\n  activityId: string;\r\n  activityInstanceId: string;\r\n  parentActivityInstanceId: string;\r\n  completed: boolean;\r\n  suspended: boolean;\r\n  faulted: boolean;\r\n  timestamp: Date;\r\n  duration?: moment.Duration;\r\n  startedRecord: WorkflowExecutionLogRecord;\r\n  completedRecord?: WorkflowExecutionLogRecord;\r\n  faultedRecord?: WorkflowExecutionLogRecord;\r\n  suspendedRecord?: WorkflowExecutionLogRecord;\r\n  children: Array<ActivityExecutionEventBlock>;\r\n}\r\n\r\nexport interface WorkflowJournalModel {\r\n  workflowInstance: WorkflowInstance;\r\n  workflowDefinition: WorkflowDefinition;\r\n}\r\n","import {Component, Event, EventEmitter, h, Method, Prop, State, Watch} from '@stencil/core';\r\nimport {TabChangedArgs, Variable, WorkflowInstance} from '../../../models';\r\nimport {InfoList} from \"../../../components/shared/forms/info-list\";\r\nimport {formatTimestamp, isNullOrWhitespace} from \"../../../utils\";\r\nimport {PropertiesTabModel, TabModel, WorkflowInstancePropertiesDisplayingArgs, WorkflowInstancePropertiesEventTypes, WorkflowInstancePropertiesViewerModel} from \"../models\";\r\nimport {Container} from \"typedi\";\r\nimport {EventBus} from \"../../../services\";\r\nimport {WorkflowDefinition} from \"../../workflow-definitions/models/entities\";\r\n\r\n@Component({\r\n  tag: 'elsa-workflow-instance-properties',\r\n})\r\nexport class WorkflowDefinitionPropertiesEditor {\r\n  private readonly eventBus: EventBus;\r\n  private slideOverPanel: HTMLElsaSlideOverPanelElement;\r\n\r\n  constructor() {\r\n    this.eventBus = Container.get(EventBus);\r\n\r\n    this.model = {\r\n      tabModels: [],\r\n    }\r\n  }\r\n\r\n  @Prop() workflowDefinition?: WorkflowDefinition;\r\n  @Prop() workflowInstance?: WorkflowInstance;\r\n  @State() private model: WorkflowInstancePropertiesViewerModel;\r\n  @State() private selectedTabIndex: number = 0;\r\n  @State() private changeHandle: object = {};\r\n\r\n  @Method()\r\n  public async show(): Promise<void> {\r\n    await this.slideOverPanel.show();\r\n  }\r\n\r\n  @Method()\r\n  public async hide(): Promise<void> {\r\n    await this.slideOverPanel.hide();\r\n  }\r\n\r\n  @Watch('workflowDefinition')\r\n  async onWorkflowDefinitionChanged() {\r\n    await this.createModel();\r\n  }\r\n\r\n  @Watch('workflowInstance')\r\n  async onWorkflowInstanceChanged() {\r\n    await this.createModel();\r\n  }\r\n\r\n  async componentWillLoad() {\r\n    await this.createModel();\r\n  }\r\n\r\n  public render() {\r\n    const workflowDefinition = this.workflowDefinition;\r\n    const title = !isNullOrWhitespace(workflowDefinition?.name) ? workflowDefinition.name : '-';\r\n    const subTitle = 'Workflow Instance';\r\n    const tabs = this.model.tabModels.map(x => x.tab);\r\n\r\n    return (\r\n      <elsa-form-panel\r\n        mainTitle={title}\r\n        subTitle={subTitle}\r\n        tabs={tabs}\r\n        selectedTabIndex={this.selectedTabIndex}\r\n        onSelectedTabIndexChanged={e => this.onSelectedTabIndexChanged(e)}/>\r\n    );\r\n  }\r\n\r\n  private createModel = async () => {\r\n    const model = {\r\n      tabModels: [],\r\n    };\r\n\r\n    const workflowDefinition = this.workflowDefinition;\r\n    const workflowInstance = this.workflowInstance;\r\n\r\n    if (!workflowDefinition || !workflowInstance) {\r\n      this.model = model;\r\n      return;\r\n    }\r\n\r\n    const propertiesTabModel: PropertiesTabModel = {\r\n      name: 'properties',\r\n      tab: null,\r\n      Widgets: [{\r\n        name: 'workflowInstanceInfo',\r\n        content: () => {\r\n\r\n          const identityDetails = {\r\n            'Instance ID': isNullOrWhitespace(workflowInstance.id) ? '(new)' : workflowInstance.id,\r\n            'Definition ID': isNullOrWhitespace(workflowDefinition.definitionId) ? '(new)' : workflowDefinition.definitionId,\r\n            'Version': workflowDefinition.version.toString(),\r\n          };\r\n\r\n          const statusDetails = {\r\n            'Status': workflowInstance.status,\r\n            'Sub status': workflowInstance.subStatus\r\n          };\r\n\r\n          const timestampDetails = {\r\n            'Created': formatTimestamp(workflowInstance.createdAt),\r\n            'Last execution': formatTimestamp(workflowInstance.updatedAt),\r\n            'Finished': formatTimestamp(workflowInstance.finishedAt),\r\n          };\r\n\r\n          return <div>\r\n            <InfoList title=\"Identity\" dictionary={identityDetails}/>\r\n            <InfoList title=\"Status\" dictionary={statusDetails}/>\r\n            <InfoList title=\"Timestamps\" dictionary={timestampDetails} hideEmptyValues={true}/>\r\n          </div>;\r\n        },\r\n        order: 10\r\n      }]\r\n    };\r\n\r\n    propertiesTabModel.tab = {\r\n      displayText: 'Properties',\r\n      content: () => this.renderPropertiesTab(propertiesTabModel)\r\n    };\r\n\r\n    const variablesTabModel: TabModel = {\r\n      name: 'variables',\r\n      tab: {\r\n        displayText: 'Variables',\r\n        content: () => this.renderVariablesTab()\r\n      }\r\n    }\r\n\r\n    model.tabModels = [propertiesTabModel, variablesTabModel];\r\n\r\n    const args: WorkflowInstancePropertiesDisplayingArgs = {model};\r\n\r\n    await this.eventBus.emit(WorkflowInstancePropertiesEventTypes.Displaying, this, args);\r\n\r\n    this.model = model;\r\n  }\r\n\r\n  private renderPropertiesTab = (tabModel: PropertiesTabModel) => {\r\n    const widgets = tabModel.Widgets.sort((a, b) => a.order < b.order ? -1 : a.order > b.order ? 1 : 0);\r\n\r\n    return <div>\r\n      {widgets.map(widget => widget.content())}\r\n    </div>\r\n  };\r\n\r\n  private renderVariablesTab = () => {\r\n    const variables: Array<Variable> = this.workflowDefinition?.variables ?? [];\r\n\r\n    return <div>\r\n      <elsa-variables-viewer variables={variables} workflowDefinition={this.workflowDefinition} workflowInstance={this.workflowInstance} />\r\n    </div>\r\n  };\r\n\r\n  private onSelectedTabIndexChanged = (e: CustomEvent<TabChangedArgs>) => this.selectedTabIndex = e.detail.selectedTabIndex;\r\n}\r\n"],"version":3}