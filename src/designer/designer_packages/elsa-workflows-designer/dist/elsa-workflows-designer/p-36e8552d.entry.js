import{r as t,c as n,h as r,a as e,H as i}from"./p-a7a3baa1.js";import"./p-219f806a.js";import{l as a}from"./p-e71312f9.js";import{G as o,H as u,P as f}from"./p-237610e8.js";import{C as s,w as c,ak as l,al as v,am as d,an as h,a8 as b,J as p,Q as m,ah as y,ao as w,ap as g,B as E,aq as A,x as _,ar as T}from"./p-691e5295.js";import{s as R}from"./p-b6964c5d.js";import{w as O,f as x,c as j}from"./p-851b5691.js";import{C as S}from"./p-b757f20d.js";import{a as N,b as I,c as M}from"./p-72dc819a.js";import{F as C}from"./p-01ef35ed.js";import{P as L}from"./p-7e202d82.js";import"./p-144a434e.js";import"./p-ddecd487.js";import"./p-37e9f5c1.js";class k extends u{get text(){return this.store.get("text")}set text(t){this.store.set("text",t)}get activity(){return this.store.get("activity")}set activity(t){this.store.set("activity",t)}get activityDescriptor(){return this.store.get("activityDescriptor")}set activityDescriptor(t){this.store.set("activityDescriptor",t)}init(){super.init();this.updateSize()}setup(){const t=this;super.setup();this.on("change:text",this.updateSize,this);this.on("change:activity",this.updateSize,this);this.html={render(){return t.createHtml()},shouldComponentUpdate(t){return t.hasChanged("text")||t.hasChanged("activity")}}}updateSize(){const t=this.activityDescriptor;if(!t)return;const n=document.createElement("div");n.className="tw-inline-block tw-flex tw-items-center tw-pl-10 tw-pr-2 tw-py-2 tw-absolute";n.style.left="-1000px";n.style.top="-1000px";n.innerHTML=this.createHtml();const r=document.getElementsByTagName("elsa-flowchart")[0];console.log(r);r.append(n);const e=()=>{const t=n.getElementsByTagName("elsa-default-activity-template")[0];const r=t.getBoundingClientRect();if(r.width==0||r.height==0){window.requestAnimationFrame(e);return}const i=n.firstElementChild.getBoundingClientRect();const a=i.width;const o=i.height;this.prop({size:{width:a,height:o}});n.remove()};e()}createHtml(){const t=this.activityDescriptor;const n=this.activity;const r=t.typeName;const e=s.get(c);const i=e.createDriver(r);const a={activity:n,activityDescriptor:t,displayType:"designer"};return i.display(a)}}k.config({ports:{groups:{left:{position:"left",attrs:{circle:{r:5,magnet:true,stroke:"#3c82f6",strokeWidth:2,fill:"#fff"},text:{fontSize:12,fill:"#888"}},label:{position:{name:"outside"}}},right:{position:"right",attrs:{circle:{r:5,magnet:true,stroke:"#3c82f6",strokeWidth:2,fill:"#fff"},text:{fontSize:12,fill:"#888"}},label:{position:{name:"outside"}}},top:{position:"top",attrs:{circle:{r:5,magnet:true,stroke:"#3c82f6",strokeWidth:2,fill:"#fff"},text:{fontSize:12,fill:"#888"}},label:{position:{name:"outside"}}},bottom:{position:"bottom",attrs:{circle:{r:5,magnet:true,stroke:"#3c82f6",strokeWidth:2,fill:"#fff"},text:{fontSize:12,fill:"#888"}},label:{position:{name:"outside"}}}}}});o.registerNode("activity",k,true);o.registerConnector("elsa-connector",((t,n)=>{const r=0;const e=Math.abs(n.y-t.y);const i=Math.floor(e/3*2);const a={x:t.x,y:t.y+r+i};const o={x:n.x,y:n.y-r-i};return f.normalize(`M ${t.x} ${t.y}\n       L ${t.x} ${t.y+r}\n       C ${a.x} ${a.y} ${o.x} ${o.y} ${n.x} ${n.y-r}\n       L ${n.x} ${n.y}\n      `)}),true);o.registerEdge("elsa-edge",{inherit:"edge",attrs:{line:{stroke:"#C2C8D5",strokeWidth:1,targetMarker:"classic",size:6}}},true);function U(t,n,r){const e=new o({container:t,interacting:n,embedding:{enabled:false},grid:{type:"mesh",size:20,visible:true,args:{color:"#e0e0e0"}},height:5e3,width:5e3,async:false,autoResize:true,keyboard:{enabled:true,global:false},clipboard:{enabled:true,useLocalStorage:true},selecting:{enabled:true,showNodeSelectionBox:true,rubberband:true},scroller:{enabled:true,pannable:true,pageVisible:false,pageBreak:false,padding:0,modifiers:["ctrl","meta"]},connecting:{allowBlank:false,allowMulti:true,allowLoop:true,allowNode:true,allowEdge:false,allowPort:true,highlight:true,router:{name:"manhattan",args:{startDirections:["top","right","left","bottom"],endDirections:["top","right","left","bottom"]}},connector:{name:"rounded",args:{radius:20}},snap:{radius:20},validateMagnet({view:t,magnet:n}){const r=t.cell;const e=r.getPort(n.getAttribute("port"));return e.type!=="in"},validateConnection({sourceView:t,targetView:n,sourceMagnet:r,targetMagnet:e}){if(!r||!e){return false}const i=t.cell;const a=i.getPort(r.getAttribute("port"));const o=n.cell;const u=o.getPort(e.getAttribute("port"));if(a.type==="in"){return false}if(u.type!=="in"){return false}e.getAttribute("port");return!(u&&u.connected)},createEdge(){return e.createEdge({shape:"elsa-edge",zIndex:-1})}},onPortRendered(t){const n=t.contentSelectors;const r=n&&n.foContent;if(r){const t=document.createElement("div");t.className="tw-rounded-full tw-border tw-border-2 tw-border-blue tw-h-8 tw-w-8";t.innerHTML=`<p>done</p>`;r.append(t)}},mousewheel:{enabled:true,modifiers:["ctrl","meta"]},history:{enabled:true,beforeAddCommand:(t,n)=>{if(n.key=="tools")return false;const r=["cell:added","cell:removed","cell:change:*"];return r.indexOf(t)>=0}}});e.on("node:mousedown",(({node:t})=>{t.toFront()}));e.on("edge:mouseenter",(({edge:t})=>{t.addTools(["source-arrowhead","target-arrowhead",{name:"button-remove",args:{distance:-30}}])}));e.on("edge:mouseleave",(({edge:t})=>{t.removeTools()}));e.bindKey(["meta+c","ctrl+c"],(()=>{const t=e.getSelectedCells();if(t.length){e.copy(t)}return false}));e.bindKey(["meta+x","ctrl+x"],(()=>{const t=e.getSelectedCells();if(t.length){e.cut(t)}return false}));e.bindKey(["meta+v","ctrl+v"],(async()=>{var t,n;if(!e.isClipboardEmpty()){const i=[...r()];const a=e.getCellsInClipboard();const o=a.filter((t=>t.shape=="activity"));const u=a.filter((t=>t.shape=="elsa-edge"));const f={};const s=[];for(const t of o){const n=t.clone({keepId:false});const r=Object.assign({},n.getData());const e=r.type;const a=R.activityDescriptors.find((t=>t.typeName==e));const o=r.id;const u=!!i.find((t=>t.id==o));if(u){const t=await l(i,a);f[o]=t;r.id=t}n.replaceData(r,{});n.activity=r;n.isClone=true;n.id=r.id;n.store.data.id=r.id;const c=n;const v=c.getPosition();v.x+=64;v.y+=64;c.setPosition(v);i.push(r);s.push(n)}for(const r of u){const i=Object.assign({},r.getData());i.source={activity:(t=f[i.source.activity])!==null&&t!==void 0?t:i.source.activity,port:v(i.source.port)};i.target={activity:(n=f[i.target.activity])!==null&&n!==void 0?n:i.target.activity,port:v(i.target.port)};const a=h(i);const o=e.createEdge(a);s.push(o)}e.addCell(s,{});requestAnimationFrame((()=>{e.cleanSelection();e.select(s)}))}return false}));e.bindKey(["meta+z","ctrl+z"],(()=>{if(e.history.canUndo()){e.history.undo()}return false}));e.bindKey(["meta+y","ctrl+y"],(()=>{if(e.history.canRedo()){e.history.redo()}return false}));e.bindKey(["meta+a","ctrl+a"],(()=>{const t=e.getNodes();if(t){e.select(t)}}));e.bindKey("del",(()=>{const t=e.getSelectedCells();if(t.length){e.removeCells(t)}}));e.bindKey(["ctrl+1","meta+1"],(()=>{const t=e.zoom();if(t<1.5){e.zoom(.1)}}));e.bindKey(["ctrl+2","meta+2"],(()=>{const t=e.zoom();if(t>.5){e.zoom(-.1)}}));e.on("node:moving",(({node:t})=>{d(e,t)}));return e}var F=undefined&&undefined.__decorate||function(t,n,r,e){var i=arguments.length,a=i<3?n:e===null?e=Object.getOwnPropertyDescriptor(n,r):e,o;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(t,n,r,e);else for(var u=t.length-1;u>=0;u--)if(o=t[u])a=(i<3?o(a):i>3?o(n,r,a):o(n,r))||a;return i>3&&a&&Object.defineProperty(n,r,a),a};var B=undefined&&undefined.__metadata||function(t,n){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(t,n)};let D=class t{constructor(){this.portProviderRegistry=s.get(p)}createDesignerNode(t){const{activityDescriptor:n,activity:r,x:e,y:i}=t;const a=this.createPorts(t);return{id:r.id,shape:"activity",activity:r,activityDescriptor:n,x:e,y:i,data:r,ports:a}}createPorts(t){const{activityDescriptor:n,activity:r}=t;const e=this.portProviderRegistry.get(n.typeName);const i={activityDescriptor:n,activity:r};const a=[{name:"In",displayName:null,mode:m.Flow}];let o=e.getOutboundPorts(i).filter((t=>t.type==m.Flow));if(o.length==0)o=[{name:"Done",displayName:"Done",type:m.Flow}];if(o.length==1)o[0].displayName=null;const u=a.map((t=>({id:y()+"_"+t.name,group:"left",attrs:!!t.displayName?{text:{text:t.displayName}}:null,type:"in",position:"left"})));const f=o.map((t=>({id:y()+"_"+t.name,group:"right",attrs:{text:{text:t.displayName}},type:"out",position:"right"})));const s=[...u,...f];return s}};D=F([b(),B("design:paramtypes",[])],D);var P=undefined&&undefined.__decorate||function(t,n,r,e){var i=arguments.length,a=i<3?n:e===null?e=Object.getOwnPropertyDescriptor(n,r):e,o;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(t,n,r,e);else for(var u=t.length-1;u>=0;u--)if(o=t[u])a=(i<3?o(a):i>3?o(n,r,a):o(n,r))||a;return i>3&&a&&Object.defineProperty(n,r,a),a};let G=class t{constructor(){this.handlerMap=new Map;this.defaultHandlerFactory=()=>s.get(D)}add(t,n){this.handlerMap.set(t,n)}get(t){return this.handlerMap.get(t)}createHandler(t){var n;const r=(n=this.get(t))!==null&&n!==void 0?n:this.defaultHandlerFactory;return r()}};G=P([b()],G);var V=undefined&&undefined.__decorate||function(t,n,r,e){var i=arguments.length,a=i<3?n:e===null?e=Object.getOwnPropertyDescriptor(n,r):e,o;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(t,n,r,e);else for(var u=t.length-1;u>=0;u--)if(o=t[u])a=(i<3?o(a):i>3?o(n,r,a):o(n,r))||a;return i>3&&a&&Object.defineProperty(n,r,a),a};var X=undefined&&undefined.__metadata||function(t,n){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(t,n)};let z=class t{constructor(){this.handlerRegistry=s.get(G)}createNode(t,n,r,e){const i=this.handlerRegistry.createHandler(t.typeName);return i.createDesignerNode({activityDescriptor:t,activity:n,x:r,y:e})}createPorts(t,n){const r=this.handlerRegistry.createHandler(t.typeName);return r.createPorts({activityDescriptor:t,activity:n})}};z=V([b(),X("design:paramtypes",[])],z);const H={ConnectionCreated:"connection-created"};class W{constructor(){this.nodes=[];this.edges=[];this.combos=[];this.comboEdges=[];this.hiddenNodes=[];this.hiddenEdges=[];this.hiddenCombos=[];this.vedges=[];this.positions=[];this.destroyed=false;this.onLayoutEnd=()=>{}}layout(t){this.init(t);return this.execute(true)}init(t){this.nodes=t.nodes||[];this.edges=t.edges||[];this.combos=t.combos||[];this.comboEdges=t.comboEdges||[];this.hiddenNodes=t.hiddenNodes||[];this.hiddenEdges=t.hiddenEdges||[];this.hiddenCombos=t.hiddenCombos||[];this.vedges=t.vedges||[]}execute(t){}executeWithWorker(){}getDefaultCfg(){return{}}updateCfg(t){if(t){Object.assign(this,t)}}getType(){return"base"}destroy(){this.nodes=null;this.edges=null;this.combos=null;this.positions=null;this.destroyed=true}}const $=t=>typeof t==="string";const Y=Array.isArray;const q=t=>typeof t==="number";const K=t=>t!==null&&typeof t==="object";const Q=t=>{if(t===null){return t}if(t instanceof Date){return new Date(t.getTime())}if(t instanceof Array){const n=[];t.forEach((t=>{n.push(t)}));return n.map((t=>Q(t)))}if(typeof t==="object"&&Object.keys(t).length){const n=Object.assign({},t);Object.keys(n).forEach((t=>{n[t]=Q(n[t])}));return n}return t};const Z=(t,n)=>{const r=t[n];if(K(r)){return r.cell}return r};const J=(t,n,r)=>{let e;if(r){e=r}else if(q(t)){e=()=>t}else{e=()=>n}return e};const tt=(t,n)=>{if(t!=="next"&&t!=="prev"){return n}};const nt=t=>{t.prev.next=t.next;t.next.prev=t.prev;delete t.next;delete t.prev};class rt{constructor(){const t={};t.prev=t;t.next=t.prev;this.shortcut=t}dequeue(){const t=this.shortcut;const n=t.prev;if(n&&n!==t){nt(n);return n}}enqueue(t){const n=this.shortcut;if(t.prev&&t.next){nt(t)}t.next=n.next;n.next.prev=t;n.next=t;t.prev=n}toString(){const t=[];const n=this.shortcut;let r=n.prev;while(r!==n){t.push(JSON.stringify(r,tt));r=r===null||r===void 0?void 0:r.prev}return`[${t.join(", ")}]`}}var et;(function(t){t["DEFAULT_EDGE_NAME"]="\0";t["GRAPH_NODE"]="\0";t["EDGE_KEY_DELIM"]=""})(et||(et={}));function it(t,n){var r=t.get(n)||0;t.set(n,r+1)}function at(t,n){var r=t.get(n);if(r!==undefined){r=r-1;if(r>0){t.set(n,r)}else{t.delete(n)}}}function ot(t,n,r,e){var i=String(n);var a=String(r);if(!t&&i>a){var o=i;i=a;a=o}return i+et.EDGE_KEY_DELIM+a+et.EDGE_KEY_DELIM+(e===undefined?et.DEFAULT_EDGE_NAME:e)}function ut(t,n,r,e){var i=String(n);var a=String(r);var o={v:n,w:r};if(!t&&i>a){var u=o.v;o.v=o.w;o.w=u}if(e!==undefined){o.name=e}return o}function ft(t,n){return ot(t,n.v,n.w,n.name)}function st(t){return typeof t==="function"}var ct=function t(n){return n.nodes().map((function(t){var r=n.node(t);var e=n.parent(t);var i={id:t,value:r,parent:e};if(i.value===undefined){delete i.value}if(i.parent===undefined){delete i.parent}return i}))};var lt=function t(n){return n.edges().map((function(t){var r=n.edge(t);var e={v:t.v,w:t.w,value:r,name:t.name};if(e.name===undefined){delete e.name}if(e.value===undefined){delete e.value}return e}))};var vt=function t(n){var r={options:{directed:n.isDirected(),multigraph:n.isMultigraph(),compound:n.isCompound()},nodes:ct(n),edges:lt(n),value:n.graph()};if(r.value===undefined){delete r.value}return r};var dt=function t(n){var r=new Et(n.options);if(n.value!==undefined){r.setGraph(n.value)}n.nodes.forEach((function(t){r.setNode(t.id,t.value);if(t.parent){r.setParent(t.id,t.parent)}}));n.edges.forEach((function(t){r.setEdge(t.v,t.w,t.value,t.name)}));return r};function ht(t,n){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);n&&(e=e.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),r.push.apply(r,e)}return r}function bt(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?ht(Object(r),!0).forEach((function(n){pt(t,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ht(Object(r)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))}))}return t}function pt(t,n,r){if(n in t){Object.defineProperty(t,n,{value:r,enumerable:true,configurable:true,writable:true})}else{t[n]=r}return t}function mt(t,n){if(!(t instanceof n)){throw new TypeError("Cannot call a class as a function")}}function yt(t,n){for(var r=0;r<n.length;r++){var e=n[r];e.enumerable=e.enumerable||false;e.configurable=true;if("value"in e)e.writable=true;Object.defineProperty(t,e.key,e)}}function wt(t,n,r){if(n)yt(t.prototype,n);if(r)yt(t,r);Object.defineProperty(t,"prototype",{writable:false});return t}var gt={compound:false,multigraph:false,directed:true};var Et=function(){function t(){var n=this;var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};mt(this,t);this.directed=true;this.multigraph=false;this.compound=false;this.GRAPH_NODE=et.GRAPH_NODE;this.label=void 0;this.nodeCountNum=0;this.edgeCountNum=0;this.defaultNodeLabelFn=function(){return undefined};this.defaultEdgeLabelFn=function(){return undefined};this.parentMap=void 0;this.childrenMap=void 0;this.nodesLabelMap=new Map;this.inEdgesMap=new Map;this.outEdgesMap=new Map;this.predecessorsMap=new Map;this.successorsMap=new Map;this.edgesMap=new Map;this.edgesLabelsMap=new Map;this.isDirected=function(){return n.directed};this.isMultigraph=function(){return n.multigraph};this.isCompound=function(){return n.compound};this.setGraph=function(t){n.label=t;return n};this.graph=function(){return n.label};this.setDefaultNodeLabel=function(t){if(st(t)){n.defaultNodeLabelFn=t}else{n.defaultNodeLabelFn=function(){return t}}return n};this.nodeCount=function(){return n.nodeCountNum};this.node=function(t){return n.nodesLabelMap.get(t)};this.nodes=function(){return Array.from(n.nodesLabelMap.keys())};this.sources=function(){return n.nodes().filter((function(t){var r;return!((r=n.inEdgesMap.get(t))===null||r===void 0?void 0:r.size)}))};this.sinks=function(){return n.nodes().filter((function(t){var r;return!((r=n.outEdgesMap.get(t))===null||r===void 0?void 0:r.size)}))};this.setNodes=function(t,r){t.map((function(t){return n.setNode(t,r)}));return n};this.hasNode=function(t){return n.nodesLabelMap.has(t)};this.checkCompound=function(){if(!n.isCompound()){throw new Error("Cannot construct parent-children relations in a non-compound graph")}};this.parent=function(t){if(n.isCompound()){var r;var e=(r=n.parentMap)===null||r===void 0?void 0:r.get(t);if(e!==n.GRAPH_NODE){return e}}};this.removeFromParentsChildList=function(t){var r=n.parentMap.get(t);n.childrenMap.get(r).delete(t)};this.setParent=function(t,r){var e,i;n.checkCompound();var a=r===undefined?n.GRAPH_NODE:r;var o=n.parent(a);while(o){if(t===o){throw new Error("Setting "+r+" as parent of "+t+" would create a cycle")}o=n.parent(o)}if(r){n.setNode(r)}n.setNode(t);n.removeFromParentsChildList(t);(e=n.parentMap)===null||e===void 0?void 0:e.set(t,a);var u=n.childrenMap.get(a);u.set(t,true);(i=n.childrenMap)===null||i===void 0?void 0:i.set(a,u);return n};this.children=function(t){var r=t===undefined?n.GRAPH_NODE:t;if(n.isCompound()){var e;var i=(e=n.childrenMap)===null||e===void 0?void 0:e.get(r);if(i){return Array.from(i.keys())}return undefined}if(r===n.GRAPH_NODE){return n.nodes()}if(t&&n.hasNode(t)){return[]}};this.predecessors=function(t){var r=n.predecessorsMap.get(t);return r?Array.from(r.keys()):undefined};this.successors=function(t){var r=n.successorsMap.get(t);return r?Array.from(r.keys()):undefined};this.neighbors=function(t){var r;if(!n.hasNode(t)){return undefined}return Array.from(new Set((r=n.predecessors(t))===null||r===void 0?void 0:r.concat(n.successors(t))))};this.isLeaf=function(t){var r;if(n.isDirected()){var e;return!((e=n.successors(t))===null||e===void 0?void 0:e.length)}return!((r=n.neighbors(t))===null||r===void 0?void 0:r.length)};this.filterNodes=function(r){var e=n.directed,i=n.multigraph,a=n.compound;var o=new t({directed:e,multigraph:i,compound:a});o.setGraph(n.graph());n.nodes().forEach((function(t){if(r(t)){o.setNode(t,n.node(t))}}));n.edges().forEach((function(t){if(o.hasNode(t.v)&&o.hasNode(t.w)){o.setEdgeObj(t,n.edge(t))}}));if(a){var u=function t(r){var e=n.parent(r);while(e!==undefined&&!o.hasNode(e)){e=n.parent(e)}return e};o.nodes().forEach((function(t){o.setParent(t,u(t))}))}return o};this.setDefaultEdgeLabel=function(t){if(st(t)){n.defaultEdgeLabelFn=t}else{n.defaultEdgeLabelFn=function(){return t}}return n};this.edgeCount=function(){return n.edgeCountNum};this.setEdgeObj=function(t,r){return n.setEdge(t.v,t.w,r,t.name)};this.setPath=function(t,r){t.reduce((function(t,e){n.setEdge(t,e,r);return e}));return n};this.edgeFromArgs=function(t,r,e){return n.edge({v:t,w:r,name:e})};this.edge=function(t){return n.edgesLabelsMap.get(ft(n.isDirected(),t))};this.hasEdge=function(t,r,e){return n.edgesLabelsMap.has(ft(n.isDirected(),{v:t,w:r,name:e}))};this.removeEdgeObj=function(t){var r=t.v,e=t.w,i=t.name;return n.removeEdge(r,e,i)};this.edges=function(){return Array.from(n.edgesMap.values())};this.inEdges=function(t,r){var e=n.inEdgesMap.get(t);if(e){return Array.from(e.values()).filter((function(t){return!r||t.v===r}))}return undefined};this.outEdges=function(t,r){var e=n.outEdgesMap.get(t);if(e){return Array.from(e.values()).filter((function(t){return!r||t.w===r}))}return undefined};this.nodeEdges=function(t,r){var e;if(!n.hasNode(t)){return undefined}return(e=n.inEdges(t,r))===null||e===void 0?void 0:e.concat(n.outEdges(t,r))};this.toJSON=function(){return vt(n)};this.nodeInDegree=function(t){var r=n.inEdgesMap.get(t);if(r){return r.size}return 0};this.nodeOutDegree=function(t){var r=n.outEdgesMap.get(t);if(r){return r.size}return 0};this.nodeDegree=function(t){return n.nodeInDegree(t)+n.nodeOutDegree(t)};this.source=function(t){return t.v};this.target=function(t){return t.w};var e=bt(bt({},gt),r);this.compound=e.compound;this.directed=e.directed;this.multigraph=e.multigraph;if(this.compound){this.parentMap=new Map;this.childrenMap=new Map}}wt(t,[{key:"setNode",value:function t(n,r){var e=this.nodesLabelMap,i=this.defaultNodeLabelFn,a=this.isCompound,o=this.parentMap,u=this.childrenMap,f=this.inEdgesMap,s=this.outEdgesMap,c=this.predecessorsMap,l=this.successorsMap;if(e.has(n)){if(r!==undefined){e.set(n,r)}return this}e.set(n,r||i(n));if(a()){var v;o===null||o===void 0?void 0:o.set(n,this.GRAPH_NODE);u===null||u===void 0?void 0:u.set(n,new Map);if(!(u===null||u===void 0?void 0:u.has(this.GRAPH_NODE))){u===null||u===void 0?void 0:u.set(this.GRAPH_NODE,new Map)}u===null||u===void 0?void 0:(v=u.get(this.GRAPH_NODE))===null||v===void 0?void 0:v.set(n,true)}[f,s,c,l].forEach((function(t){return t.set(n,new Map)}));this.nodeCountNum+=1;return this}},{key:"removeNode",value:function t(n){var r=this;if(this.hasNode(n)){var e=function t(n){r.removeEdge(n.v,n.w,n.name)};var i=this.inEdgesMap,a=this.outEdgesMap,o=this.predecessorsMap,u=this.successorsMap,f=this.nodesLabelMap;if(this.isCompound()){var s,c,l;this.removeFromParentsChildList(n);(s=this.parentMap)===null||s===void 0?void 0:s.delete(n);(c=this.children(n))===null||c===void 0?void 0:c.forEach((function(t){return r.setParent(t)}));(l=this.childrenMap)===null||l===void 0?void 0:l.delete(n)}var v=i.get(n);var d=a.get(n);Array.from(v.values()).forEach((function(t){return e(t)}));Array.from(d.values()).forEach((function(t){return e(t)}));f.delete(n);i.delete(n);a.delete(n);o.delete(n);u.delete(n);this.nodeCountNum-=1}return this}},{key:"setEdge",value:function t(n,r,e,i){var a,o;var u=ut(this.isDirected(),n,r,i);var f=ft(this.isDirected(),u);var s=u.v,c=u.w;if(this.edgesLabelsMap.has(f)){this.edgesLabelsMap.set(f,e);return this}if(i!==undefined&&!this.isMultigraph()){throw new Error("Cannot set a named edge when isMultigraph = false")}this.setNode(s);this.setNode(c);this.edgesLabelsMap.set(f,e||this.defaultEdgeLabelFn(s,c,i));Object.freeze(u);this.edgesMap.set(f,u);var l=this.predecessorsMap.get(c);var v=this.successorsMap.get(s);it(l,s);it(v,c);(a=this.inEdgesMap.get(c))===null||a===void 0?void 0:a.set(f,u);(o=this.outEdgesMap.get(s))===null||o===void 0?void 0:o.set(f,u);this.edgeCountNum+=1;return this}},{key:"removeEdge",value:function t(n,r,e){var i=ot(this.isDirected(),n,r,e);var a=this.edgesMap.get(i);if(a){var o=ut(this.isDirected(),n,r,e),u=o.v,f=o.w;this.edgesLabelsMap.delete(i);this.edgesMap.delete(i);var s=this.predecessorsMap.get(f);var c=this.successorsMap.get(u);at(s,u);at(c,f);this.inEdgesMap.get(f).delete(i);this.outEdgesMap.get(u).delete(i);this.edgeCountNum-=1}return this}}]);return t}();Et.fromJSON=dt;function At(t,n){for(var r=0;r<n.length;r++){var e=n[r];e.enumerable=e.enumerable||false;e.configurable=true;if("value"in e)e.writable=true;Object.defineProperty(t,e.key,e)}}function _t(t,n,r){if(n)At(t.prototype,n);if(r)At(t,r);Object.defineProperty(t,"prototype",{writable:false});return t}function Tt(t,n){if(!(t instanceof n)){throw new TypeError("Cannot call a class as a function")}}var Rt=_t((function t(){var n=this;Tt(this,t);this.arr=[];this.keyIndice=new Map;this.size=function(){return n.arr.length};this.keys=function(){return n.arr.map((function(t){return t.key}))};this.has=function(t){return n.keyIndice.has(t)};this.priority=function(t){var r=n.keyIndice.get(t);if(r!==undefined){return n.arr[r].priority}};this.swap=function(t,r){var e=n.arr,i=n.keyIndice;var a=[e[t],e[r]],o=a[0],u=a[1];e[t]=u;e[r]=o;i.set(o.key,r);i.set(u.key,t)};this.innerDecrease=function(t){var r=n.arr;var e=r[t].priority;var i;var a=t;while(a!==0){var o;i=a>>1;if(((o=r[i])===null||o===void 0?void 0:o.priority)<e){break}n.swap(a,i);a=i}};this.heapify=function(t){var r=n.arr;var e=t<<1;var i=e+1;var a=t;if(e<r.length){a=r[e].priority<r[a].priority?e:a;if(i<r.length){a=r[i].priority<r[a].priority?i:a}if(a!==t){n.swap(t,a);n.heapify(a)}}};this.min=function(){if(n.size()===0){throw new Error("Queue underflow")}return n.arr[0].key};this.add=function(t,r){var e=n.keyIndice,i=n.arr;if(!e.has(t)){var a=i.length;e.set(t,a);i.push({key:t,priority:r});n.innerDecrease(a);return true}return false};this.removeMin=function(){n.swap(0,n.arr.length-1);var t=n.arr.pop();n.keyIndice.delete(t.key);n.heapify(0);return t.key};this.decrease=function(t,r){if(!n.has(t)){throw new Error("There's no key named ".concat(t))}var e=n.keyIndice.get(t);if(r>n.arr[e].priority){throw new Error("New priority is greater than current priority.Key: ".concat(t," Old: + ").concat(n.arr[e].priority," New: ").concat(r))}n.arr[e].priority=r;n.innerDecrease(e)}}));var Ot=function t(n,r){var e=new Et;var i=new Map;var a=new Rt;var o;function u(t){var n=t.v===o?t.w:t.v;var e=a.priority(n);if(e!==undefined){var u=r(t);if(u<e){i.set(n,o);a.decrease(n,u)}}}if(n.nodeCount()===0){return e}n.nodes().forEach((function(t){a.add(t,Number.POSITIVE_INFINITY);e.setNode(t)}));a.decrease(n.nodes()[0],0);var f=false;while(a.size()>0){var s;o=a.removeMin();if(i.has(o)){e.setEdge(o,i.get(o))}else if(f){throw new Error("Input graph is not connected: "+n.graph())}else{f=true}(s=n.nodeEdges(o))===null||s===void 0?void 0:s.forEach(u)}return e};var xt=function t(n){var r=new Set;var e=[];var i=n.nodes();i.forEach((function(t){var i=[];var a=[t];while(a.length>0){var o=a.pop();if(!r.has(o)){var u,f;r.add(o);i.push(o);(u=n.successors(o))===null||u===void 0?void 0:u.forEach((function(t){return a.push(t)}));(f=n.predecessors(o))===null||f===void 0?void 0:f.forEach((function(t){return a.push(t)}))}}if(i.length){e.push(i)}}));return e};var jt=function t(n,r,e,i,a,o){if(!i.includes(r)){i.push(r);if(!e){o.push(r)}a(r).forEach((function(r){return t(n,r,e,i,a,o)}));if(e){o.push(r)}}};var St=function t(n,r,e){var i=Array.isArray(r)?r:[r];var a=function t(r){return n.isDirected()?n.successors(r):n.neighbors(r)};var o=[];var u=[];i.forEach((function(t){if(!n.hasNode(t)){throw new Error("Graph does not have node: "+t)}else{jt(n,t,e==="post",u,a,o)}}));return o};function Nt(t,n){return kt(t)||Lt(t,n)||Mt(t,n)||It()}function It(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Mt(t,n){if(!t)return;if(typeof t==="string")return Ct(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor)r=t.constructor.name;if(r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ct(t,n)}function Ct(t,n){if(n==null||n>t.length)n=t.length;for(var r=0,e=new Array(n);r<n;r++){e[r]=t[r]}return e}function Lt(t,n){var r=t==null?null:typeof Symbol!=="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(r==null)return;var e=[];var i=true;var a=false;var o,u;try{for(r=r.call(t);!(i=(o=r.next()).done);i=true){e.push(o.value);if(n&&e.length===n)break}}catch(t){a=true;u=t}finally{try{if(!i&&r["return"]!=null)r["return"]()}finally{if(a)throw u}}return e}function kt(t){if(Array.isArray(t))return t}var Ut=function t(){return 1};var Ft=function t(n,r,e,i){return Bt(n,r,e||Ut,i||function(t){return n.outEdges(t)})};var Bt=function t(n,r,e,i){var a=new Map;var o=new Rt;var u;var f;var s=function t(n){var r=n.v!==u?n.v:n.w;var i=a.get(r);var s=e(n);var c=f.distance+s;if(s<0){throw new Error("dijkstra does not allow negative edge weights. "+"Bad edge: "+n+" Weight: "+s)}if(c<i.distance){i.distance=c;i.predecessor=u;o.decrease(r,c)}};n.nodes().forEach((function(t){var n=t===r?0:Number.POSITIVE_INFINITY;a.set(t,{distance:n});o.add(t,n)}));while(o.size()>0){u=o.removeMin();f=a.get(u);if(f&&f.distance===Number.POSITIVE_INFINITY){break}i(u).forEach(s)}var c={};Array.from(a.entries()).forEach((function(t){var n=Nt(t,2),r=n[0],e=n[1];c[String(r)]=e;return c}));return c};var Dt=function t(n,r,e){var i={};n.nodes().forEach((function(t){i[String(t)]=Ft(n,t,r,e);return i}));return i};var Pt=function t(n){var r=0;var e=[];var i=new Map;var a=[];function o(t){var u;var f={onStack:true,lowlink:r,index:r};i.set(t,f);r+=1;e.push(t);(u=n.successors(t))===null||u===void 0?void 0:u.forEach((function(t){var n;if(!i.has(t)){o(t);var r=i.get(t);f.lowlink=Math.min(f.lowlink,r.lowlink)}else if((n=i.get(t))===null||n===void 0?void 0:n.onStack){var e=i.get(t);f.lowlink=Math.min(f.lowlink,e.index)}}));if(f.lowlink===f.index){var s=[];var c;do{c=e.pop();var l=i.get(c);l.onStack=false;s.push(c)}while(t!==c);a.push(s)}}n.nodes().forEach((function(t){if(!i.has(t)){o(t)}}));return a};var Gt=function t(n){return Pt(n).filter((function(t){return t.length>1||t.length===1&&n.hasEdge(t[0],t[0])}))};function Vt(t){"@babel/helpers - typeof";return Vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Vt(t)}function Xt(t,n){for(var r=0;r<n.length;r++){var e=n[r];e.enumerable=e.enumerable||false;e.configurable=true;if("value"in e)e.writable=true;Object.defineProperty(t,e.key,e)}}function zt(t,n,r){if(n)Xt(t.prototype,n);if(r)Xt(t,r);Object.defineProperty(t,"prototype",{writable:false});return t}function Ht(t,n){if(!(t instanceof n)){throw new TypeError("Cannot call a class as a function")}}function Wt(t,n){if(typeof n!=="function"&&n!==null){throw new TypeError("Super expression must either be null or a function")}t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:true,configurable:true}});Object.defineProperty(t,"prototype",{writable:false});if(n)tn(t,n)}function $t(t){var n=Zt();return function r(){var e=nn(t),i;if(n){var a=nn(this).constructor;i=Reflect.construct(e,arguments,a)}else{i=e.apply(this,arguments)}return Yt(this,i)}}function Yt(t,n){if(n&&(Vt(n)==="object"||typeof n==="function")){return n}else if(n!==void 0){throw new TypeError("Derived constructors may only return object or undefined")}return qt(t)}function qt(t){if(t===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t}function Kt(t){var n=typeof Map==="function"?new Map:undefined;Kt=function t(r){if(r===null||!Jt(r))return r;if(typeof r!=="function"){throw new TypeError("Super expression must either be null or a function")}if(typeof n!=="undefined"){if(n.has(r))return n.get(r);n.set(r,e)}function e(){return Qt(r,arguments,nn(this).constructor)}e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});return tn(e,r)};return Kt(t)}function Qt(t,n,r){if(Zt()){Qt=Reflect.construct}else{Qt=function t(n,r,e){var i=[null];i.push.apply(i,r);var a=Function.bind.apply(n,i);var o=new a;if(e)tn(o,e.prototype);return o}}return Qt.apply(null,arguments)}function Zt(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));return true}catch(t){return false}}function Jt(t){return Function.toString.call(t).indexOf("[native code]")!==-1}function tn(t,n){tn=Object.setPrototypeOf||function t(n,r){n.__proto__=r;return n};return tn(t,n)}function nn(t){nn=Object.setPrototypeOf?Object.getPrototypeOf:function t(n){return n.__proto__||Object.getPrototypeOf(n)};return nn(t)}var rn=function(t){Wt(r,t);var n=$t(r);function r(){Ht(this,r);return n.apply(this,arguments)}return zt(r)}(Kt(Error));function en(t){var n=new Set;var r=new Set;var e=[];function i(a){if(r.has(a)){throw new rn}if(!n.has(a)){var o;r.add(a);n.add(a);(o=t.predecessors(a))===null||o===void 0?void 0:o.forEach(i);r.delete(a);e.push(a)}}t.sinks().forEach(i);if(n.size!==t.nodeCount()){throw new rn}return e}var an=function t(n){try{en(n)}catch(t){if(t instanceof rn){return false}throw t}return true};var on=function t(n,r){return St(n,r,"post")};var un=function t(n,r){return St(n,r,"pre")};var fn=function t(){return 1};function sn(t,n,r){return cn(t,n||fn,r||function(n){return t.outEdges(n)})}function cn(t,n,r){var e={};var i=t.nodes();i.forEach((function(t){var a=String(t);e[a]={};e[a][a]={distance:0};i.forEach((function(n){if(t!==n){e[a][String(n)]={distance:Number.POSITIVE_INFINITY}}}));r(t).forEach((function(r){var i=r.v===t?r.w:r.v;var o=n(r);e[a][String(i)]={distance:o,predecessor:t}}))}));i.forEach((function(t){var n=String(t);var r=e[n];i.forEach((function(t){var a=String(t);var o=e[a];i.forEach((function(t){var e=String(t);var i=o[n];var a=r[e];var u=o[e];var f=i.distance+a.distance;if(f<u.distance){u.distance=f;u.predecessor=a.predecessor}}))}))}));return e}const ln=Object.freeze({__proto__:null,components:xt,dfs:St,dijkstra:Ft,dijkstraAll:Dt,findCycles:Gt,tarjan:Pt,isAcyclic:an,postorder:on,preorder:un,prim:Ot,topsort:en,floydWarshall:sn});class vn extends rt{}class dn extends Et{}const hn=()=>1;const bn=(t,n)=>{var r;if(t.nodeCount()<=1)return[];const e=yn(t,n||hn);const i=pn(e.graph,e.buckets,e.zeroIdx);return(r=i.map((n=>t.outEdges(n.v,n.w))))===null||r===void 0?void 0:r.flat()};const pn=(t,n,r)=>{let e=[];const i=n[n.length-1];const a=n[0];let o;while(t.nodeCount()){while(o=a.dequeue()){mn(t,n,r,o)}while(o=i.dequeue()){mn(t,n,r,o)}if(t.nodeCount()){for(let i=n.length-2;i>0;--i){o=n[i].dequeue();if(o){e=e.concat(mn(t,n,r,o,true));break}}}}return e};const mn=(t,n,r,e,i)=>{var a,o;const u=[];(a=t.inEdges(e.v))===null||a===void 0?void 0:a.forEach((e=>{const a=t.edge(e);const o=t.node(e.v);if(i){u.push({v:e.v,w:e.w,in:0,out:0})}if(o.out===undefined)o.out=0;o.out-=a;wn(n,r,o)}));(o=t.outEdges(e.v))===null||o===void 0?void 0:o.forEach((e=>{const i=t.edge(e);const a=e.w;const o=t.node(a);if(o.in===undefined)o.in=0;o.in-=i;wn(n,r,o)}));t.removeNode(e.v);return i?u:undefined};const yn=(t,n)=>{const r=new dn;let e=0;let i=0;t.nodes().forEach((t=>{r.setNode(t,{v:t,in:0,out:0})}));t.edges().forEach((t=>{const a=r.edge(t)||0;const o=(n===null||n===void 0?void 0:n(t))||1;const u=a+o;r.setEdge(t.v,t.w,u);i=Math.max(i,r.node(t.v).out+=o);e=Math.max(e,r.node(t.w).in+=o)}));const a=[];const o=i+e+3;for(let t=0;t<o;t++){a.push(new vn)}const u=e+1;r.nodes().forEach((t=>{wn(a,u,r.node(t))}));return{buckets:a,zeroIdx:u,graph:r}};const wn=(t,n,r)=>{if(!r.out){t[0].enqueue(r)}else if(!r["in"]){t[t.length-1].enqueue(r)}else{t[r.out-r["in"]+n].enqueue(r)}};const gn=t=>{const n=t=>n=>{var r;return((r=t.edge(n))===null||r===void 0?void 0:r.weight)||1};const r=t.graph().acyclicer==="greedy"?bn(t,n(t)):En(t);r===null||r===void 0?void 0:r.forEach((n=>{const r=t.edge(n);t.removeEdgeObj(n);r.forwardName=n.name;r.reversed=true;t.setEdge(n.w,n.v,r,`rev-${Math.random()}`)}))};const En=t=>{const n=[];const r={};const e={};const i=a=>{var o;if(e[a]){return}e[a]=true;r[a]=true;(o=t.outEdges(a))===null||o===void 0?void 0:o.forEach((t=>{if(r[t.w]){n.push(t)}else{i(t.w)}}));delete r[a]};t.nodes().forEach(i);return n};const An=t=>{t.edges().forEach((n=>{const r=t.edge(n);if(r.reversed){t.removeEdgeObj(n);const e=r.forwardName;delete r.reversed;delete r.forwardName;t.setEdge(n.w,n.v,r,e)}}))};const _n={run:gn,undo:An};class Tn extends Et{}const Rn=(t,n)=>Number(t)-Number(n);const On=(t,n,r,e)=>{let i;do{i=`${e}${Math.random()}`}while(t.hasNode(i));r.dummy=n;t.setNode(i,r);return i};const xn=t=>{const n=(new Tn).setGraph(t.graph());t.nodes().forEach((r=>{n.setNode(r,t.node(r))}));t.edges().forEach((r=>{const e=n.edgeFromArgs(r.v,r.w)||{weight:0,minlen:1};const i=t.edge(r);n.setEdge(r.v,r.w,{weight:e.weight+i.weight,minlen:Math.max(e.minlen,i.minlen)})}));return n};const jn=t=>{const n=new Tn({multigraph:t.isMultigraph()}).setGraph(t.graph());t.nodes().forEach((r=>{var e;if(!((e=t.children(r))===null||e===void 0?void 0:e.length)){n.setNode(r,t.node(r))}}));t.edges().forEach((r=>{n.setEdgeObj(r,t.edge(r))}));return n};const Sn=(t,n)=>t===null||t===void 0?void 0:t.reduce(((t,r,e)=>{t[r]=n[e];return t}),{});const Nn=(t,n)=>{const r=Number(t.x);const e=Number(t.y);const i=Number(n.x)-r;const a=Number(n.y)-e;let o=Number(t.width)/2;let u=Number(t.height)/2;if(!i&&!a){return{x:0,y:0}}let f;let s;if(Math.abs(a)*o>Math.abs(i)*u){if(a<0){u=-u}f=u*i/a;s=u}else{if(i<0){o=-o}f=o;s=o*a/i}return{x:r+f,y:e+s}};const In=t=>{const n=[];const r=kn(t)+1;for(let t=0;t<r;t++){n.push([])}t.nodes().forEach((r=>{const e=t.node(r);if(!e)return;const i=e.rank;if(i!==undefined&&n[i]){n[i].push(r)}}));for(let e=0;e<r;e++){n[e]=n[e].sort(((n,r)=>{var e,i;return Rn((e=t.node(n))===null||e===void 0?void 0:e.order,(i=t.node(r))===null||i===void 0?void 0:i.order)}))}return n};const Mn=t=>{const n=t.nodes().filter((n=>{var r;return((r=t.node(n))===null||r===void 0?void 0:r.rank)!==undefined})).map((n=>t.node(n).rank));const r=Math.min(...n);t.nodes().forEach((n=>{const e=t.node(n);if(e.hasOwnProperty("rank")&&r!==Infinity){e.rank-=r}}))};const Cn=t=>{const n=t.nodes();const r=n.filter((n=>{var r;return((r=t.node(n))===null||r===void 0?void 0:r.rank)!==undefined})).map((n=>t.node(n).rank));const e=Math.min(...r);const i=[];n.forEach((n=>{var r;const a=(((r=t.node(n))===null||r===void 0?void 0:r.rank)||0)-e;if(!i[a]){i[a]=[]}i[a].push(n)}));let a=0;const o=t.graph().nodeRankFactor||0;for(let n=0;n<i.length;n++){const r=i[n];if(r===undefined){if(n%o!==0){a-=1}}else if(a){r===null||r===void 0?void 0:r.forEach((n=>{const r=t.node(n);if(r){r.rank=r.rank||0;r.rank+=a}}))}}};const Ln=(t,n,r,e)=>{const i={width:0,height:0};if(q(r)&&q(e)){i.rank=r;i.order=e}return On(t,"border",i,n)};const kn=t=>{let n;t.nodes().forEach((r=>{var e;const i=(e=t.node(r))===null||e===void 0?void 0:e.rank;if(i!==undefined){if(n===undefined||i>n){n=i}}}));if(!n){n=0}return n};const Un=(t,n)=>{const r={lhs:[],rhs:[]};t===null||t===void 0?void 0:t.forEach((t=>{if(n(t)){r.lhs.push(t)}else{r.rhs.push(t)}}));return r};const Fn=(t,n)=>{const r=Date.now();try{return n()}finally{console.log(`${t} time: ${Date.now()-r}ms`)}};const Bn=(t,n)=>n();const Dn=(t,n)=>t.reduce(((t,r)=>{const e=n(t);const i=n(r);return e>i?r:t}));const Pn=t=>{t.graph().dummyChains=[];t.edges().forEach((n=>Gn(t,n)))};const Gn=(t,n)=>{let r=n.v;let e=t.node(r).rank;const i=n.w;const a=t.node(i).rank;const o=n.name;const u=t.edge(n);const f=u.labelRank;if(a===e+1)return;t.removeEdgeObj(n);const s=t.graph();let c;let l;let v;for(v=0,++e;e<a;++v,++e){u.points=[];l={edgeLabel:u,width:0,height:0,edgeObj:n,rank:e};c=On(t,"edge",l,"_d");if(e===f){l.width=u.width;l.height=u.height;l.dummy="edge-label";l.labelpos=u.labelpos}t.setEdge(r,c,{weight:u.weight},o);if(v===0){if(!s.dummyChains)s.dummyChains=[];s.dummyChains.push(c)}r=c}t.setEdge(r,i,{weight:u.weight},o)};const Vn=t=>{var n;(n=t.graph().dummyChains)===null||n===void 0?void 0:n.forEach((n=>{let r=t.node(n);const e=r.edgeLabel;let i;if(r.edgeObj){t.setEdgeObj(r.edgeObj,e)}let a=n;while(r.dummy){i=t.successors(a)[0];t.removeNode(a);e.points.push({x:r.x,y:r.y});if(r.dummy==="edge-label"){e.x=r.x;e.y=r.y;e.width=r.width;e.height=r.height}a=i;r=t.node(a)}}))};const Xn={run:Pn,undo:Vn};const zn=t=>{var n;const r={};const e=n=>{var i;const a=t.node(n);if(!a)return 0;if(r[n]){return a.rank}r[n]=true;let o;(i=t.outEdges(n))===null||i===void 0?void 0:i.forEach((n=>{const r=e(n.w);const i=t.edge(n).minlen;const a=r-i;if(a){if(o===undefined||a<o){o=a}}}));if(!o){o=0}a.rank=o;return o};(n=t.sources())===null||n===void 0?void 0:n.forEach((t=>e(t)))};const Hn=t=>{var n;const r={};let e;const i=n=>{var a;const o=t.node(n);if(!o)return 0;if(r[n]){return o.rank}r[n]=true;let u;(a=t.outEdges(n))===null||a===void 0?void 0:a.forEach((n=>{const r=i(n.w);const e=t.edge(n).minlen;const a=r-e;if(a){if(u===undefined||a<u){u=a}}}));if(!u){u=0}if(e===undefined||u<e){e=u}o.rank=u;return u};(n=t.sources())===null||n===void 0?void 0:n.forEach((n=>{if(t.node(n))i(n)}));if(e===undefined){e=0}const a={};const o=(n,r)=>{var e;const i=t.node(n);const u=!isNaN(i.layer)?i.layer:r;if(i.rank===undefined||i.rank<u){i.rank=u}if(a[n])return;a[n]=true;(e=t.outEdges(n))===null||e===void 0?void 0:e.map((n=>{o(n.w,u+t.edge(n).minlen)}))};t.nodes().forEach((n=>{const r=t.node(n);if(!r)return;if(!isNaN(r.layer)){o(n,r.layer)}else{r.rank-=e}}))};const Wn=(t,n)=>t.node(n.w).rank-t.node(n.v).rank-t.edge(n).minlen;const $n=t=>{const n=new Tn({directed:false});const r=t.nodes()[0];const e=t.nodeCount();n.setNode(r,{});let i;let a;while(Yn(n,t)<e){i=Qn(n,t);a=n.hasNode(i.v)?Wn(t,i):-Wn(t,i);Zn(n,t,a)}return n};const Yn=(t,n)=>{const r=e=>{n.nodeEdges(e).forEach((i=>{const a=i.v;const o=e===a?i.w:a;if(!t.hasNode(o)&&!Wn(n,i)){t.setNode(o,{});t.setEdge(e,o,{});r(o)}}))};t.nodes().forEach(r);return t.nodeCount()};const qn=t=>{const n=new Tn({directed:false});const r=t.nodes()[0];const e=t.nodes().filter((n=>!!t.node(n))).length;n.setNode(r,{});let i;let a;while(Kn(n,t)<e){i=Qn(n,t);a=n.hasNode(i.v)?Wn(t,i):-Wn(t,i);Zn(n,t,a)}return n};const Kn=(t,n)=>{const r=e=>{var i;(i=n.nodeEdges(e))===null||i===void 0?void 0:i.forEach((i=>{const a=i.v;const o=e===a?i.w:a;if(!t.hasNode(o)&&(n.node(o).layer!==undefined||!Wn(n,i))){t.setNode(o,{});t.setEdge(e,o,{});r(o)}}))};t.nodes().forEach(r);return t.nodeCount()};const Qn=(t,n)=>Dn(n.edges(),(r=>{if(t.hasNode(r.v)!==t.hasNode(r.w)){return Wn(n,r)}return Infinity}));const Zn=(t,n,r)=>{t.nodes().forEach((t=>{if(!n.node(t).rank)n.node(t).rank=0;n.node(t).rank+=r}))};const{preorder:Jn,postorder:tr}=ln;const nr=t=>{const n=xn(t);zn(n);const r=$n(n);ar(r);rr(r,n);let e;let i;while(e=ur(r)){i=fr(r,n,e);sr(r,n,e,i)}};const rr=(t,n)=>{let r=tr(t,t.nodes());r=r===null||r===void 0?void 0:r.slice(0,(r===null||r===void 0?void 0:r.length)-1);r===null||r===void 0?void 0:r.forEach((r=>{er(t,n,r)}))};const er=(t,n,r)=>{const e=t.node(r);const i=e.parent;t.edgeFromArgs(r,i).cutvalue=ir(t,n,r)};const ir=(t,n,r)=>{var e;const i=t.node(r);const a=i.parent;let o=true;let u=n.edgeFromArgs(r,a);let f=0;if(!u){o=false;u=n.edgeFromArgs(a,r)}f=u.weight;(e=n.nodeEdges(r))===null||e===void 0?void 0:e.forEach((e=>{const i=e.v===r;const u=i?e.w:e.v;if(u!==a){const a=i===o;const s=n.edge(e).weight;f+=a?s:-s;if(lr(t,r,u)){const n=t.edgeFromArgs(r,u).cutvalue;f+=a?-n:n}}}));return f};const ar=(t,n=t.nodes()[0])=>{or(t,{},1,n)};const or=(t,n,r,e,i)=>{var a;const o=r;let u=r;const f=t.node(e);n[e]=true;(a=t.neighbors(e))===null||a===void 0?void 0:a.forEach((r=>{if(!n[r]){u=or(t,n,u,r,e)}}));f.low=o;f.lim=u++;if(i){f.parent=i}else{delete f.parent}return u};const ur=t=>t.edges().find((n=>t.edge(n).cutvalue<0));const fr=(t,n,r)=>{let e=r.v;let i=r.w;if(!n.hasEdge(e,i)){e=r.w;i=r.v}const a=t.node(e);const o=t.node(i);let u=a;let f=false;if(a.lim>o.lim){u=o;f=true}const s=n.edges().filter((n=>f===vr(t,t.node(n.v),u)&&f!==vr(t,t.node(n.w),u)));return Dn(s,(t=>Wn(n,t)))};const sr=(t,n,r,e)=>{const i=r.v;const a=r.w;t.removeEdge(i,a);t.setEdge(e.v,e.w,{});ar(t);rr(t,n);cr(t,n)};const cr=(t,n)=>{const r=t.nodes().find((t=>{var r;return!((r=n.node(t))===null||r===void 0?void 0:r.parent)}));let e=Jn(t,r);e=e===null||e===void 0?void 0:e.slice(1);e===null||e===void 0?void 0:e.forEach((r=>{const e=t.node(r).parent;let i=n.edgeFromArgs(r,e);let a=false;if(!i){i=n.edgeFromArgs(e,r);a=true}n.node(r).rank=n.node(e).rank+(a?i.minlen:-i.minlen)}))};const lr=(t,n,r)=>t.hasEdge(n,r);const vr=(t,n,r)=>r.low<=n.lim&&n.lim<=r.lim;const dr=t=>{switch(t.graph().ranker){case"network-simplex":pr(t);break;case"tight-tree":br(t);break;case"longest-path":hr(t);break;default:br(t)}};const hr=zn;const br=t=>{Hn(t);qn(t)};const pr=t=>{nr(t)};const mr=t=>{var n;const r={};let e=0;const i=n=>{var a;const o=e;(a=t.children(n))===null||a===void 0?void 0:a.forEach(i);r[n]={low:o,lim:e++}};(n=t.children())===null||n===void 0?void 0:n.forEach(i);return r};const yr=(t,n,r,e)=>{const i=[];const a=[];const o=Math.min(n[r].low,n[e].low);const u=Math.max(n[r].lim,n[e].lim);let f;let s;f=r;do{f=t.parent(f);i.push(f)}while(f&&(n[f].low>o||u>n[f].lim));s=f;f=e;while(f&&f!==s){a.push(f);f=t.parent(f)}return{lca:s,path:i.concat(a.reverse())}};const wr=t=>{var n;const r=mr(t);(n=t.graph().dummyChains)===null||n===void 0?void 0:n.forEach((n=>{var e,i;let a=n;let o=t.node(a);const u=o.edgeObj;if(!u)return;const f=yr(t,r,u.v,u.w);const s=f.path;const c=f.lca;let l=0;let v=s[l];let d=true;while(a!==u.w){o=t.node(a);if(d){while(v!==c&&((e=t.node(v))===null||e===void 0?void 0:e.maxRank)<o.rank){l++;v=s[l]}if(v===c){d=false}}if(!d){while(l<s.length-1&&((i=t.node(s[l+1]))===null||i===void 0?void 0:i.minRank)<=o.rank){l++}v=s[l]}t.setParent(a,v);a=t.successors(a)[0]}}))};const gr=t=>{var n;const r=On(t,"root",{},"_root");const e=Ar(t);let i=Math.max(...Object.values(e));if(Math.abs(i)===Infinity){i=1}const a=i-1;const o=2*a+1;t.graph().nestingRoot=r;t.edges().forEach((n=>{t.edge(n).minlen*=o}));const u=_r(t)+1;(n=t.children())===null||n===void 0?void 0:n.forEach((n=>{Er(t,r,o,u,a,e,n)}));t.graph().nodeRankFactor=o};const Er=(t,n,r,e,i,a,o)=>{const u=t.children(o);if(!(u===null||u===void 0?void 0:u.length)){if(o!==n){t.setEdge(n,o,{weight:0,minlen:r})}return}const f=Ln(t,"_bt");const s=Ln(t,"_bb");const c=t.node(o);t.setParent(f,o);c.borderTop=f;t.setParent(s,o);c.borderBottom=s;u===null||u===void 0?void 0:u.forEach((u=>{Er(t,n,r,e,i,a,u);const c=t.node(u);const l=c.borderTop?c.borderTop:u;const v=c.borderBottom?c.borderBottom:u;const d=c.borderTop?e:2*e;const h=l!==v?1:i-a[o]+1;t.setEdge(f,l,{minlen:h,weight:d,nestingEdge:true});t.setEdge(v,s,{minlen:h,weight:d,nestingEdge:true})}));if(!t.parent(o)){t.setEdge(n,f,{weight:0,minlen:i+a[o]})}};const Ar=t=>{var n;const r={};const e=(n,i)=>{const a=t.children(n);a===null||a===void 0?void 0:a.forEach((t=>e(t,i+1)));r[n]=i};(n=t.children())===null||n===void 0?void 0:n.forEach((t=>e(t,1)));return r};const _r=t=>{let n=0;t.edges().forEach((r=>{n+=t.edge(r).weight}));return n};const Tr=t=>{const n=t.graph();n.nestingRoot&&t.removeNode(n.nestingRoot);delete n.nestingRoot;t.edges().forEach((n=>{const r=t.edge(n);if(r.nestingEdge){t.removeEdgeObj(n)}}))};const Rr={run:gr,cleanup:Tr};const Or=t=>{var n;const r=n=>{const e=t.children(n);const i=t.node(n);if(e===null||e===void 0?void 0:e.length){e.forEach((t=>r(t)))}if(i.hasOwnProperty("minRank")){i.borderLeft=[];i.borderRight=[];for(let r=i.minRank,e=i.maxRank+1;r<e;r+=1){xr(t,"borderLeft","_bl",n,i,r);xr(t,"borderRight","_br",n,i,r)}}};(n=t.children())===null||n===void 0?void 0:n.forEach((t=>r(t)))};const xr=(t,n,r,e,i,a)=>{const o={rank:a,borderType:n,width:0,height:0};const u=i[n][a-1];const f=On(t,"border",o,r);i[n][a]=f;t.setParent(f,e);if(u){t.setEdge(u,f,{weight:1})}};const jr=t=>{var n;const r=(n=t.graph().rankdir)===null||n===void 0?void 0:n.toLowerCase();if(r==="lr"||r==="rl"){Nr(t)}};const Sr=t=>{var n;const r=(n=t.graph().rankdir)===null||n===void 0?void 0:n.toLowerCase();if(r==="bt"||r==="rl"){Mr(t)}if(r==="lr"||r==="rl"){Lr(t);Nr(t)}};const Nr=t=>{t.nodes().forEach((n=>{Ir(t.node(n))}));t.edges().forEach((n=>{Ir(t.edge(n))}))};const Ir=t=>{const n=t.width;t.width=t.height;t.height=n};const Mr=t=>{t.nodes().forEach((n=>{Cr(t.node(n))}));t.edges().forEach((n=>{var r;const e=t.edge(n);(r=e.points)===null||r===void 0?void 0:r.forEach((t=>Cr(t)));if(e.hasOwnProperty("y")){Cr(e)}}))};const Cr=t=>{if(t===null||t===void 0?void 0:t.y){t.y=-t.y}};const Lr=t=>{t.nodes().forEach((n=>{kr(t.node(n))}));t.edges().forEach((n=>{var r;const e=t.edge(n);(r=e.points)===null||r===void 0?void 0:r.forEach((t=>kr(t)));if(e.hasOwnProperty("x")){kr(e)}}))};const kr=t=>{const n=t.x;t.x=t.y;t.y=n};const Ur={adjust:jr,undo:Sr};const Fr=t=>{const n={};const r=t.nodes().filter((n=>{var r;return!((r=t.children(n))===null||r===void 0?void 0:r.length)}));const e=r.map((n=>t.node(n).rank));const i=Math.max(...e);const a=[];for(let t=0;t<i+1;t++){a.push([])}const o=r=>{var e;if(n.hasOwnProperty(r))return;n[r]=true;const i=t.node(r);if(!isNaN(i.rank)){a[i.rank].push(r)}(e=t.successors(r))===null||e===void 0?void 0:e.forEach((t=>o(t)))};const u=r.sort(((n,r)=>t.node(n).rank-t.node(r).rank));const f=u.filter((n=>t.node(n).fixorder!==undefined));const s=f.sort(((n,r)=>t.node(n).fixorder-t.node(r).fixorder));s===null||s===void 0?void 0:s.forEach((r=>{if(!isNaN(t.node(r).rank)){a[t.node(r).rank].push(r)}n[r]=true}));u===null||u===void 0?void 0:u.forEach(o);return a};const Br=(t,n,r)=>{const e=Sn(r,r.map(((t,n)=>n)));const i=n.map((n=>{var r;const i=(r=t.outEdges(n))===null||r===void 0?void 0:r.map((n=>({pos:e[n.w]||0,weight:t.edge(n).weight})));return i===null||i===void 0?void 0:i.sort(((t,n)=>t.pos-n.pos))}));const a=i.flat().filter((t=>t!==undefined));let o=1;while(o<r.length)o<<=1;const u=2*o-1;o-=1;const f=Array(u).fill(0,0,u);let s=0;a===null||a===void 0?void 0:a.forEach((t=>{if(t){let n=t.pos+o;f[n]+=t.weight;let r=0;while(n>0){if(n%2){r+=f[n+1]}n=n-1>>1;f[n]+=t.weight}s+=t.weight*r}}));return s};const Dr=(t,n)=>{let r=0;for(let e=1;e<(n===null||n===void 0?void 0:n.length);e+=1){r+=Br(t,n[e-1],n[e])}return r};const Pr=(t,n,r)=>{const e=Gr(t);const i=new Tn({compound:true}).setGraph({root:e}).setDefaultNodeLabel((n=>t.node(n)));t.nodes().forEach((a=>{var o;const u=t.node(a);const f=t.parent(a);if(u.rank===n||u.minRank<=n&&n<=u.maxRank){i.setNode(a);i.setParent(a,f||e);(o=t[r](a))===null||o===void 0?void 0:o.forEach((n=>{const r=n.v===a?n.w:n.v;const e=i.edgeFromArgs(r,a);const o=e!==undefined?e.weight:0;i.setEdge(r,a,{weight:t.edge(n).weight+o})}));if(u.hasOwnProperty("minRank")){i.setNode(a,{borderLeft:u.borderLeft[n],borderRight:u.borderRight[n]})}}}));return i};const Gr=t=>{let n;while(t.hasNode(n=`_root${Math.random()}`));return n};const Vr=(t,n,r)=>{const e={};let i;r===null||r===void 0?void 0:r.forEach((r=>{let a=t.parent(r);let o;let u;while(a){o=t.parent(a);if(o){u=e[o];e[o]=a}else{u=i;i=a}if(u&&u!==a){n.setEdge(u,a);return}a=o}}))};const Xr=(t,n)=>n.map((n=>{const r=t.inEdges(n);if(!(r===null||r===void 0?void 0:r.length)){return{v:n}}{const e={sum:0,weight:0};r===null||r===void 0?void 0:r.forEach((n=>{const r=t.edge(n);const i=t.node(n.v);e.sum+=r.weight*i.order;e.weight+=r.weight}));return{v:n,barycenter:e.sum/e.weight,weight:e.weight}}}));const zr=(t,n)=>{var r,e,i;const a={};t===null||t===void 0?void 0:t.forEach(((t,n)=>{a[t.v]={i:n,indegree:0,in:[],out:[],vs:[t.v]};const r=a[t.v];if(t.barycenter!==undefined){r.barycenter=t.barycenter;r.weight=t.weight}}));(r=n.edges())===null||r===void 0?void 0:r.forEach((t=>{const n=a[t.v];const r=a[t.w];if(n!==undefined&&r!==undefined){r.indegree++;n.out.push(a[t.w])}}));const o=(i=(e=Object.values(a)).filter)===null||i===void 0?void 0:i.call(e,(t=>!t.indegree));return Hr(o)};const Hr=t=>{var n,r;const e=[];const i=t=>n=>{if(n.merged)return;if(n.barycenter===undefined||t.barycenter===undefined||n.barycenter>=t.barycenter){Wr(t,n)}};const a=n=>r=>{r["in"].push(n);if(--r.indegree===0){t.push(r)}};while(t===null||t===void 0?void 0:t.length){const o=t.pop();e.push(o);(n=o["in"].reverse())===null||n===void 0?void 0:n.forEach((t=>i(o)(t)));(r=o.out)===null||r===void 0?void 0:r.forEach((t=>a(o)(t)))}const o=e.filter((t=>!t.merged));const u=["vs","i","barycenter","weight"];return o.map((t=>{const n={};u===null||u===void 0?void 0:u.forEach((r=>{if(t[r]===undefined)return;n[r]=t[r]}));return n}))};const Wr=(t,n)=>{var r;let e=0;let i=0;if(t.weight){e+=t.barycenter*t.weight;i+=t.weight}if(n.weight){e+=n.barycenter*n.weight;i+=n.weight}t.vs=(r=n.vs)===null||r===void 0?void 0:r.concat(t.vs);t.barycenter=e/i;t.weight=i;t.i=Math.min(n.i,t.i);n.merged=true};const $r=(t,n,r,e)=>{const i=Un(t,(t=>{const n=t.hasOwnProperty("fixorder")&&!isNaN(t.fixorder);if(e)return!n&&t.hasOwnProperty("barycenter");return n||t.hasOwnProperty("barycenter")}));const a=i.lhs;const o=i.rhs.sort(((t,n)=>-t.i- -n.i));const u=[];let f=0;let s=0;let c=0;a===null||a===void 0?void 0:a.sort(qr(!!n,!!r));c=Yr(u,o,c);a===null||a===void 0?void 0:a.forEach((t=>{var n;c+=(n=t.vs)===null||n===void 0?void 0:n.length;u.push(t.vs);f+=t.barycenter*t.weight;s+=t.weight;c=Yr(u,o,c)}));const l={vs:u.flat()};if(s){l.barycenter=f/s;l.weight=s}return l};const Yr=(t,n,r)=>{let e=r;let i;while(n.length&&(i=n[n.length-1]).i<=e){n.pop();t===null||t===void 0?void 0:t.push(i.vs);e++}return e};const qr=(t,n)=>(r,e)=>{if(r.fixorder!==undefined&&e.fixorder!==undefined){return r.fixorder-e.fixorder}if(r.barycenter<e.barycenter){return-1}if(r.barycenter>e.barycenter){return 1}if(n&&r.order!==undefined&&e.order!==undefined){if(r.order<e.order){return-1}if(r.order>e.order){return 1}}return!t?r.i-e.i:e.i-r.i};const Kr=(t,n,r,e,i,a)=>{var o,u,f,s;let c=t.children(n);const l=t.node(n);const v=l?l.borderLeft:undefined;const d=l?l.borderRight:undefined;const h={};if(v){c=c===null||c===void 0?void 0:c.filter((t=>t!==v&&t!==d))}const b=Xr(t,c||[]);b===null||b===void 0?void 0:b.forEach((n=>{var i;if((i=t.children(n.v))===null||i===void 0?void 0:i.length){const i=Kr(t,n.v,r,e,a);h[n.v]=i;if(i.hasOwnProperty("barycenter")){Zr(n,i)}}}));const p=zr(b,r);Qr(p,h);(o=p.filter((t=>t.vs.length>0)))===null||o===void 0?void 0:o.forEach((n=>{const r=t.node(n.vs[0]);if(r){n.fixorder=r.fixorder;n.order=r.order}}));const m=$r(p,e,i,a);if(v){m.vs=[v,m.vs,d].flat();if((u=t.predecessors(v))===null||u===void 0?void 0:u.length){const n=t.node(((f=t.predecessors(v))===null||f===void 0?void 0:f[0])||"");const r=t.node(((s=t.predecessors(d))===null||s===void 0?void 0:s[0])||"");if(!m.hasOwnProperty("barycenter")){m.barycenter=0;m.weight=0}m.barycenter=(m.barycenter*m.weight+n.order+r.order)/(m.weight+2);m.weight+=2}}return m};const Qr=(t,n)=>{t===null||t===void 0?void 0:t.forEach((t=>{var r;const e=(r=t.vs)===null||r===void 0?void 0:r.map((t=>{if(n[t]){return n[t].vs}return t}));t.vs=e.flat()}))};const Zr=(t,n)=>{if(t.barycenter!==undefined){t.barycenter=(t.barycenter*t.weight+n.barycenter*n.weight)/(t.weight+n.weight);t.weight+=n.weight}else{t.barycenter=n.barycenter;t.weight=n.weight}};const Jr=(t,n)=>{const r=kn(t);const e=[];const i=[];for(let t=1;t<r+1;t++)e.push(t);for(let t=r-1;t>-1;t--)i.push(t);const a=te(t,e,"inEdges");const o=te(t,i,"outEdges");let u=Fr(t);re(t,u);let f=Number.POSITIVE_INFINITY;let s;for(let r=0,e=0;e<4;++r,++e){ne(r%2?a:o,r%4>=2,false,n);u=In(t);const i=Dr(t,u);if(i<f){e=0;s=Q(u);f=i}}u=Fr(t);re(t,u);for(let r=0,e=0;e<4;++r,++e){ne(r%2?a:o,r%4>=2,true,n);u=In(t);const i=Dr(t,u);if(i<f){e=0;s=Q(u);f=i}}re(t,s)};const te=(t,n,r)=>n.map((n=>Pr(t,n,r)));const ne=(t,n,r,e)=>{const i=new Tn;t===null||t===void 0?void 0:t.forEach((t=>{var a;const o=t.graph().root;const u=Kr(t,o,i,n,r,e);for(let n=0;n<((a=u.vs)===null||a===void 0?void 0:a.length)||0;n++){const r=t.node(u.vs[n]);if(r){r.order=n}}Vr(t,i,u.vs)}))};const re=(t,n)=>{n===null||n===void 0?void 0:n.forEach((n=>{n===null||n===void 0?void 0:n.forEach(((n,r)=>{t.node(n).order=r}))}))};class ee extends Et{}const ie=(t,n)=>{const r={};const e=(n,e)=>{let i=0;let a=0;const o=n.length;const u=e===null||e===void 0?void 0:e[(e===null||e===void 0?void 0:e.length)-1];e===null||e===void 0?void 0:e.forEach(((n,f)=>{var s;const c=oe(t,n);const l=c?t.node(c).order:o;if(c||n===u){(s=e.slice(a,f+1))===null||s===void 0?void 0:s.forEach((n=>{var e;(e=t.predecessors(n))===null||e===void 0?void 0:e.forEach((e=>{var a;const o=t.node(e);const u=o.order;if((u<i||l<u)&&!(o.dummy&&((a=t.node(n))===null||a===void 0?void 0:a.dummy))){ue(r,e,n)}}))}));a=f+1;i=l}}));return e};if(n===null||n===void 0?void 0:n.length){n.reduce(e)}return r};const ae=(t,n)=>{const r={};function e(n,e,i,a,o){var u,f;let s;for(let c=e;c<i;c++){s=n[c];if((u=t.node(s))===null||u===void 0?void 0:u.dummy){(f=t.predecessors(s))===null||f===void 0?void 0:f.forEach((n=>{const e=t.node(n);if(e.dummy&&(e.order<a||e.order>o)){ue(r,n,s)}}))}}}function i(t){return JSON.stringify(t.slice(1))}function a(t,n){const r=i(t);if(n.get(r))return;e(...t);n.set(r,true)}const o=(n,r)=>{let e=-1;let i;let o=0;const u=new Map;r===null||r===void 0?void 0:r.forEach(((f,s)=>{var c;if(((c=t.node(f))===null||c===void 0?void 0:c.dummy)==="border"){const n=t.predecessors(f)||[];if(n.length){i=t.node(n[0]).order;a([r,o,s,e,i],u);o=s;e=i}}a([r,o,r.length,i,n.length],u)}));return r};if(n===null||n===void 0?void 0:n.length){n.reduce(o)}return r};const oe=(t,n)=>{var r,e;if((r=t.node(n))===null||r===void 0?void 0:r.dummy){return(e=t.predecessors(n))===null||e===void 0?void 0:e.find((n=>t.node(n).dummy))}};const ue=(t,n,r)=>{let e=n;let i=r;if(e>i){const t=e;e=i;i=t}let a=t[e];if(!a){t[e]=a={}}a[i]=true};const fe=(t,n,r)=>{let e=n;let i=r;if(e>i){const t=n;e=i;i=t}return!!t[e]};const se=(t,n,r,e)=>{const i={};const a={};const o={};n===null||n===void 0?void 0:n.forEach((t=>{t===null||t===void 0?void 0:t.forEach(((t,n)=>{i[t]=t;a[t]=t;o[t]=n}))}));n===null||n===void 0?void 0:n.forEach((t=>{let n=-1;t===null||t===void 0?void 0:t.forEach((t=>{let u=e(t);if(u.length){u=u.sort(((t,n)=>o[t]-o[n]));const e=(u.length-1)/2;for(let f=Math.floor(e),s=Math.ceil(e);f<=s;++f){const e=u[f];if(a[t]===t&&n<o[e]&&!fe(r,t,e)){a[e]=t;a[t]=i[t]=i[e];n=o[e]}}}}))}));return{root:i,align:a}};const ce=(t,n,r,e,i)=>{var a;const o={};const u=le(t,n,r,i);const f=i?"borderLeft":"borderRight";const s=(t,n)=>{let r=u.nodes();let e=r.pop();const i={};while(e){if(i[e]){t(e)}else{i[e]=true;r.push(e);r=r.concat(n(e))}e=r.pop()}};const c=t=>{o[t]=(u.inEdges(t)||[]).reduce(((t,n)=>Math.max(t,(o[n.v]||0)+u.edge(n))),0)};const l=n=>{const r=(u.outEdges(n)||[]).reduce(((t,n)=>Math.min(t,(o[n.w]||0)-u.edge(n))),Number.POSITIVE_INFINITY);const e=t.node(n);if(r!==Number.POSITIVE_INFINITY&&e.borderType!==f){o[n]=Math.max(o[n],r)}};s(c,u.predecessors.bind(u));s(l,u.successors.bind(u));(a=Object.values(e))===null||a===void 0?void 0:a.forEach((t=>{o[t]=o[r[t]]}));return o};const le=(t,n,r,e)=>{const i=new ee;const a=t.graph();const o=be(a.nodesep,a.edgesep,e);n===null||n===void 0?void 0:n.forEach((n=>{let e;n===null||n===void 0?void 0:n.forEach((n=>{const a=r[n];i.setNode(a);if(e){const u=r[e];const f=i.edgeFromArgs(u,a);i.setEdge(u,a,Math.max(o(t,n,e),f||0))}e=n}))}));return i};const ve=(t,n)=>Dn(Object.values(n),(n=>{var r;let e=Number.NEGATIVE_INFINITY;let i=Number.POSITIVE_INFINITY;(r=Object.keys(n))===null||r===void 0?void 0:r.forEach((r=>{const a=n[r];const o=pe(t,r)/2;e=Math.max(a+o,e);i=Math.min(a-o,i)}));return e-i}));function de(t,n){const r=Object.values(n);const e=Math.min(...r);const i=Math.max(...r);["u","d"].forEach((r=>{["l","r"].forEach((a=>{const o=r+a;const u=t[o];let f;if(u===n)return;const s=Object.values(u);f=a==="l"?e-Math.min(...s):i-Math.max(...s);if(f){t[o]={};Object.keys(u).forEach((n=>{t[o][n]=u[n]+f}))}}))}))}const he=(t,n)=>{const r={};Object.keys(t.ul).forEach((e=>{if(n){r[e]=t[n.toLowerCase()][e]}else{const n=Object.values(t).map((t=>t[e]));r[e]=(n[0]+n[1])/2}}));return r};const be=(t,n,r)=>(e,i,a)=>{const o=e.node(i);const u=e.node(a);let f=0;let s;f+=o.width/2;if(o.hasOwnProperty("labelpos")){switch((o.labelpos||"").toLowerCase()){case"l":s=-o.width/2;break;case"r":s=o.width/2;break}}if(s){f+=r?s:-s}s=0;f+=(o.dummy?n:t)/2;f+=(u.dummy?n:t)/2;f+=u.width/2;if(u.labelpos){switch((u.labelpos||"").toLowerCase()){case"l":s=u.width/2;break;case"r":s=-u.width/2;break}}if(s){f+=r?s:-s}s=0;return f};const pe=(t,n)=>t.node(n).width||0;const me=t=>{const n=In(t);const r=t.graph().ranksep;let e=0;n===null||n===void 0?void 0:n.forEach((n=>{const i=n.map((n=>t.node(n).height));const a=Math.max(...i,0);n===null||n===void 0?void 0:n.forEach((n=>{t.node(n).y=e+a/2}));e+=a+r}))};const ye=t=>{const n=In(t);const r=Object.assign(ie(t,n),ae(t,n));const e={};let i=[];["u","d"].forEach((a=>{i=a==="u"?n:Object.values(n).reverse();["l","r"].forEach((n=>{if(n==="r"){i=i.map((t=>Object.values(t).reverse()))}const o=(a==="u"?t.predecessors:t.successors).bind(t);const u=se(t,i,r,o);const f=ce(t,i,u.root,u.align,n==="r");if(n==="r"){Object.keys(f).forEach((t=>f[t]=-f[t]))}e[a+n]=f}))}));const a=ve(t,e);a&&de(e,a);return he(e,t.graph().align)};const we=t=>{var n;const r=jn(t);me(r);const e=ye(r);(n=Object.keys(e))===null||n===void 0?void 0:n.forEach((t=>{r.node(t).x=e[t]}))};const ge=(t,n)=>{const r=t.nodes().filter((n=>{var r;return!((r=t.children(n))===null||r===void 0?void 0:r.length)}));const e=r.map((n=>t.node(n).rank));const i=Math.max(...e);const a=[];for(let t=0;t<i+1;t++){a[t]=[]}n===null||n===void 0?void 0:n.forEach((n=>{const r=t.node(n);if(!r||(r===null||r===void 0?void 0:r.dummy)){return}if(!isNaN(r.rank)){r.fixorder=a[r.rank].length;a[r.rank].push(n)}}))};const Ee=(t,n)=>{const r=n&&n.debugTiming?Fn:Bn;r("layout",(()=>{if(n&&!n.keepNodeOrder&&n.prevGraph){r("  inheritOrder",(()=>{_e(t,n.prevGraph)}))}const e=r("  buildLayoutGraph",(()=>Ce(t)));if(!(n&&n.edgeLabelSpace===false)){r("  makeSpaceForEdgeLabels",(()=>{Le(e)}))}try{r("  runLayout",(()=>{Ae(e,r,n)}))}catch(t){if(t.message==="Not possible to find intersection inside of the rectangle"){console.error("The following error may be caused by improper layer setting, please make sure your manual layer setting does not violate the graph's structure:\n",t);return}throw t}r("  updateInputGraph",(()=>{Te(t,e)}))}))};const Ae=(t,n,r)=>{n("    removeSelfEdges",(()=>{Xe(t)}));n("    acyclic",(()=>{_n.run(t)}));n("    nestingGraph.run",(()=>{Rr.run(t)}));n("    rank",(()=>{dr(jn(t))}));n("    injectEdgeLabelProxies",(()=>{ke(t)}));n("    removeEmptyRanks",(()=>{Cn(t)}));n("    nestingGraph.cleanup",(()=>{Rr.cleanup(t)}));n("    normalizeRanks",(()=>{Mn(t)}));n("    assignRankMinMax",(()=>{Ue(t)}));n("    removeEdgeLabelProxies",(()=>{Fe(t)}));n("    normalize.run",(()=>{Xn.run(t)}));n("    parentDummyChains",(()=>{wr(t)}));n("    addBorderSegments",(()=>{Or(t)}));if(r&&r.keepNodeOrder){n("    initDataOrder",(()=>{ge(t,r.nodeOrder)}))}n("    order",(()=>{Jr(t,r===null||r===void 0?void 0:r.keepNodeOrder)}));n("    insertSelfEdges",(()=>{ze(t)}));n("    adjustCoordinateSystem",(()=>{Ur.adjust(t)}));n("    position",(()=>{we(t)}));n("    positionSelfEdges",(()=>{He(t)}));n("    removeBorderNodes",(()=>{Ve(t)}));n("    normalize.undo",(()=>{Xn.undo(t)}));n("    fixupEdgeLabelCoords",(()=>{Pe(t)}));n("    undoCoordinateSystem",(()=>{Ur.undo(t)}));n("    translateGraph",(()=>{Be(t)}));n("    assignNodeIntersects",(()=>{De(t)}));n("    reversePoints",(()=>{Ge(t)}));n("    acyclic.undo",(()=>{_n.undo(t)}))};const _e=(t,n)=>{t.nodes().forEach((r=>{const e=t.node(r);const i=n.node(r);if(i!==undefined){e.fixorder=i._order;delete i._order}else{delete e.fixorder}}))};const Te=(t,n)=>{t.nodes().forEach((r=>{var e;const i=t.node(r);if(i){const t=n.node(r);i.x=t.x;i.y=t.y;i._order=t.order;i._rank=t.rank;if((e=n.children(r))===null||e===void 0?void 0:e.length){i.width=t.width;i.height=t.height}}}));t.edges().forEach((r=>{const e=t.edge(r);const i=n.edge(r);e.points=i?i.points:[];if(i&&i.hasOwnProperty("x")){e.x=i.x;e.y=i.y}}));t.graph().width=n.graph().width;t.graph().height=n.graph().height};const Re=["nodesep","edgesep","ranksep","marginx","marginy"];const Oe={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"};const xe=["acyclicer","ranker","rankdir","align"];const je=["width","height","layer","fixorder"];const Se={width:0,height:0};const Ne=["minlen","weight","width","height","labeloffset"];const Ie={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"};const Me=["labelpos"];const Ce=t=>{const n=new Tn({multigraph:true,compound:true});const r=$e(t.graph());const e={};xe===null||xe===void 0?void 0:xe.forEach((t=>{if(r[t]!==undefined)e[t]=r[t]}));n.setGraph(Object.assign({},Oe,We(r,Re),e));t.nodes().forEach((r=>{const e=$e(t.node(r));const i=Object.assign(Object.assign({},Se),e);const a=We(i,je);n.setNode(r,a);n.setParent(r,t.parent(r))}));t.edges().forEach((r=>{const e=$e(t.edge(r));const i={};Me===null||Me===void 0?void 0:Me.forEach((t=>{if(e[t]!==undefined)i[t]=e[t]}));n.setEdgeObj(r,Object.assign({},Ie,We(e,Ne),i))}));return n};const Le=t=>{const n=t.graph();if(!n.ranksep)n.ranksep=0;n.ranksep/=2;t.nodes().forEach((n=>{const r=t.node(n);if(!isNaN(r.layer)){if(!r.layer)r.layer=0}}));t.edges().forEach((r=>{var e;const i=t.edge(r);i.minlen*=2;if(((e=i.labelpos)===null||e===void 0?void 0:e.toLowerCase())!=="c"){if(n.rankdir==="TB"||n.rankdir==="BT"){i.width+=i.labeloffset}else{i.height+=i.labeloffset}}}))};const ke=t=>{t.edges().forEach((n=>{const r=t.edge(n);if(r.width&&r.height){const r=t.node(n.v);const e=t.node(n.w);const i={e:n,rank:(e.rank-r.rank)/2+r.rank};On(t,"edge-proxy",i,"_ep")}}))};const Ue=t=>{let n=0;t.nodes().forEach((r=>{var e,i;const a=t.node(r);if(a.borderTop){a.minRank=(e=t.node(a.borderTop))===null||e===void 0?void 0:e.rank;a.maxRank=(i=t.node(a.borderBottom))===null||i===void 0?void 0:i.rank;n=Math.max(n,a.maxRank||-Infinity)}}));t.graph().maxRank=n};const Fe=t=>{t.nodes().forEach((n=>{const r=t.node(n);if(r.dummy==="edge-proxy"){t.edge(r.e).labelRank=r.rank;t.removeNode(n)}}))};const Be=t=>{let n;let r=0;let e;let i=0;const a=t.graph();const o=a.marginx||0;const u=a.marginy||0;const f=t=>{if(!t)return;const a=t.x;const o=t.y;const u=t.width;const f=t.height;if(!isNaN(a)&&!isNaN(u)){if(n===undefined){n=a-u/2}n=Math.min(n,a-u/2);r=Math.max(r,a+u/2)}if(!isNaN(o)&&!isNaN(f)){if(e===undefined){e=o-f/2}e=Math.min(e,o-f/2);i=Math.max(i,o+f/2)}};t.nodes().forEach((n=>{f(t.node(n))}));t.edges().forEach((n=>{const r=t.edge(n);if(r===null||r===void 0?void 0:r.hasOwnProperty("x")){f(r)}}));n-=o;e-=u;t.nodes().forEach((r=>{const i=t.node(r);if(i){i.x-=n;i.y-=e}}));t.edges().forEach((r=>{var i;const a=t.edge(r);(i=a.points)===null||i===void 0?void 0:i.forEach((t=>{t.x-=n;t.y-=e}));if(a.hasOwnProperty("x")){a.x-=n}if(a.hasOwnProperty("y")){a.y-=e}}));a.width=r-n+o;a.height=i-e+u};const De=t=>{t.edges().forEach((n=>{const r=t.edge(n);const e=t.node(n.v);const i=t.node(n.w);let a;let o;if(!r.points){r.points=[];a=i;o=e}else{a=r.points[0];o=r.points[r.points.length-1]}r.points.unshift(Nn(e,a));r.points.push(Nn(i,o))}))};const Pe=t=>{t.edges().forEach((n=>{const r=t.edge(n);if(r===null||r===void 0?void 0:r.hasOwnProperty("x")){if(r.labelpos==="l"||r.labelpos==="r"){r.width-=r.labeloffset}switch(r.labelpos){case"l":r.x-=r.width/2+r.labeloffset;break;case"r":r.x+=r.width/2+r.labeloffset;break}}}))};const Ge=t=>{t.edges().forEach((n=>{var r;const e=t.edge(n);if(e.reversed){(r=e.points)===null||r===void 0?void 0:r.reverse()}}))};const Ve=t=>{t.nodes().forEach((n=>{var r,e,i;if((r=t.children(n))===null||r===void 0?void 0:r.length){const r=t.node(n);const a=t.node(r.borderTop);const o=t.node(r.borderBottom);const u=t.node(r.borderLeft[((e=r.borderLeft)===null||e===void 0?void 0:e.length)-1]);const f=t.node(r.borderRight[((i=r.borderRight)===null||i===void 0?void 0:i.length)-1]);r.width=Math.abs((f===null||f===void 0?void 0:f.x)-(u===null||u===void 0?void 0:u.x))||10;r.height=Math.abs((o===null||o===void 0?void 0:o.y)-(a===null||a===void 0?void 0:a.y))||10;r.x=((u===null||u===void 0?void 0:u.x)||0)+r.width/2;r.y=((a===null||a===void 0?void 0:a.y)||0)+r.height/2}}));t.nodes().forEach((n=>{var r;if(((r=t.node(n))===null||r===void 0?void 0:r.dummy)==="border"){t.removeNode(n)}}))};const Xe=t=>{t.edges().forEach((n=>{if(n.v===n.w){const r=t.node(n.v);if(!r.selfEdges){r.selfEdges=[]}r.selfEdges.push({e:n,label:t.edge(n)});t.removeEdgeObj(n)}}))};const ze=t=>{const n=In(t);n===null||n===void 0?void 0:n.forEach((n=>{let r=0;n===null||n===void 0?void 0:n.forEach(((n,e)=>{var i;const a=t.node(n);a.order=e+r;(i=a.selfEdges)===null||i===void 0?void 0:i.forEach((n=>{On(t,"selfedge",{width:n.label.width,height:n.label.height,rank:a.rank,order:e+ ++r,e:n.e,label:n.label},"_se")}));delete a.selfEdges}))}))};const He=t=>{t.nodes().forEach((n=>{const r=t.node(n);if(r.dummy==="selfedge"){const e=t.node(r.e.v);const i=e.x+e.width/2;const a=e.y;const o=r.x-i;const u=e.height/2;t.setEdgeObj(r.e,r.label);t.removeNode(n);r.label.points=[{x:i+2*o/3,y:a-u},{x:i+5*o/6,y:a-u},{y:a,x:i+o},{x:i+5*o/6,y:a+u},{x:i+2*o/3,y:a+u}];r.label.x=r.x;r.label.y=r.y}}))};const We=(t,n)=>{const r={};n===null||n===void 0?void 0:n.forEach((n=>{if(t[n]===undefined)return;r[n]=+t[n]}));return r};const $e=(t={})=>{const n={};Object.keys(t).forEach((r=>{n[r.toLowerCase()]=t[r]}));return n};const Ye={layout:Ee,util:{time:Fn,notime:Bn}};class qe extends W{constructor(t){super();this.rankdir="TB";this.nodesep=50;this.ranksep=50;this.controlPoints=false;this.sortByCombo=false;this.edgeLabelSpace=true;this.radial=false;this.nodes=[];this.edges=[];this.onLayoutEnd=()=>{};this.layoutNode=t=>{const n=this;const{nodes:r}=n;const e=r.find((n=>n.id===t));if(e){const t=e.layout!==false;return t}return true};this.updateCfg(t)}getDefaultCfg(){return{rankdir:"TB",align:undefined,nodeSize:undefined,nodesepFunc:undefined,ranksepFunc:undefined,nodesep:50,ranksep:50,controlPoints:false,radial:false,focusNode:null}}execute(){var t,n,r;const e=this;const{nodes:i,nodeSize:a,rankdir:o,combos:u,begin:f,radial:s,comboEdges:c=[],vedges:l=[]}=e;if(!i)return;const v=e.edges||[];const d=new Tn({multigraph:true,compound:true});e.nodeMap={};const h={};i.forEach((t=>{e.nodeMap[t.id]=t;if(!t.comboId)return;h[t.comboId]=h[t.comboId]||[];h[t.comboId].push(t.id)}));let b;if(!a){b=t=>{if(t.size){if(Y(t.size)){return t.size}if(K(t.size)){return[t.size.width||40,t.size.height||40]}return[t.size,t.size]}return[40,40]}}else if(Y(a)){b=()=>a}else{b=()=>[a,a]}const p=J(e.ranksep,50,e.ranksepFunc);const m=J(e.nodesep,50,e.nodesepFunc);let y=m;let w=p;if(o==="LR"||o==="RL"){y=p;w=m}d.setDefaultEdgeLabel((()=>({})));d.setGraph(e);const g={};if(this.sortByCombo&&u){u.forEach((t=>{g[t.id]=t;if(t.collapsed){const n=b(t);const r=w(t);const e=y(t);const i=n[0]+2*e;const a=n[1]+2*r;d.setNode(t.id,{width:i,height:a})}if(!t.parentId)return;if(!g[t.parentId]){d.setNode(t.parentId,{})}d.setParent(t.id,t.parentId)}))}i.filter((t=>t.layout!==false)).forEach((t=>{const n=b(t);const r=w(t);const e=y(t);const i=n[0]+2*e;const a=n[1]+2*r;const o=t.layer;if(q(o)){d.setNode(t.id,{width:i,height:a,layer:o})}else{d.setNode(t.id,{width:i,height:a})}if(this.sortByCombo&&t.comboId){if(!g[t.comboId]){g[t.comboId]={id:t.comboId};d.setNode(t.comboId,{})}d.setParent(t.id,t.comboId)}}));v.forEach((t=>{const n=Z(t,"source");const r=Z(t,"target");if(this.layoutNode(n)&&this.layoutNode(r)){d.setEdge(n,r,{weight:t.weight||1})}}));(t=c===null||c===void 0?void 0:c.concat(l||[]))===null||t===void 0?void 0:t.forEach((t=>{var n,r;const{source:e,target:i}=t;const a=((n=g[e])===null||n===void 0?void 0:n.collapsed)?[e]:h[e]||[e];const o=((r=g[i])===null||r===void 0?void 0:r.collapsed)?[i]:h[i]||[i];a.forEach((n=>{o.forEach((r=>{d.setEdge(n,r,{weight:t.weight||1})}))}))}));let E=undefined;if((n=e.preset)===null||n===void 0?void 0:n.nodes){E=new Tn({multigraph:true,compound:true});e.preset.nodes.forEach((t=>{E===null||E===void 0?void 0:E.setNode(t.id,t)}))}Ye.layout(d,{prevGraph:E,edgeLabelSpace:e.edgeLabelSpace,keepNodeOrder:Boolean(!!e.nodeOrder),nodeOrder:e.nodeOrder});const A=[0,0];if(f){let t=Infinity;let n=Infinity;d.nodes().forEach((r=>{const e=d.node(r);if(t>e.x)t=e.x;if(n>e.y)n=e.y}));d.edges().forEach((r=>{var e;const i=d.edge(r);(e=i.points)===null||e===void 0?void 0:e.forEach((r=>{if(t>r.x)t=r.x;if(n>r.y)n=r.y}))}));A[0]=f[0]-t;A[1]=f[1]-n}const _=o==="LR"||o==="RL";if(s){const{focusNode:t,ranksep:n,getRadialPos:a}=this;const o=$(t)?t:t===null||t===void 0?void 0:t.id;const u=o?(r=d.node(o))===null||r===void 0?void 0:r._rank:0;const f=[];const s=_?"y":"x";const c=_?"height":"width";let l=Infinity;let h=-Infinity;d.nodes().forEach((t=>{const n=d.node(t);const r=i.findIndex((n=>n.id===t));if(!i[r])return;const e=m(i[r]);if(u===0){if(!f[n._rank]){f[n._rank]={nodes:[],totalWidth:0,maxSize:-Infinity}}f[n._rank].nodes.push(t);f[n._rank].totalWidth+=e*2+n[c];if(f[n._rank].maxSize<Math.max(n.width,n.height)){f[n._rank].maxSize=Math.max(n.width,n.height)}}else{const r=n._rank-u;if(r===0){if(!f[r]){f[r]={nodes:[],totalWidth:0,maxSize:-Infinity}}f[r].nodes.push(t);f[r].totalWidth+=e*2+n[c];if(f[r].maxSize<Math.max(n.width,n.height)){f[r].maxSize=Math.max(n.width,n.height)}}else{const i=Math.abs(r);if(!f[i]){f[i]={left:[],right:[],totalWidth:0,maxSize:-Infinity}}f[i].totalWidth+=e*2+n[c];if(f[i].maxSize<Math.max(n.width,n.height)){f[i].maxSize=Math.max(n.width,n.height)}if(r<0){f[i].left.push(t)}else{f[i].right.push(t)}}}const a=n[s]-n[c]/2-e;const o=n[s]+n[c]/2+e;if(a<l)l=a;if(o>h)h=o}));let b=n||50;const y={};const w=(h-l)/.9;const g=[(l+h-w)*.5,(l+h+w)*.5];const E=(t,n,r=-Infinity,e=[0,1])=>{let o=r;t.forEach((t=>{const r=d.node(t);y[t]=n;const{x:u,y:f}=a(r[s],g,w,n,e);const c=i.findIndex((n=>n.id===t));if(!i[c])return;i[c].x=u+A[0];i[c].y=f+A[1];i[c]._order=r._order;const l=p(i[c]);if(o<l)o=l}));return o};let T=true;f.forEach((t=>{var n,r,e,a,o,f,s;if(!((n=t===null||t===void 0?void 0:t.nodes)===null||n===void 0?void 0:n.length)&&!((r=t===null||t===void 0?void 0:t.left)===null||r===void 0?void 0:r.length)&&!((e=t===null||t===void 0?void 0:t.right)===null||e===void 0?void 0:e.length)){return}if(T&&t.nodes.length===1){const n=i.findIndex((n=>n.id===t.nodes[0]));if(n<=-1)return;i[n].x=A[0];i[n].y=A[1];y[t.nodes[0]]=0;b=p(i[n]);T=false;return}b=Math.max(b,t.totalWidth/(2*Math.PI));let c=-Infinity;if(u===0||((a=t.nodes)===null||a===void 0?void 0:a.length)){c=E(t.nodes,b,c,[0,1])}else{const n=((o=t.left)===null||o===void 0?void 0:o.length)/(((f=t.left)===null||f===void 0?void 0:f.length)+((s=t.right)===null||s===void 0?void 0:s.length));c=E(t.left,b,c,[0,n]);c=E(t.right,b,c,[n+.05,1])}b+=c;T=false}));d.edges().forEach((t=>{var n,r,i;const o=d.edge(t);const u=v.findIndex((n=>{const r=Z(n,"source");const e=Z(n,"target");return r===t.v&&e===t.w}));if(u<=-1)return;if(e.edgeLabelSpace&&e.controlPoints&&v[u].type!=="loop"){const e=s==="x"?"y":"x";const f=(n=o===null||o===void 0?void 0:o.points)===null||n===void 0?void 0:n.slice(1,o.points.length-1);const c=[];const l=(r=d.node(t.v))===null||r===void 0?void 0:r[e];const h=l-((i=d.node(t.w))===null||i===void 0?void 0:i[e]);const b=y[t.v];const p=b-y[t.w];f===null||f===void 0?void 0:f.forEach((t=>{const n=(t[e]-l)/h*p+b;const r=a(t[s],g,w,n);c.push({x:r.x+A[0],y:r.y+A[1]})}));v[u].controlPoints=c}}))}else{const t=new Set;const n=o==="BT"||o==="RL";const r=n?(t,n)=>n-t:(t,n)=>t-n;d.nodes().forEach((n=>{const r=d.node(n);if(!r)return;let e=this.nodeMap[n];if(!e){e=u===null||u===void 0?void 0:u.find((t=>t.id===n))}if(!e)return;e.x=r.x+A[0];e.y=r.y+A[1];e._order=r._order;t.add(_?e.x:e.y)}));const i=Array.from(t).sort(r);const a=_?(t,n)=>t.x!==n.x:(t,n)=>t.y!==n.y;const f=_?(t,n,r)=>{const e=Math.max(n.y,r.y);const i=Math.min(n.y,r.y);return t.filter((t=>t.y<=e&&t.y>=i))}:(t,n,r)=>{const e=Math.max(n.x,r.x);const i=Math.min(n.x,r.x);return t.filter((t=>t.x<=e&&t.x>=i))};d.edges().forEach((t=>{const n=d.edge(t);const r=v.findIndex((n=>{const r=Z(n,"source");const e=Z(n,"target");return r===t.v&&e===t.w}));if(r<=-1)return;if(e.edgeLabelSpace&&e.controlPoints&&v[r].type!=="loop"){const o=e.nodeMap[t.v];const u=e.nodeMap[t.w];v[r].controlPoints=Ke(n===null||n===void 0?void 0:n.points,o,u,i,_,a,f);v[r].controlPoints.forEach((t=>{t.x+=A[0];t.y+=A[1]}))}}))}if(e.onLayoutEnd)e.onLayoutEnd();return{nodes:i,edges:v}}getRadialPos(t,n,r,e,i=[0,1]){let a=(t-n[0])/r;a=a*(i[1]-i[0])+i[0];const o=a*2*Math.PI;return{x:Math.cos(o)*e,y:Math.sin(o)*e}}getType(){return"dagre"}}const Ke=(t,n,r,e,i,a,o)=>{let u=(t===null||t===void 0?void 0:t.slice(1,t.length-1))||[];if(n&&r){let{x:t,y:f}=n;let{x:s,y:c}=r;if(i){t=n.y;f=n.x;s=r.y;c=r.x}if(c!==f&&t!==s){const l=e.indexOf(f);const v=e[l+1];if(v){const t=u[0];const n=i?{x:(f+v)/2,y:(t===null||t===void 0?void 0:t.y)||s}:{x:(t===null||t===void 0?void 0:t.x)||s,y:(f+v)/2};if(!t||a(t,n)){u.unshift(n)}}const d=e.indexOf(c);const h=Math.abs(d-l);if(h===1){u=o(u,n,r);if(!u.length){u.push(i?{x:(f+c)/2,y:t}:{x:t,y:(f+c)/2})}}else if(h>1){const n=e[d-1];if(n){const r=u[u.length-1];const e=i?{x:(c+n)/2,y:(r===null||r===void 0?void 0:r.y)||s}:{x:(r===null||r===void 0?void 0:r.x)||t,y:(c+n)/2};if(!r||a(r,e)){u.push(e)}}}}}return u};var Qe,Ze,Je,ti;!function(t){t[t.META=0]="META",t[t.NODE=1]="NODE",t[t.BRIDGE=2]="BRIDGE"}(Qe||(Qe={})),function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE",t[t.UNSPECIFIED=2]="UNSPECIFIED"}(Ze||(Ze={})),function(t){t[t.META=0]="META",t[t.CORE=1]="CORE",t[t.BRIDGE=2]="BRIDGE"}(Je||(Je={})),function(t){t[t.META=0]="META",t[t.OP=1]="OP",t[t.SERIES=2]="SERIES"}(ti||(ti={}));var ni="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function ri(t,n){return t(n={exports:{}},n.exports),n.exports}var ei=function(){this.__data__=[],this.size=0};var ii=function(t,n){return t===n||t!=t&&n!=n};var ai=function(t,n){for(var r=t.length;r--;)if(ii(t[r][0],n))return r;return-1},oi=Array.prototype.splice;var ui=function(t){var n=this.__data__,r=ai(n,t);return!(r<0)&&(r==n.length-1?n.pop():oi.call(n,r,1),--this.size,!0)};var fi=function(t){var n=this.__data__,r=ai(n,t);return r<0?void 0:n[r][1]};var si=function(t){return ai(this.__data__,t)>-1};var ci=function(t,n){var r=this.__data__,e=ai(r,t);return e<0?(++this.size,r.push([t,n])):r[e][1]=n,this};function li(t){var n=-1,r=null==t?0:t.length;for(this.clear();++n<r;){var e=t[n];this.set(e[0],e[1])}}li.prototype.clear=ei,li.prototype.delete=ui,li.prototype.get=fi,li.prototype.has=si,li.prototype.set=ci;var vi=li;var di=function(){this.__data__=new vi,this.size=0};var hi=function(t){var n=this.__data__,r=n.delete(t);return this.size=n.size,r};var bi=function(t){return this.__data__.get(t)};var pi=function(t){return this.__data__.has(t)},mi="object"==typeof ni&&ni&&ni.Object===Object&&ni,yi="object"==typeof self&&self&&self.Object===Object&&self,wi=mi||yi||Function("return this")(),gi=wi.Symbol,Ei=Object.prototype,Ai=Ei.hasOwnProperty,_i=Ei.toString,Ti=gi?gi.toStringTag:void 0;var Ri=function(t){var n=Ai.call(t,Ti),r=t[Ti];try{t[Ti]=void 0;var e=!0}catch(t){}var i=_i.call(t);return e&&(n?t[Ti]=r:delete t[Ti]),i},Oi=Object.prototype.toString;var xi=function(t){return Oi.call(t)},ji=gi?gi.toStringTag:void 0;var Si=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":ji&&ji in Object(t)?Ri(t):xi(t)};var Ni=function(t){var n=typeof t;return null!=t&&("object"==n||"function"==n)};var Ii,Mi=function(t){if(!Ni(t))return!1;var n=Si(t);return"[object Function]"==n||"[object GeneratorFunction]"==n||"[object AsyncFunction]"==n||"[object Proxy]"==n},Ci=wi["__core-js_shared__"],Li=(Ii=/[^.]+$/.exec(Ci&&Ci.keys&&Ci.keys.IE_PROTO||""))?"Symbol(src)_1."+Ii:"";var ki=function(t){return!!Li&&Li in t},Ui=Function.prototype.toString;var Fi=function(t){if(null!=t){try{return Ui.call(t)}catch(t){}try{return t+""}catch(t){}}return""},Bi=/^\[object .+?Constructor\]$/,Di=Function.prototype,Pi=Object.prototype,Gi=Di.toString,Vi=Pi.hasOwnProperty,Xi=RegExp("^"+Gi.call(Vi).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var zi=function(t){return!(!Ni(t)||ki(t))&&(Mi(t)?Xi:Bi).test(Fi(t))};var Hi=function(t,n){return null==t?void 0:t[n]};var Wi=function(t,n){var r=Hi(t,n);return zi(r)?r:void 0},$i=Wi(wi,"Map"),Yi=Wi(Object,"create");var qi=function(){this.__data__=Yi?Yi(null):{},this.size=0};var Ki=function(t){var n=this.has(t)&&delete this.__data__[t];return this.size-=n?1:0,n},Qi=Object.prototype.hasOwnProperty;var Zi=function(t){var n=this.__data__;if(Yi){var r=n[t];return"__lodash_hash_undefined__"===r?void 0:r}return Qi.call(n,t)?n[t]:void 0},Ji=Object.prototype.hasOwnProperty;var ta=function(t){var n=this.__data__;return Yi?void 0!==n[t]:Ji.call(n,t)};var na=function(t,n){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=Yi&&void 0===n?"__lodash_hash_undefined__":n,this};function ra(t){var n=-1,r=null==t?0:t.length;for(this.clear();++n<r;){var e=t[n];this.set(e[0],e[1])}}ra.prototype.clear=qi,ra.prototype.delete=Ki,ra.prototype.get=Zi,ra.prototype.has=ta,ra.prototype.set=na;var ea=ra;var ia=function(){this.size=0,this.__data__={hash:new ea,map:new($i||vi),string:new ea}};var aa=function(t){var n=typeof t;return"string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t};var oa=function(t,n){var r=t.__data__;return aa(n)?r["string"==typeof n?"string":"hash"]:r.map};var ua=function(t){var n=oa(this,t).delete(t);return this.size-=n?1:0,n};var fa=function(t){return oa(this,t).get(t)};var sa=function(t){return oa(this,t).has(t)};var ca=function(t,n){var r=oa(this,t),e=r.size;return r.set(t,n),this.size+=r.size==e?0:1,this};function la(t){var n=-1,r=null==t?0:t.length;for(this.clear();++n<r;){var e=t[n];this.set(e[0],e[1])}}la.prototype.clear=ia,la.prototype.delete=ua,la.prototype.get=fa,la.prototype.has=sa,la.prototype.set=ca;var va=la;var da=function(t,n){var r=this.__data__;if(r instanceof vi){var e=r.__data__;if(!$i||e.length<199)return e.push([t,n]),this.size=++r.size,this;r=this.__data__=new va(e)}return r.set(t,n),this.size=r.size,this};function ha(t){var n=this.__data__=new vi(t);this.size=n.size}ha.prototype.clear=di,ha.prototype.delete=hi,ha.prototype.get=bi,ha.prototype.has=pi,ha.prototype.set=da;var ba=ha;var pa=function(t,n){for(var r=-1,e=null==t?0:t.length;++r<e&&!1!==n(t[r],r,t););return t},ma=function(){try{var t=Wi(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();var ya=function(t,n,r){"__proto__"==n&&ma?ma(t,n,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[n]=r},wa=Object.prototype.hasOwnProperty;var ga=function(t,n,r){var e=t[n];wa.call(t,n)&&ii(e,r)&&(void 0!==r||n in t)||ya(t,n,r)};var Ea=function(t,n,r,e){var i=!r;r||(r={});for(var a=-1,o=n.length;++a<o;){var u=n[a],f=e?e(r[u],t[u],u,r,t):void 0;void 0===f&&(f=t[u]),i?ya(r,u,f):ga(r,u,f)}return r};var Aa=function(t,n){for(var r=-1,e=Array(t);++r<t;)e[r]=n(r);return e};var _a=function(t){return null!=t&&"object"==typeof t};var Ta=function(t){return _a(t)&&"[object Arguments]"==Si(t)},Ra=Object.prototype,Oa=Ra.hasOwnProperty,xa=Ra.propertyIsEnumerable,ja=Ta(function(){return arguments}())?Ta:function(t){return _a(t)&&Oa.call(t,"callee")&&!xa.call(t,"callee")},Sa=Array.isArray;var Na=function(){return!1},Ia=ri((function(t,n){var r=n&&!n.nodeType&&n,e=r&&t&&!t.nodeType&&t,i=e&&e.exports===r?wi.Buffer:void 0,a=(i?i.isBuffer:void 0)||Na;t.exports=a})),Ma=/^(?:0|[1-9]\d*)$/;var Ca=function(t,n){var r=typeof t;return!!(n=null==n?9007199254740991:n)&&("number"==r||"symbol"!=r&&Ma.test(t))&&t>-1&&t%1==0&&t<n};var La=function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991},ka={};ka["[object Float32Array]"]=ka["[object Float64Array]"]=ka["[object Int8Array]"]=ka["[object Int16Array]"]=ka["[object Int32Array]"]=ka["[object Uint8Array]"]=ka["[object Uint8ClampedArray]"]=ka["[object Uint16Array]"]=ka["[object Uint32Array]"]=!0,ka["[object Arguments]"]=ka["[object Array]"]=ka["[object ArrayBuffer]"]=ka["[object Boolean]"]=ka["[object DataView]"]=ka["[object Date]"]=ka["[object Error]"]=ka["[object Function]"]=ka["[object Map]"]=ka["[object Number]"]=ka["[object Object]"]=ka["[object RegExp]"]=ka["[object Set]"]=ka["[object String]"]=ka["[object WeakMap]"]=!1;var Ua=function(t){return _a(t)&&La(t.length)&&!!ka[Si(t)]};var Fa=function(t){return function(n){return t(n)}},Ba=ri((function(t,n){var r=n&&!n.nodeType&&n,e=r&&t&&!t.nodeType&&t,i=e&&e.exports===r&&mi.process,a=function(){try{var t=e&&e.require&&e.require("util").types;return t||i&&i.binding&&i.binding("util")}catch(t){}}();t.exports=a})),Da=Ba&&Ba.isTypedArray,Pa=Da?Fa(Da):Ua,Ga=Object.prototype.hasOwnProperty;var Va=function(t,n){var r=Sa(t),e=!r&&ja(t),i=!r&&!e&&Ia(t),a=!r&&!e&&!i&&Pa(t),o=r||e||i||a,u=o?Aa(t.length,String):[],f=u.length;for(var s in t)!n&&!Ga.call(t,s)||o&&("length"==s||i&&("offset"==s||"parent"==s)||a&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||Ca(s,f))||u.push(s);return u},Xa=Object.prototype;var za=function(t){var n=t&&t.constructor;return t===("function"==typeof n&&n.prototype||Xa)};var Ha=function(t,n){return function(r){return t(n(r))}},Wa=Ha(Object.keys,Object),$a=Object.prototype.hasOwnProperty;var Ya=function(t){if(!za(t))return Wa(t);var n=[];for(var r in Object(t))$a.call(t,r)&&"constructor"!=r&&n.push(r);return n};var qa=function(t){return null!=t&&La(t.length)&&!Mi(t)};var Ka=function(t){return qa(t)?Va(t):Ya(t)};var Qa=function(t,n){return t&&Ea(n,Ka(n),t)};var Za=function(t){var n=[];if(null!=t)for(var r in Object(t))n.push(r);return n},Ja=Object.prototype.hasOwnProperty;var to=function(t){if(!Ni(t))return Za(t);var n=za(t),r=[];for(var e in t)("constructor"!=e||!n&&Ja.call(t,e))&&r.push(e);return r};var no=function(t){return qa(t)?Va(t,!0):to(t)};var ro=function(t,n){return t&&Ea(n,no(n),t)},eo=ri((function(t,n){var r=n&&!n.nodeType&&n,e=r&&t&&!t.nodeType&&t,i=e&&e.exports===r?wi.Buffer:void 0,a=i?i.allocUnsafe:void 0;t.exports=function(t,n){if(n)return t.slice();var r=t.length,e=a?a(r):new t.constructor(r);return t.copy(e),e}}));var io=function(t,n){var r=-1,e=t.length;for(n||(n=Array(e));++r<e;)n[r]=t[r];return n};var ao=function(t,n){for(var r=-1,e=null==t?0:t.length,i=0,a=[];++r<e;){var o=t[r];n(o,r,t)&&(a[i++]=o)}return a};var oo=function(){return[]},uo=Object.prototype.propertyIsEnumerable,fo=Object.getOwnPropertySymbols,so=fo?function(t){return null==t?[]:(t=Object(t),ao(fo(t),(function(n){return uo.call(t,n)})))}:oo;var co=function(t,n){return Ea(t,so(t),n)};var lo=function(t,n){for(var r=-1,e=n.length,i=t.length;++r<e;)t[i+r]=n[r];return t},vo=Ha(Object.getPrototypeOf,Object),ho=Object.getOwnPropertySymbols?function(t){for(var n=[];t;)lo(n,so(t)),t=vo(t);return n}:oo;var bo=function(t,n){return Ea(t,ho(t),n)};var po=function(t,n,r){var e=n(t);return Sa(t)?e:lo(e,r(t))};var mo=function(t){return po(t,Ka,so)};var yo=function(t){return po(t,no,ho)},wo=Wi(wi,"DataView"),go=Wi(wi,"Promise"),Eo=Wi(wi,"Set"),Ao=Wi(wi,"WeakMap"),_o=Fi(wo),To=Fi($i),Ro=Fi(go),Oo=Fi(Eo),xo=Fi(Ao),jo=Si;(wo&&"[object DataView]"!=jo(new wo(new ArrayBuffer(1)))||$i&&"[object Map]"!=jo(new $i)||go&&"[object Promise]"!=jo(go.resolve())||Eo&&"[object Set]"!=jo(new Eo)||Ao&&"[object WeakMap]"!=jo(new Ao))&&(jo=function(t){var n=Si(t),r="[object Object]"==n?t.constructor:void 0,e=r?Fi(r):"";if(e)switch(e){case _o:return"[object DataView]";case To:return"[object Map]";case Ro:return"[object Promise]";case Oo:return"[object Set]";case xo:return"[object WeakMap]"}return n});var So=jo,No=Object.prototype.hasOwnProperty;var Io=function(t){var n=t.length,r=new t.constructor(n);return n&&"string"==typeof t[0]&&No.call(t,"index")&&(r.index=t.index,r.input=t.input),r},Mo=wi.Uint8Array;var Co=function(t){var n=new t.constructor(t.byteLength);return new Mo(n).set(new Mo(t)),n};var Lo=function(t,n){var r=n?Co(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)},ko=/\w*$/;var Uo=function(t){var n=new t.constructor(t.source,ko.exec(t));return n.lastIndex=t.lastIndex,n},Fo=gi?gi.prototype:void 0,Bo=Fo?Fo.valueOf:void 0;var Do=function(t){return Bo?Object(Bo.call(t)):{}};var Po=function(t,n){var r=n?Co(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)};var Go=function(t,n,r){var e=t.constructor;switch(n){case"[object ArrayBuffer]":return Co(t);case"[object Boolean]":case"[object Date]":return new e(+t);case"[object DataView]":return Lo(t,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Po(t,r);case"[object Map]":return new e;case"[object Number]":case"[object String]":return new e(t);case"[object RegExp]":return Uo(t);case"[object Set]":return new e;case"[object Symbol]":return Do(t)}},Vo=Object.create,Xo=function(){function t(){}return function(n){if(!Ni(n))return{};if(Vo)return Vo(n);t.prototype=n;var r=new t;return t.prototype=void 0,r}}();var zo=function(t){return"function"!=typeof t.constructor||za(t)?{}:Xo(vo(t))};var Ho=function(t){return _a(t)&&"[object Map]"==So(t)},Wo=Ba&&Ba.isMap,$o=Wo?Fa(Wo):Ho;var Yo=function(t){return _a(t)&&"[object Set]"==So(t)},qo=Ba&&Ba.isSet,Ko=qo?Fa(qo):Yo,Qo={};Qo["[object Arguments]"]=Qo["[object Array]"]=Qo["[object ArrayBuffer]"]=Qo["[object DataView]"]=Qo["[object Boolean]"]=Qo["[object Date]"]=Qo["[object Float32Array]"]=Qo["[object Float64Array]"]=Qo["[object Int8Array]"]=Qo["[object Int16Array]"]=Qo["[object Int32Array]"]=Qo["[object Map]"]=Qo["[object Number]"]=Qo["[object Object]"]=Qo["[object RegExp]"]=Qo["[object Set]"]=Qo["[object String]"]=Qo["[object Symbol]"]=Qo["[object Uint8Array]"]=Qo["[object Uint8ClampedArray]"]=Qo["[object Uint16Array]"]=Qo["[object Uint32Array]"]=!0,Qo["[object Error]"]=Qo["[object Function]"]=Qo["[object WeakMap]"]=!1;var Zo=function t(n,r,e,i,a,o){var u,f=1&r,s=2&r,c=4&r;if(e&&(u=a?e(n,i,a,o):e(n)),void 0!==u)return u;if(!Ni(n))return n;var l=Sa(n);if(l){if(u=Io(n),!f)return io(n,u)}else{var v=So(n),d="[object Function]"==v||"[object GeneratorFunction]"==v;if(Ia(n))return eo(n,f);if("[object Object]"==v||"[object Arguments]"==v||d&&!a){if(u=s||d?{}:zo(n),!f)return s?bo(n,ro(u,n)):co(n,Qa(u,n))}else{if(!Qo[v])return a?n:{};u=Go(n,v,f)}}o||(o=new ba);var h=o.get(n);if(h)return h;o.set(n,u),Ko(n)?n.forEach((function(i){u.add(t(i,r,e,i,n,o))})):$o(n)&&n.forEach((function(i,a){u.set(a,t(i,r,e,a,n,o))}));var b=l?void 0:(c?s?yo:mo:s?no:Ka)(n);return pa(b||n,(function(i,a){b&&(i=n[a=i]),ga(u,a,t(i,r,e,a,n,o))})),u};var Jo=function(t){return Zo(t,4)};var tu=function(t){return function(){return t}};var nu=function(t){return function(n,r,e){for(var i=-1,a=Object(n),o=e(n),u=o.length;u--;){var f=o[t?u:++i];if(!1===r(a[f],f,a))break}return n}}();var ru=function(t,n){return t&&nu(t,n,Ka)};var eu=function(t,n){return function(r,e){if(null==r)return r;if(!qa(r))return t(r,e);for(var i=r.length,a=n?i:-1,o=Object(r);(n?a--:++a<i)&&!1!==e(o[a],a,o););return r}}(ru);var iu=function(t){return t};var au=function(t){return"function"==typeof t?t:iu};var ou=function(t,n){return(Sa(t)?pa:eu)(t,au(n))},uu=ou;var fu=function(t,n){var r=[];return eu(t,(function(t,e,i){n(t,e,i)&&r.push(t)})),r};var su=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this};var cu=function(t){return this.__data__.has(t)};function lu(t){var n=-1,r=null==t?0:t.length;for(this.__data__=new va;++n<r;)this.add(t[n])}lu.prototype.add=lu.prototype.push=su,lu.prototype.has=cu;var vu=lu;var du=function(t,n){for(var r=-1,e=null==t?0:t.length;++r<e;)if(n(t[r],r,t))return!0;return!1};var hu=function(t,n){return t.has(n)};var bu=function(t,n,r,e,i,a){var o=1&r,u=t.length,f=n.length;if(u!=f&&!(o&&f>u))return!1;var s=a.get(t),c=a.get(n);if(s&&c)return s==n&&c==t;var l=-1,v=!0,d=2&r?new vu:void 0;for(a.set(t,n),a.set(n,t);++l<u;){var h=t[l],b=n[l];if(e)var p=o?e(b,h,l,n,t,a):e(h,b,l,t,n,a);if(void 0!==p){if(p)continue;v=!1;break}if(d){if(!du(n,(function(t,n){if(!hu(d,n)&&(h===t||i(h,t,r,e,a)))return d.push(n)}))){v=!1;break}}else if(h!==b&&!i(h,b,r,e,a)){v=!1;break}}return a.delete(t),a.delete(n),v};var pu=function(t){var n=-1,r=Array(t.size);return t.forEach((function(t,e){r[++n]=[e,t]})),r};var mu=function(t){var n=-1,r=Array(t.size);return t.forEach((function(t){r[++n]=t})),r},yu=gi?gi.prototype:void 0,wu=yu?yu.valueOf:void 0;var gu=function(t,n,r,e,i,a,o){switch(r){case"[object DataView]":if(t.byteLength!=n.byteLength||t.byteOffset!=n.byteOffset)return!1;t=t.buffer,n=n.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=n.byteLength||!a(new Mo(t),new Mo(n)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ii(+t,+n);case"[object Error]":return t.name==n.name&&t.message==n.message;case"[object RegExp]":case"[object String]":return t==n+"";case"[object Map]":var u=pu;case"[object Set]":var f=1&e;if(u||(u=mu),t.size!=n.size&&!f)return!1;var s=o.get(t);if(s)return s==n;e|=2,o.set(t,n);var c=bu(u(t),u(n),e,i,a,o);return o.delete(t),c;case"[object Symbol]":if(wu)return wu.call(t)==wu.call(n)}return!1},Eu=Object.prototype.hasOwnProperty;var Au=function(t,n,r,e,i,a){var o=1&r,u=mo(t),f=u.length;if(f!=mo(n).length&&!o)return!1;for(var s=f;s--;){var c=u[s];if(!(o?c in n:Eu.call(n,c)))return!1}var l=a.get(t),v=a.get(n);if(l&&v)return l==n&&v==t;var d=!0;a.set(t,n),a.set(n,t);for(var h=o;++s<f;){var b=t[c=u[s]],p=n[c];if(e)var m=o?e(p,b,c,n,t,a):e(b,p,c,t,n,a);if(!(void 0===m?b===p||i(b,p,r,e,a):m)){d=!1;break}h||(h="constructor"==c)}if(d&&!h){var y=t.constructor,w=n.constructor;y==w||!("constructor"in t)||!("constructor"in n)||"function"==typeof y&&y instanceof y&&"function"==typeof w&&w instanceof w||(d=!1)}return a.delete(t),a.delete(n),d},_u=Object.prototype.hasOwnProperty;var Tu=function(t,n,r,e,i,a){var o=Sa(t),u=Sa(n),f=o?"[object Array]":So(t),s=u?"[object Array]":So(n),c="[object Object]"==(f="[object Arguments]"==f?"[object Object]":f),l="[object Object]"==(s="[object Arguments]"==s?"[object Object]":s),v=f==s;if(v&&Ia(t)){if(!Ia(n))return!1;o=!0,c=!1}if(v&&!c)return a||(a=new ba),o||Pa(t)?bu(t,n,r,e,i,a):gu(t,n,f,r,e,i,a);if(!(1&r)){var d=c&&_u.call(t,"__wrapped__"),h=l&&_u.call(n,"__wrapped__");if(d||h){var b=d?t.value():t,p=h?n.value():n;return a||(a=new ba),i(b,p,r,e,a)}}return!!v&&(a||(a=new ba),Au(t,n,r,e,i,a))};var Ru=function t(n,r,e,i,a){return n===r||(null==n||null==r||!_a(n)&&!_a(r)?n!=n&&r!=r:Tu(n,r,e,i,t,a))};var Ou=function(t,n,r,e){var i=r.length,a=i,o=!e;if(null==t)return!a;for(t=Object(t);i--;){var u=r[i];if(o&&u[2]?u[1]!==t[u[0]]:!(u[0]in t))return!1}for(;++i<a;){var f=(u=r[i])[0],s=t[f],c=u[1];if(o&&u[2]){if(void 0===s&&!(f in t))return!1}else{var l=new ba;if(e)var v=e(s,c,f,t,n,l);if(!(void 0===v?Ru(c,s,3,e,l):v))return!1}}return!0};var xu=function(t){return t==t&&!Ni(t)};var ju=function(t){for(var n=Ka(t),r=n.length;r--;){var e=n[r],i=t[e];n[r]=[e,i,xu(i)]}return n};var Su=function(t,n){return function(r){return null!=r&&(r[t]===n&&(void 0!==n||t in Object(r)))}};var Nu=function(t){var n=ju(t);return 1==n.length&&n[0][2]?Su(n[0][0],n[0][1]):function(r){return r===t||Ou(r,t,n)}};var Iu=function(t){return"symbol"==typeof t||_a(t)&&"[object Symbol]"==Si(t)},Mu=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Cu=/^\w*$/;var Lu=function(t,n){if(Sa(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!Iu(t))||(Cu.test(t)||!Mu.test(t)||null!=n&&t in Object(n))};function ku(t,n){if("function"!=typeof t||null!=n&&"function"!=typeof n)throw new TypeError("Expected a function");var r=function(){var e=arguments,i=n?n.apply(this,e):e[0],a=r.cache;if(a.has(i))return a.get(i);var o=t.apply(this,e);return r.cache=a.set(i,o)||a,o};return r.cache=new(ku.Cache||va),r}ku.Cache=va;var Uu=ku;var Fu=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Bu=/\\(\\)?/g,Du=function(t){var n=Uu(t,(function(t){return 500===r.size&&r.clear(),t})),r=n.cache;return n}((function(t){var n=[];return 46===t.charCodeAt(0)&&n.push(""),t.replace(Fu,(function(t,r,e,i){n.push(e?i.replace(Bu,"$1"):r||t)})),n}));var Pu=function(t,n){for(var r=-1,e=null==t?0:t.length,i=Array(e);++r<e;)i[r]=n(t[r],r,t);return i},Gu=gi?gi.prototype:void 0,Vu=Gu?Gu.toString:void 0;var Xu=function t(n){if("string"==typeof n)return n;if(Sa(n))return Pu(n,t)+"";if(Iu(n))return Vu?Vu.call(n):"";var r=n+"";return"0"==r&&1/n==-Infinity?"-0":r};var zu=function(t){return null==t?"":Xu(t)};var Hu=function(t,n){return Sa(t)?t:Lu(t,n)?[t]:Du(zu(t))};var Wu=function(t){if("string"==typeof t||Iu(t))return t;var n=t+"";return"0"==n&&1/t==-Infinity?"-0":n};var $u=function(t,n){for(var r=0,e=(n=Hu(n,t)).length;null!=t&&r<e;)t=t[Wu(n[r++])];return r&&r==e?t:void 0};var Yu=function(t,n,r){var e=null==t?void 0:$u(t,n);return void 0===e?r:e};var qu=function(t,n){return null!=t&&n in Object(t)};var Ku=function(t,n,r){for(var e=-1,i=(n=Hu(n,t)).length,a=!1;++e<i;){var o=Wu(n[e]);if(!(a=null!=t&&r(t,o)))break;t=t[o]}return a||++e!=i?a:!!(i=null==t?0:t.length)&&La(i)&&Ca(o,i)&&(Sa(t)||ja(t))};var Qu=function(t,n){return null!=t&&Ku(t,n,qu)};var Zu=function(t,n){return Lu(t)&&xu(n)?Su(Wu(t),n):function(r){var e=Yu(r,t);return void 0===e&&e===n?Qu(r,t):Ru(n,e,3)}};var Ju=function(t){return function(n){return null==n?void 0:n[t]}};var tf=function(t){return function(n){return $u(n,t)}};var nf=function(t){return Lu(t)?Ju(Wu(t)):tf(t)};var rf=function(t){return"function"==typeof t?t:null==t?iu:"object"==typeof t?Sa(t)?Zu(t[0],t[1]):Nu(t):nf(t)};var ef=function(t,n){return(Sa(t)?ao:fu)(t,rf(n))},af=Object.prototype.hasOwnProperty;var of=function(t,n){return null!=t&&af.call(t,n)};var uf=function(t,n){return null!=t&&Ku(t,n,of)},ff=Object.prototype.hasOwnProperty;var sf=function(t){if(null==t)return!0;if(qa(t)&&(Sa(t)||"string"==typeof t||"function"==typeof t.splice||Ia(t)||Pa(t)||ja(t)))return!t.length;var n=So(t);if("[object Map]"==n||"[object Set]"==n)return!t.size;if(za(t))return!Ya(t).length;for(var r in t)if(ff.call(t,r))return!1;return!0};var cf=function(t){return void 0===t};var lf=function(t,n){var r=-1,e=qa(t)?Array(t.length):[];return eu(t,(function(t,i,a){e[++r]=n(t,i,a)})),e};var vf=function(t,n){return(Sa(t)?Pu:lf)(t,rf(n))};var df=function(t,n,r,e){var i=-1,a=null==t?0:t.length;for(e&&a&&(r=t[++i]);++i<a;)r=n(r,t[i],i,t);return r};var hf=function(t,n,r,e,i){return i(t,(function(t,i,a){r=e?(e=!1,t):n(r,t,i,a)})),r};var bf=function(t,n,r){var e=Sa(t)?df:hf,i=arguments.length<3;return e(t,rf(n),r,i,eu)};var pf=function(t){return"string"==typeof t||!Sa(t)&&_a(t)&&"[object String]"==Si(t)},mf=Ju("length"),yf=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var wf=function(t){return yf.test(t)},gf="[\\ud800-\\udfff]",Ef="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Af="\\ud83c[\\udffb-\\udfff]",_f="[^\\ud800-\\udfff]",Tf="(?:\\ud83c[\\udde6-\\uddff]){2}",Rf="[\\ud800-\\udbff][\\udc00-\\udfff]",Of="(?:"+Ef+"|"+Af+")"+"?",xf="[\\ufe0e\\ufe0f]?"+Of+("(?:\\u200d(?:"+[_f,Tf,Rf].join("|")+")[\\ufe0e\\ufe0f]?"+Of+")*"),jf="(?:"+[_f+Ef+"?",Ef,Tf,Rf,gf].join("|")+")",Sf=RegExp(Af+"(?="+Af+")|"+jf+xf,"g");var Nf=function(t){for(var n=Sf.lastIndex=0;Sf.test(t);)++n;return n};var If=function(t){return wf(t)?Nf(t):mf(t)};var Mf=function(t){if(null==t)return 0;if(qa(t))return pf(t)?If(t):t.length;var n=So(t);return"[object Map]"==n||"[object Set]"==n?t.size:Ya(t).length};var Cf=function(t,n,r){var e=Sa(t),i=e||Ia(t)||Pa(t);if(n=rf(n),null==r){var a=t&&t.constructor;r=i?e?new a:[]:Ni(t)&&Mi(a)?Xo(vo(t)):{}}return(i?pa:ru)(t,(function(t,e,i){return n(r,t,e,i)})),r},Lf=gi?gi.isConcatSpreadable:void 0;var kf=function(t){return Sa(t)||ja(t)||!!(Lf&&t&&t[Lf])};var Uf=function t(n,r,e,i,a){var o=-1,u=n.length;for(e||(e=kf),a||(a=[]);++o<u;){var f=n[o];r>0&&e(f)?r>1?t(f,r-1,e,i,a):lo(a,f):i||(a[a.length]=f)}return a};var Ff=function(t,n,r){switch(r.length){case 0:return t.call(n);case 1:return t.call(n,r[0]);case 2:return t.call(n,r[0],r[1]);case 3:return t.call(n,r[0],r[1],r[2])}return t.apply(n,r)},Bf=Math.max;var Df=function(t,n,r){return n=Bf(void 0===n?t.length-1:n,0),function(){for(var e=arguments,i=-1,a=Bf(e.length-n,0),o=Array(a);++i<a;)o[i]=e[n+i];i=-1;for(var u=Array(n+1);++i<n;)u[i]=e[i];return u[n]=r(o),Ff(t,this,u)}},Pf=ma?function(t,n){return ma(t,"toString",{configurable:!0,enumerable:!1,value:tu(n),writable:!0})}:iu,Gf=Date.now;var Vf=function(t){var n=0,r=0;return function(){var e=Gf(),i=16-(e-r);if(r=e,i>0){if(++n>=800)return arguments[0]}else n=0;return t.apply(void 0,arguments)}}(Pf);var Xf=function(t,n){return Vf(Df(t,n,iu),t+"")};var zf=function(t,n,r,e){for(var i=t.length,a=r+(e?1:-1);e?a--:++a<i;)if(n(t[a],a,t))return a;return-1};var Hf=function(t){return t!=t};var Wf=function(t,n,r){for(var e=r-1,i=t.length;++e<i;)if(t[e]===n)return e;return-1};var $f=function(t,n,r){return n==n?Wf(t,n,r):zf(t,Hf,r)};var Yf=function(t,n){return!!(null==t?0:t.length)&&$f(t,n,0)>-1};var qf=function(t,n,r){for(var e=-1,i=null==t?0:t.length;++e<i;)if(r(n,t[e]))return!0;return!1};var Kf=function(){},Qf=Eo&&1/mu(new Eo([,-0]))[1]==1/0?function(t){return new Eo(t)}:Kf;var Zf=function(t,n,r){var e=-1,i=Yf,a=t.length,o=!0,u=[],f=u;if(r)o=!1,i=qf;else if(a>=200){var s=n?null:Qf(t);if(s)return mu(s);o=!1,i=hu,f=new vu}else f=n?[]:u;t:for(;++e<a;){var c=t[e],l=n?n(c):c;if(c=r||0!==c?c:0,o&&l==l){for(var v=f.length;v--;)if(f[v]===l)continue t;n&&f.push(l),u.push(c)}else i(f,l,r)||(f!==u&&f.push(l),u.push(c))}return u};var Jf=function(t){return _a(t)&&qa(t)},ts=Xf((function(t){return Zf(Uf(t,1,Jf,!0))}));var ns=function(t,n){return Pu(n,(function(n){return t[n]}))};var rs,es=function(t){return null==t?[]:ns(t,Ka(t))};try{rs={clone:Jo,constant:tu,each:uu,filter:ef,has:uf,isArray:Sa,isEmpty:sf,isFunction:Mi,isUndefined:cf,keys:Ka,map:vf,reduce:bf,size:Mf,transform:Cf,union:ts,values:es}}catch(t){}rs||(rs=window._);var is=rs;function as(t){this._isDirected=!is.has(t,"directed")||t.directed,this._isMultigraph=!!is.has(t,"multigraph")&&t.multigraph,this._isCompound=!!is.has(t,"compound")&&t.compound,this._label=void 0,this._defaultNodeLabelFn=is.constant(void 0),this._defaultEdgeLabelFn=is.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children["\0"]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}function os(t,n){t[n]?t[n]++:t[n]=1}function us(t,n){--t[n]||delete t[n]}function fs(t,n,r,e){var i=""+n,a=""+r;if(!t&&i>a){var o=i;i=a,a=o}return i+""+a+""+(is.isUndefined(e)?"\0":e)}function ss(t,n,r,e){var i=""+n,a=""+r;if(!t&&i>a){var o=i;i=a,a=o}var u={v:i,w:a};return e&&(u.name=e),u}function cs(t,n){return fs(t,n.v,n.w,n.name)}as.prototype._nodeCount=0,as.prototype._edgeCount=0,as.prototype.isDirected=function(){return this._isDirected},as.prototype.isMultigraph=function(){return this._isMultigraph},as.prototype.isCompound=function(){return this._isCompound},as.prototype.setGraph=function(t){return this._label=t,this},as.prototype.graph=function(){return this._label},as.prototype.setDefaultNodeLabel=function(t){return is.isFunction(t)||(t=is.constant(t)),this._defaultNodeLabelFn=t,this},as.prototype.nodeCount=function(){return this._nodeCount},as.prototype.nodes=function(){return is.keys(this._nodes)},as.prototype.sources=function(){var t=this;return is.filter(this.nodes(),(function(n){return is.isEmpty(t._in[n])}))},as.prototype.sinks=function(){var t=this;return is.filter(this.nodes(),(function(n){return is.isEmpty(t._out[n])}))},as.prototype.setNodes=function(t,n){var r=arguments,e=this;return is.each(t,(function(t){r.length>1?e.setNode(t,n):e.setNode(t)})),this},as.prototype.setNode=function(t,n){return is.has(this._nodes,t)?(arguments.length>1&&(this._nodes[t]=n),this):(this._nodes[t]=arguments.length>1?n:this._defaultNodeLabelFn(t),this._isCompound&&(this._parent[t]="\0",this._children[t]={},this._children["\0"][t]=!0),this._in[t]={},this._preds[t]={},this._out[t]={},this._sucs[t]={},++this._nodeCount,this)},as.prototype.node=function(t){return this._nodes[t]},as.prototype.hasNode=function(t){return is.has(this._nodes,t)},as.prototype.removeNode=function(t){var n=this;if(is.has(this._nodes,t)){var r=function(t){n.removeEdge(n._edgeObjs[t])};delete this._nodes[t],this._isCompound&&(this._removeFromParentsChildList(t),delete this._parent[t],is.each(this.children(t),(function(t){n.setParent(t)})),delete this._children[t]),is.each(is.keys(this._in[t]),r),delete this._in[t],delete this._preds[t],is.each(is.keys(this._out[t]),r),delete this._out[t],delete this._sucs[t],--this._nodeCount}return this},as.prototype.setParent=function(t,n){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(is.isUndefined(n))n="\0";else{for(var r=n+="";!is.isUndefined(r);r=this.parent(r))if(r===t)throw new Error("Setting "+n+" as parent of "+t+" would create a cycle");this.setNode(n)}return this.setNode(t),this._removeFromParentsChildList(t),this._parent[t]=n,this._children[n][t]=!0,this},as.prototype._removeFromParentsChildList=function(t){delete this._children[this._parent[t]][t]},as.prototype.parent=function(t){if(this._isCompound){var n=this._parent[t];if("\0"!==n)return n}},as.prototype.children=function(t){if(is.isUndefined(t)&&(t="\0"),this._isCompound){var n=this._children[t];if(n)return is.keys(n)}else{if("\0"===t)return this.nodes();if(this.hasNode(t))return[]}},as.prototype.predecessors=function(t){var n=this._preds[t];if(n)return is.keys(n)},as.prototype.successors=function(t){var n=this._sucs[t];if(n)return is.keys(n)},as.prototype.neighbors=function(t){var n=this.predecessors(t);if(n)return is.union(n,this.successors(t))},as.prototype.isLeaf=function(t){return 0===(this.isDirected()?this.successors(t):this.neighbors(t)).length},as.prototype.filterNodes=function(t){var n=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});n.setGraph(this.graph());var r=this;is.each(this._nodes,(function(r,e){t(e)&&n.setNode(e,r)})),is.each(this._edgeObjs,(function(t){n.hasNode(t.v)&&n.hasNode(t.w)&&n.setEdge(t,r.edge(t))}));var e={};function i(t){var a=r.parent(t);return void 0===a||n.hasNode(a)?(e[t]=a,a):a in e?e[a]:i(a)}return this._isCompound&&is.each(n.nodes(),(function(t){n.setParent(t,i(t))})),n},as.prototype.setDefaultEdgeLabel=function(t){return is.isFunction(t)||(t=is.constant(t)),this._defaultEdgeLabelFn=t,this},as.prototype.edgeCount=function(){return this._edgeCount},as.prototype.edges=function(){return is.values(this._edgeObjs)},as.prototype.setPath=function(t,n){var r=this,e=arguments;return is.reduce(t,(function(t,i){return e.length>1?r.setEdge(t,i,n):r.setEdge(t,i),i})),this},as.prototype.setEdge=function(){var t,n,r,e,i=!1,a=arguments[0];"object"==typeof a&&null!==a&&"v"in a?(t=a.v,n=a.w,r=a.name,2===arguments.length&&(e=arguments[1],i=!0)):(t=a,n=arguments[1],r=arguments[3],arguments.length>2&&(e=arguments[2],i=!0)),t=""+t,n=""+n,is.isUndefined(r)||(r=""+r);var o=fs(this._isDirected,t,n,r);if(is.has(this._edgeLabels,o))return i&&(this._edgeLabels[o]=e),this;if(!is.isUndefined(r)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(t),this.setNode(n),this._edgeLabels[o]=i?e:this._defaultEdgeLabelFn(t,n,r);var u=ss(this._isDirected,t,n,r);return t=u.v,n=u.w,Object.freeze(u),this._edgeObjs[o]=u,os(this._preds[n],t),os(this._sucs[t],n),this._in[n][o]=u,this._out[t][o]=u,this._edgeCount++,this},as.prototype.edge=function(t,n,r){var e=1===arguments.length?cs(this._isDirected,arguments[0]):fs(this._isDirected,t,n,r);return this._edgeLabels[e]},as.prototype.hasEdge=function(t,n,r){var e=1===arguments.length?cs(this._isDirected,arguments[0]):fs(this._isDirected,t,n,r);return is.has(this._edgeLabels,e)},as.prototype.removeEdge=function(t,n,r){var e=1===arguments.length?cs(this._isDirected,arguments[0]):fs(this._isDirected,t,n,r),i=this._edgeObjs[e];return i&&(t=i.v,n=i.w,delete this._edgeLabels[e],delete this._edgeObjs[e],us(this._preds[n],t),us(this._sucs[t],n),delete this._in[n][e],delete this._out[t][e],this._edgeCount--),this},as.prototype.inEdges=function(t,n){var r=this._in[t];if(r){var e=is.values(r);return n?is.filter(e,(function(t){return t.v===n})):e}},as.prototype.outEdges=function(t,n){var r=this._out[t];if(r){var e=is.values(r);return n?is.filter(e,(function(t){return t.w===n})):e}},as.prototype.nodeEdges=function(t,n){var r=this.inEdges(t,n);if(r)return r.concat(this.outEdges(t,n))};is.constant(1);is.constant(1);var ls=function(t){return Zo(t,5)};var vs=function(t,n,r){if(!Ni(r))return!1;var e=typeof n;return!!("number"==e?qa(r)&&Ca(n,r.length):"string"==e&&n in r)&&ii(r[n],t)},ds=Object.prototype,hs=ds.hasOwnProperty,bs=Xf((function(t,n){t=Object(t);var r=-1,e=n.length,i=e>2?n[2]:void 0;for(i&&vs(n[0],n[1],i)&&(e=1);++r<e;)for(var a=n[r],o=no(a),u=-1,f=o.length;++u<f;){var s=o[u],c=t[s];(void 0===c||ii(c,ds[s])&&!hs.call(t,s))&&(t[s]=a[s])}return t}));var ps=function(t){return function(n,r,e){var i=Object(n);if(!qa(n)){var a=rf(r);n=Ka(n),r=function(t){return a(i[t],t,i)}}var o=t(n,r,e);return o>-1?i[a?n[o]:o]:void 0}},ms=/^\s+|\s+$/g,ys=/^[-+]0x[0-9a-f]+$/i,ws=/^0b[01]+$/i,gs=/^0o[0-7]+$/i,Es=parseInt;var As=function(t){if("number"==typeof t)return t;if(Iu(t))return NaN;if(Ni(t)){var n="function"==typeof t.valueOf?t.valueOf():t;t=Ni(n)?n+"":n}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(ms,"");var r=ws.test(t);return r||gs.test(t)?Es(t.slice(2),r?2:8):ys.test(t)?NaN:+t};var _s=function(t){return t?Infinity===(t=As(t))||-Infinity===t?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0};var Ts=function(t){var n=_s(t),r=n%1;return n==n?r?n-r:n:0},Rs=Math.max;var Os=ps((function(t,n,r){var e=null==t?0:t.length;if(!e)return-1;var i=null==r?0:Ts(r);return i<0&&(i=Rs(e+i,0)),zf(t,rf(n),i)}));var xs=function(t){return(null==t?0:t.length)?Uf(t,1):[]};var js=function(t,n){return null==t?t:nu(t,au(n),no)};var Ss=function(t){var n=null==t?0:t.length;return n?t[n-1]:void 0};var Ns=function(t,n){var r={};return n=rf(n),ru(t,(function(t,e,i){ya(r,e,n(t,e,i))})),r};var Is=function(t,n,r){for(var e=-1,i=t.length;++e<i;){var a=t[e],o=n(a);if(null!=o&&(void 0===u?o==o&&!Iu(o):r(o,u)))var u=o,f=a}return f};var Ms=function(t,n){return t>n};var Cs=function(t){return t&&t.length?Is(t,iu,Ms):void 0};var Ls=function(t,n,r){(void 0!==r&&!ii(t[n],r)||void 0===r&&!(n in t))&&ya(t,n,r)},ks=Function.prototype,Us=Object.prototype,Fs=ks.toString,Bs=Us.hasOwnProperty,Ds=Fs.call(Object);var Ps=function(t){if(!_a(t)||"[object Object]"!=Si(t))return!1;var n=vo(t);if(null===n)return!0;var r=Bs.call(n,"constructor")&&n.constructor;return"function"==typeof r&&r instanceof r&&Fs.call(r)==Ds};var Gs=function(t,n){if(("constructor"!==n||"function"!=typeof t[n])&&"__proto__"!=n)return t[n]};var Vs=function(t){return Ea(t,no(t))};var Xs=function(t,n,r,e,i,a,o){var u=Gs(t,r),f=Gs(n,r),s=o.get(f);if(s)Ls(t,r,s);else{var c=a?a(u,f,r+"",t,n,o):void 0,l=void 0===c;if(l){var v=Sa(f),d=!v&&Ia(f),h=!v&&!d&&Pa(f);c=f,v||d||h?Sa(u)?c=u:Jf(u)?c=io(u):d?(l=!1,c=eo(f,!0)):h?(l=!1,c=Po(f,!0)):c=[]:Ps(f)||ja(f)?(c=u,ja(u)?c=Vs(u):Ni(u)&&!Mi(u)||(c=zo(f))):l=!1}l&&(o.set(f,c),i(c,f,e,a,o),o.delete(f)),Ls(t,r,c)}};var zs=function t(n,r,e,i,a){n!==r&&nu(r,(function(o,u){if(a||(a=new ba),Ni(o))Xs(n,r,u,e,t,i,a);else{var f=i?i(Gs(n,u),o,u+"",n,r,a):void 0;void 0===f&&(f=o),Ls(n,u,f)}}),no)};var Hs=function(t){return Xf((function(n,r){var e=-1,i=r.length,a=i>1?r[i-1]:void 0,o=i>2?r[2]:void 0;for(a=t.length>3&&"function"==typeof a?(i--,a):void 0,o&&vs(r[0],r[1],o)&&(a=i<3?void 0:a,i=1),n=Object(n);++e<i;){var u=r[e];u&&t(n,u,e,a)}return n}))}((function(t,n,r){zs(t,n,r)}));var Ws=function(t,n){return t<n};var $s=function(t){return t&&t.length?Is(t,iu,Ws):void 0};var Ys=function(t,n){return t&&t.length?Is(t,rf(n),Ws):void 0},qs=function(){return wi.Date.now()};var Ks=function(t,n,r,e){if(!Ni(t))return t;for(var i=-1,a=(n=Hu(n,t)).length,o=a-1,u=t;null!=u&&++i<a;){var f=Wu(n[i]),s=r;if("__proto__"===f||"constructor"===f||"prototype"===f)return t;if(i!=o){var c=u[f];void 0===(s=e?e(c,f,u):void 0)&&(s=Ni(c)?c:Ca(n[i+1])?[]:{})}ga(u,f,s),u=u[f]}return t};var Qs=function(t,n,r){for(var e=-1,i=n.length,a={};++e<i;){var o=n[e],u=$u(t,o);r(u,o)&&Ks(a,Hu(o,t),u)}return a};var Zs=function(t,n){return Qs(t,n,(function(n,r){return Qu(t,r)}))};var Js=function(t){return Vf(Df(t,void 0,xs),t+"")}((function(t,n){return null==t?{}:Zs(t,n)})),tc=Math.ceil,nc=Math.max;var rc=function(t,n,r,e){for(var i=-1,a=nc(tc((n-t)/(r||1)),0),o=Array(a);a--;)o[e?a:++i]=t,t+=r;return o};var ec=function(t){return function(n,r,e){return e&&"number"!=typeof e&&vs(n,r,e)&&(r=e=void 0),n=_s(n),void 0===r?(r=n,n=0):r=_s(r),e=void 0===e?n<r?1:-1:_s(e),rc(n,r,e,t)}}();var ic=function(t,n){var r=t.length;for(t.sort(n);r--;)t[r]=t[r].value;return t};var ac=function(t,n){if(t!==n){var r=void 0!==t,e=null===t,i=t==t,a=Iu(t),o=void 0!==n,u=null===n,f=n==n,s=Iu(n);if(!u&&!s&&!a&&t>n||a&&o&&f&&!u&&!s||e&&o&&f||!r&&f||!i)return 1;if(!e&&!a&&!s&&t<n||s&&r&&i&&!e&&!a||u&&r&&i||!o&&i||!f)return-1}return 0};var oc=function(t,n,r){for(var e=-1,i=t.criteria,a=n.criteria,o=i.length,u=r.length;++e<o;){var f=ac(i[e],a[e]);if(f)return e>=u?f:f*("desc"==r[e]?-1:1)}return t.index-n.index};var uc=function(t,n,r){n=n.length?Pu(n,(function(t){return Sa(t)?function(n){return $u(n,1===t.length?t[0]:t)}:t})):[iu];var e=-1;n=Pu(n,Fa(rf));var i=lf(t,(function(t,r,i){return{criteria:Pu(n,(function(n){return n(t)})),index:++e,value:t}}));return ic(i,(function(t,n){return oc(t,n,r)}))},fc=Xf((function(t,n){if(null==t)return[];var r=n.length;return r>1&&vs(t,n[0],n[1])?n=[]:r>2&&vs(n[0],n[1],n[2])&&(n=[n[0]]),uc(t,Uf(n,1),[])})),sc=0;var cc=function(t){var n=++sc;return zu(t)+n};var lc=function(t,n,r){for(var e=-1,i=t.length,a=n.length,o={};++e<i;){var u=e<a?n[e]:void 0;r(o,t[e],u)}return o};var vc,dc=function(t,n){return lc(t||[],n||[],ga)};try{vc={cloneDeep:ls,constant:tu,defaults:bs,each:uu,filter:ef,find:Os,flatten:xs,forEach:ou,forIn:js,has:uf,isUndefined:cf,last:Ss,map:vf,mapValues:Ns,max:Cs,merge:Hs,min:$s,minBy:Ys,now:qs,pick:Js,range:ec,reduce:bf,sortBy:fc,uniqueId:cc,values:es,zipObject:dc}}catch(t){}vc||(vc=window._);var hc=vc;hc.constant(1);N((function(t){function n(t,n,r,e,i,a,o){try{var u=t[a](o);var f=u.value}catch(t){r(t);return}if(u.done){n(f)}else{Promise.resolve(f).then(e,i)}}function r(t){return function(){var r=this,e=arguments;return new Promise((function(i,a){var o=t.apply(r,e);function u(t){n(o,i,a,u,f,"next",t)}function f(t){n(o,i,a,u,f,"throw",t)}u(undefined)}))}}t.exports=r,t.exports.__esModule=true,t.exports["default"]=t.exports}));var bc=N((function(t){function n(r){"@babel/helpers - typeof";return t.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=true,t.exports["default"]=t.exports,n(r)}t.exports=n,t.exports.__esModule=true,t.exports["default"]=t.exports}));var pc=N((function(t){var n=bc["default"];function r(t,r){if(n(t)!=="object"||t===null)return t;var e=t[Symbol.toPrimitive];if(e!==undefined){var i=e.call(t,r||"default");if(n(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(t)}t.exports=r,t.exports.__esModule=true,t.exports["default"]=t.exports}));var mc=N((function(t){var n=bc["default"];function r(t){var r=pc(t,"string");return n(r)==="symbol"?r:String(r)}t.exports=r,t.exports.__esModule=true,t.exports["default"]=t.exports}));var yc=N((function(t){function n(t,n,r){n=mc(n);if(n in t){Object.defineProperty(t,n,{value:r,enumerable:true,configurable:true,writable:true})}else{t[n]=r}return t}t.exports=n,t.exports.__esModule=true,t.exports["default"]=t.exports}));const wc=I(yc);N((function(t){function n(t,n){if(!(t instanceof n)){throw new TypeError("Cannot call a class as a function")}}t.exports=n,t.exports.__esModule=true,t.exports["default"]=t.exports}));N((function(t){function n(t,n){for(var r=0;r<n.length;r++){var e=n[r];e.enumerable=e.enumerable||false;e.configurable=true;if("value"in e)e.writable=true;Object.defineProperty(t,mc(e.key),e)}}function r(t,r,e){if(r)n(t.prototype,r);if(e)n(t,e);Object.defineProperty(t,"prototype",{writable:false});return t}t.exports=r,t.exports.__esModule=true,t.exports["default"]=t.exports}));var gc=N((function(t){var n=bc["default"];function r(){t.exports=r=function t(){return e},t.exports.__esModule=true,t.exports["default"]=t.exports;var e={},i=Object.prototype,a=i.hasOwnProperty,o=Object.defineProperty||function(t,n,r){t[n]=r.value},u="function"==typeof Symbol?Symbol:{},f=u.iterator||"@@iterator",s=u.asyncIterator||"@@asyncIterator",c=u.toStringTag||"@@toStringTag";function l(t,n,r){return Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[n]}try{l({},"")}catch(t){l=function t(n,r,e){return n[r]=e}}function v(t,n,r,e){var i=n&&n.prototype instanceof b?n:b,a=Object.create(i.prototype),u=new j(e||[]);return o(a,"_invoke",{value:T(t,r,u)}),a}function d(t,n,r){try{return{type:"normal",arg:t.call(n,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=v;var h={};function b(){}function p(){}function m(){}var y={};l(y,f,(function(){return this}));var w=Object.getPrototypeOf,g=w&&w(w(S([])));g&&g!==i&&a.call(g,f)&&(y=g);var E=m.prototype=b.prototype=Object.create(y);function A(t){["next","throw","return"].forEach((function(n){l(t,n,(function(t){return this._invoke(n,t)}))}))}function _(t,r){function e(i,o,u,f){var s=d(t[i],t,o);if("throw"!==s.type){var c=s.arg,l=c.value;return l&&"object"==n(l)&&a.call(l,"__await")?r.resolve(l.__await).then((function(t){e("next",t,u,f)}),(function(t){e("throw",t,u,f)})):r.resolve(l).then((function(t){c.value=t,u(c)}),(function(t){return e("throw",t,u,f)}))}f(s.arg)}var i;o(this,"_invoke",{value:function t(n,a){function o(){return new r((function(t,r){e(n,a,t,r)}))}return i=i?i.then(o,o):o()}})}function T(t,n,r){var e="suspendedStart";return function(i,a){if("executing"===e)throw new Error("Generator is already running");if("completed"===e){if("throw"===i)throw a;return N()}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var u=R(o,r);if(u){if(u===h)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===e)throw e="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);e="executing";var f=d(t,n,r);if("normal"===f.type){if(e=r.done?"completed":"suspendedYield",f.arg===h)continue;return{value:f.arg,done:r.done}}"throw"===f.type&&(e="completed",r.method="throw",r.arg=f.arg)}}}function R(t,n){var r=n.method,e=t.iterator[r];if(undefined===e)return n.delegate=null,"throw"===r&&t.iterator["return"]&&(n.method="return",n.arg=undefined,R(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var i=d(e,t.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,h;var a=i.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=undefined),n.delegate=null,h):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}function O(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function x(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function j(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function S(t){if(t){var n=t[f];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,e=function n(){for(;++r<t.length;)if(a.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=undefined,n.done=!0,n};return e.next=e}}return{next:N}}function N(){return{value:undefined,done:!0}}return p.prototype=m,o(E,"constructor",{value:m,configurable:!0}),o(m,"constructor",{value:p,configurable:!0}),p.displayName=l(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===p||"GeneratorFunction"===(n.displayName||n.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,m):(t.__proto__=m,l(t,c,"GeneratorFunction")),t.prototype=Object.create(E),t},e.awrap=function(t){return{__await:t}},A(_.prototype),l(_.prototype,s,(function(){return this})),e.AsyncIterator=_,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var o=new _(v(t,n,r,i),a);return e.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},A(E),l(E,c,"Generator"),l(E,f,(function(){return this})),l(E,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var n=Object(t),r=[];for(var e in n)r.push(e);return r.reverse(),function t(){for(;r.length;){var e=r.pop();if(e in n)return t.value=e,t.done=!1,t}return t.done=!0,t}},e.values=S,j.prototype={constructor:j,reset:function t(n){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method="next",this.arg=undefined,this.tryEntries.forEach(x),!n)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=undefined)},stop:function t(){this.done=!0;var n=this.tryEntries[0].completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function t(n){if(this.done)throw n;var r=this;function e(t,e){return u.type="throw",u.arg=n,r.next=t,e&&(r.method="next",r.arg=undefined),!!e}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],u=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var f=a.call(o,"catchLoc"),s=a.call(o,"finallyLoc");if(f&&s){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(f){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function t(n,r){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===n||"continue"===n)&&o.tryLoc<=r&&r<=o.finallyLoc&&(o=null);var u=o?o.completion:{};return u.type=n,u.arg=r,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(u)},complete:function t(n,r){if("throw"===n.type)throw n.arg;return"break"===n.type||"continue"===n.type?this.next=n.arg:"return"===n.type?(this.rval=this.arg=n.arg,this.method="return",this.next="end"):"normal"===n.type&&r&&(this.next=r),h},finish:function t(n){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.finallyLoc===n)return this.complete(e.completion,e.afterLoc),x(e),h}},catch:function t(n){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc===n){var i=e.completion;if("throw"===i.type){var a=i.arg;x(e)}return a}}throw new Error("illegal catch attempt")},delegateYield:function t(n,r,e){return this.delegate={iterator:S(n),resultName:r,nextLoc:e},"next"===this.method&&(this.arg=undefined),h}},e}t.exports=r,t.exports.__esModule=true,t.exports["default"]=t.exports}));var Ec=gc();try{regeneratorRuntime=Ec}catch(t){if(typeof globalThis==="object"){globalThis.regeneratorRuntime=Ec}else{Function("r","regeneratorRuntime = r")(Ec)}}var Ac;(function(t){t[t["DEPTH_BUFFER_BIT"]=256]="DEPTH_BUFFER_BIT";t[t["STENCIL_BUFFER_BIT"]=1024]="STENCIL_BUFFER_BIT";t[t["COLOR_BUFFER_BIT"]=16384]="COLOR_BUFFER_BIT";t[t["POINTS"]=0]="POINTS";t[t["LINES"]=1]="LINES";t[t["LINE_LOOP"]=2]="LINE_LOOP";t[t["LINE_STRIP"]=3]="LINE_STRIP";t[t["TRIANGLES"]=4]="TRIANGLES";t[t["TRIANGLE_STRIP"]=5]="TRIANGLE_STRIP";t[t["TRIANGLE_FAN"]=6]="TRIANGLE_FAN";t[t["ZERO"]=0]="ZERO";t[t["ONE"]=1]="ONE";t[t["SRC_COLOR"]=768]="SRC_COLOR";t[t["ONE_MINUS_SRC_COLOR"]=769]="ONE_MINUS_SRC_COLOR";t[t["SRC_ALPHA"]=770]="SRC_ALPHA";t[t["ONE_MINUS_SRC_ALPHA"]=771]="ONE_MINUS_SRC_ALPHA";t[t["DST_ALPHA"]=772]="DST_ALPHA";t[t["ONE_MINUS_DST_ALPHA"]=773]="ONE_MINUS_DST_ALPHA";t[t["DST_COLOR"]=774]="DST_COLOR";t[t["ONE_MINUS_DST_COLOR"]=775]="ONE_MINUS_DST_COLOR";t[t["SRC_ALPHA_SATURATE"]=776]="SRC_ALPHA_SATURATE";t[t["FUNC_ADD"]=32774]="FUNC_ADD";t[t["BLEND_EQUATION"]=32777]="BLEND_EQUATION";t[t["BLEND_EQUATION_RGB"]=32777]="BLEND_EQUATION_RGB";t[t["BLEND_EQUATION_ALPHA"]=34877]="BLEND_EQUATION_ALPHA";t[t["FUNC_SUBTRACT"]=32778]="FUNC_SUBTRACT";t[t["FUNC_REVERSE_SUBTRACT"]=32779]="FUNC_REVERSE_SUBTRACT";t[t["MAX_EXT"]=32776]="MAX_EXT";t[t["MIN_EXT"]=32775]="MIN_EXT";t[t["BLEND_DST_RGB"]=32968]="BLEND_DST_RGB";t[t["BLEND_SRC_RGB"]=32969]="BLEND_SRC_RGB";t[t["BLEND_DST_ALPHA"]=32970]="BLEND_DST_ALPHA";t[t["BLEND_SRC_ALPHA"]=32971]="BLEND_SRC_ALPHA";t[t["CONSTANT_COLOR"]=32769]="CONSTANT_COLOR";t[t["ONE_MINUS_CONSTANT_COLOR"]=32770]="ONE_MINUS_CONSTANT_COLOR";t[t["CONSTANT_ALPHA"]=32771]="CONSTANT_ALPHA";t[t["ONE_MINUS_CONSTANT_ALPHA"]=32772]="ONE_MINUS_CONSTANT_ALPHA";t[t["BLEND_COLOR"]=32773]="BLEND_COLOR";t[t["ARRAY_BUFFER"]=34962]="ARRAY_BUFFER";t[t["ELEMENT_ARRAY_BUFFER"]=34963]="ELEMENT_ARRAY_BUFFER";t[t["ARRAY_BUFFER_BINDING"]=34964]="ARRAY_BUFFER_BINDING";t[t["ELEMENT_ARRAY_BUFFER_BINDING"]=34965]="ELEMENT_ARRAY_BUFFER_BINDING";t[t["STREAM_DRAW"]=35040]="STREAM_DRAW";t[t["STATIC_DRAW"]=35044]="STATIC_DRAW";t[t["DYNAMIC_DRAW"]=35048]="DYNAMIC_DRAW";t[t["BUFFER_SIZE"]=34660]="BUFFER_SIZE";t[t["BUFFER_USAGE"]=34661]="BUFFER_USAGE";t[t["CURRENT_VERTEX_ATTRIB"]=34342]="CURRENT_VERTEX_ATTRIB";t[t["FRONT"]=1028]="FRONT";t[t["BACK"]=1029]="BACK";t[t["FRONT_AND_BACK"]=1032]="FRONT_AND_BACK";t[t["CULL_FACE"]=2884]="CULL_FACE";t[t["BLEND"]=3042]="BLEND";t[t["DITHER"]=3024]="DITHER";t[t["STENCIL_TEST"]=2960]="STENCIL_TEST";t[t["DEPTH_TEST"]=2929]="DEPTH_TEST";t[t["SCISSOR_TEST"]=3089]="SCISSOR_TEST";t[t["POLYGON_OFFSET_FILL"]=32823]="POLYGON_OFFSET_FILL";t[t["SAMPLE_ALPHA_TO_COVERAGE"]=32926]="SAMPLE_ALPHA_TO_COVERAGE";t[t["SAMPLE_COVERAGE"]=32928]="SAMPLE_COVERAGE";t[t["NO_ERROR"]=0]="NO_ERROR";t[t["INVALID_ENUM"]=1280]="INVALID_ENUM";t[t["INVALID_VALUE"]=1281]="INVALID_VALUE";t[t["INVALID_OPERATION"]=1282]="INVALID_OPERATION";t[t["OUT_OF_MEMORY"]=1285]="OUT_OF_MEMORY";t[t["CW"]=2304]="CW";t[t["CCW"]=2305]="CCW";t[t["LINE_WIDTH"]=2849]="LINE_WIDTH";t[t["ALIASED_POINT_SIZE_RANGE"]=33901]="ALIASED_POINT_SIZE_RANGE";t[t["ALIASED_LINE_WIDTH_RANGE"]=33902]="ALIASED_LINE_WIDTH_RANGE";t[t["CULL_FACE_MODE"]=2885]="CULL_FACE_MODE";t[t["FRONT_FACE"]=2886]="FRONT_FACE";t[t["DEPTH_RANGE"]=2928]="DEPTH_RANGE";t[t["DEPTH_WRITEMASK"]=2930]="DEPTH_WRITEMASK";t[t["DEPTH_CLEAR_VALUE"]=2931]="DEPTH_CLEAR_VALUE";t[t["DEPTH_FUNC"]=2932]="DEPTH_FUNC";t[t["STENCIL_CLEAR_VALUE"]=2961]="STENCIL_CLEAR_VALUE";t[t["STENCIL_FUNC"]=2962]="STENCIL_FUNC";t[t["STENCIL_FAIL"]=2964]="STENCIL_FAIL";t[t["STENCIL_PASS_DEPTH_FAIL"]=2965]="STENCIL_PASS_DEPTH_FAIL";t[t["STENCIL_PASS_DEPTH_PASS"]=2966]="STENCIL_PASS_DEPTH_PASS";t[t["STENCIL_REF"]=2967]="STENCIL_REF";t[t["STENCIL_VALUE_MASK"]=2963]="STENCIL_VALUE_MASK";t[t["STENCIL_WRITEMASK"]=2968]="STENCIL_WRITEMASK";t[t["STENCIL_BACK_FUNC"]=34816]="STENCIL_BACK_FUNC";t[t["STENCIL_BACK_FAIL"]=34817]="STENCIL_BACK_FAIL";t[t["STENCIL_BACK_PASS_DEPTH_FAIL"]=34818]="STENCIL_BACK_PASS_DEPTH_FAIL";t[t["STENCIL_BACK_PASS_DEPTH_PASS"]=34819]="STENCIL_BACK_PASS_DEPTH_PASS";t[t["STENCIL_BACK_REF"]=36003]="STENCIL_BACK_REF";t[t["STENCIL_BACK_VALUE_MASK"]=36004]="STENCIL_BACK_VALUE_MASK";t[t["STENCIL_BACK_WRITEMASK"]=36005]="STENCIL_BACK_WRITEMASK";t[t["VIEWPORT"]=2978]="VIEWPORT";t[t["SCISSOR_BOX"]=3088]="SCISSOR_BOX";t[t["COLOR_CLEAR_VALUE"]=3106]="COLOR_CLEAR_VALUE";t[t["COLOR_WRITEMASK"]=3107]="COLOR_WRITEMASK";t[t["UNPACK_ALIGNMENT"]=3317]="UNPACK_ALIGNMENT";t[t["PACK_ALIGNMENT"]=3333]="PACK_ALIGNMENT";t[t["MAX_TEXTURE_SIZE"]=3379]="MAX_TEXTURE_SIZE";t[t["MAX_VIEWPORT_DIMS"]=3386]="MAX_VIEWPORT_DIMS";t[t["SUBPIXEL_BITS"]=3408]="SUBPIXEL_BITS";t[t["RED_BITS"]=3410]="RED_BITS";t[t["GREEN_BITS"]=3411]="GREEN_BITS";t[t["BLUE_BITS"]=3412]="BLUE_BITS";t[t["ALPHA_BITS"]=3413]="ALPHA_BITS";t[t["DEPTH_BITS"]=3414]="DEPTH_BITS";t[t["STENCIL_BITS"]=3415]="STENCIL_BITS";t[t["POLYGON_OFFSET_UNITS"]=10752]="POLYGON_OFFSET_UNITS";t[t["POLYGON_OFFSET_FACTOR"]=32824]="POLYGON_OFFSET_FACTOR";t[t["TEXTURE_BINDING_2D"]=32873]="TEXTURE_BINDING_2D";t[t["SAMPLE_BUFFERS"]=32936]="SAMPLE_BUFFERS";t[t["SAMPLES"]=32937]="SAMPLES";t[t["SAMPLE_COVERAGE_VALUE"]=32938]="SAMPLE_COVERAGE_VALUE";t[t["SAMPLE_COVERAGE_INVERT"]=32939]="SAMPLE_COVERAGE_INVERT";t[t["COMPRESSED_TEXTURE_FORMATS"]=34467]="COMPRESSED_TEXTURE_FORMATS";t[t["DONT_CARE"]=4352]="DONT_CARE";t[t["FASTEST"]=4353]="FASTEST";t[t["NICEST"]=4354]="NICEST";t[t["GENERATE_MIPMAP_HINT"]=33170]="GENERATE_MIPMAP_HINT";t[t["BYTE"]=5120]="BYTE";t[t["UNSIGNED_BYTE"]=5121]="UNSIGNED_BYTE";t[t["SHORT"]=5122]="SHORT";t[t["UNSIGNED_SHORT"]=5123]="UNSIGNED_SHORT";t[t["INT"]=5124]="INT";t[t["UNSIGNED_INT"]=5125]="UNSIGNED_INT";t[t["FLOAT"]=5126]="FLOAT";t[t["DEPTH_COMPONENT"]=6402]="DEPTH_COMPONENT";t[t["ALPHA"]=6406]="ALPHA";t[t["RGB"]=6407]="RGB";t[t["RGBA"]=6408]="RGBA";t[t["LUMINANCE"]=6409]="LUMINANCE";t[t["LUMINANCE_ALPHA"]=6410]="LUMINANCE_ALPHA";t[t["UNSIGNED_SHORT_4_4_4_4"]=32819]="UNSIGNED_SHORT_4_4_4_4";t[t["UNSIGNED_SHORT_5_5_5_1"]=32820]="UNSIGNED_SHORT_5_5_5_1";t[t["UNSIGNED_SHORT_5_6_5"]=33635]="UNSIGNED_SHORT_5_6_5";t[t["FRAGMENT_SHADER"]=35632]="FRAGMENT_SHADER";t[t["VERTEX_SHADER"]=35633]="VERTEX_SHADER";t[t["MAX_VERTEX_ATTRIBS"]=34921]="MAX_VERTEX_ATTRIBS";t[t["MAX_VERTEX_UNIFORM_VECTORS"]=36347]="MAX_VERTEX_UNIFORM_VECTORS";t[t["MAX_VARYING_VECTORS"]=36348]="MAX_VARYING_VECTORS";t[t["MAX_COMBINED_TEXTURE_IMAGE_UNITS"]=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS";t[t["MAX_VERTEX_TEXTURE_IMAGE_UNITS"]=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS";t[t["MAX_TEXTURE_IMAGE_UNITS"]=34930]="MAX_TEXTURE_IMAGE_UNITS";t[t["MAX_FRAGMENT_UNIFORM_VECTORS"]=36349]="MAX_FRAGMENT_UNIFORM_VECTORS";t[t["SHADER_TYPE"]=35663]="SHADER_TYPE";t[t["DELETE_STATUS"]=35712]="DELETE_STATUS";t[t["LINK_STATUS"]=35714]="LINK_STATUS";t[t["VALIDATE_STATUS"]=35715]="VALIDATE_STATUS";t[t["ATTACHED_SHADERS"]=35717]="ATTACHED_SHADERS";t[t["ACTIVE_UNIFORMS"]=35718]="ACTIVE_UNIFORMS";t[t["ACTIVE_ATTRIBUTES"]=35721]="ACTIVE_ATTRIBUTES";t[t["SHADING_LANGUAGE_VERSION"]=35724]="SHADING_LANGUAGE_VERSION";t[t["CURRENT_PROGRAM"]=35725]="CURRENT_PROGRAM";t[t["NEVER"]=512]="NEVER";t[t["LESS"]=513]="LESS";t[t["EQUAL"]=514]="EQUAL";t[t["LEQUAL"]=515]="LEQUAL";t[t["GREATER"]=516]="GREATER";t[t["NOTEQUAL"]=517]="NOTEQUAL";t[t["GEQUAL"]=518]="GEQUAL";t[t["ALWAYS"]=519]="ALWAYS";t[t["KEEP"]=7680]="KEEP";t[t["REPLACE"]=7681]="REPLACE";t[t["INCR"]=7682]="INCR";t[t["DECR"]=7683]="DECR";t[t["INVERT"]=5386]="INVERT";t[t["INCR_WRAP"]=34055]="INCR_WRAP";t[t["DECR_WRAP"]=34056]="DECR_WRAP";t[t["VENDOR"]=7936]="VENDOR";t[t["RENDERER"]=7937]="RENDERER";t[t["VERSION"]=7938]="VERSION";t[t["NEAREST"]=9728]="NEAREST";t[t["LINEAR"]=9729]="LINEAR";t[t["NEAREST_MIPMAP_NEAREST"]=9984]="NEAREST_MIPMAP_NEAREST";t[t["LINEAR_MIPMAP_NEAREST"]=9985]="LINEAR_MIPMAP_NEAREST";t[t["NEAREST_MIPMAP_LINEAR"]=9986]="NEAREST_MIPMAP_LINEAR";t[t["LINEAR_MIPMAP_LINEAR"]=9987]="LINEAR_MIPMAP_LINEAR";t[t["TEXTURE_MAG_FILTER"]=10240]="TEXTURE_MAG_FILTER";t[t["TEXTURE_MIN_FILTER"]=10241]="TEXTURE_MIN_FILTER";t[t["TEXTURE_WRAP_S"]=10242]="TEXTURE_WRAP_S";t[t["TEXTURE_WRAP_T"]=10243]="TEXTURE_WRAP_T";t[t["TEXTURE_2D"]=3553]="TEXTURE_2D";t[t["TEXTURE"]=5890]="TEXTURE";t[t["TEXTURE_CUBE_MAP"]=34067]="TEXTURE_CUBE_MAP";t[t["TEXTURE_BINDING_CUBE_MAP"]=34068]="TEXTURE_BINDING_CUBE_MAP";t[t["TEXTURE_CUBE_MAP_POSITIVE_X"]=34069]="TEXTURE_CUBE_MAP_POSITIVE_X";t[t["TEXTURE_CUBE_MAP_NEGATIVE_X"]=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X";t[t["TEXTURE_CUBE_MAP_POSITIVE_Y"]=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y";t[t["TEXTURE_CUBE_MAP_NEGATIVE_Y"]=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y";t[t["TEXTURE_CUBE_MAP_POSITIVE_Z"]=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z";t[t["TEXTURE_CUBE_MAP_NEGATIVE_Z"]=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z";t[t["MAX_CUBE_MAP_TEXTURE_SIZE"]=34076]="MAX_CUBE_MAP_TEXTURE_SIZE";t[t["TEXTURE0"]=33984]="TEXTURE0";t[t["TEXTURE1"]=33985]="TEXTURE1";t[t["TEXTURE2"]=33986]="TEXTURE2";t[t["TEXTURE3"]=33987]="TEXTURE3";t[t["TEXTURE4"]=33988]="TEXTURE4";t[t["TEXTURE5"]=33989]="TEXTURE5";t[t["TEXTURE6"]=33990]="TEXTURE6";t[t["TEXTURE7"]=33991]="TEXTURE7";t[t["TEXTURE8"]=33992]="TEXTURE8";t[t["TEXTURE9"]=33993]="TEXTURE9";t[t["TEXTURE10"]=33994]="TEXTURE10";t[t["TEXTURE11"]=33995]="TEXTURE11";t[t["TEXTURE12"]=33996]="TEXTURE12";t[t["TEXTURE13"]=33997]="TEXTURE13";t[t["TEXTURE14"]=33998]="TEXTURE14";t[t["TEXTURE15"]=33999]="TEXTURE15";t[t["TEXTURE16"]=34e3]="TEXTURE16";t[t["TEXTURE17"]=34001]="TEXTURE17";t[t["TEXTURE18"]=34002]="TEXTURE18";t[t["TEXTURE19"]=34003]="TEXTURE19";t[t["TEXTURE20"]=34004]="TEXTURE20";t[t["TEXTURE21"]=34005]="TEXTURE21";t[t["TEXTURE22"]=34006]="TEXTURE22";t[t["TEXTURE23"]=34007]="TEXTURE23";t[t["TEXTURE24"]=34008]="TEXTURE24";t[t["TEXTURE25"]=34009]="TEXTURE25";t[t["TEXTURE26"]=34010]="TEXTURE26";t[t["TEXTURE27"]=34011]="TEXTURE27";t[t["TEXTURE28"]=34012]="TEXTURE28";t[t["TEXTURE29"]=34013]="TEXTURE29";t[t["TEXTURE30"]=34014]="TEXTURE30";t[t["TEXTURE31"]=34015]="TEXTURE31";t[t["ACTIVE_TEXTURE"]=34016]="ACTIVE_TEXTURE";t[t["REPEAT"]=10497]="REPEAT";t[t["CLAMP_TO_EDGE"]=33071]="CLAMP_TO_EDGE";t[t["MIRRORED_REPEAT"]=33648]="MIRRORED_REPEAT";t[t["FLOAT_VEC2"]=35664]="FLOAT_VEC2";t[t["FLOAT_VEC3"]=35665]="FLOAT_VEC3";t[t["FLOAT_VEC4"]=35666]="FLOAT_VEC4";t[t["INT_VEC2"]=35667]="INT_VEC2";t[t["INT_VEC3"]=35668]="INT_VEC3";t[t["INT_VEC4"]=35669]="INT_VEC4";t[t["BOOL"]=35670]="BOOL";t[t["BOOL_VEC2"]=35671]="BOOL_VEC2";t[t["BOOL_VEC3"]=35672]="BOOL_VEC3";t[t["BOOL_VEC4"]=35673]="BOOL_VEC4";t[t["FLOAT_MAT2"]=35674]="FLOAT_MAT2";t[t["FLOAT_MAT3"]=35675]="FLOAT_MAT3";t[t["FLOAT_MAT4"]=35676]="FLOAT_MAT4";t[t["SAMPLER_2D"]=35678]="SAMPLER_2D";t[t["SAMPLER_CUBE"]=35680]="SAMPLER_CUBE";t[t["VERTEX_ATTRIB_ARRAY_ENABLED"]=34338]="VERTEX_ATTRIB_ARRAY_ENABLED";t[t["VERTEX_ATTRIB_ARRAY_SIZE"]=34339]="VERTEX_ATTRIB_ARRAY_SIZE";t[t["VERTEX_ATTRIB_ARRAY_STRIDE"]=34340]="VERTEX_ATTRIB_ARRAY_STRIDE";t[t["VERTEX_ATTRIB_ARRAY_TYPE"]=34341]="VERTEX_ATTRIB_ARRAY_TYPE";t[t["VERTEX_ATTRIB_ARRAY_NORMALIZED"]=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED";t[t["VERTEX_ATTRIB_ARRAY_POINTER"]=34373]="VERTEX_ATTRIB_ARRAY_POINTER";t[t["VERTEX_ATTRIB_ARRAY_BUFFER_BINDING"]=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING";t[t["COMPILE_STATUS"]=35713]="COMPILE_STATUS";t[t["LOW_FLOAT"]=36336]="LOW_FLOAT";t[t["MEDIUM_FLOAT"]=36337]="MEDIUM_FLOAT";t[t["HIGH_FLOAT"]=36338]="HIGH_FLOAT";t[t["LOW_INT"]=36339]="LOW_INT";t[t["MEDIUM_INT"]=36340]="MEDIUM_INT";t[t["HIGH_INT"]=36341]="HIGH_INT";t[t["FRAMEBUFFER"]=36160]="FRAMEBUFFER";t[t["RENDERBUFFER"]=36161]="RENDERBUFFER";t[t["RGBA4"]=32854]="RGBA4";t[t["RGB5_A1"]=32855]="RGB5_A1";t[t["RGB565"]=36194]="RGB565";t[t["DEPTH_COMPONENT16"]=33189]="DEPTH_COMPONENT16";t[t["STENCIL_INDEX"]=6401]="STENCIL_INDEX";t[t["STENCIL_INDEX8"]=36168]="STENCIL_INDEX8";t[t["DEPTH_STENCIL"]=34041]="DEPTH_STENCIL";t[t["RENDERBUFFER_WIDTH"]=36162]="RENDERBUFFER_WIDTH";t[t["RENDERBUFFER_HEIGHT"]=36163]="RENDERBUFFER_HEIGHT";t[t["RENDERBUFFER_INTERNAL_FORMAT"]=36164]="RENDERBUFFER_INTERNAL_FORMAT";t[t["RENDERBUFFER_RED_SIZE"]=36176]="RENDERBUFFER_RED_SIZE";t[t["RENDERBUFFER_GREEN_SIZE"]=36177]="RENDERBUFFER_GREEN_SIZE";t[t["RENDERBUFFER_BLUE_SIZE"]=36178]="RENDERBUFFER_BLUE_SIZE";t[t["RENDERBUFFER_ALPHA_SIZE"]=36179]="RENDERBUFFER_ALPHA_SIZE";t[t["RENDERBUFFER_DEPTH_SIZE"]=36180]="RENDERBUFFER_DEPTH_SIZE";t[t["RENDERBUFFER_STENCIL_SIZE"]=36181]="RENDERBUFFER_STENCIL_SIZE";t[t["FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE"]=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE";t[t["FRAMEBUFFER_ATTACHMENT_OBJECT_NAME"]=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME";t[t["FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL"]=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL";t[t["FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE"]=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE";t[t["COLOR_ATTACHMENT0"]=36064]="COLOR_ATTACHMENT0";t[t["DEPTH_ATTACHMENT"]=36096]="DEPTH_ATTACHMENT";t[t["STENCIL_ATTACHMENT"]=36128]="STENCIL_ATTACHMENT";t[t["DEPTH_STENCIL_ATTACHMENT"]=33306]="DEPTH_STENCIL_ATTACHMENT";t[t["NONE"]=0]="NONE";t[t["FRAMEBUFFER_COMPLETE"]=36053]="FRAMEBUFFER_COMPLETE";t[t["FRAMEBUFFER_INCOMPLETE_ATTACHMENT"]=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT";t[t["FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT"]=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";t[t["FRAMEBUFFER_INCOMPLETE_DIMENSIONS"]=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS";t[t["FRAMEBUFFER_UNSUPPORTED"]=36061]="FRAMEBUFFER_UNSUPPORTED";t[t["FRAMEBUFFER_BINDING"]=36006]="FRAMEBUFFER_BINDING";t[t["RENDERBUFFER_BINDING"]=36007]="RENDERBUFFER_BINDING";t[t["MAX_RENDERBUFFER_SIZE"]=34024]="MAX_RENDERBUFFER_SIZE";t[t["INVALID_FRAMEBUFFER_OPERATION"]=1286]="INVALID_FRAMEBUFFER_OPERATION";t[t["UNPACK_FLIP_Y_WEBGL"]=37440]="UNPACK_FLIP_Y_WEBGL";t[t["UNPACK_PREMULTIPLY_ALPHA_WEBGL"]=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL";t[t["CONTEXT_LOST_WEBGL"]=37442]="CONTEXT_LOST_WEBGL";t[t["UNPACK_COLORSPACE_CONVERSION_WEBGL"]=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL";t[t["BROWSER_DEFAULT_WEBGL"]=37444]="BROWSER_DEFAULT_WEBGL";t[t["COPY_SRC"]=1]="COPY_SRC";t[t["COPY_DST"]=2]="COPY_DST";t[t["SAMPLED"]=4]="SAMPLED";t[t["STORAGE"]=8]="STORAGE";t[t["RENDER_ATTACHMENT"]=16]="RENDER_ATTACHMENT"})(Ac||(Ac={}));typeof navigator!=="undefined"&&/Version\/[\d\.]+.*Safari/.test(navigator.userAgent);var _c;(function(t){t["Void"]="Void";t["Boolean"]="Boolean";t["Float"]="Float";t["Uint32"]="Uint32";t["Int32"]="Int32";t["Vector"]="Vector";t["Vector2Float"]="vec2<f32>";t["Vector3Float"]="vec3<f32>";t["Vector4Float"]="vec4<f32>";t["Vector2Boolean"]="vec2<bool>";t["Vector3Boolean"]="vec3<bool>";t["Vector4Boolean"]="vec4<bool>";t["Vector2Uint"]="vec2<u32>";t["Vector3Uint"]="vec3<u32>";t["Vector4Uint"]="vec4<u32>";t["Vector2Int"]="vec2<i32>";t["Vector3Int"]="vec3<i32>";t["Vector4Int"]="vec4<i32>";t["Matrix"]="Matrix";t["Matrix3x3Float"]="mat3x3<f32>";t["Matrix4x4Float"]="mat4x4<i32>";t["Struct"]="Struct";t["FloatArray"]="Float[]";t["Vector4FloatArray"]="vec4<f32>[]"})(_c||(_c={}));var Tc;(function(t){t["Program"]="Program";t["Identifier"]="Identifier";t["VariableDeclaration"]="VariableDeclaration";t["BlockStatement"]="BlockStatement";t["ReturnStatement"]="ReturnStatement";t["FunctionDeclaration"]="FunctionDeclaration";t["VariableDeclarator"]="VariableDeclarator";t["AssignmentExpression"]="AssignmentExpression";t["LogicalExpression"]="LogicalExpression";t["BinaryExpression"]="BinaryExpression";t["ArrayExpression"]="ArrayExpression";t["UnaryExpression"]="UnaryExpression";t["UpdateExpression"]="UpdateExpression";t["FunctionExpression"]="FunctionExpression";t["MemberExpression"]="MemberExpression";t["ConditionalExpression"]="ConditionalExpression";t["ExpressionStatement"]="ExpressionStatement";t["CallExpression"]="CallExpression";t["NumThreadStatement"]="NumThreadStatement";t["StorageStatement"]="StorageStatement";t["DoWhileStatement"]="DoWhileStatement";t["WhileStatement"]="WhileStatement";t["ForStatement"]="ForStatement";t["BreakStatement"]="BreakStatement";t["ContinueStatement"]="ContinueStatement";t["IfStatement"]="IfStatement";t["ImportedFunctionStatement"]="ImportedFunctionStatement"})(Tc||(Tc={}));var Rc;(function(t){t["Input"]="Input";t["Output"]="Output";t["Uniform"]="Uniform";t["Workgroup"]="Workgroup";t["UniformConstant"]="UniformConstant";t["Image"]="Image";t["StorageBuffer"]="StorageBuffer";t["Private"]="Private";t["Function"]="Function"})(Rc||(Rc={}));var Oc;(function(t){t["GLSL100"]="GLSL100";t["GLSL450"]="GLSL450";t["WGSL"]="WGSL"})(Oc||(Oc={}));N((function(t,n){(function(n,r){t.exports=r()})(M,(function(){var t=function(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array||t instanceof Uint8ClampedArray};var n=function(t,n){var r=Object.keys(n);for(var e=0;e<r.length;++e){t[r[e]]=n[r[e]]}return t};var r="\n";function e(t){if(typeof atob!=="undefined"){return atob(t)}return"base64:"+t}function i(t){var n=new Error("(regl) "+t);console.error(n);throw n}function a(t,n){if(!t){i(n)}}function o(t){if(t){return": "+t}return""}function u(t,n,r){if(!(t in n)){i("unknown parameter ("+t+")"+o(r)+". possible values: "+Object.keys(n).join())}}function f(n,r){if(!t(n)){i("invalid parameter type"+o(r)+". must be a typed array")}}function s(t,n){switch(n){case"number":return typeof t==="number";case"object":return typeof t==="object";case"string":return typeof t==="string";case"boolean":return typeof t==="boolean";case"function":return typeof t==="function";case"undefined":return typeof t==="undefined";case"symbol":return typeof t==="symbol"}}function c(t,n,r){if(!s(t,n)){i("invalid parameter type"+o(r)+". expected "+n+", got "+typeof t)}}function l(t,n){if(!(t>=0&&(t|0)===t)){i("invalid parameter type, ("+t+")"+o(n)+". must be a nonnegative integer")}}function v(t,n,r){if(n.indexOf(t)<0){i("invalid value"+o(r)+". must be one of: "+n)}}var d=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function h(t){Object.keys(t).forEach((function(t){if(d.indexOf(t)<0){i('invalid regl constructor argument "'+t+'". must be one of '+d)}}))}function b(t,n){t=t+"";while(t.length<n){t=" "+t}return t}function p(){this.name="unknown";this.lines=[];this.index={};this.hasErrors=false}function m(t,n){this.number=t;this.line=n;this.errors=[]}function y(t,n,r){this.file=t;this.line=n;this.message=r}function w(){var t=new Error;var n=(t.stack||t).toString();var r=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(n);if(r){return r[1]}var e=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(n);if(e){return e[1]}return"unknown"}function g(){var t=new Error;var n=(t.stack||t).toString();var r=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(n);if(r){return r[1]}var e=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(n);if(e){return e[1]}return"unknown"}function E(t,n){var r=t.split("\n");var i=1;var a=0;var o={unknown:new p,0:new p};o.unknown.name=o[0].name=n||w();o.unknown.lines.push(new m(0,""));for(var u=0;u<r.length;++u){var f=r[u];var s=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(f);if(s){switch(s[1]){case"line":var c=/(\d+)(\s+\d+)?/.exec(s[2]);if(c){i=c[1]|0;if(c[2]){a=c[2]|0;if(!(a in o)){o[a]=new p}}}break;case"define":var l=/SHADER_NAME(_B64)?\s+(.*)$/.exec(s[2]);if(l){o[a].name=l[1]?e(l[2]):l[2]}break}}o[a].lines.push(new m(i++,f))}Object.keys(o).forEach((function(t){var n=o[t];n.lines.forEach((function(t){n.index[t.number]=t}))}));return o}function A(t){var n=[];t.split("\n").forEach((function(t){if(t.length<5){return}var r=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(t);if(r){n.push(new y(r[1]|0,r[2]|0,r[3].trim()))}else if(t.length>0){n.push(new y("unknown",0,t))}}));return n}function _(t,n){n.forEach((function(n){var r=t[n.file];if(r){var e=r.index[n.line];if(e){e.errors.push(n);r.hasErrors=true;return}}t.unknown.hasErrors=true;t.unknown.lines[0].errors.push(n)}))}function T(t,n,e,i,o){if(!t.getShaderParameter(n,t.COMPILE_STATUS)){var u=t.getShaderInfoLog(n);var f=i===t.FRAGMENT_SHADER?"fragment":"vertex";I(e,"string",f+" shader source must be a string",o);var s=E(e,o);var c=A(u);_(s,c);Object.keys(s).forEach((function(t){var n=s[t];if(!n.hasErrors){return}var e=[""];var i=[""];function a(t,n){e.push(t);i.push(n||"")}a("file number "+t+": "+n.name+"\n","color:red;text-decoration:underline;font-weight:bold");n.lines.forEach((function(t){if(t.errors.length>0){a(b(t.number,4)+"|  ","background-color:yellow; font-weight:bold");a(t.line+r,"color:red; background-color:yellow; font-weight:bold");var n=0;t.errors.forEach((function(e){var i=e.message;var o=/^\s*'(.*)'\s*:\s*(.*)$/.exec(i);if(o){var u=o[1];i=o[2];switch(u){case"assign":u="=";break}n=Math.max(t.line.indexOf(u,n),0)}else{n=0}a(b("| ",6));a(b("^^^",n+3)+r,"font-weight:bold");a(b("| ",6));a(i+r,"font-weight:bold")}));a(b("| ",6)+r)}else{a(b(t.number,4)+"|  ");a(t.line+r,"color:red")}}));if(typeof document!=="undefined"&&!window.chrome){i[0]=e.join("%c");console.log.apply(console,i)}else{console.log(e.join(""))}}));a.raise("Error compiling "+f+" shader, "+s[0].name)}}function R(t,n,e,i,o){if(!t.getProgramParameter(n,t.LINK_STATUS)){var u=t.getProgramInfoLog(n);var f=E(e,o);var s=E(i,o);var c='Error linking program with vertex shader, "'+s[0].name+'", and fragment shader "'+f[0].name+'"';if(typeof document!=="undefined"){console.log("%c"+c+r+"%c"+u,"color:red;text-decoration:underline;font-weight:bold","color:red")}else{console.log(c+r+u)}a.raise(c)}}function O(t){t._commandRef=w()}function x(t,n,r,e){O(t);function i(t){if(t){return e.id(t)}return 0}t._fragId=i(t.static.frag);t._vertId=i(t.static.vert);function a(t,n){Object.keys(n).forEach((function(n){t[e.id(n)]=true}))}var o=t._uniformSet={};a(o,n.static);a(o,n.dynamic);var u=t._attributeSet={};a(u,r.static);a(u,r.dynamic);t._hasCount="count"in t.static||"count"in t.dynamic||"elements"in t.static||"elements"in t.dynamic}function j(t,n){var r=g();i(t+" in command "+(n||w())+(r==="unknown"?"":" called from "+r))}function S(t,n,r){if(!t){j(n,r||w())}}function N(t,n,r,e){if(!(t in n)){j("unknown parameter ("+t+")"+o(r)+". possible values: "+Object.keys(n).join(),e||w())}}function I(t,n,r,e){if(!s(t,n)){j("invalid parameter type"+o(r)+". expected "+n+", got "+typeof t,e||w())}}function M(t){t()}function C(t,n,r){if(t.texture){v(t.texture._texture.internalformat,n,"unsupported texture format for attachment")}else{v(t.renderbuffer._renderbuffer.format,r,"unsupported renderbuffer format for attachment")}}var L=33071;var k=9728;var U=9984;var F=9985;var B=9986;var D=9987;var P=5120;var G=5121;var V=5122;var X=5123;var z=5124;var H=5125;var W=5126;var $=32819;var Y=32820;var q=33635;var K=34042;var Q=36193;var Z={};Z[P]=Z[G]=1;Z[V]=Z[X]=Z[Q]=Z[q]=Z[$]=Z[Y]=2;Z[z]=Z[H]=Z[W]=Z[K]=4;function J(t,n){if(t===Y||t===$||t===q){return 2}else if(t===K){return 4}else{return Z[t]*n}}function tt(t){return!(t&t-1)&&!!t}function nt(t,n,r){var e;var i=n.width;var o=n.height;var u=n.channels;a(i>0&&i<=r.maxTextureSize&&o>0&&o<=r.maxTextureSize,"invalid texture shape");if(t.wrapS!==L||t.wrapT!==L){a(tt(i)&&tt(o),"incompatible wrap mode for texture, both width and height must be power of 2")}if(n.mipmask===1){if(i!==1&&o!==1){a(t.minFilter!==U&&t.minFilter!==B&&t.minFilter!==F&&t.minFilter!==D,"min filter requires mipmap")}}else{a(tt(i)&&tt(o),"texture must be a square power of 2 to support mipmapping");a(n.mipmask===(i<<1)-1,"missing or incomplete mipmap data")}if(n.type===W){if(r.extensions.indexOf("oes_texture_float_linear")<0){a(t.minFilter===k&&t.magFilter===k,"filter not supported, must enable oes_texture_float_linear")}a(!t.genMipmaps,"mipmap generation not supported with float textures")}var f=n.images;for(e=0;e<16;++e){if(f[e]){var s=i>>e;var c=o>>e;a(n.mipmask&1<<e,"missing mipmap data");var l=f[e];a(l.width===s&&l.height===c,"invalid shape for mip images");a(l.format===n.format&&l.internalformat===n.internalformat&&l.type===n.type,"incompatible type for mip image");if(l.compressed);else if(l.data){var v=Math.ceil(J(l.type,u)*s/l.unpackAlignment)*l.unpackAlignment;a(l.data.byteLength===v*c,"invalid data for image, buffer size is inconsistent with image format")}else;}else if(!t.genMipmaps){a((n.mipmask&1<<e)===0,"extra mipmap data")}}if(n.compressed){a(!t.genMipmaps,"mipmap generation for compressed images not supported")}}function rt(t,n,r,e){var i=t.width;var o=t.height;var u=t.channels;a(i>0&&i<=e.maxTextureSize&&o>0&&o<=e.maxTextureSize,"invalid texture shape");a(i===o,"cube map must be square");a(n.wrapS===L&&n.wrapT===L,"wrap mode not supported by cube map");for(var f=0;f<r.length;++f){var s=r[f];a(s.width===i&&s.height===o,"inconsistent cube map face shape");if(n.genMipmaps){a(!s.compressed,"can not generate mipmap for compressed textures");a(s.mipmask===1,"can not specify mipmaps and generate mipmaps")}var c=s.images;for(var l=0;l<16;++l){var v=c[l];if(v){var d=i>>l;var h=o>>l;a(s.mipmask&1<<l,"missing mipmap data");a(v.width===d&&v.height===h,"invalid shape for mip images");a(v.format===t.format&&v.internalformat===t.internalformat&&v.type===t.type,"incompatible type for mip image");if(v.compressed);else if(v.data){a(v.data.byteLength===d*h*Math.max(J(v.type,u),v.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}else;}}}}var et=n(a,{optional:M,raise:i,commandRaise:j,command:S,parameter:u,commandParameter:N,constructor:h,type:c,commandType:I,isTypedArray:f,nni:l,oneOf:v,shaderError:T,linkError:R,callSite:g,saveCommandRef:O,saveDrawInfo:x,framebufferFormat:C,guessCommand:w,texture2D:nt,textureCube:rt});var it=0;var at=0;var ot=5;var ut=6;function ft(t,n){this.id=it++;this.type=t;this.data=n}function st(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function ct(t){if(t.length===0){return[]}var n=t.charAt(0);var r=t.charAt(t.length-1);if(t.length>1&&n===r&&(n==='"'||n==="'")){return['"'+st(t.substr(1,t.length-2))+'"']}var e=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(e){return ct(t.substr(0,e.index)).concat(ct(e[1])).concat(ct(t.substr(e.index+e[0].length)))}var i=t.split(".");if(i.length===1){return['"'+st(t)+'"']}var a=[];for(var o=0;o<i.length;++o){a=a.concat(ct(i[o]))}return a}function lt(t){return"["+ct(t).join("][")+"]"}function vt(t,n){return new ft(t,lt(n+""))}function dt(t){return typeof t==="function"&&!t._reglType||t instanceof ft}function ht(t,n){if(typeof t==="function"){return new ft(at,t)}else if(typeof t==="number"||typeof t==="boolean"){return new ft(ot,t)}else if(Array.isArray(t)){return new ft(ut,t.map(((t,r)=>ht(t,n+"["+r+"]"))))}else if(t instanceof ft){return t}et(false,"invalid option type in uniform "+n)}var bt={DynamicVariable:ft,define:vt,isDynamic:dt,unbox:ht,accessor:lt};var pt={next:typeof requestAnimationFrame==="function"?function(t){return requestAnimationFrame(t)}:function(t){return setTimeout(t,16)},cancel:typeof cancelAnimationFrame==="function"?function(t){return cancelAnimationFrame(t)}:clearTimeout};var mt=typeof performance!=="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function yt(){var t={"":0};var n=[""];return{id:function(r){var e=t[r];if(e){return e}e=t[r]=n.length;n.push(r);return e},str:function(t){return n[t]}}}function wt(t,r,e){var i=document.createElement("canvas");n(i.style,{border:0,margin:0,padding:0,top:0,left:0});t.appendChild(i);if(t===document.body){i.style.position="absolute";n(t.style,{margin:0,padding:0})}function a(){var r=window.innerWidth;var a=window.innerHeight;if(t!==document.body){var o=t.getBoundingClientRect();r=o.right-o.left;a=o.bottom-o.top}i.width=e*r;i.height=e*a;n(i.style,{width:r+"px",height:a+"px"})}var o;if(t!==document.body&&typeof ResizeObserver==="function"){o=new ResizeObserver((function(){setTimeout(a)}));o.observe(t)}else{window.addEventListener("resize",a,false)}function u(){if(o){o.disconnect()}else{window.removeEventListener("resize",a)}t.removeChild(i)}a();return{canvas:i,onDestroy:u}}function gt(t,n){function r(r){try{return t.getContext(r,n)}catch(t){return null}}return r("webgl")||r("experimental-webgl")||r("webgl-experimental")}function Et(t){return typeof t.nodeName==="string"&&typeof t.appendChild==="function"&&typeof t.getBoundingClientRect==="function"}function At(t){return typeof t.drawArrays==="function"||typeof t.drawElements==="function"}function _t(t){if(typeof t==="string"){return t.split()}et(Array.isArray(t),"invalid extension array");return t}function Tt(t){if(typeof t==="string"){et(typeof document!=="undefined","not supported outside of DOM");return document.querySelector(t)}return t}function Rt(t){var n=t||{};var r,e,i,a;var o={};var u=[];var f=[];var s=typeof window==="undefined"?1:window.devicePixelRatio;var c=false;var l=function(t){if(t){et.raise(t)}};var v=function(){};if(typeof n==="string"){et(typeof document!=="undefined","selector queries only supported in DOM enviroments");r=document.querySelector(n);et(r,"invalid query string for element")}else if(typeof n==="object"){if(Et(n)){r=n}else if(At(n)){a=n;i=a.canvas}else{et.constructor(n);if("gl"in n){a=n.gl}else if("canvas"in n){i=Tt(n.canvas)}else if("container"in n){e=Tt(n.container)}if("attributes"in n){o=n.attributes;et.type(o,"object","invalid context attributes")}if("extensions"in n){u=_t(n.extensions)}if("optionalExtensions"in n){f=_t(n.optionalExtensions)}if("onDone"in n){et.type(n.onDone,"function","invalid or missing onDone callback");l=n.onDone}if("profile"in n){c=!!n.profile}if("pixelRatio"in n){s=+n.pixelRatio;et(s>0,"invalid pixel ratio")}}}else{et.raise("invalid arguments to regl")}if(r){if(r.nodeName.toLowerCase()==="canvas"){i=r}else{e=r}}if(!a){if(!i){et(typeof document!=="undefined","must manually specify webgl context outside of DOM environments");var d=wt(e||document.body,l,s);if(!d){return null}i=d.canvas;v=d.onDestroy}if(o.premultipliedAlpha===undefined)o.premultipliedAlpha=true;a=gt(i,o)}if(!a){v();l("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org");return null}return{gl:a,canvas:i,container:e,extensions:u,optionalExtensions:f,pixelRatio:s,profile:c,onDone:l,onDestroy:v}}function Ot(t,n){var r={};function e(n){et.type(n,"string","extension name must be string");var e=n.toLowerCase();var i;try{i=r[e]=t.getExtension(e)}catch(t){}return!!i}for(var i=0;i<n.extensions.length;++i){var a=n.extensions[i];if(!e(a)){n.onDestroy();n.onDone('"'+a+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser');return null}}n.optionalExtensions.forEach(e);return{extensions:r,restore:function(){Object.keys(r).forEach((function(t){if(r[t]&&!e(t)){throw new Error("(regl): error restoring extension "+t)}}))}}}function xt(t,n){var r=Array(t);for(var e=0;e<t;++e){r[e]=n(e)}return r}var jt=5120;var St=5121;var Nt=5122;var It=5123;var Mt=5124;var Ct=5125;var Lt=5126;function kt(t){for(var n=16;n<=1<<28;n*=16){if(t<=n){return n}}return 0}function Ut(t){var n,r;n=(t>65535)<<4;t>>>=n;r=(t>255)<<3;t>>>=r;n|=r;r=(t>15)<<2;t>>>=r;n|=r;r=(t>3)<<1;t>>>=r;n|=r;return n|t>>1}function Ft(){var t=xt(8,(function(){return[]}));function n(n){var r=kt(n);var e=t[Ut(r)>>2];if(e.length>0){return e.pop()}return new ArrayBuffer(r)}function r(n){t[Ut(n.byteLength)>>2].push(n)}function e(t,r){var e=null;switch(t){case jt:e=new Int8Array(n(r),0,r);break;case St:e=new Uint8Array(n(r),0,r);break;case Nt:e=new Int16Array(n(2*r),0,r);break;case It:e=new Uint16Array(n(2*r),0,r);break;case Mt:e=new Int32Array(n(4*r),0,r);break;case Ct:e=new Uint32Array(n(4*r),0,r);break;case Lt:e=new Float32Array(n(4*r),0,r);break;default:return null}if(e.length!==r){return e.subarray(0,r)}return e}function i(t){r(t.buffer)}return{alloc:n,free:r,allocType:e,freeType:i}}var Bt=Ft();Bt.zero=Ft();var Dt=3408;var Pt=3410;var Gt=3411;var Vt=3412;var Xt=3413;var zt=3414;var Ht=3415;var Wt=33901;var $t=33902;var Yt=3379;var qt=3386;var Kt=34921;var Qt=36347;var Zt=36348;var Jt=35661;var tn=35660;var nn=34930;var rn=36349;var en=34076;var an=34024;var on=7936;var un=7937;var fn=7938;var sn=35724;var cn=34047;var ln=36063;var vn=34852;var dn=3553;var hn=34067;var bn=34069;var pn=33984;var mn=6408;var yn=5126;var wn=5121;var gn=36160;var En=36053;var An=36064;var _n=16384;var Tn=function(t,n){var r=1;if(n.ext_texture_filter_anisotropic){r=t.getParameter(cn)}var e=1;var i=1;if(n.webgl_draw_buffers){e=t.getParameter(vn);i=t.getParameter(ln)}var a=!!n.oes_texture_float;if(a){var o=t.createTexture();t.bindTexture(dn,o);t.texImage2D(dn,0,mn,1,1,0,mn,yn,null);var u=t.createFramebuffer();t.bindFramebuffer(gn,u);t.framebufferTexture2D(gn,An,dn,o,0);t.bindTexture(dn,null);if(t.checkFramebufferStatus(gn)!==En)a=false;else{t.viewport(0,0,1,1);t.clearColor(1,0,0,1);t.clear(_n);var f=Bt.allocType(yn,4);t.readPixels(0,0,1,1,mn,yn,f);if(t.getError())a=false;else{t.deleteFramebuffer(u);t.deleteTexture(o);a=f[0]===1}Bt.freeType(f)}}var s=typeof navigator!=="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent));var c=true;if(!s){var l=t.createTexture();var v=Bt.allocType(wn,36);t.activeTexture(pn);t.bindTexture(hn,l);t.texImage2D(bn,0,mn,3,3,0,mn,wn,v);Bt.freeType(v);t.bindTexture(hn,null);t.deleteTexture(l);c=!t.getError()}return{colorBits:[t.getParameter(Pt),t.getParameter(Gt),t.getParameter(Vt),t.getParameter(Xt)],depthBits:t.getParameter(zt),stencilBits:t.getParameter(Ht),subpixelBits:t.getParameter(Dt),extensions:Object.keys(n).filter((function(t){return!!n[t]})),maxAnisotropic:r,maxDrawbuffers:e,maxColorAttachments:i,pointSizeDims:t.getParameter(Wt),lineWidthDims:t.getParameter($t),maxViewportDims:t.getParameter(qt),maxCombinedTextureUnits:t.getParameter(Jt),maxCubeMapSize:t.getParameter(en),maxRenderbufferSize:t.getParameter(an),maxTextureUnits:t.getParameter(nn),maxTextureSize:t.getParameter(Yt),maxAttributes:t.getParameter(Kt),maxVertexUniforms:t.getParameter(Qt),maxVertexTextureUnits:t.getParameter(tn),maxVaryingVectors:t.getParameter(Zt),maxFragmentUniforms:t.getParameter(rn),glsl:t.getParameter(sn),renderer:t.getParameter(un),vendor:t.getParameter(on),version:t.getParameter(fn),readFloat:a,npotTextureCube:c}};function Rn(n){return!!n&&typeof n==="object"&&Array.isArray(n.shape)&&Array.isArray(n.stride)&&typeof n.offset==="number"&&n.shape.length===n.stride.length&&(Array.isArray(n.data)||t(n.data))}var On=function(t){return Object.keys(t).map((function(n){return t[n]}))};var xn={shape:Cn,flatten:Mn};function jn(t,n,r){for(var e=0;e<n;++e){r[e]=t[e]}}function Sn(t,n,r,e){var i=0;for(var a=0;a<n;++a){var o=t[a];for(var u=0;u<r;++u){e[i++]=o[u]}}}function Nn(t,n,r,e,i,a){var o=a;for(var u=0;u<n;++u){var f=t[u];for(var s=0;s<r;++s){var c=f[s];for(var l=0;l<e;++l){i[o++]=c[l]}}}}function In(t,n,r,e,i){var a=1;for(var o=r+1;o<n.length;++o){a*=n[o]}var u=n[r];if(n.length-r===4){var f=n[r+1];var s=n[r+2];var c=n[r+3];for(o=0;o<u;++o){Nn(t[o],f,s,c,e,i);i+=a}}else{for(o=0;o<u;++o){In(t[o],n,r+1,e,i);i+=a}}}function Mn(t,n,r,e){var i=1;if(n.length){for(var a=0;a<n.length;++a){i*=n[a]}}else{i=0}var o=e||Bt.allocType(r,i);switch(n.length){case 0:break;case 1:jn(t,n[0],o);break;case 2:Sn(t,n[0],n[1],o);break;case 3:Nn(t,n[0],n[1],n[2],o,0);break;default:In(t,n,0,o,0)}return o}function Cn(t){var n=[];for(var r=t;r.length;r=r[0]){n.push(r.length)}return n}var Ln={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};var kn=5120;var Un=5122;var Fn=5124;var Bn=5121;var Dn=5123;var Pn=5125;var Gn=5126;var Vn=5126;var Xn={int8:kn,int16:Un,int32:Fn,uint8:Bn,uint16:Dn,uint32:Pn,float:Gn,float32:Vn};var zn=35048;var Hn=35040;var Wn={dynamic:zn,stream:Hn,static:35044};var $n=xn.flatten;var Yn=xn.shape;var qn=35044;var Kn=35040;var Qn=5121;var Zn=5126;var Jn=[];Jn[5120]=1;Jn[5122]=2;Jn[5124]=4;Jn[5121]=1;Jn[5123]=2;Jn[5125]=4;Jn[5126]=4;function tr(t){return Ln[Object.prototype.toString.call(t)]|0}function nr(t,n){for(var r=0;r<n.length;++r){t[r]=n[r]}}function rr(t,n,r,e,i,a,o){var u=0;for(var f=0;f<r;++f){for(var s=0;s<e;++s){t[u++]=n[i*f+a*s+o]}}}function er(n,r,e,i){var a=0;var o={};function u(t){this.id=a++;this.buffer=n.createBuffer();this.type=t;this.usage=qn;this.byteLength=0;this.dimension=1;this.dtype=Qn;this.persistentData=null;if(e.profile){this.stats={size:0}}}u.prototype.bind=function(){n.bindBuffer(this.type,this.buffer)};u.prototype.destroy=function(){d(this)};var f=[];function s(t,n){var r=f.pop();if(!r){r=new u(t)}r.bind();v(r,n,Kn,0,1,false);return r}function c(t){f.push(t)}function l(t,r,e){t.byteLength=r.byteLength;n.bufferData(t.type,r,e)}function v(n,r,e,i,a,o){var u;n.usage=e;if(Array.isArray(r)){n.dtype=i||Zn;if(r.length>0){var f;if(Array.isArray(r[0])){u=Yn(r);var s=1;for(var c=1;c<u.length;++c){s*=u[c]}n.dimension=s;f=$n(r,u,n.dtype);l(n,f,e);if(o){n.persistentData=f}else{Bt.freeType(f)}}else if(typeof r[0]==="number"){n.dimension=a;var v=Bt.allocType(n.dtype,r.length);nr(v,r);l(n,v,e);if(o){n.persistentData=v}else{Bt.freeType(v)}}else if(t(r[0])){n.dimension=r[0].length;n.dtype=i||tr(r[0])||Zn;f=$n(r,[r.length,r[0].length],n.dtype);l(n,f,e);if(o){n.persistentData=f}else{Bt.freeType(f)}}else{et.raise("invalid buffer data")}}}else if(t(r)){n.dtype=i||tr(r);n.dimension=a;l(n,r,e);if(o){n.persistentData=new Uint8Array(new Uint8Array(r.buffer))}}else if(Rn(r)){u=r.shape;var d=r.stride;var h=r.offset;var b=0;var p=0;var m=0;var y=0;if(u.length===1){b=u[0];p=1;m=d[0];y=0}else if(u.length===2){b=u[0];p=u[1];m=d[0];y=d[1]}else{et.raise("invalid shape")}n.dtype=i||tr(r.data)||Zn;n.dimension=p;var w=Bt.allocType(n.dtype,b*p);rr(w,r.data,b,p,m,y,h);l(n,w,e);if(o){n.persistentData=w}else{Bt.freeType(w)}}else if(r instanceof ArrayBuffer){n.dtype=Qn;n.dimension=a;l(n,r,e);if(o){n.persistentData=new Uint8Array(new Uint8Array(r))}}else{et.raise("invalid buffer data")}}function d(t){r.bufferCount--;i(t);var e=t.buffer;et(e,"buffer must not be deleted already");n.deleteBuffer(e);t.buffer=null;delete o[t.id]}function h(i,a,f,s){r.bufferCount++;var c=new u(a);o[c.id]=c;function l(r){var i=qn;var a=null;var o=0;var u=0;var f=1;if(Array.isArray(r)||t(r)||Rn(r)||r instanceof ArrayBuffer){a=r}else if(typeof r==="number"){o=r|0}else if(r){et.type(r,"object","buffer arguments must be an object, a number or an array");if("data"in r){et(a===null||Array.isArray(a)||t(a)||Rn(a),"invalid data for buffer");a=r.data}if("usage"in r){et.parameter(r.usage,Wn,"invalid buffer usage");i=Wn[r.usage]}if("type"in r){et.parameter(r.type,Xn,"invalid buffer type");u=Xn[r.type]}if("dimension"in r){et.type(r.dimension,"number","invalid dimension");f=r.dimension|0}if("length"in r){et.nni(o,"buffer length must be a nonnegative integer");o=r.length|0}}c.bind();if(!a){if(o)n.bufferData(c.type,o,i);c.dtype=u||Qn;c.usage=i;c.dimension=f;c.byteLength=o}else{v(c,a,i,u,f,s)}if(e.profile){c.stats.size=c.byteLength*Jn[c.dtype]}return l}function h(t,r){et(r+t.byteLength<=c.byteLength,"invalid buffer subdata call, buffer is too small. "+" Can't write data of size "+t.byteLength+" starting from offset "+r+" to a buffer of size "+c.byteLength);n.bufferSubData(c.type,r,t)}function b(n,r){var e=(r||0)|0;var i;c.bind();if(t(n)||n instanceof ArrayBuffer){h(n,e)}else if(Array.isArray(n)){if(n.length>0){if(typeof n[0]==="number"){var a=Bt.allocType(c.dtype,n.length);nr(a,n);h(a,e);Bt.freeType(a)}else if(Array.isArray(n[0])||t(n[0])){i=Yn(n);var o=$n(n,i,c.dtype);h(o,e);Bt.freeType(o)}else{et.raise("invalid buffer data")}}}else if(Rn(n)){i=n.shape;var u=n.stride;var f=0;var s=0;var v=0;var d=0;if(i.length===1){f=i[0];s=1;v=u[0];d=0}else if(i.length===2){f=i[0];s=i[1];v=u[0];d=u[1]}else{et.raise("invalid shape")}var b=Array.isArray(n.data)?c.dtype:tr(n.data);var p=Bt.allocType(b,f*s);rr(p,n.data,f,s,v,d,n.offset);h(p,e);Bt.freeType(p)}else{et.raise("invalid data for buffer subdata")}return l}if(!f){l(i)}l._reglType="buffer";l._buffer=c;l.subdata=b;if(e.profile){l.stats=c.stats}l.destroy=function(){d(c)};return l}function b(){On(o).forEach((function(t){t.buffer=n.createBuffer();n.bindBuffer(t.type,t.buffer);n.bufferData(t.type,t.persistentData||t.byteLength,t.usage)}))}if(e.profile){r.getTotalBufferSize=function(){var t=0;Object.keys(o).forEach((function(n){t+=o[n].stats.size}));return t}}return{create:h,createStream:s,destroyStream:c,clear:function(){On(o).forEach(d);f.forEach(d)},getBuffer:function(t){if(t&&t._buffer instanceof u){return t._buffer}return null},restore:b,_initBuffer:v}}var ir=0;var ar=0;var or=1;var ur=1;var fr=4;var sr=4;var cr={points:ir,point:ar,lines:or,line:ur,triangles:fr,triangle:sr,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6};var lr=0;var vr=1;var dr=4;var hr=5120;var br=5121;var pr=5122;var mr=5123;var yr=5124;var wr=5125;var gr=34963;var Er=35040;var Ar=35044;function _r(n,r,e,i){var a={};var o=0;var u={uint8:br,uint16:mr};if(r.oes_element_index_uint){u.uint32=wr}function f(t){this.id=o++;a[this.id]=this;this.buffer=t;this.primType=dr;this.vertCount=0;this.type=0}f.prototype.bind=function(){this.buffer.bind()};var s=[];function c(t){var n=s.pop();if(!n){n=new f(e.create(null,gr,true,false)._buffer)}v(n,t,Er,-1,-1,0,0);return n}function l(t){s.push(t)}function v(i,a,o,u,f,s,c){i.buffer.bind();var l;if(a){var v=c;if(!c&&(!t(a)||Rn(a)&&!t(a.data))){v=r.oes_element_index_uint?wr:mr}e._initBuffer(i.buffer,a,o,v,3)}else{n.bufferData(gr,s,o);i.buffer.dtype=l||br;i.buffer.usage=o;i.buffer.dimension=3;i.buffer.byteLength=s}l=c;if(!c){switch(i.buffer.dtype){case br:case hr:l=br;break;case mr:case pr:l=mr;break;case wr:case yr:l=wr;break;default:et.raise("unsupported type for element array")}i.buffer.dtype=l}i.type=l;et(l!==wr||!!r.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var d=f;if(d<0){d=i.buffer.byteLength;if(l===mr){d>>=1}else if(l===wr){d>>=2}}i.vertCount=d;var h=u;if(u<0){h=dr;var b=i.buffer.dimension;if(b===1)h=lr;if(b===2)h=vr;if(b===3)h=dr}i.primType=h}function d(t){i.elementsCount--;et(t.buffer!==null,"must not double destroy elements");delete a[t.id];t.buffer.destroy();t.buffer=null}function h(n,r){var a=e.create(null,gr,true);var o=new f(a._buffer);i.elementsCount++;function s(n){if(!n){a();o.primType=dr;o.vertCount=0;o.type=br}else if(typeof n==="number"){a(n);o.primType=dr;o.vertCount=n|0;o.type=br}else{var r=null;var e=Ar;var i=-1;var f=-1;var c=0;var l=0;if(Array.isArray(n)||t(n)||Rn(n)){r=n}else{et.type(n,"object","invalid arguments for elements");if("data"in n){r=n.data;et(Array.isArray(r)||t(r)||Rn(r),"invalid data for element buffer")}if("usage"in n){et.parameter(n.usage,Wn,"invalid element buffer usage");e=Wn[n.usage]}if("primitive"in n){et.parameter(n.primitive,cr,"invalid element buffer primitive");i=cr[n.primitive]}if("count"in n){et(typeof n.count==="number"&&n.count>=0,"invalid vertex count for elements");f=n.count|0}if("type"in n){et.parameter(n.type,u,"invalid buffer type");l=u[n.type]}if("length"in n){c=n.length|0}else{c=f;if(l===mr||l===pr){c*=2}else if(l===wr||l===yr){c*=4}}}v(o,r,e,i,f,c,l)}return s}s(n);s._reglType="elements";s._elements=o;s.subdata=function(t,n){a.subdata(t,n);return s};s.destroy=function(){d(o)};return s}return{create:h,createStream:c,destroyStream:l,getElements:function(t){if(typeof t==="function"&&t._elements instanceof f){return t._elements}return null},clear:function(){On(a).forEach(d)}}}var Tr=new Float32Array(1);var Rr=new Uint32Array(Tr.buffer);var Or=5123;function xr(t){var n=Bt.allocType(Or,t.length);for(var r=0;r<t.length;++r){if(isNaN(t[r])){n[r]=65535}else if(t[r]===Infinity){n[r]=31744}else if(t[r]===-Infinity){n[r]=64512}else{Tr[0]=t[r];var e=Rr[0];var i=e>>>31<<15;var a=(e<<1>>>24)-127;var o=e>>13&(1<<10)-1;if(a<-24){n[r]=i}else if(a<-14){var u=-14-a;n[r]=i+(o+(1<<10)>>u)}else if(a>15){n[r]=i+31744}else{n[r]=i+(a+15<<10)+o}}}return n}function jr(n){return Array.isArray(n)||t(n)}var Sr=function(t){return!(t&t-1)&&!!t};var Nr=34467;var Ir=3553;var Mr=34067;var Cr=34069;var Lr=6408;var kr=6406;var Ur=6407;var Fr=6409;var Br=6410;var Dr=32854;var Pr=32855;var Gr=36194;var Vr=32819;var Xr=32820;var zr=33635;var Hr=34042;var Wr=6402;var $r=34041;var Yr=35904;var qr=35906;var Kr=36193;var Qr=33776;var Zr=33777;var Jr=33778;var te=33779;var ne=35986;var re=35987;var ee=34798;var ie=35840;var ae=35841;var oe=35842;var ue=35843;var fe=36196;var se=5121;var ce=5123;var le=5125;var ve=5126;var de=10242;var he=10243;var be=10497;var pe=33071;var me=33648;var ye=10240;var we=10241;var ge=9728;var Ee=9729;var Ae=9984;var _e=9985;var Te=9986;var Re=9987;var Oe=33170;var xe=4352;var je=4353;var Se=4354;var Ne=34046;var Ie=3317;var Me=37440;var Ce=37441;var Le=37443;var ke=37444;var Ue=33984;var Fe=[Ae,Te,_e,Re];var Be=[0,Fr,Br,Ur,Lr];var De={};De[Fr]=De[kr]=De[Wr]=1;De[$r]=De[Br]=2;De[Ur]=De[Yr]=3;De[Lr]=De[qr]=4;function Pe(t){return"[object "+t+"]"}var Ge=Pe("HTMLCanvasElement");var Ve=Pe("OffscreenCanvas");var Xe=Pe("CanvasRenderingContext2D");var ze=Pe("ImageBitmap");var He=Pe("HTMLImageElement");var We=Pe("HTMLVideoElement");var $e=Object.keys(Ln).concat([Ge,Ve,Xe,ze,He,We]);var Ye=[];Ye[se]=1;Ye[ve]=4;Ye[Kr]=2;Ye[ce]=2;Ye[le]=4;var qe=[];qe[Dr]=2;qe[Pr]=2;qe[Gr]=2;qe[$r]=4;qe[Qr]=.5;qe[Zr]=.5;qe[Jr]=1;qe[te]=1;qe[ne]=.5;qe[re]=1;qe[ee]=1;qe[ie]=.5;qe[ae]=.25;qe[oe]=.5;qe[ue]=.25;qe[fe]=.5;function Ke(t){return Array.isArray(t)&&(t.length===0||typeof t[0]==="number")}function Qe(t){if(!Array.isArray(t)){return false}var n=t.length;if(n===0||!jr(t[0])){return false}return true}function Ze(t){return Object.prototype.toString.call(t)}function Je(t){return Ze(t)===Ge}function ti(t){return Ze(t)===Ve}function ni(t){return Ze(t)===Xe}function ri(t){return Ze(t)===ze}function ei(t){return Ze(t)===He}function ii(t){return Ze(t)===We}function ai(t){if(!t){return false}var n=Ze(t);if($e.indexOf(n)>=0){return true}return Ke(t)||Qe(t)||Rn(t)}function oi(t){return Ln[Object.prototype.toString.call(t)]|0}function ui(t,n){var r=n.length;switch(t.type){case se:case ce:case le:case ve:var e=Bt.allocType(t.type,r);e.set(n);t.data=e;break;case Kr:t.data=xr(n);break;default:et.raise("unsupported texture type, must specify a typed array")}}function fi(t,n){return Bt.allocType(t.type===Kr?ve:t.type,n)}function si(t,n){if(t.type===Kr){t.data=xr(n);Bt.freeType(n)}else{t.data=n}}function ci(t,n,r,e,i,a){var o=t.width;var u=t.height;var f=t.channels;var s=o*u*f;var c=fi(t,s);var l=0;for(var v=0;v<u;++v){for(var d=0;d<o;++d){for(var h=0;h<f;++h){c[l++]=n[r*d+e*v+i*h+a]}}}si(t,c)}function li(t,n,r,e,i,a){var o;if(typeof qe[t]!=="undefined"){o=qe[t]}else{o=De[t]*Ye[n]}if(a){o*=6}if(i){var u=0;var f=r;while(f>=1){u+=o*f*f;f/=2}return u}else{return o*r*e}}function vi(r,e,i,a,o,u,f){var s={"don't care":xe,"dont care":xe,nice:Se,fast:je};var c={repeat:be,clamp:pe,mirror:me};var l={nearest:ge,linear:Ee};var v=n({mipmap:Re,"nearest mipmap nearest":Ae,"linear mipmap nearest":_e,"nearest mipmap linear":Te,"linear mipmap linear":Re},l);var d={none:0,browser:ke};var h={uint8:se,rgba4:Vr,rgb565:zr,"rgb5 a1":Xr};var b={alpha:kr,luminance:Fr,"luminance alpha":Br,rgb:Ur,rgba:Lr,rgba4:Dr,"rgb5 a1":Pr,rgb565:Gr};var p={};if(e.ext_srgb){b.srgb=Yr;b.srgba=qr}if(e.oes_texture_float){h.float32=h.float=ve}if(e.oes_texture_half_float){h["float16"]=h["half float"]=Kr}if(e.webgl_depth_texture){n(b,{depth:Wr,"depth stencil":$r});n(h,{uint16:ce,uint32:le,"depth stencil":Hr})}if(e.webgl_compressed_texture_s3tc){n(p,{"rgb s3tc dxt1":Qr,"rgba s3tc dxt1":Zr,"rgba s3tc dxt3":Jr,"rgba s3tc dxt5":te})}if(e.webgl_compressed_texture_atc){n(p,{"rgb atc":ne,"rgba atc explicit alpha":re,"rgba atc interpolated alpha":ee})}if(e.webgl_compressed_texture_pvrtc){n(p,{"rgb pvrtc 4bppv1":ie,"rgb pvrtc 2bppv1":ae,"rgba pvrtc 4bppv1":oe,"rgba pvrtc 2bppv1":ue})}if(e.webgl_compressed_texture_etc1){p["rgb etc1"]=fe}var m=Array.prototype.slice.call(r.getParameter(Nr));Object.keys(p).forEach((function(t){var n=p[t];if(m.indexOf(n)>=0){b[t]=n}}));var y=Object.keys(b);i.textureFormats=y;var w=[];Object.keys(b).forEach((function(t){var n=b[t];w[n]=t}));var g=[];Object.keys(h).forEach((function(t){var n=h[t];g[n]=t}));var E=[];Object.keys(l).forEach((function(t){var n=l[t];E[n]=t}));var A=[];Object.keys(v).forEach((function(t){var n=v[t];A[n]=t}));var _=[];Object.keys(c).forEach((function(t){var n=c[t];_[n]=t}));var T=y.reduce((function(t,n){var r=b[n];if(r===Fr||r===kr||r===Fr||r===Br||r===Wr||r===$r||e.ext_srgb&&(r===Yr||r===qr)){t[r]=r}else if(r===Pr||n.indexOf("rgba")>=0){t[r]=Lr}else{t[r]=Ur}return t}),{});function R(){this.internalformat=Lr;this.format=Lr;this.type=se;this.compressed=false;this.premultiplyAlpha=false;this.flipY=false;this.unpackAlignment=1;this.colorSpace=ke;this.width=0;this.height=0;this.channels=0}function O(t,n){t.internalformat=n.internalformat;t.format=n.format;t.type=n.type;t.compressed=n.compressed;t.premultiplyAlpha=n.premultiplyAlpha;t.flipY=n.flipY;t.unpackAlignment=n.unpackAlignment;t.colorSpace=n.colorSpace;t.width=n.width;t.height=n.height;t.channels=n.channels}function x(t,n){if(typeof n!=="object"||!n){return}if("premultiplyAlpha"in n){et.type(n.premultiplyAlpha,"boolean","invalid premultiplyAlpha");t.premultiplyAlpha=n.premultiplyAlpha}if("flipY"in n){et.type(n.flipY,"boolean","invalid texture flip");t.flipY=n.flipY}if("alignment"in n){et.oneOf(n.alignment,[1,2,4,8],"invalid texture unpack alignment");t.unpackAlignment=n.alignment}if("colorSpace"in n){et.parameter(n.colorSpace,d,"invalid colorSpace");t.colorSpace=d[n.colorSpace]}if("type"in n){var r=n.type;et(e.oes_texture_float||!(r==="float"||r==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures.");et(e.oes_texture_half_float||!(r==="half float"||r==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures.");et(e.webgl_depth_texture||!(r==="uint16"||r==="uint32"||r==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.");et.parameter(r,h,"invalid texture type");t.type=h[r]}var a=t.width;var o=t.height;var u=t.channels;var f=false;if("shape"in n){et(Array.isArray(n.shape)&&n.shape.length>=2,"shape must be an array");a=n.shape[0];o=n.shape[1];if(n.shape.length===3){u=n.shape[2];et(u>0&&u<=4,"invalid number of channels");f=true}et(a>=0&&a<=i.maxTextureSize,"invalid width");et(o>=0&&o<=i.maxTextureSize,"invalid height")}else{if("radius"in n){a=o=n.radius;et(a>=0&&a<=i.maxTextureSize,"invalid radius")}if("width"in n){a=n.width;et(a>=0&&a<=i.maxTextureSize,"invalid width")}if("height"in n){o=n.height;et(o>=0&&o<=i.maxTextureSize,"invalid height")}if("channels"in n){u=n.channels;et(u>0&&u<=4,"invalid number of channels");f=true}}t.width=a|0;t.height=o|0;t.channels=u|0;var s=false;if("format"in n){var c=n.format;et(e.webgl_depth_texture||!(c==="depth"||c==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.");et.parameter(c,b,"invalid texture format");var l=t.internalformat=b[c];t.format=T[l];if(c in h){if(!("type"in n)){t.type=h[c]}}if(c in p){t.compressed=true}s=true}if(!f&&s){t.channels=De[t.format]}else if(f&&!s){if(t.channels!==Be[t.format]){t.format=t.internalformat=Be[t.channels]}}else if(s&&f){et(t.channels===De[t.format],"number of channels inconsistent with specified format")}}function j(t){r.pixelStorei(Me,t.flipY);r.pixelStorei(Ce,t.premultiplyAlpha);r.pixelStorei(Le,t.colorSpace);r.pixelStorei(Ie,t.unpackAlignment)}function S(){R.call(this);this.xOffset=0;this.yOffset=0;this.data=null;this.needsFree=false;this.element=null;this.needsCopy=false}function N(n,r){var e=null;if(ai(r)){e=r}else if(r){et.type(r,"object","invalid pixel data type");x(n,r);if("x"in r){n.xOffset=r.x|0}if("y"in r){n.yOffset=r.y|0}if(ai(r.data)){e=r.data}}et(!n.compressed||e instanceof Uint8Array,"compressed texture data must be stored in a uint8array");if(r.copy){et(!e,"can not specify copy and data field for the same texture");var a=o.viewportWidth;var u=o.viewportHeight;n.width=n.width||a-n.xOffset;n.height=n.height||u-n.yOffset;n.needsCopy=true;et(n.xOffset>=0&&n.xOffset<a&&n.yOffset>=0&&n.yOffset<u&&n.width>0&&n.width<=a&&n.height>0&&n.height<=u,"copy texture read out of bounds")}else if(!e){n.width=n.width||1;n.height=n.height||1;n.channels=n.channels||4}else if(t(e)){n.channels=n.channels||4;n.data=e;if(!("type"in r)&&n.type===se){n.type=oi(e)}}else if(Ke(e)){n.channels=n.channels||4;ui(n,e);n.alignment=1;n.needsFree=true}else if(Rn(e)){var f=e.data;if(!Array.isArray(f)&&n.type===se){n.type=oi(f)}var s=e.shape;var c=e.stride;var l,v,d,h,b,p;if(s.length===3){d=s[2];p=c[2]}else{et(s.length===2,"invalid ndarray pixel data, must be 2 or 3D");d=1;p=1}l=s[0];v=s[1];h=c[0];b=c[1];n.alignment=1;n.width=l;n.height=v;n.channels=d;n.format=n.internalformat=Be[d];n.needsFree=true;ci(n,f,h,b,p,e.offset)}else if(Je(e)||ti(e)||ni(e)){if(Je(e)||ti(e)){n.element=e}else{n.element=e.canvas}n.width=n.element.width;n.height=n.element.height;n.channels=4}else if(ri(e)){n.element=e;n.width=e.width;n.height=e.height;n.channels=4}else if(ei(e)){n.element=e;n.width=e.naturalWidth;n.height=e.naturalHeight;n.channels=4}else if(ii(e)){n.element=e;n.width=e.videoWidth;n.height=e.videoHeight;n.channels=4}else if(Qe(e)){var m=n.width||e[0].length;var y=n.height||e.length;var w=n.channels;if(jr(e[0][0])){w=w||e[0][0].length}else{w=w||1}var g=xn.shape(e);var E=1;for(var A=0;A<g.length;++A){E*=g[A]}var _=fi(n,E);xn.flatten(e,g,"",_);si(n,_);n.alignment=1;n.width=m;n.height=y;n.channels=w;n.format=n.internalformat=Be[w];n.needsFree=true}if(n.type===ve){et(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled")}else if(n.type===Kr){et(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}}function I(t,n,e){var i=t.element;var o=t.data;var u=t.internalformat;var f=t.format;var s=t.type;var c=t.width;var l=t.height;j(t);if(i){r.texImage2D(n,e,f,f,s,i)}else if(t.compressed){r.compressedTexImage2D(n,e,u,c,l,0,o)}else if(t.needsCopy){a();r.copyTexImage2D(n,e,f,t.xOffset,t.yOffset,c,l,0)}else{r.texImage2D(n,e,f,c,l,0,f,s,o||null)}}function M(t,n,e,i,o){var u=t.element;var f=t.data;var s=t.internalformat;var c=t.format;var l=t.type;var v=t.width;var d=t.height;j(t);if(u){r.texSubImage2D(n,o,e,i,c,l,u)}else if(t.compressed){r.compressedTexSubImage2D(n,o,e,i,s,v,d,f)}else if(t.needsCopy){a();r.copyTexSubImage2D(n,o,e,i,t.xOffset,t.yOffset,v,d)}else{r.texSubImage2D(n,o,e,i,v,d,c,l,f)}}var C=[];function L(){return C.pop()||new S}function k(t){if(t.needsFree){Bt.freeType(t.data)}S.call(t);C.push(t)}function U(){R.call(this);this.genMipmaps=false;this.mipmapHint=xe;this.mipmask=0;this.images=Array(16)}function F(t,n,r){var e=t.images[0]=L();t.mipmask=1;e.width=t.width=n;e.height=t.height=r;e.channels=t.channels=4}function B(t,n){var r=null;if(ai(n)){r=t.images[0]=L();O(r,t);N(r,n);t.mipmask=1}else{x(t,n);if(Array.isArray(n.mipmap)){var e=n.mipmap;for(var i=0;i<e.length;++i){r=t.images[i]=L();O(r,t);r.width>>=i;r.height>>=i;N(r,e[i]);t.mipmask|=1<<i}}else{r=t.images[0]=L();O(r,t);N(r,n);t.mipmask=1}}O(t,t.images[0]);if(t.compressed&&(t.internalformat===Qr||t.internalformat===Zr||t.internalformat===Jr||t.internalformat===te)){et(t.width%4===0&&t.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}}function D(t,n){var r=t.images;for(var e=0;e<r.length;++e){if(!r[e]){return}I(r[e],n,e)}}var P=[];function G(){var t=P.pop()||new U;R.call(t);t.mipmask=0;for(var n=0;n<16;++n){t.images[n]=null}return t}function V(t){var n=t.images;for(var r=0;r<n.length;++r){if(n[r]){k(n[r])}n[r]=null}P.push(t)}function X(){this.minFilter=ge;this.magFilter=ge;this.wrapS=pe;this.wrapT=pe;this.anisotropic=1;this.genMipmaps=false;this.mipmapHint=xe}function z(t,n){if("min"in n){var r=n.min;et.parameter(r,v);t.minFilter=v[r];if(Fe.indexOf(t.minFilter)>=0&&!("faces"in n)){t.genMipmaps=true}}if("mag"in n){var e=n.mag;et.parameter(e,l);t.magFilter=l[e]}var a=t.wrapS;var o=t.wrapT;if("wrap"in n){var u=n.wrap;if(typeof u==="string"){et.parameter(u,c);a=o=c[u]}else if(Array.isArray(u)){et.parameter(u[0],c);et.parameter(u[1],c);a=c[u[0]];o=c[u[1]]}}else{if("wrapS"in n){var f=n.wrapS;et.parameter(f,c);a=c[f]}if("wrapT"in n){var d=n.wrapT;et.parameter(d,c);o=c[d]}}t.wrapS=a;t.wrapT=o;if("anisotropic"in n){var h=n.anisotropic;et(typeof h==="number"&&h>=1&&h<=i.maxAnisotropic,"aniso samples must be between 1 and ");t.anisotropic=n.anisotropic}if("mipmap"in n){var b=false;switch(typeof n.mipmap){case"string":et.parameter(n.mipmap,s,"invalid mipmap hint");t.mipmapHint=s[n.mipmap];t.genMipmaps=true;b=true;break;case"boolean":b=t.genMipmaps=n.mipmap;break;case"object":et(Array.isArray(n.mipmap),"invalid mipmap type");t.genMipmaps=false;b=true;break;default:et.raise("invalid mipmap type")}if(b&&!("min"in n)){t.minFilter=Ae}}}function H(t,n){r.texParameteri(n,we,t.minFilter);r.texParameteri(n,ye,t.magFilter);r.texParameteri(n,de,t.wrapS);r.texParameteri(n,he,t.wrapT);if(e.ext_texture_filter_anisotropic){r.texParameteri(n,Ne,t.anisotropic)}if(t.genMipmaps){r.hint(Oe,t.mipmapHint);r.generateMipmap(n)}}var W=0;var $={};var Y=i.maxTextureUnits;var q=Array(Y).map((function(){return null}));function K(t){R.call(this);this.mipmask=0;this.internalformat=Lr;this.id=W++;this.refCount=1;this.target=t;this.texture=r.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=new X;if(f.profile){this.stats={size:0}}}function Q(t){r.activeTexture(Ue);r.bindTexture(t.target,t.texture)}function Z(){var t=q[0];if(t){r.bindTexture(t.target,t.texture)}else{r.bindTexture(Ir,null)}}function J(t){var n=t.texture;et(n,"must not double destroy texture");var e=t.unit;var i=t.target;if(e>=0){r.activeTexture(Ue+e);r.bindTexture(i,null);q[e]=null}r.deleteTexture(n);t.texture=null;t.params=null;t.pixels=null;t.refCount=0;delete $[t.id];u.textureCount--}n(K.prototype,{bind:function(){var t=this;t.bindCount+=1;var n=t.unit;if(n<0){for(var e=0;e<Y;++e){var i=q[e];if(i){if(i.bindCount>0){continue}i.unit=-1}q[e]=t;n=e;break}if(n>=Y){et.raise("insufficient number of texture units")}if(f.profile&&u.maxTextureUnits<n+1){u.maxTextureUnits=n+1}t.unit=n;r.activeTexture(Ue+n);r.bindTexture(t.target,t.texture)}return n},unbind:function(){this.bindCount-=1},decRef:function(){if(--this.refCount<=0){J(this)}}});function tt(t,n){var e=new K(Ir);$[e.id]=e;u.textureCount++;function a(t,n){var r=e.texInfo;X.call(r);var o=G();if(typeof t==="number"){if(typeof n==="number"){F(o,t|0,n|0)}else{F(o,t|0,t|0)}}else if(t){et.type(t,"object","invalid arguments to regl.texture");z(r,t);B(o,t)}else{F(o,1,1)}if(r.genMipmaps){o.mipmask=(o.width<<1)-1}e.mipmask=o.mipmask;O(e,o);et.texture2D(r,o,i);e.internalformat=o.internalformat;a.width=o.width;a.height=o.height;Q(e);D(o,Ir);H(r,Ir);Z();V(o);if(f.profile){e.stats.size=li(e.internalformat,e.type,o.width,o.height,r.genMipmaps,false)}a.format=w[e.internalformat];a.type=g[e.type];a.mag=E[r.magFilter];a.min=A[r.minFilter];a.wrapS=_[r.wrapS];a.wrapT=_[r.wrapT];return a}function o(t,n,r,i){et(!!t,"must specify image data");var o=n|0;var u=r|0;var f=i|0;var s=L();O(s,e);s.width=0;s.height=0;N(s,t);s.width=s.width||(e.width>>f)-o;s.height=s.height||(e.height>>f)-u;et(e.type===s.type&&e.format===s.format&&e.internalformat===s.internalformat,"incompatible format for texture.subimage");et(o>=0&&u>=0&&o+s.width<=e.width&&u+s.height<=e.height,"texture.subimage write out of bounds");et(e.mipmask&1<<f,"missing mipmap data");et(s.data||s.element||s.needsCopy,"missing image data");Q(e);M(s,Ir,o,u,f);Z();k(s);return a}function s(t,n){var i=t|0;var o=n|0||i;if(i===e.width&&o===e.height){return a}a.width=e.width=i;a.height=e.height=o;Q(e);for(var u=0;e.mipmask>>u;++u){var s=i>>u;var c=o>>u;if(!s||!c)break;r.texImage2D(Ir,u,e.format,s,c,0,e.format,e.type,null)}Z();if(f.profile){e.stats.size=li(e.internalformat,e.type,i,o,false,false)}return a}a(t,n);a.subimage=o;a.resize=s;a._reglType="texture2d";a._texture=e;if(f.profile){a.stats=e.stats}a.destroy=function(){e.decRef()};return a}function nt(t,n,e,a,o,s){var c=new K(Mr);$[c.id]=c;u.cubeCount++;var l=new Array(6);function v(t,n,r,e,a,o){var u;var s=c.texInfo;X.call(s);for(u=0;u<6;++u){l[u]=G()}if(typeof t==="number"||!t){var d=t|0||1;for(u=0;u<6;++u){F(l[u],d,d)}}else if(typeof t==="object"){if(n){B(l[0],t);B(l[1],n);B(l[2],r);B(l[3],e);B(l[4],a);B(l[5],o)}else{z(s,t);x(c,t);if("faces"in t){var h=t.faces;et(Array.isArray(h)&&h.length===6,"cube faces must be a length 6 array");for(u=0;u<6;++u){et(typeof h[u]==="object"&&!!h[u],"invalid input for cube map face");O(l[u],c);B(l[u],h[u])}}else{for(u=0;u<6;++u){B(l[u],t)}}}}else{et.raise("invalid arguments to cube map")}O(c,l[0]);if(!i.npotTextureCube){et(Sr(c.width)&&Sr(c.height),"your browser does not support non power or two texture dimensions")}if(s.genMipmaps){c.mipmask=(l[0].width<<1)-1}else{c.mipmask=l[0].mipmask}et.textureCube(c,s,l,i);c.internalformat=l[0].internalformat;v.width=l[0].width;v.height=l[0].height;Q(c);for(u=0;u<6;++u){D(l[u],Cr+u)}H(s,Mr);Z();if(f.profile){c.stats.size=li(c.internalformat,c.type,v.width,v.height,s.genMipmaps,true)}v.format=w[c.internalformat];v.type=g[c.type];v.mag=E[s.magFilter];v.min=A[s.minFilter];v.wrapS=_[s.wrapS];v.wrapT=_[s.wrapT];for(u=0;u<6;++u){V(l[u])}return v}function d(t,n,r,e,i){et(!!n,"must specify image data");et(typeof t==="number"&&t===(t|0)&&t>=0&&t<6,"invalid face");var a=r|0;var o=e|0;var u=i|0;var f=L();O(f,c);f.width=0;f.height=0;N(f,n);f.width=f.width||(c.width>>u)-a;f.height=f.height||(c.height>>u)-o;et(c.type===f.type&&c.format===f.format&&c.internalformat===f.internalformat,"incompatible format for texture.subimage");et(a>=0&&o>=0&&a+f.width<=c.width&&o+f.height<=c.height,"texture.subimage write out of bounds");et(c.mipmask&1<<u,"missing mipmap data");et(f.data||f.element||f.needsCopy,"missing image data");Q(c);M(f,Cr+t,a,o,u);Z();k(f);return v}function h(t){var n=t|0;if(n===c.width){return}v.width=c.width=n;v.height=c.height=n;Q(c);for(var e=0;e<6;++e){for(var i=0;c.mipmask>>i;++i){r.texImage2D(Cr+e,i,c.format,n>>i,n>>i,0,c.format,c.type,null)}}Z();if(f.profile){c.stats.size=li(c.internalformat,c.type,v.width,v.height,false,true)}return v}v(t,n,e,a,o,s);v.subimage=d;v.resize=h;v._reglType="textureCube";v._texture=c;if(f.profile){v.stats=c.stats}v.destroy=function(){c.decRef()};return v}function rt(){for(var t=0;t<Y;++t){r.activeTexture(Ue+t);r.bindTexture(Ir,null);q[t]=null}On($).forEach(J);u.cubeCount=0;u.textureCount=0}if(f.profile){u.getTotalTextureSize=function(){var t=0;Object.keys($).forEach((function(n){t+=$[n].stats.size}));return t}}function it(){for(var t=0;t<Y;++t){var n=q[t];if(n){n.bindCount=0;n.unit=-1;q[t]=null}}On($).forEach((function(t){t.texture=r.createTexture();r.bindTexture(t.target,t.texture);for(var n=0;n<32;++n){if((t.mipmask&1<<n)===0){continue}if(t.target===Ir){r.texImage2D(Ir,n,t.internalformat,t.width>>n,t.height>>n,0,t.internalformat,t.type,null)}else{for(var e=0;e<6;++e){r.texImage2D(Cr+e,n,t.internalformat,t.width>>n,t.height>>n,0,t.internalformat,t.type,null)}}}H(t.texInfo,t.target)}))}function at(){for(var t=0;t<Y;++t){var n=q[t];if(n){n.bindCount=0;n.unit=-1;q[t]=null}r.activeTexture(Ue+t);r.bindTexture(Ir,null);r.bindTexture(Mr,null)}}return{create2D:tt,createCube:nt,clear:rt,getTexture:function(t){return null},restore:it,refresh:at}}var di=36161;var hi=32854;var bi=32855;var pi=36194;var mi=33189;var yi=36168;var wi=34041;var gi=35907;var Ei=34836;var Ai=34842;var _i=34843;var Ti=[];Ti[hi]=2;Ti[bi]=2;Ti[pi]=2;Ti[mi]=2;Ti[yi]=1;Ti[wi]=4;Ti[gi]=4;Ti[Ei]=16;Ti[Ai]=8;Ti[_i]=6;function Ri(t,n,r){return Ti[t]*n*r}var Oi=function(t,n,r,e,i){var a={rgba4:hi,rgb565:pi,"rgb5 a1":bi,depth:mi,stencil:yi,"depth stencil":wi};if(n.ext_srgb){a["srgba"]=gi}if(n.ext_color_buffer_half_float){a["rgba16f"]=Ai;a["rgb16f"]=_i}if(n.webgl_color_buffer_float){a["rgba32f"]=Ei}var o=[];Object.keys(a).forEach((function(t){var n=a[t];o[n]=t}));var u=0;var f={};function s(t){this.id=u++;this.refCount=1;this.renderbuffer=t;this.format=hi;this.width=0;this.height=0;if(i.profile){this.stats={size:0}}}s.prototype.decRef=function(){if(--this.refCount<=0){c(this)}};function c(n){var r=n.renderbuffer;et(r,"must not double destroy renderbuffer");t.bindRenderbuffer(di,null);t.deleteRenderbuffer(r);n.renderbuffer=null;n.refCount=0;delete f[n.id];e.renderbufferCount--}function l(n,u){var c=new s(t.createRenderbuffer());f[c.id]=c;e.renderbufferCount++;function l(n,e){var u=0;var f=0;var s=hi;if(typeof n==="object"&&n){var v=n;if("shape"in v){var d=v.shape;et(Array.isArray(d)&&d.length>=2,"invalid renderbuffer shape");u=d[0]|0;f=d[1]|0}else{if("radius"in v){u=f=v.radius|0}if("width"in v){u=v.width|0}if("height"in v){f=v.height|0}}if("format"in v){et.parameter(v.format,a,"invalid renderbuffer format");s=a[v.format]}}else if(typeof n==="number"){u=n|0;if(typeof e==="number"){f=e|0}else{f=u}}else if(!n){u=f=1}else{et.raise("invalid arguments to renderbuffer constructor")}et(u>0&&f>0&&u<=r.maxRenderbufferSize&&f<=r.maxRenderbufferSize,"invalid renderbuffer size");if(u===c.width&&f===c.height&&s===c.format){return}l.width=c.width=u;l.height=c.height=f;c.format=s;t.bindRenderbuffer(di,c.renderbuffer);t.renderbufferStorage(di,s,u,f);et(t.getError()===0,"invalid render buffer format");if(i.profile){c.stats.size=Ri(c.format,c.width,c.height)}l.format=o[c.format];return l}function v(n,e){var a=n|0;var o=e|0||a;if(a===c.width&&o===c.height){return l}et(a>0&&o>0&&a<=r.maxRenderbufferSize&&o<=r.maxRenderbufferSize,"invalid renderbuffer size");l.width=c.width=a;l.height=c.height=o;t.bindRenderbuffer(di,c.renderbuffer);t.renderbufferStorage(di,c.format,a,o);et(t.getError()===0,"invalid render buffer format");if(i.profile){c.stats.size=Ri(c.format,c.width,c.height)}return l}l(n,u);l.resize=v;l._reglType="renderbuffer";l._renderbuffer=c;if(i.profile){l.stats=c.stats}l.destroy=function(){c.decRef()};return l}if(i.profile){e.getTotalRenderbufferSize=function(){var t=0;Object.keys(f).forEach((function(n){t+=f[n].stats.size}));return t}}function v(){On(f).forEach((function(n){n.renderbuffer=t.createRenderbuffer();t.bindRenderbuffer(di,n.renderbuffer);t.renderbufferStorage(di,n.format,n.width,n.height)}));t.bindRenderbuffer(di,null)}return{create:l,clear:function(){On(f).forEach(c)},restore:v}};var xi=36160;var ji=36161;var Si=3553;var Ni=34069;var Ii=36064;var Mi=36096;var Ci=36128;var Li=33306;var ki=36053;var Ui=36054;var Fi=36055;var Bi=36057;var Di=36061;var Pi=36193;var Gi=5121;var Vi=5126;var Xi=6407;var zi=6408;var Hi=6402;var Wi=[Xi,zi];var $i=[];$i[zi]=4;$i[Xi]=3;var Yi=[];Yi[Gi]=1;Yi[Vi]=4;Yi[Pi]=2;var qi=32854;var Ki=32855;var Qi=36194;var Zi=33189;var Ji=36168;var ta=34041;var na=35907;var ra=34836;var ea=34842;var ia=34843;var aa=[qi,Ki,Qi,na,ea,ia,ra];var oa={};oa[ki]="complete";oa[Ui]="incomplete attachment";oa[Bi]="incomplete dimensions";oa[Fi]="incomplete, missing attachment";oa[Di]="unsupported";function ua(t,r,e,i,a,o){var u={cur:null,next:null,dirty:false,setFBO:null};var f=["rgba"];var s=["rgba4","rgb565","rgb5 a1"];if(r.ext_srgb){s.push("srgba")}if(r.ext_color_buffer_half_float){s.push("rgba16f","rgb16f")}if(r.webgl_color_buffer_float){s.push("rgba32f")}var c=["uint8"];if(r.oes_texture_half_float){c.push("half float","float16")}if(r.oes_texture_float){c.push("float","float32")}function l(t,n,r){this.target=t;this.texture=n;this.renderbuffer=r;var e=0;var i=0;if(n){e=n.width;i=n.height}else if(r){e=r.width;i=r.height}this.width=e;this.height=i}function v(t){if(t){if(t.texture){t.texture._texture.decRef()}if(t.renderbuffer){t.renderbuffer._renderbuffer.decRef()}}}function d(t,n,r){if(!t){return}if(t.texture){var e=t.texture._texture;var i=Math.max(1,e.width);var a=Math.max(1,e.height);et(i===n&&a===r,"inconsistent width/height for supplied texture");e.refCount+=1}else{var o=t.renderbuffer._renderbuffer;et(o.width===n&&o.height===r,"inconsistent width/height for renderbuffer");o.refCount+=1}}function h(n,r){if(r){if(r.texture){t.framebufferTexture2D(xi,n,r.target,r.texture._texture.texture,0)}else{t.framebufferRenderbuffer(xi,n,ji,r.renderbuffer._renderbuffer.renderbuffer)}}}function b(t){var n=Si;var r=null;var e=null;var i=t;if(typeof t==="object"){i=t.data;if("target"in t){n=t.target|0}}et.type(i,"function","invalid attachment data");var a=i._reglType;if(a==="texture2d"){r=i;et(n===Si)}else if(a==="textureCube"){r=i;et(n>=Ni&&n<Ni+6,"invalid cube map target")}else if(a==="renderbuffer"){e=i;n=ji}else{et.raise("invalid regl object for attachment")}return new l(n,r,e)}function p(t,n,r,e,o){if(r){var u=i.create2D({width:t,height:n,format:e,type:o});u._texture.refCount=0;return new l(Si,u,null)}else{var f=a.create({width:t,height:n,format:e});f._renderbuffer.refCount=0;return new l(ji,null,f)}}function m(t){return t&&(t.texture||t.renderbuffer)}function y(t,n,r){if(t){if(t.texture){t.texture.resize(n,r)}else if(t.renderbuffer){t.renderbuffer.resize(n,r)}t.width=n;t.height=r}}var w=0;var g={};function E(){this.id=w++;g[this.id]=this;this.framebuffer=t.createFramebuffer();this.width=0;this.height=0;this.colorAttachments=[];this.depthAttachment=null;this.stencilAttachment=null;this.depthStencilAttachment=null}function A(t){t.colorAttachments.forEach(v);v(t.depthAttachment);v(t.stencilAttachment);v(t.depthStencilAttachment)}function _(n){var r=n.framebuffer;et(r,"must not double destroy framebuffer");t.deleteFramebuffer(r);n.framebuffer=null;o.framebufferCount--;delete g[n.id]}function T(n){var r;t.bindFramebuffer(xi,n.framebuffer);var i=n.colorAttachments;for(r=0;r<i.length;++r){h(Ii+r,i[r])}for(r=i.length;r<e.maxColorAttachments;++r){t.framebufferTexture2D(xi,Ii+r,Si,null,0)}t.framebufferTexture2D(xi,Li,Si,null,0);t.framebufferTexture2D(xi,Mi,Si,null,0);t.framebufferTexture2D(xi,Ci,Si,null,0);h(Mi,n.depthAttachment);h(Ci,n.stencilAttachment);h(Li,n.depthStencilAttachment);var a=t.checkFramebufferStatus(xi);if(!t.isContextLost()&&a!==ki){et.raise("framebuffer configuration not supported, status = "+oa[a])}t.bindFramebuffer(xi,u.next?u.next.framebuffer:null);u.cur=u.next;t.getError()}function R(t,i){var a=new E;o.framebufferCount++;function l(t,n){var i;et(u.next!==a,"can not update framebuffer which is currently in use");var o=0;var v=0;var h=true;var y=true;var w=null;var g=true;var E="rgba";var _="uint8";var R=1;var O=null;var x=null;var j=null;var S=false;if(typeof t==="number"){o=t|0;v=n|0||o}else if(!t){o=v=1}else{et.type(t,"object","invalid arguments for framebuffer");var N=t;if("shape"in N){var I=N.shape;et(Array.isArray(I)&&I.length>=2,"invalid shape for framebuffer");o=I[0];v=I[1]}else{if("radius"in N){o=v=N.radius}if("width"in N){o=N.width}if("height"in N){v=N.height}}if("color"in N||"colors"in N){w=N.color||N.colors;if(Array.isArray(w)){et(w.length===1||r.webgl_draw_buffers,"multiple render targets not supported")}}if(!w){if("colorCount"in N){R=N.colorCount|0;et(R>0,"invalid color buffer count")}if("colorTexture"in N){g=!!N.colorTexture;E="rgba4"}if("colorType"in N){_=N.colorType;if(!g){if(_==="half float"||_==="float16"){et(r.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers");E="rgba16f"}else if(_==="float"||_==="float32"){et(r.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers");E="rgba32f"}}else{et(r.oes_texture_float||!(_==="float"||_==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects");et(r.oes_texture_half_float||!(_==="half float"||_==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")}et.oneOf(_,c,"invalid color type")}if("colorFormat"in N){E=N.colorFormat;if(f.indexOf(E)>=0){g=true}else if(s.indexOf(E)>=0){g=false}else{if(g){et.oneOf(N.colorFormat,f,"invalid color format for texture")}else{et.oneOf(N.colorFormat,s,"invalid color format for renderbuffer")}}}}if("depthTexture"in N||"depthStencilTexture"in N){S=!!(N.depthTexture||N.depthStencilTexture);et(!S||r.webgl_depth_texture,"webgl_depth_texture extension not supported")}if("depth"in N){if(typeof N.depth==="boolean"){h=N.depth}else{O=N.depth;y=false}}if("stencil"in N){if(typeof N.stencil==="boolean"){y=N.stencil}else{x=N.stencil;h=false}}if("depthStencil"in N){if(typeof N.depthStencil==="boolean"){h=y=N.depthStencil}else{j=N.depthStencil;h=false;y=false}}}var M=null;var C=null;var L=null;var k=null;if(Array.isArray(w)){M=w.map(b)}else if(w){M=[b(w)]}else{M=new Array(R);for(i=0;i<R;++i){M[i]=p(o,v,g,E,_)}}et(r.webgl_draw_buffers||M.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers.");et(M.length<=e.maxColorAttachments,"too many color attachments, not supported");o=o||M[0].width;v=v||M[0].height;if(O){C=b(O)}else if(h&&!y){C=p(o,v,S,"depth","uint32")}if(x){L=b(x)}else if(y&&!h){L=p(o,v,false,"stencil","uint8")}if(j){k=b(j)}else if(!O&&!x&&y&&h){k=p(o,v,S,"depth stencil","depth stencil")}et(!!O+!!x+!!j<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var U=null;for(i=0;i<M.length;++i){d(M[i],o,v);et(!M[i]||M[i].texture&&Wi.indexOf(M[i].texture._texture.format)>=0||M[i].renderbuffer&&aa.indexOf(M[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid");if(M[i]&&M[i].texture){var F=$i[M[i].texture._texture.format]*Yi[M[i].texture._texture.type];if(U===null){U=F}else{et(U===F,"all color attachments much have the same number of bits per pixel.")}}}d(C,o,v);et(!C||C.texture&&C.texture._texture.format===Hi||C.renderbuffer&&C.renderbuffer._renderbuffer.format===Zi,"invalid depth attachment for framebuffer object");d(L,o,v);et(!L||L.renderbuffer&&L.renderbuffer._renderbuffer.format===Ji,"invalid stencil attachment for framebuffer object");d(k,o,v);et(!k||k.texture&&k.texture._texture.format===ta||k.renderbuffer&&k.renderbuffer._renderbuffer.format===ta,"invalid depth-stencil attachment for framebuffer object");A(a);a.width=o;a.height=v;a.colorAttachments=M;a.depthAttachment=C;a.stencilAttachment=L;a.depthStencilAttachment=k;l.color=M.map(m);l.depth=m(C);l.stencil=m(L);l.depthStencil=m(k);l.width=a.width;l.height=a.height;T(a);return l}function v(t,n){et(u.next!==a,"can not resize a framebuffer which is currently in use");var r=Math.max(t|0,1);var e=Math.max(n|0||r,1);if(r===a.width&&e===a.height){return l}var i=a.colorAttachments;for(var o=0;o<i.length;++o){y(i[o],r,e)}y(a.depthAttachment,r,e);y(a.stencilAttachment,r,e);y(a.depthStencilAttachment,r,e);a.width=l.width=r;a.height=l.height=e;T(a);return l}l(t,i);return n(l,{resize:v,_reglType:"framebuffer",_framebuffer:a,destroy:function(){_(a);A(a)},use:function(t){u.setFBO({framebuffer:l},t)}})}function O(t){var a=Array(6);function o(t){var e;et(a.indexOf(u.next)<0,"can not update framebuffer which is currently in use");var s={color:null};var l=0;var v=null;var d="rgba";var h="uint8";var b=1;if(typeof t==="number"){l=t|0}else if(!t){l=1}else{et.type(t,"object","invalid arguments for framebuffer");var p=t;if("shape"in p){var m=p.shape;et(Array.isArray(m)&&m.length>=2,"invalid shape for framebuffer");et(m[0]===m[1],"cube framebuffer must be square");l=m[0]}else{if("radius"in p){l=p.radius|0}if("width"in p){l=p.width|0;if("height"in p){et(p.height===l,"must be square")}}else if("height"in p){l=p.height|0}}if("color"in p||"colors"in p){v=p.color||p.colors;if(Array.isArray(v)){et(v.length===1||r.webgl_draw_buffers,"multiple render targets not supported")}}if(!v){if("colorCount"in p){b=p.colorCount|0;et(b>0,"invalid color buffer count")}if("colorType"in p){et.oneOf(p.colorType,c,"invalid color type");h=p.colorType}if("colorFormat"in p){d=p.colorFormat;et.oneOf(p.colorFormat,f,"invalid color format for texture")}}if("depth"in p){s.depth=p.depth}if("stencil"in p){s.stencil=p.stencil}if("depthStencil"in p){s.depthStencil=p.depthStencil}}var y;if(v){if(Array.isArray(v)){y=[];for(e=0;e<v.length;++e){y[e]=v[e]}}else{y=[v]}}else{y=Array(b);var w={radius:l,format:d,type:h};for(e=0;e<b;++e){y[e]=i.createCube(w)}}s.color=Array(y.length);for(e=0;e<y.length;++e){var g=y[e];et(typeof g==="function"&&g._reglType==="textureCube","invalid cube map");l=l||g.width;et(g.width===l&&g.height===l,"invalid cube map shape");s.color[e]={target:Ni,data:y[e]}}for(e=0;e<6;++e){for(var E=0;E<y.length;++E){s.color[E].target=Ni+e}if(e>0){s.depth=a[0].depth;s.stencil=a[0].stencil;s.depthStencil=a[0].depthStencil}if(a[e]){a[e](s)}else{a[e]=R(s)}}return n(o,{width:l,height:l,color:y})}function s(t){var n;var r=t|0;et(r>0&&r<=e.maxCubeMapSize,"invalid radius for cube fbo");if(r===o.width){return o}var i=o.color;for(n=0;n<i.length;++n){i[n].resize(r)}for(n=0;n<6;++n){a[n].resize(r)}o.width=o.height=r;return o}o(t);return n(o,{faces:a,resize:s,_reglType:"framebufferCube",destroy:function(){a.forEach((function(t){t.destroy()}))}})}function x(){u.cur=null;u.next=null;u.dirty=true;On(g).forEach((function(n){n.framebuffer=t.createFramebuffer();T(n)}))}return n(u,{getFramebuffer:function(t){if(typeof t==="function"&&t._reglType==="framebuffer"){var n=t._framebuffer;if(n instanceof E){return n}}return null},create:R,createCube:O,clear:function(){On(g).forEach(_)},restore:x})}var fa=5126;var sa=34962;function ca(){this.state=0;this.x=0;this.y=0;this.z=0;this.w=0;this.buffer=null;this.size=0;this.normalized=false;this.type=fa;this.offset=0;this.stride=0;this.divisor=0}function la(n,r,e,i,a){var o=e.maxAttributes;var u=new Array(o);for(var f=0;f<o;++f){u[f]=new ca}var s=0;var c={};var l={Record:ca,scope:{},state:u,currentVAO:null,targetVAO:null,restore:d()?g:function(){},createVAO:E,getVAO:b,destroyBuffer:v,setVAO:d()?p:m,clear:d()?y:function(){}};function v(t){for(var r=0;r<u.length;++r){var e=u[r];if(e.buffer===t){n.disableVertexAttribArray(r);e.buffer=null}}}function d(){return r.oes_vertex_array_object}function h(){return r.angle_instanced_arrays}function b(t){if(typeof t==="function"&&t._vao){return t._vao}return null}function p(t){if(t===l.currentVAO){return}var n=d();if(t){n.bindVertexArrayOES(t.vao)}else{n.bindVertexArrayOES(null)}l.currentVAO=t}function m(t){if(t===l.currentVAO){return}if(t){t.bindAttrs()}else{var r=h();for(var e=0;e<u.length;++e){var i=u[e];if(i.buffer){n.enableVertexAttribArray(e);n.vertexAttribPointer(e,i.size,i.type,i.normalized,i.stride,i.offfset);if(r&&i.divisor){r.vertexAttribDivisorANGLE(e,i.divisor)}}else{n.disableVertexAttribArray(e);n.vertexAttrib4f(e,i.x,i.y,i.z,i.w)}}}l.currentVAO=t}function y(){On(c).forEach((function(t){t.destroy()}))}function w(){this.id=++s;this.attributes=[];var t=d();if(t){this.vao=t.createVertexArrayOES()}else{this.vao=null}c[this.id]=this;this.buffers=[]}w.prototype.bindAttrs=function(){var t=h();var r=this.attributes;for(var e=0;e<r.length;++e){var i=r[e];if(i.buffer){n.enableVertexAttribArray(e);n.bindBuffer(sa,i.buffer.buffer);n.vertexAttribPointer(e,i.size,i.type,i.normalized,i.stride,i.offset);if(t&&i.divisor){t.vertexAttribDivisorANGLE(e,i.divisor)}}else{n.disableVertexAttribArray(e);n.vertexAttrib4f(e,i.x,i.y,i.z,i.w)}}for(var a=r.length;a<o;++a){n.disableVertexAttribArray(a)}};w.prototype.refresh=function(){var t=d();if(t){t.bindVertexArrayOES(this.vao);this.bindAttrs();l.currentVAO=this}};w.prototype.destroy=function(){if(this.vao){var t=d();if(this===l.currentVAO){l.currentVAO=null;t.bindVertexArrayOES(null)}t.deleteVertexArrayOES(this.vao);this.vao=null}if(c[this.id]){delete c[this.id];i.vaoCount-=1}};function g(){var t=d();if(t){On(c).forEach((function(t){t.refresh()}))}}function E(n){var e=new w;i.vaoCount+=1;function u(n){et(Array.isArray(n),"arguments to vertex array constructor must be an array");et(n.length<o,"too many attributes");et(n.length>0,"must specify at least one attribute");var i={};var f=e.attributes;f.length=n.length;for(var s=0;s<n.length;++s){var c=n[s];var l=f[s]=new ca;var v=c.data||c;if(Array.isArray(v)||t(v)||Rn(v)){var d;if(e.buffers[s]){d=e.buffers[s];if(t(v)&&d._buffer.byteLength>=v.byteLength){d.subdata(v)}else{d.destroy();e.buffers[s]=null}}if(!e.buffers[s]){d=e.buffers[s]=a.create(c,sa,false,true)}l.buffer=a.getBuffer(d);l.size=l.buffer.dimension|0;l.normalized=false;l.type=l.buffer.dtype;l.offset=0;l.stride=0;l.divisor=0;l.state=1;i[s]=1}else if(a.getBuffer(c)){l.buffer=a.getBuffer(c);l.size=l.buffer.dimension|0;l.normalized=false;l.type=l.buffer.dtype;l.offset=0;l.stride=0;l.divisor=0;l.state=1}else if(a.getBuffer(c.buffer)){l.buffer=a.getBuffer(c.buffer);l.size=(+c.size||l.buffer.dimension)|0;l.normalized=!!c.normalized||false;if("type"in c){et.parameter(c.type,Xn,"invalid buffer type");l.type=Xn[c.type]}else{l.type=l.buffer.dtype}l.offset=(c.offset||0)|0;l.stride=(c.stride||0)|0;l.divisor=(c.divisor||0)|0;l.state=1;et(l.size>=1&&l.size<=4,"size must be between 1 and 4");et(l.offset>=0,"invalid offset");et(l.stride>=0&&l.stride<=255,"stride must be between 0 and 255");et(l.divisor>=0,"divisor must be positive");et(!l.divisor||!!r.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")}else if("x"in c){et(s>0,"first attribute must not be a constant");l.x=+c.x||0;l.y=+c.y||0;l.z=+c.z||0;l.w=+c.w||0;l.state=2}else{et(false,"invalid attribute spec for location "+s)}}for(var h=0;h<e.buffers.length;++h){if(!i[h]&&e.buffers[h]){e.buffers[h].destroy();e.buffers[h]=null}}e.refresh();return u}u.destroy=function(){for(var t=0;t<e.buffers.length;++t){if(e.buffers[t]){e.buffers[t].destroy()}}e.buffers.length=0;e.destroy()};u._vao=e;u._reglType="vao";return u(n)}return l}var va=35632;var da=35633;var ha=35718;var ba=35721;function pa(t,r,e,i){var a={};var o={};function u(t,n,r,e){this.name=t;this.id=n;this.location=r;this.info=e}function f(t,n){for(var r=0;r<t.length;++r){if(t[r].id===n.id){t[r].location=n.location;return}}t.push(n)}function s(n,e,i){var u=n===va?a:o;var f=u[e];if(!f){var s=r.str(e);f=t.createShader(n);t.shaderSource(f,s);t.compileShader(f);et.shaderError(t,f,s,n,i);u[e]=f}return f}var c={};var l=[];var v=0;function d(t,n){this.id=v++;this.fragId=t;this.vertId=n;this.program=null;this.uniforms=[];this.attributes=[];this.refCount=1;if(i.profile){this.stats={uniformsCount:0,attributesCount:0}}}function h(n,e,a){var o,c;var l=s(va,n.fragId);var v=s(da,n.vertId);var d=n.program=t.createProgram();t.attachShader(d,l);t.attachShader(d,v);if(a){for(o=0;o<a.length;++o){var h=a[o];t.bindAttribLocation(d,h[0],h[1])}}t.linkProgram(d);et.linkError(t,d,r.str(n.fragId),r.str(n.vertId),e);var b=t.getProgramParameter(d,ha);if(i.profile){n.stats.uniformsCount=b}var p=n.uniforms;for(o=0;o<b;++o){c=t.getActiveUniform(d,o);if(c){if(c.size>1){for(var m=0;m<c.size;++m){var y=c.name.replace("[0]","["+m+"]");f(p,new u(y,r.id(y),t.getUniformLocation(d,y),c))}}else{f(p,new u(c.name,r.id(c.name),t.getUniformLocation(d,c.name),c))}}}var w=t.getProgramParameter(d,ba);if(i.profile){n.stats.attributesCount=w}var g=n.attributes;for(o=0;o<w;++o){c=t.getActiveAttrib(d,o);if(c){f(g,new u(c.name,r.id(c.name),t.getAttribLocation(d,c.name),c))}}}if(i.profile){e.getMaxUniformsCount=function(){var t=0;l.forEach((function(n){if(n.stats.uniformsCount>t){t=n.stats.uniformsCount}}));return t};e.getMaxAttributesCount=function(){var t=0;l.forEach((function(n){if(n.stats.attributesCount>t){t=n.stats.attributesCount}}));return t}}function b(){a={};o={};for(var t=0;t<l.length;++t){h(l[t],null,l[t].attributes.map((function(t){return[t.location,t.name]})))}}return{clear:function(){var n=t.deleteShader.bind(t);On(a).forEach(n);a={};On(o).forEach(n);o={};l.forEach((function(n){t.deleteProgram(n.program)}));l.length=0;c={};e.shaderCount=0},program:function(r,i,u,f){et.command(r>=0,"missing vertex shader",u);et.command(i>=0,"missing fragment shader",u);var s=c[i];if(!s){s=c[i]={}}var v=s[r];if(v){v.refCount++;if(!f){return v}}var b=new d(i,r);e.shaderCount++;h(b,u,f);if(!v){s[r]=b}l.push(b);return n(b,{destroy:function(){b.refCount--;if(b.refCount<=0){t.deleteProgram(b.program);var n=l.indexOf(b);l.splice(n,1);e.shaderCount--}if(s[b.vertId].refCount<=0){t.deleteShader(o[b.vertId]);delete o[b.vertId];delete c[b.fragId][b.vertId]}if(!Object.keys(c[b.fragId]).length){t.deleteShader(a[b.fragId]);delete a[b.fragId];delete c[b.fragId]}}})},restore:b,shader:s,frag:-1,vert:-1}}var ma=6408;var ya=5121;var wa=3333;var ga=5126;function Ea(n,r,e,i,a,o,u){function f(f){var s;if(r.next===null){et(a.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer');s=ya}else{et(r.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer");s=r.next.colorAttachments[0].texture._texture.type;if(o.oes_texture_float){et(s===ya||s===ga,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'");if(s===ga){et(u.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")}}else{et(s===ya,"Reading from a framebuffer is only allowed for the type 'uint8'")}}var c=0;var l=0;var v=i.framebufferWidth;var d=i.framebufferHeight;var h=null;if(t(f)){h=f}else if(f){et.type(f,"object","invalid arguments to regl.read()");c=f.x|0;l=f.y|0;et(c>=0&&c<i.framebufferWidth,"invalid x offset for regl.read");et(l>=0&&l<i.framebufferHeight,"invalid y offset for regl.read");v=(f.width||i.framebufferWidth-c)|0;d=(f.height||i.framebufferHeight-l)|0;h=f.data||null}if(h){if(s===ya){et(h instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'")}else if(s===ga){et(h instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")}}et(v>0&&v+c<=i.framebufferWidth,"invalid width for read pixels");et(d>0&&d+l<=i.framebufferHeight,"invalid height for read pixels");e();var b=v*d*4;if(!h){if(s===ya){h=new Uint8Array(b)}else if(s===ga){h=h||new Float32Array(b)}}et.isTypedArray(h,"data buffer for regl.read() must be a typedarray");et(h.byteLength>=b,"data buffer for regl.read() too small");n.pixelStorei(wa,4);n.readPixels(c,l,v,d,ma,s,h);return h}function s(t){var n;r.setFBO({framebuffer:t.framebuffer},(function(){n=f(t)}));return n}function c(t){if(!t||!("framebuffer"in t)){return f(t)}else{return s(t)}}return c}function Aa(t){return Array.prototype.slice.call(t)}function _a(t){return Aa(t).join("")}function Ta(){var t=0;var r=[];var e=[];function i(n){for(var i=0;i<e.length;++i){if(e[i]===n){return r[i]}}var a="g"+t++;r.push(a);e.push(n);return a}function a(){var r=[];function e(){r.push.apply(r,Aa(arguments))}var i=[];function a(){var n="v"+t++;i.push(n);if(arguments.length>0){r.push(n,"=");r.push.apply(r,Aa(arguments));r.push(";")}return n}return n(e,{def:a,toString:function(){return _a([i.length>0?"var "+i.join(",")+";":"",_a(r)])}})}function o(){var t=a();var r=a();var e=t.toString;var i=r.toString;function o(n,e){r(n,e,"=",t.def(n,e),";")}return n((function(){t.apply(t,Aa(arguments))}),{def:t.def,entry:t,exit:r,save:o,set:function(n,r,e){o(n,r);t(n,r,"=",e,";")},toString:function(){return e()+i()}})}function u(){var t=_a(arguments);var r=o();var e=o();var i=r.toString;var a=e.toString;return n(r,{then:function(){r.apply(r,Aa(arguments));return this},else:function(){e.apply(e,Aa(arguments));return this},toString:function(){var n=a();if(n){n="else{"+n+"}"}return _a(["if(",t,"){",i(),"}",n])}})}var f=a();var s={};function c(t,r){var e=[];function i(){var t="a"+e.length;e.push(t);return t}r=r||0;for(var a=0;a<r;++a){i()}var u=o();var f=u.toString;var c=s[t]=n(u,{arg:i,toString:function(){return _a(["function(",e.join(),"){",f(),"}"])}});return c}function l(){var t=['"use strict";',f,"return {"];Object.keys(s).forEach((function(n){t.push('"',n,'":',s[n].toString(),",")}));t.push("}");var n=_a(t).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");var i=Function.apply(null,r.concat(n));return i.apply(null,e)}return{global:f,link:i,block:a,proc:c,scope:o,cond:u,compile:l}}var Ra="xyzw".split("");var Oa=5121;var xa=1;var ja=2;var Sa=0;var Na=1;var Ia=2;var Ma=3;var Ca=4;var La=5;var ka=6;var Ua="dither";var Fa="blend.enable";var Ba="blend.color";var Da="blend.equation";var Pa="blend.func";var Ga="depth.enable";var Va="depth.func";var Xa="depth.range";var za="depth.mask";var Ha="colorMask";var Wa="cull.enable";var $a="cull.face";var Ya="frontFace";var qa="lineWidth";var Ka="polygonOffset.enable";var Qa="polygonOffset.offset";var Za="sample.alpha";var Ja="sample.enable";var to="sample.coverage";var no="stencil.enable";var ro="stencil.mask";var eo="stencil.func";var io="stencil.opFront";var ao="stencil.opBack";var oo="scissor.enable";var uo="scissor.box";var fo="viewport";var so="profile";var co="framebuffer";var lo="vert";var vo="frag";var ho="elements";var bo="primitive";var po="count";var mo="offset";var yo="instances";var wo="vao";var go="Width";var Eo="Height";var Ao=co+go;var _o=co+Eo;var To=fo+go;var Ro=fo+Eo;var Oo="drawingBuffer";var xo=Oo+go;var jo=Oo+Eo;var So=[Pa,Da,eo,io,ao,to,fo,uo,Qa];var No=34962;var Io=34963;var Mo=35632;var Co=35633;var Lo=3553;var ko=34067;var Uo=2884;var Fo=3042;var Bo=3024;var Do=2960;var Po=2929;var Go=3089;var Vo=32823;var Xo=32926;var zo=32928;var Ho=5126;var Wo=35664;var $o=35665;var Yo=35666;var qo=5124;var Ko=35667;var Qo=35668;var Zo=35669;var Jo=35670;var tu=35671;var nu=35672;var ru=35673;var eu=35674;var iu=35675;var au=35676;var ou=35678;var uu=35680;var fu=4;var su=1028;var cu=1029;var lu=2304;var vu=2305;var du=32775;var hu=32776;var bu=519;var pu=7680;var mu=0;var yu=1;var wu=32774;var gu=513;var Eu=36160;var Au=36064;var _u={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776};var Tu=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"];var Ru={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519};var Ou={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386};var xu={frag:Mo,vert:Co};var ju={cw:lu,ccw:vu};function Su(n){return Array.isArray(n)||t(n)||Rn(n)}function Nu(t){return t.sort((function(t,n){if(t===fo){return-1}else if(n===fo){return 1}return t<n?-1:1}))}function Iu(t,n,r,e){this.thisDep=t;this.contextDep=n;this.propDep=r;this.append=e}function Mu(t){return t&&!(t.thisDep||t.contextDep||t.propDep)}function Cu(t){return new Iu(false,false,false,t)}function Lu(t,n){var r=t.type;if(r===Sa){var e=t.data.length;return new Iu(true,e>=1,e>=2,n)}else if(r===Ca){var i=t.data;return new Iu(i.thisDep,i.contextDep,i.propDep,n)}else if(r===La){return new Iu(false,false,false,n)}else if(r===ka){var a=false;var o=false;var u=false;for(var f=0;f<t.data.length;++f){var s=t.data[f];if(s.type===Na){u=true}else if(s.type===Ia){o=true}else if(s.type===Ma){a=true}else if(s.type===Sa){a=true;var c=s.data;if(c>=1){o=true}if(c>=2){u=true}}else if(s.type===Ca){a=a||s.data.thisDep;o=o||s.data.contextDep;u=u||s.data.propDep}}return new Iu(a,o,u,n)}else{return new Iu(r===Ma,r===Ia,r===Na,n)}}var ku=new Iu(false,false,false,(function(){}));function Uu(t,r,e,i,a,o,u,f,s,c,l,v,d,h,b){var p=c.Record;var m={add:32774,subtract:32778,"reverse subtract":32779};if(e.ext_blend_minmax){m.min=du;m.max=hu}var y=e.angle_instanced_arrays;var w=e.webgl_draw_buffers;var g={dirty:true,profile:b.profile};var E={};var A=[];var _={};var T={};function R(t){return t.replace(".","_")}function O(t,n,r){var e=R(t);A.push(t);E[e]=g[e]=!!r;_[e]=n}function x(t,n,r){var e=R(t);A.push(t);if(Array.isArray(r)){g[e]=r.slice();E[e]=r.slice()}else{g[e]=E[e]=r}T[e]=n}O(Ua,Bo);O(Fa,Fo);x(Ba,"blendColor",[0,0,0,0]);x(Da,"blendEquationSeparate",[wu,wu]);x(Pa,"blendFuncSeparate",[yu,mu,yu,mu]);O(Ga,Po,true);x(Va,"depthFunc",gu);x(Xa,"depthRange",[0,1]);x(za,"depthMask",true);x(Ha,Ha,[true,true,true,true]);O(Wa,Uo);x($a,"cullFace",cu);x(Ya,Ya,vu);x(qa,qa,1);O(Ka,Vo);x(Qa,"polygonOffset",[0,0]);O(Za,Xo);O(Ja,zo);x(to,"sampleCoverage",[1,false]);O(no,Do);x(ro,"stencilMask",-1);x(eo,"stencilFunc",[bu,0,-1]);x(io,"stencilOpSeparate",[su,pu,pu,pu]);x(ao,"stencilOpSeparate",[cu,pu,pu,pu]);O(oo,Go);x(uo,"scissor",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]);x(fo,fo,[0,0,t.drawingBufferWidth,t.drawingBufferHeight]);var j={gl:t,context:d,strings:r,next:E,current:g,draw:v,elements:o,buffer:a,shader:l,attributes:c.state,vao:c,uniforms:s,framebuffer:f,extensions:e,timer:h,isBufferArgs:Su};var S={primTypes:cr,compareFuncs:Ru,blendFuncs:_u,blendEquations:m,stencilOps:Ou,glTypes:Xn,orientationType:ju};et.optional((function(){j.isArrayLike=jr}));if(w){S.backBuffer=[cu];S.drawBuffer=xt(i.maxDrawbuffers,(function(t){if(t===0){return[0]}return xt(t,(function(t){return Au+t}))}))}var N=0;function I(){var t=Ta();var n=t.link;var e=t.global;t.id=N++;t.batchId="0";var i=n(j);var a=t.shared={props:"a0"};Object.keys(j).forEach((function(t){a[t]=e.def(i,".",t)}));et.optional((function(){t.CHECK=n(et);t.commandStr=et.guessCommand();t.command=n(t.commandStr);t.assert=function(t,r,e){t("if(!(",r,"))",this.CHECK,".commandRaise(",n(e),",",this.command,");")};S.invalidBlendCombinations=Tu}));var o=t.next={};var u=t.current={};Object.keys(T).forEach((function(t){if(Array.isArray(g[t])){o[t]=e.def(a.next,".",t);u[t]=e.def(a.current,".",t)}}));var f=t.constants={};Object.keys(S).forEach((function(t){f[t]=e.def(JSON.stringify(S[t]))}));t.invoke=function(r,e){switch(e.type){case Sa:var i=["this",a.context,a.props,t.batchId];return r.def(n(e.data),".call(",i.slice(0,Math.max(e.data.length+1,4)),")");case Na:return r.def(a.props,e.data);case Ia:return r.def(a.context,e.data);case Ma:return r.def("this",e.data);case Ca:e.data.append(t,r);return e.data.ref;case La:return e.data.toString();case ka:return e.data.map((function(n){return t.invoke(r,n)}))}};t.attribCache={};var s={};t.scopeAttrib=function(t){var e=r.id(t);if(e in s){return s[e]}var i=c.scope[e];if(!i){i=c.scope[e]=new p}var a=s[e]=n(i);return a};return t}function M(t){var n=t.static;var r=t.dynamic;var e;if(so in n){var i=!!n[so];e=Cu((function(t,n){return i}));e.enable=i}else if(so in r){var a=r[so];e=Lu(a,(function(t,n){return t.invoke(n,a)}))}return e}function C(t,n){var r=t.static;var e=t.dynamic;if(co in r){var i=r[co];if(i){i=f.getFramebuffer(i);et.command(i,"invalid framebuffer object");return Cu((function(t,n){var r=t.link(i);var e=t.shared;n.set(e.framebuffer,".next",r);var a=e.context;n.set(a,"."+Ao,r+".width");n.set(a,"."+_o,r+".height");return r}))}else{return Cu((function(t,n){var r=t.shared;n.set(r.framebuffer,".next","null");var e=r.context;n.set(e,"."+Ao,e+"."+xo);n.set(e,"."+_o,e+"."+jo);return"null"}))}}else if(co in e){var a=e[co];return Lu(a,(function(t,n){var r=t.invoke(n,a);var e=t.shared;var i=e.framebuffer;var o=n.def(i,".getFramebuffer(",r,")");et.optional((function(){t.assert(n,"!"+r+"||"+o,"invalid framebuffer object")}));n.set(i,".next",o);var u=e.context;n.set(u,"."+Ao,o+"?"+o+".width:"+u+"."+xo);n.set(u,"."+_o,o+"?"+o+".height:"+u+"."+jo);return o}))}else{return null}}function L(t,n,r){var e=t.static;var i=t.dynamic;function a(t){if(t in e){var a=e[t];et.commandType(a,"object","invalid "+t,r.commandStr);var o=true;var u=a.x|0;var f=a.y|0;var s,c;if("width"in a){s=a.width|0;et.command(s>=0,"invalid "+t,r.commandStr)}else{o=false}if("height"in a){c=a.height|0;et.command(c>=0,"invalid "+t,r.commandStr)}else{o=false}return new Iu(!o&&n&&n.thisDep,!o&&n&&n.contextDep,!o&&n&&n.propDep,(function(t,n){var r=t.shared.context;var e=s;if(!("width"in a)){e=n.def(r,".",Ao,"-",u)}var i=c;if(!("height"in a)){i=n.def(r,".",_o,"-",f)}return[u,f,e,i]}))}else if(t in i){var l=i[t];var v=Lu(l,(function(n,r){var e=n.invoke(r,l);et.optional((function(){n.assert(r,e+"&&typeof "+e+'==="object"',"invalid "+t)}));var i=n.shared.context;var a=r.def(e,".x|0");var o=r.def(e,".y|0");var u=r.def('"width" in ',e,"?",e,".width|0:","(",i,".",Ao,"-",a,")");var f=r.def('"height" in ',e,"?",e,".height|0:","(",i,".",_o,"-",o,")");et.optional((function(){n.assert(r,u+">=0&&"+f+">=0","invalid "+t)}));return[a,o,u,f]}));if(n){v.thisDep=v.thisDep||n.thisDep;v.contextDep=v.contextDep||n.contextDep;v.propDep=v.propDep||n.propDep}return v}else if(n){return new Iu(n.thisDep,n.contextDep,n.propDep,(function(t,n){var r=t.shared.context;return[0,0,n.def(r,".",Ao),n.def(r,".",_o)]}))}else{return null}}var o=a(fo);if(o){var u=o;o=new Iu(o.thisDep,o.contextDep,o.propDep,(function(t,n){var r=u.append(t,n);var e=t.shared.context;n.set(e,"."+To,r[2]);n.set(e,"."+Ro,r[3]);return r}))}return{viewport:o,scissor_box:a(uo)}}function k(t,n){var r=t.static;var e=typeof r[vo]==="string"&&typeof r[lo]==="string";if(e){if(Object.keys(n.dynamic).length>0){return null}var i=n.static;var a=Object.keys(i);if(a.length>0&&typeof i[a[0]]==="number"){var o=[];for(var u=0;u<a.length;++u){et(typeof i[a[u]]==="number","must specify all vertex attribute locations when using vaos");o.push([i[a[u]]|0,a[u]])}return o}}return null}function U(t,n,e){var i=t.static;var a=t.dynamic;function o(t){if(t in i){var n=r.id(i[t]);et.optional((function(){l.shader(xu[t],n,et.guessCommand())}));var e=Cu((function(){return n}));e.id=n;return e}else if(t in a){var o=a[t];return Lu(o,(function(n,r){var e=n.invoke(r,o);var i=r.def(n.shared.strings,".id(",e,")");et.optional((function(){r(n.shared.shader,".shader(",xu[t],",",i,",",n.command,");")}));return i}))}return null}var u=o(vo);var f=o(lo);var s=null;var c;if(Mu(u)&&Mu(f)){s=l.program(f.id,u.id,null,e);c=Cu((function(t,n){return t.link(s)}))}else{c=new Iu(u&&u.thisDep||f&&f.thisDep,u&&u.contextDep||f&&f.contextDep,u&&u.propDep||f&&f.propDep,(function(t,n){var r=t.shared.shader;var e;if(u){e=u.append(t,n)}else{e=n.def(r,".",vo)}var i;if(f){i=f.append(t,n)}else{i=n.def(r,".",lo)}var a=r+".program("+i+","+e;et.optional((function(){a+=","+t.command}));return n.def(a+")")}))}return{frag:u,vert:f,progVar:c,program:s}}function F(t,n){var r=t.static;var e=t.dynamic;function i(){if(ho in r){var t=r[ho];if(Su(t)){t=o.getElements(o.create(t,true))}else if(t){t=o.getElements(t);et.command(t,"invalid elements",n.commandStr)}var i=Cu((function(n,r){if(t){var e=n.link(t);n.ELEMENTS=e;return e}n.ELEMENTS=null;return null}));i.value=t;return i}else if(ho in e){var a=e[ho];return Lu(a,(function(t,n){var r=t.shared;var e=r.isBufferArgs;var i=r.elements;var o=t.invoke(n,a);var u=n.def("null");var f=n.def(e,"(",o,")");var s=t.cond(f).then(u,"=",i,".createStream(",o,");").else(u,"=",i,".getElements(",o,");");et.optional((function(){t.assert(s.else,"!"+o+"||"+u,"invalid elements")}));n.entry(s);n.exit(t.cond(f).then(i,".destroyStream(",u,");"));t.ELEMENTS=u;return u}))}return null}var a=i();function u(){if(bo in r){var t=r[bo];et.commandParameter(t,cr,"invalid primitve",n.commandStr);return Cu((function(n,r){return cr[t]}))}else if(bo in e){var i=e[bo];return Lu(i,(function(t,n){var r=t.constants.primTypes;var e=t.invoke(n,i);et.optional((function(){t.assert(n,e+" in "+r,"invalid primitive, must be one of "+Object.keys(cr))}));return n.def(r,"[",e,"]")}))}else if(a){if(Mu(a)){if(a.value){return Cu((function(t,n){return n.def(t.ELEMENTS,".primType")}))}else{return Cu((function(){return fu}))}}else{return new Iu(a.thisDep,a.contextDep,a.propDep,(function(t,n){var r=t.ELEMENTS;return n.def(r,"?",r,".primType:",fu)}))}}return null}function f(t,i){if(t in r){var o=r[t]|0;et.command(!i||o>=0,"invalid "+t,n.commandStr);return Cu((function(t,n){if(i){t.OFFSET=o}return o}))}else if(t in e){var u=e[t];return Lu(u,(function(n,r){var e=n.invoke(r,u);if(i){n.OFFSET=e;et.optional((function(){n.assert(r,e+">=0","invalid "+t)}))}return e}))}else if(i&&a){return Cu((function(t,n){t.OFFSET="0";return 0}))}return null}var s=f(mo,true);function c(){if(po in r){var t=r[po]|0;et.command(typeof t==="number"&&t>=0,"invalid vertex count",n.commandStr);return Cu((function(){return t}))}else if(po in e){var i=e[po];return Lu(i,(function(t,n){var r=t.invoke(n,i);et.optional((function(){t.assert(n,"typeof "+r+'==="number"&&'+r+">=0&&"+r+"===("+r+"|0)","invalid vertex count")}));return r}))}else if(a){if(Mu(a)){if(a){if(s){return new Iu(s.thisDep,s.contextDep,s.propDep,(function(t,n){var r=n.def(t.ELEMENTS,".vertCount-",t.OFFSET);et.optional((function(){t.assert(n,r+">=0","invalid vertex offset/element buffer too small")}));return r}))}else{return Cu((function(t,n){return n.def(t.ELEMENTS,".vertCount")}))}}else{var o=Cu((function(){return-1}));et.optional((function(){o.MISSING=true}));return o}}else{var u=new Iu(a.thisDep||s.thisDep,a.contextDep||s.contextDep,a.propDep||s.propDep,(function(t,n){var r=t.ELEMENTS;if(t.OFFSET){return n.def(r,"?",r,".vertCount-",t.OFFSET,":-1")}return n.def(r,"?",r,".vertCount:-1")}));et.optional((function(){u.DYNAMIC=true}));return u}}return null}return{elements:a,primitive:u(),count:c(),instances:f(yo,false),offset:s}}function B(t,n){var r=t.static;var e=t.dynamic;var a={};A.forEach((function(t){var o=R(t);function u(n,i){if(t in r){var u=n(r[t]);a[o]=Cu((function(){return u}))}else if(t in e){var f=e[t];a[o]=Lu(f,(function(t,n){return i(t,n,t.invoke(n,f))}))}}switch(t){case Wa:case Fa:case Ua:case no:case Ga:case oo:case Ka:case Za:case Ja:case za:return u((function(r){et.commandType(r,"boolean",t,n.commandStr);return r}),(function(n,r,e){et.optional((function(){n.assert(r,"typeof "+e+'==="boolean"',"invalid flag "+t,n.commandStr)}));return e}));case Va:return u((function(r){et.commandParameter(r,Ru,"invalid "+t,n.commandStr);return Ru[r]}),(function(n,r,e){var i=n.constants.compareFuncs;et.optional((function(){n.assert(r,e+" in "+i,"invalid "+t+", must be one of "+Object.keys(Ru))}));return r.def(i,"[",e,"]")}));case Xa:return u((function(t){et.command(jr(t)&&t.length===2&&typeof t[0]==="number"&&typeof t[1]==="number"&&t[0]<=t[1],"depth range is 2d array",n.commandStr);return t}),(function(t,n,r){et.optional((function(){t.assert(n,t.shared.isArrayLike+"("+r+")&&"+r+".length===2&&"+"typeof "+r+'[0]==="number"&&'+"typeof "+r+'[1]==="number"&&'+r+"[0]<="+r+"[1]","depth range must be a 2d array")}));var e=n.def("+",r,"[0]");var i=n.def("+",r,"[1]");return[e,i]}));case Pa:return u((function(t){et.commandType(t,"object","blend.func",n.commandStr);var r="srcRGB"in t?t.srcRGB:t.src;var e="srcAlpha"in t?t.srcAlpha:t.src;var i="dstRGB"in t?t.dstRGB:t.dst;var a="dstAlpha"in t?t.dstAlpha:t.dst;et.commandParameter(r,_u,o+".srcRGB",n.commandStr);et.commandParameter(e,_u,o+".srcAlpha",n.commandStr);et.commandParameter(i,_u,o+".dstRGB",n.commandStr);et.commandParameter(a,_u,o+".dstAlpha",n.commandStr);et.command(Tu.indexOf(r+", "+i)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+r+", "+i+")",n.commandStr);return[_u[r],_u[i],_u[e],_u[a]]}),(function(n,r,e){var i=n.constants.blendFuncs;et.optional((function(){n.assert(r,e+"&&typeof "+e+'==="object"',"invalid blend func, must be an object")}));function a(a,o){var u=r.def('"',a,o,'" in ',e,"?",e,".",a,o,":",e,".",a);et.optional((function(){n.assert(r,u+" in "+i,"invalid "+t+"."+a+o+", must be one of "+Object.keys(_u))}));return u}var o=a("src","RGB");var u=a("dst","RGB");et.optional((function(){var t=n.constants.invalidBlendCombinations;n.assert(r,t+".indexOf("+o+'+", "+'+u+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var f=r.def(i,"[",o,"]");var s=r.def(i,"[",a("src","Alpha"),"]");var c=r.def(i,"[",u,"]");var l=r.def(i,"[",a("dst","Alpha"),"]");return[f,c,s,l]}));case Da:return u((function(r){if(typeof r==="string"){et.commandParameter(r,m,"invalid "+t,n.commandStr);return[m[r],m[r]]}else if(typeof r==="object"){et.commandParameter(r.rgb,m,t+".rgb",n.commandStr);et.commandParameter(r.alpha,m,t+".alpha",n.commandStr);return[m[r.rgb],m[r.alpha]]}else{et.commandRaise("invalid blend.equation",n.commandStr)}}),(function(n,r,e){var i=n.constants.blendEquations;var a=r.def();var o=r.def();var u=n.cond("typeof ",e,'==="string"');et.optional((function(){function r(t,r,e){n.assert(t,e+" in "+i,"invalid "+r+", must be one of "+Object.keys(m))}r(u.then,t,e);n.assert(u.else,e+"&&typeof "+e+'==="object"',"invalid "+t);r(u.else,t+".rgb",e+".rgb");r(u.else,t+".alpha",e+".alpha")}));u.then(a,"=",o,"=",i,"[",e,"];");u.else(a,"=",i,"[",e,".rgb];",o,"=",i,"[",e,".alpha];");r(u);return[a,o]}));case Ba:return u((function(t){et.command(jr(t)&&t.length===4,"blend.color must be a 4d array",n.commandStr);return xt(4,(function(n){return+t[n]}))}),(function(t,n,r){et.optional((function(){t.assert(n,t.shared.isArrayLike+"("+r+")&&"+r+".length===4","blend.color must be a 4d array")}));return xt(4,(function(t){return n.def("+",r,"[",t,"]")}))}));case ro:return u((function(t){et.commandType(t,"number",o,n.commandStr);return t|0}),(function(t,n,r){et.optional((function(){t.assert(n,"typeof "+r+'==="number"',"invalid stencil.mask")}));return n.def(r,"|0")}));case eo:return u((function(r){et.commandType(r,"object",o,n.commandStr);var e=r.cmp||"keep";var i=r.ref||0;var a="mask"in r?r.mask:-1;et.commandParameter(e,Ru,t+".cmp",n.commandStr);et.commandType(i,"number",t+".ref",n.commandStr);et.commandType(a,"number",t+".mask",n.commandStr);return[Ru[e],i,a]}),(function(t,n,r){var e=t.constants.compareFuncs;et.optional((function(){function i(){t.assert(n,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(r+"&&typeof ",r,'==="object"');i('!("cmp" in ',r,")||(",r,".cmp in ",e,")")}));var i=n.def('"cmp" in ',r,"?",e,"[",r,".cmp]",":",pu);var a=n.def(r,".ref|0");var o=n.def('"mask" in ',r,"?",r,".mask|0:-1");return[i,a,o]}));case io:case ao:return u((function(r){et.commandType(r,"object",o,n.commandStr);var e=r.fail||"keep";var i=r.zfail||"keep";var a=r.zpass||"keep";et.commandParameter(e,Ou,t+".fail",n.commandStr);et.commandParameter(i,Ou,t+".zfail",n.commandStr);et.commandParameter(a,Ou,t+".zpass",n.commandStr);return[t===ao?cu:su,Ou[e],Ou[i],Ou[a]]}),(function(n,r,e){var i=n.constants.stencilOps;et.optional((function(){n.assert(r,e+"&&typeof "+e+'==="object"',"invalid "+t)}));function a(a){et.optional((function(){n.assert(r,'!("'+a+'" in '+e+")||"+"("+e+"."+a+" in "+i+")","invalid "+t+"."+a+", must be one of "+Object.keys(Ou))}));return r.def('"',a,'" in ',e,"?",i,"[",e,".",a,"]:",pu)}return[t===ao?cu:su,a("fail"),a("zfail"),a("zpass")]}));case Qa:return u((function(t){et.commandType(t,"object",o,n.commandStr);var r=t.factor|0;var e=t.units|0;et.commandType(r,"number",o+".factor",n.commandStr);et.commandType(e,"number",o+".units",n.commandStr);return[r,e]}),(function(n,r,e){et.optional((function(){n.assert(r,e+"&&typeof "+e+'==="object"',"invalid "+t)}));var i=r.def(e,".factor|0");var a=r.def(e,".units|0");return[i,a]}));case $a:return u((function(t){var r=0;if(t==="front"){r=su}else if(t==="back"){r=cu}et.command(!!r,o,n.commandStr);return r}),(function(t,n,r){et.optional((function(){t.assert(n,r+'==="front"||'+r+'==="back"',"invalid cull.face")}));return n.def(r,'==="front"?',su,":",cu)}));case qa:return u((function(t){et.command(typeof t==="number"&&t>=i.lineWidthDims[0]&&t<=i.lineWidthDims[1],"invalid line width, must be a positive number between "+i.lineWidthDims[0]+" and "+i.lineWidthDims[1],n.commandStr);return t}),(function(t,n,r){et.optional((function(){t.assert(n,"typeof "+r+'==="number"&&'+r+">="+i.lineWidthDims[0]+"&&"+r+"<="+i.lineWidthDims[1],"invalid line width")}));return r}));case Ya:return u((function(t){et.commandParameter(t,ju,o,n.commandStr);return ju[t]}),(function(t,n,r){et.optional((function(){t.assert(n,r+'==="cw"||'+r+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}));return n.def(r+'==="cw"?'+lu+":"+vu)}));case Ha:return u((function(t){et.command(jr(t)&&t.length===4,"color.mask must be length 4 array",n.commandStr);return t.map((function(t){return!!t}))}),(function(t,n,r){et.optional((function(){t.assert(n,t.shared.isArrayLike+"("+r+")&&"+r+".length===4","invalid color.mask")}));return xt(4,(function(t){return"!!"+r+"["+t+"]"}))}));case to:return u((function(t){et.command(typeof t==="object"&&t,o,n.commandStr);var r="value"in t?t.value:1;var e=!!t.invert;et.command(typeof r==="number"&&r>=0&&r<=1,"sample.coverage.value must be a number between 0 and 1",n.commandStr);return[r,e]}),(function(t,n,r){et.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid sample.coverage")}));var e=n.def('"value" in ',r,"?+",r,".value:1");var i=n.def("!!",r,".invert");return[e,i]}))}}));return a}function D(t,n){var r=t.static;var e=t.dynamic;var i={};Object.keys(r).forEach((function(t){var e=r[t];var a;if(typeof e==="number"||typeof e==="boolean"){a=Cu((function(){return e}))}else if(typeof e==="function"){var o=e._reglType;if(o==="texture2d"||o==="textureCube"){a=Cu((function(t){return t.link(e)}))}else if(o==="framebuffer"||o==="framebufferCube"){et.command(e.color.length>0,'missing color attachment for framebuffer sent to uniform "'+t+'"',n.commandStr);a=Cu((function(t){return t.link(e.color[0])}))}else{et.commandRaise('invalid data for uniform "'+t+'"',n.commandStr)}}else if(jr(e)){a=Cu((function(n){var r=n.global.def("[",xt(e.length,(function(r){et.command(typeof e[r]==="number"||typeof e[r]==="boolean","invalid uniform "+t,n.commandStr);return e[r]})),"]");return r}))}else{et.commandRaise('invalid or missing data for uniform "'+t+'"',n.commandStr)}a.value=e;i[t]=a}));Object.keys(e).forEach((function(t){var n=e[t];i[t]=Lu(n,(function(t,r){return t.invoke(r,n)}))}));return i}function P(t,n){var e=t.static;var i=t.dynamic;var o={};Object.keys(e).forEach((function(t){var i=e[t];var u=r.id(t);var f=new p;if(Su(i)){f.state=xa;f.buffer=a.getBuffer(a.create(i,No,false,true));f.type=0}else{var s=a.getBuffer(i);if(s){f.state=xa;f.buffer=s;f.type=0}else{et.command(typeof i==="object"&&i,"invalid data for attribute "+t,n.commandStr);if("constant"in i){var c=i.constant;f.buffer="null";f.state=ja;if(typeof c==="number"){f.x=c}else{et.command(jr(c)&&c.length>0&&c.length<=4,"invalid constant for attribute "+t,n.commandStr);Ra.forEach((function(t,n){if(n<c.length){f[t]=c[n]}}))}}else{if(Su(i.buffer)){s=a.getBuffer(a.create(i.buffer,No,false,true))}else{s=a.getBuffer(i.buffer)}et.command(!!s,'missing buffer for attribute "'+t+'"',n.commandStr);var l=i.offset|0;et.command(l>=0,'invalid offset for attribute "'+t+'"',n.commandStr);var v=i.stride|0;et.command(v>=0&&v<256,'invalid stride for attribute "'+t+'", must be integer betweeen [0, 255]',n.commandStr);var d=i.size|0;et.command(!("size"in i)||d>0&&d<=4,'invalid size for attribute "'+t+'", must be 1,2,3,4',n.commandStr);var h=!!i.normalized;var b=0;if("type"in i){et.commandParameter(i.type,Xn,"invalid type for attribute "+t,n.commandStr);b=Xn[i.type]}var m=i.divisor|0;if("divisor"in i){et.command(m===0||y,'cannot specify divisor for attribute "'+t+'", instancing not supported',n.commandStr);et.command(m>=0,'invalid divisor for attribute "'+t+'"',n.commandStr)}et.optional((function(){var r=n.commandStr;var e=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(n){et.command(e.indexOf(n)>=0,'unknown parameter "'+n+'" for attribute pointer "'+t+'" (valid parameters are '+e+")",r)}))}));f.buffer=s;f.state=xa;f.size=d;f.normalized=h;f.type=b||s.dtype;f.offset=l;f.stride=v;f.divisor=m}}}o[t]=Cu((function(t,n){var r=t.attribCache;if(u in r){return r[u]}var e={isStream:false};Object.keys(f).forEach((function(t){e[t]=f[t]}));if(f.buffer){e.buffer=t.link(f.buffer);e.type=e.type||e.buffer+".dtype"}r[u]=e;return e}))}));Object.keys(i).forEach((function(t){var n=i[t];function r(r,e){var i=r.invoke(e,n);var a=r.shared;var o=r.constants;var u=a.isBufferArgs;var f=a.buffer;et.optional((function(){r.assert(e,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+u+"("+i+")||"+f+".getBuffer("+i+")||"+f+".getBuffer("+i+".buffer)||"+u+"("+i+".buffer)||"+'("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+a.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+t+'"')}));var s={isStream:e.def(false)};var c=new p;c.state=xa;Object.keys(c).forEach((function(t){s[t]=e.def(""+c[t])}));var l=s.buffer;var v=s.type;e("if(",u,"(",i,")){",s.isStream,"=true;",l,"=",f,".createStream(",No,",",i,");",v,"=",l,".dtype;","}else{",l,"=",f,".getBuffer(",i,");","if(",l,"){",v,"=",l,".dtype;",'}else if("constant" in ',i,"){",s.state,"=",ja,";","if(typeof "+i+'.constant === "number"){',s[Ra[0]],"=",i,".constant;",Ra.slice(1).map((function(t){return s[t]})).join("="),"=0;","}else{",Ra.map((function(t,n){return s[t]+"="+i+".constant.length>"+n+"?"+i+".constant["+n+"]:0;"})).join(""),"}}else{","if(",u,"(",i,".buffer)){",l,"=",f,".createStream(",No,",",i,".buffer);","}else{",l,"=",f,".getBuffer(",i,".buffer);","}",v,'="type" in ',i,"?",o.glTypes,"[",i,".type]:",l,".dtype;",s.normalized,"=!!",i,".normalized;");function d(t){e(s[t],"=",i,".",t,"|0;")}d("size");d("offset");d("stride");d("divisor");e("}}");e.exit("if(",s.isStream,"){",f,".destroyStream(",l,");","}");return s}o[t]=Lu(n,r)}));return o}function G(t,n){var r=t.static;var e=t.dynamic;if(wo in r){var i=r[wo];if(i!==null&&c.getVAO(i)===null){i=c.createVAO(i)}return Cu((function(t){return t.link(c.getVAO(i))}))}else if(wo in e){var a=e[wo];return Lu(a,(function(t,n){var r=t.invoke(n,a);return n.def(t.shared.vao+".getVAO("+r+")")}))}return null}function V(t){var n=t.static;var r=t.dynamic;var e={};Object.keys(n).forEach((function(t){var r=n[t];e[t]=Cu((function(t,n){if(typeof r==="number"||typeof r==="boolean"){return""+r}else{return t.link(r)}}))}));Object.keys(r).forEach((function(t){var n=r[t];e[t]=Lu(n,(function(t,r){return t.invoke(r,n)}))}));return e}function X(t,n,r,i,a){var o=t.static;var u=t.dynamic;et.optional((function(){var t=[co,lo,vo,ho,bo,mo,po,yo,so,wo].concat(A);function n(n){Object.keys(n).forEach((function(n){et.command(t.indexOf(n)>=0,'unknown parameter "'+n+'"',a.commandStr)}))}n(o);n(u)}));var f=k(t,n);var s=C(t);var l=L(t,s,a);var v=F(t,a);var d=B(t,a);var h=U(t,a,f);function b(t){var n=l[t];if(n){d[t]=n}}b(fo);b(R(uo));var p=Object.keys(d).length>0;var m={framebuffer:s,draw:v,shader:h,state:d,dirty:p,scopeVAO:null,drawVAO:null,useVAO:false,attributes:{}};m.profile=M(t);m.uniforms=D(r,a);m.drawVAO=m.scopeVAO=G(t);if(!m.drawVAO&&h.program&&!f&&e.angle_instanced_arrays){var y=true;var w=h.program.attributes.map((function(t){var r=n.static[t];y=y&&!!r;return r}));if(y&&w.length>0){var g=c.getVAO(c.createVAO(w));m.drawVAO=new Iu(null,null,null,(function(t,n){return t.link(g)}));m.useVAO=true}}if(f){m.useVAO=true}else{m.attributes=P(n,a)}m.context=V(i);return m}function z(t,n,r){var e=t.shared;var i=e.context;var a=t.scope();Object.keys(r).forEach((function(e){n.save(i,"."+e);var o=r[e];var u=o.append(t,n);if(Array.isArray(u)){a(i,".",e,"=[",u.join(),"];")}else{a(i,".",e,"=",u,";")}}));n(a)}function H(t,n,r,e){var i=t.shared;var a=i.gl;var o=i.framebuffer;var u;if(w){u=n.def(i.extensions,".webgl_draw_buffers")}var f=t.constants;var s=f.drawBuffer;var c=f.backBuffer;var l;if(r){l=r.append(t,n)}else{l=n.def(o,".next")}if(!e){n("if(",l,"!==",o,".cur){")}n("if(",l,"){",a,".bindFramebuffer(",Eu,",",l,".framebuffer);");if(w){n(u,".drawBuffersWEBGL(",s,"[",l,".colorAttachments.length]);")}n("}else{",a,".bindFramebuffer(",Eu,",null);");if(w){n(u,".drawBuffersWEBGL(",c,");")}n("}",o,".cur=",l,";");if(!e){n("}")}}function W(t,n,r){var e=t.shared;var i=e.gl;var a=t.current;var o=t.next;var u=e.current;var f=e.next;var s=t.cond(u,".dirty");A.forEach((function(n){var e=R(n);if(e in r.state){return}var c,l;if(e in o){c=o[e];l=a[e];var v=xt(g[e].length,(function(t){return s.def(c,"[",t,"]")}));s(t.cond(v.map((function(t,n){return t+"!=="+l+"["+n+"]"})).join("||")).then(i,".",T[e],"(",v,");",v.map((function(t,n){return l+"["+n+"]="+t})).join(";"),";"))}else{c=s.def(f,".",e);var d=t.cond(c,"!==",u,".",e);s(d);if(e in _){d(t.cond(c).then(i,".enable(",_[e],");").else(i,".disable(",_[e],");"),u,".",e,"=",c,";")}else{d(i,".",T[e],"(",c,");",u,".",e,"=",c,";")}}}));if(Object.keys(r.state).length===0){s(u,".dirty=false;")}n(s)}function $(t,n,r,e){var i=t.shared;var a=t.current;var o=i.current;var u=i.gl;Nu(Object.keys(r)).forEach((function(i){var f=r[i];if(e&&!e(f)){return}var s=f.append(t,n);if(_[i]){var c=_[i];if(Mu(f)){if(s){n(u,".enable(",c,");")}else{n(u,".disable(",c,");")}}else{n(t.cond(s).then(u,".enable(",c,");").else(u,".disable(",c,");"))}n(o,".",i,"=",s,";")}else if(jr(s)){var l=a[i];n(u,".",T[i],"(",s,");",s.map((function(t,n){return l+"["+n+"]="+t})).join(";"),";")}else{n(u,".",T[i],"(",s,");",o,".",i,"=",s,";")}}))}function Y(t,n){if(y){t.instancing=n.def(t.shared.extensions,".angle_instanced_arrays")}}function q(t,n,r,e,i){var a=t.shared;var o=t.stats;var u=a.current;var f=a.timer;var s=r.profile;function c(){if(typeof performance==="undefined"){return"Date.now()"}else{return"performance.now()"}}var l,v;function d(t){l=n.def();t(l,"=",c(),";");if(typeof i==="string"){t(o,".count+=",i,";")}else{t(o,".count++;")}if(h){if(e){v=n.def();t(v,"=",f,".getNumPendingQueries();")}else{t(f,".beginQuery(",o,");")}}}function b(t){t(o,".cpuTime+=",c(),"-",l,";");if(h){if(e){t(f,".pushScopeStats(",v,",",f,".getNumPendingQueries(),",o,");")}else{t(f,".endQuery();")}}}function p(t){var r=n.def(u,".profile");n(u,".profile=",t,";");n.exit(u,".profile=",r,";")}var m;if(s){if(Mu(s)){if(s.enable){d(n);b(n.exit);p("true")}else{p("false")}return}m=s.append(t,n);p(m)}else{m=n.def(u,".profile")}var y=t.block();d(y);n("if(",m,"){",y,"}");var w=t.block();b(w);n.exit("if(",m,"){",w,"}")}function K(t,n,r,e,i){var a=t.shared;function o(t){switch(t){case Wo:case Ko:case tu:return 2;case $o:case Qo:case nu:return 3;case Yo:case Zo:case ru:return 4;default:return 1}}function u(r,e,i){var o=a.gl;var u=n.def(r,".location");var f=n.def(a.attributes,"[",u,"]");var s=i.state;var c=i.buffer;var l=[i.x,i.y,i.z,i.w];var v=["buffer","normalized","offset","stride"];function d(){n("if(!",f,".buffer){",o,".enableVertexAttribArray(",u,");}");var r=i.type;var a;if(!i.size){a=e}else{a=n.def(i.size,"||",e)}n("if(",f,".type!==",r,"||",f,".size!==",a,"||",v.map((function(t){return f+"."+t+"!=="+i[t]})).join("||"),"){",o,".bindBuffer(",No,",",c,".buffer);",o,".vertexAttribPointer(",[u,a,r,i.normalized,i.stride,i.offset],");",f,".type=",r,";",f,".size=",a,";",v.map((function(t){return f+"."+t+"="+i[t]+";"})).join(""),"}");if(y){var s=i.divisor;n("if(",f,".divisor!==",s,"){",t.instancing,".vertexAttribDivisorANGLE(",[u,s],");",f,".divisor=",s,";}")}}function h(){n("if(",f,".buffer){",o,".disableVertexAttribArray(",u,");",f,".buffer=null;","}if(",Ra.map((function(t,n){return f+"."+t+"!=="+l[n]})).join("||"),"){",o,".vertexAttrib4f(",u,",",l,");",Ra.map((function(t,n){return f+"."+t+"="+l[n]+";"})).join(""),"}")}if(s===xa){d()}else if(s===ja){h()}else{n("if(",s,"===",xa,"){");d();n("}else{");h();n("}")}}e.forEach((function(e){var a=e.name;var f=r.attributes[a];var s;if(f){if(!i(f)){return}s=f.append(t,n)}else{if(!i(ku)){return}var c=t.scopeAttrib(a);et.optional((function(){t.assert(n,c+".state","missing attribute "+a)}));s={};Object.keys(new p).forEach((function(t){s[t]=n.def(c,".",t)}))}u(t.link(e),o(e.info.type),s)}))}function Q(t,n,e,i,a){var o=t.shared;var u=o.gl;var f;for(var s=0;s<i.length;++s){var c=i[s];var l=c.name;var v=c.info.type;var d=e.uniforms[l];var h=t.link(c);var b=h+".location";var p;if(d){if(!a(d)){continue}if(Mu(d)){var m=d.value;et.command(m!==null&&typeof m!=="undefined",'missing uniform "'+l+'"',t.commandStr);if(v===ou||v===uu){et.command(typeof m==="function"&&(v===ou&&(m._reglType==="texture2d"||m._reglType==="framebuffer")||v===uu&&(m._reglType==="textureCube"||m._reglType==="framebufferCube")),"invalid texture for uniform "+l,t.commandStr);var y=t.link(m._texture||m.color[0]._texture);n(u,".uniform1i(",b,",",y+".bind());");n.exit(y,".unbind();")}else if(v===eu||v===iu||v===au){et.optional((function(){et.command(jr(m),"invalid matrix for uniform "+l,t.commandStr);et.command(v===eu&&m.length===4||v===iu&&m.length===9||v===au&&m.length===16,"invalid length for matrix uniform "+l,t.commandStr)}));var w=t.global.def("new Float32Array(["+Array.prototype.slice.call(m)+"])");var g=2;if(v===iu){g=3}else if(v===au){g=4}n(u,".uniformMatrix",g,"fv(",b,",false,",w,");")}else{switch(v){case Ho:et.commandType(m,"number","uniform "+l,t.commandStr);f="1f";break;case Wo:et.command(jr(m)&&m.length===2,"uniform "+l,t.commandStr);f="2f";break;case $o:et.command(jr(m)&&m.length===3,"uniform "+l,t.commandStr);f="3f";break;case Yo:et.command(jr(m)&&m.length===4,"uniform "+l,t.commandStr);f="4f";break;case Jo:et.commandType(m,"boolean","uniform "+l,t.commandStr);f="1i";break;case qo:et.commandType(m,"number","uniform "+l,t.commandStr);f="1i";break;case tu:et.command(jr(m)&&m.length===2,"uniform "+l,t.commandStr);f="2i";break;case Ko:et.command(jr(m)&&m.length===2,"uniform "+l,t.commandStr);f="2i";break;case nu:et.command(jr(m)&&m.length===3,"uniform "+l,t.commandStr);f="3i";break;case Qo:et.command(jr(m)&&m.length===3,"uniform "+l,t.commandStr);f="3i";break;case ru:et.command(jr(m)&&m.length===4,"uniform "+l,t.commandStr);f="4i";break;case Zo:et.command(jr(m)&&m.length===4,"uniform "+l,t.commandStr);f="4i";break}n(u,".uniform",f,"(",b,",",jr(m)?Array.prototype.slice.call(m):m,");")}continue}else{p=d.append(t,n)}}else{if(!a(ku)){continue}p=n.def(o.uniforms,"[",r.id(l),"]")}if(v===ou){et(!Array.isArray(p),"must specify a scalar prop for textures");n("if(",p,"&&",p,'._reglType==="framebuffer"){',p,"=",p,".color[0];","}")}else if(v===uu){et(!Array.isArray(p),"must specify a scalar prop for cube maps");n("if(",p,"&&",p,'._reglType==="framebufferCube"){',p,"=",p,".color[0];","}")}et.optional((function(){function r(r,e){t.assert(n,r,'bad data or missing for uniform "'+l+'".  '+e)}function e(t){et(!Array.isArray(p),"must not specify an array type for uniform");r("typeof "+p+'==="'+t+'"',"invalid type, expected "+t)}function i(t,n){if(Array.isArray(p)){et(p.length===t,"must have length "+t)}else{r(o.isArrayLike+"("+p+")&&"+p+".length==="+t,"invalid vector, should have length "+t)}}function a(t){et(!Array.isArray(p),"must not specify a value type");r("typeof "+p+'==="function"&&'+p+'._reglType==="texture'+(t===Lo?"2d":"Cube")+'"',"invalid texture type")}switch(v){case qo:e("number");break;case Ko:i(2);break;case Qo:i(3);break;case Zo:i(4);break;case Ho:e("number");break;case Wo:i(2);break;case $o:i(3);break;case Yo:i(4);break;case Jo:e("boolean");break;case tu:i(2);break;case nu:i(3);break;case ru:i(4);break;case eu:i(4);break;case iu:i(9);break;case au:i(16);break;case ou:a(Lo);break;case uu:a(ko);break}}));var E=1;switch(v){case ou:case uu:var A=n.def(p,"._texture");n(u,".uniform1i(",b,",",A,".bind());");n.exit(A,".unbind();");continue;case qo:case Jo:f="1i";break;case Ko:case tu:f="2i";E=2;break;case Qo:case nu:f="3i";E=3;break;case Zo:case ru:f="4i";E=4;break;case Ho:f="1f";break;case Wo:f="2f";E=2;break;case $o:f="3f";E=3;break;case Yo:f="4f";E=4;break;case eu:f="Matrix2fv";break;case iu:f="Matrix3fv";break;case au:f="Matrix4fv";break}n(u,".uniform",f,"(",b,",");if(f.charAt(0)==="M"){var _=Math.pow(v-eu+2,2);var T=t.global.def("new Float32Array(",_,")");if(Array.isArray(p)){n("false,(",xt(_,(function(t){return T+"["+t+"]="+p[t]})),",",T,")")}else{n("false,(Array.isArray(",p,")||",p," instanceof Float32Array)?",p,":(",xt(_,(function(t){return T+"["+t+"]="+p+"["+t+"]"})),",",T,")")}}else if(E>1){n(xt(E,(function(t){return Array.isArray(p)?p[t]:p+"["+t+"]"})))}else{et(!Array.isArray(p),"uniform value must not be an array");n(p)}n(");")}}function Z(t,n,r,e){var i=t.shared;var a=i.gl;var o=i.draw;var u=e.draw;function f(){var i=u.elements;var f;var s=n;if(i){if(i.contextDep&&e.contextDynamic||i.propDep){s=r}f=i.append(t,s)}else{f=s.def(o,".",ho)}if(f){s("if("+f+")"+a+".bindBuffer("+Io+","+f+".buffer.buffer);")}return f}function s(){var i=u.count;var a;var f=n;if(i){if(i.contextDep&&e.contextDynamic||i.propDep){f=r}a=i.append(t,f);et.optional((function(){if(i.MISSING){t.assert(n,"false","missing vertex count")}if(i.DYNAMIC){t.assert(f,a+">=0","missing vertex count")}}))}else{a=f.def(o,".",po);et.optional((function(){t.assert(f,a+">=0","missing vertex count")}))}return a}var c=f();function l(i){var a=u[i];if(a){if(a.contextDep&&e.contextDynamic||a.propDep){return a.append(t,r)}else{return a.append(t,n)}}else{return n.def(o,".",i)}}var v=l(bo);var d=l(mo);var h=s();if(typeof h==="number"){if(h===0){return}}else{r("if(",h,"){");r.exit("}")}var b,p;if(y){b=l(yo);p=t.instancing}var m=c+".type";var w=u.elements&&Mu(u.elements);function g(){function t(){r(p,".drawElementsInstancedANGLE(",[v,h,m,d+"<<(("+m+"-"+Oa+")>>1)",b],");")}function n(){r(p,".drawArraysInstancedANGLE(",[v,d,h,b],");")}if(c){if(!w){r("if(",c,"){");t();r("}else{");n();r("}")}else{t()}}else{n()}}function E(){function t(){r(a+".drawElements("+[v,h,m,d+"<<(("+m+"-"+Oa+")>>1)"]+");")}function n(){r(a+".drawArrays("+[v,d,h]+");")}if(c){if(!w){r("if(",c,"){");t();r("}else{");n();r("}")}else{t()}}else{n()}}if(y&&(typeof b!=="number"||b>=0)){if(typeof b==="string"){r("if(",b,">0){");g();r("}else if(",b,"<0){");E();r("}")}else{g()}}else{E()}}function J(t,n,r,e,i){var a=I();var o=a.proc("body",i);et.optional((function(){a.commandStr=n.commandStr;a.command=a.link(n.commandStr)}));if(y){a.instancing=o.def(a.shared.extensions,".angle_instanced_arrays")}t(a,o,r,e);return a.compile().body}function tt(t,n,r,e){Y(t,n);if(r.useVAO){if(r.drawVAO){n(t.shared.vao,".setVAO(",r.drawVAO.append(t,n),");")}else{n(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);")}}else{n(t.shared.vao,".setVAO(null);");K(t,n,r,e.attributes,(function(){return true}))}Q(t,n,r,e.uniforms,(function(){return true}));Z(t,n,n,r)}function nt(t,n){var r=t.proc("draw",1);Y(t,r);z(t,r,n.context);H(t,r,n.framebuffer);W(t,r,n);$(t,r,n.state);q(t,r,n,false,true);var e=n.shader.progVar.append(t,r);r(t.shared.gl,".useProgram(",e,".program);");if(n.shader.program){tt(t,r,n,n.shader.program)}else{r(t.shared.vao,".setVAO(null);");var i=t.global.def("{}");var a=r.def(e,".id");var o=r.def(i,"[",a,"]");r(t.cond(o).then(o,".call(this,a0);").else(o,"=",i,"[",a,"]=",t.link((function(r){return J(tt,t,n,r,1)})),"(",e,");",o,".call(this,a0);"))}if(Object.keys(n.state).length>0){r(t.shared.current,".dirty=true;")}}function rt(t,n,r,e){t.batchId="a1";Y(t,n);function i(){return true}K(t,n,r,e.attributes,i);Q(t,n,r,e.uniforms,i);Z(t,n,n,r)}function it(t,n,r,e){Y(t,n);var i=r.contextDep;var a=n.def();var o="a0";var u="a1";var f=n.def();t.shared.props=f;t.batchId=a;var s=t.scope();var c=t.scope();n(s.entry,"for(",a,"=0;",a,"<",u,";++",a,"){",f,"=",o,"[",a,"];",c,"}",s.exit);function l(t){return t.contextDep&&i||t.propDep}function v(t){return!l(t)}if(r.needsContext){z(t,c,r.context)}if(r.needsFramebuffer){H(t,c,r.framebuffer)}$(t,c,r.state,l);if(r.profile&&l(r.profile)){q(t,c,r,false,true)}if(!e){var d=t.global.def("{}");var h=r.shader.progVar.append(t,c);var b=c.def(h,".id");var p=c.def(d,"[",b,"]");c(t.shared.gl,".useProgram(",h,".program);","if(!",p,"){",p,"=",d,"[",b,"]=",t.link((function(n){return J(rt,t,r,n,2)})),"(",h,");}",p,".call(this,a0[",a,"],",a,");")}else{if(r.useVAO){if(r.drawVAO){if(l(r.drawVAO)){c(t.shared.vao,".setVAO(",r.drawVAO.append(t,c),");")}else{s(t.shared.vao,".setVAO(",r.drawVAO.append(t,s),");")}}else{s(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);")}}else{s(t.shared.vao,".setVAO(null);");K(t,s,r,e.attributes,v);K(t,c,r,e.attributes,l)}Q(t,s,r,e.uniforms,v);Q(t,c,r,e.uniforms,l);Z(t,s,c,r)}}function at(t,n){var r=t.proc("batch",2);t.batchId="0";Y(t,r);var e=false;var i=true;Object.keys(n.context).forEach((function(t){e=e||n.context[t].propDep}));if(!e){z(t,r,n.context);i=false}var a=n.framebuffer;var o=false;if(a){if(a.propDep){e=o=true}else if(a.contextDep&&e){o=true}if(!o){H(t,r,a)}}else{H(t,r,null)}if(n.state.viewport&&n.state.viewport.propDep){e=true}function u(t){return t.contextDep&&e||t.propDep}W(t,r,n);$(t,r,n.state,(function(t){return!u(t)}));if(!n.profile||!u(n.profile)){q(t,r,n,false,"a1")}n.contextDep=e;n.needsContext=i;n.needsFramebuffer=o;var f=n.shader.progVar;if(f.contextDep&&e||f.propDep){it(t,r,n,null)}else{var s=f.append(t,r);r(t.shared.gl,".useProgram(",s,".program);");if(n.shader.program){it(t,r,n,n.shader.program)}else{r(t.shared.vao,".setVAO(null);");var c=t.global.def("{}");var l=r.def(s,".id");var v=r.def(c,"[",l,"]");r(t.cond(v).then(v,".call(this,a0,a1);").else(v,"=",c,"[",l,"]=",t.link((function(r){return J(it,t,n,r,2)})),"(",s,");",v,".call(this,a0,a1);"))}}if(Object.keys(n.state).length>0){r(t.shared.current,".dirty=true;")}}function ot(t,n){var e=t.proc("scope",3);t.batchId="a2";var i=t.shared;var a=i.current;z(t,e,n.context);if(n.framebuffer){n.framebuffer.append(t,e)}Nu(Object.keys(n.state)).forEach((function(r){var a=n.state[r];var o=a.append(t,e);if(jr(o)){o.forEach((function(n,i){e.set(t.next[r],"["+i+"]",n)}))}else{e.set(i.next,"."+r,o)}}));q(t,e,n,true,true);[ho,mo,po,yo,bo].forEach((function(r){var a=n.draw[r];if(!a){return}e.set(i.draw,"."+r,""+a.append(t,e))}));Object.keys(n.uniforms).forEach((function(a){var o=n.uniforms[a].append(t,e);if(Array.isArray(o)){o="["+o.join()+"]"}e.set(i.uniforms,"["+r.id(a)+"]",o)}));Object.keys(n.attributes).forEach((function(r){var i=n.attributes[r].append(t,e);var a=t.scopeAttrib(r);Object.keys(new p).forEach((function(t){e.set(a,"."+t,i[t])}))}));if(n.scopeVAO){e.set(i.vao,".targetVAO",n.scopeVAO.append(t,e))}function o(r){var a=n.shader[r];if(a){e.set(i.shader,"."+r,a.append(t,e))}}o(lo);o(vo);if(Object.keys(n.state).length>0){e(a,".dirty=true;");e.exit(a,".dirty=true;")}e("a1(",t.shared.context,",a0,",t.batchId,");")}function ut(t){if(typeof t!=="object"||jr(t)){return}var n=Object.keys(t);for(var r=0;r<n.length;++r){if(bt.isDynamic(t[n[r]])){return true}}return false}function ft(t,n,r){var e=n.static[r];if(!e||!ut(e)){return}var i=t.global;var a=Object.keys(e);var o=false;var u=false;var f=false;var s=t.global.def("{}");a.forEach((function(n){var r=e[n];if(bt.isDynamic(r)){if(typeof r==="function"){r=e[n]=bt.unbox(r)}var a=Lu(r,null);o=o||a.thisDep;f=f||a.propDep;u=u||a.contextDep}else{i(s,".",n,"=");switch(typeof r){case"number":i(r);break;case"string":i('"',r,'"');break;case"object":if(Array.isArray(r)){i("[",r.join(),"]")}break;default:i(t.link(r));break}i(";")}}));function c(t,n){a.forEach((function(r){var i=e[r];if(!bt.isDynamic(i)){return}var a=t.invoke(n,i);n(s,".",r,"=",a,";")}))}n.dynamic[r]=new bt.DynamicVariable(Ca,{thisDep:o,contextDep:u,propDep:f,ref:s,append:c});delete n.static[r]}function st(t,r,e,i,a){var o=I();o.stats=o.link(a);Object.keys(r.static).forEach((function(t){ft(o,r,t)}));So.forEach((function(n){ft(o,t,n)}));var u=X(t,r,e,i,o);nt(o,u);ot(o,u);at(o,u);return n(o.compile(),{destroy:function(){u.shader.program.destroy()}})}return{next:E,current:g,procs:function(){var t=I();var n=t.proc("poll");var r=t.proc("refresh");var a=t.block();n(a);r(a);var o=t.shared;var u=o.gl;var f=o.next;var s=o.current;a(s,".dirty=false;");H(t,n);H(t,r,null,true);var c;if(y){c=t.link(y)}if(e.oes_vertex_array_object){r(t.link(e.oes_vertex_array_object),".bindVertexArrayOES(null);")}for(var l=0;l<i.maxAttributes;++l){var v=r.def(o.attributes,"[",l,"]");var d=t.cond(v,".buffer");d.then(u,".enableVertexAttribArray(",l,");",u,".bindBuffer(",No,",",v,".buffer.buffer);",u,".vertexAttribPointer(",l,",",v,".size,",v,".type,",v,".normalized,",v,".stride,",v,".offset);").else(u,".disableVertexAttribArray(",l,");",u,".vertexAttrib4f(",l,",",v,".x,",v,".y,",v,".z,",v,".w);",v,".buffer=null;");r(d);if(y){r(c,".vertexAttribDivisorANGLE(",l,",",v,".divisor);")}}r(t.shared.vao,".currentVAO=null;",t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);");Object.keys(_).forEach((function(e){var i=_[e];var o=a.def(f,".",e);var c=t.block();c("if(",o,"){",u,".enable(",i,")}else{",u,".disable(",i,")}",s,".",e,"=",o,";");r(c);n("if(",o,"!==",s,".",e,"){",c,"}")}));Object.keys(T).forEach((function(e){var i=T[e];var o=g[e];var c,l;var v=t.block();v(u,".",i,"(");if(jr(o)){var d=o.length;c=t.global.def(f,".",e);l=t.global.def(s,".",e);v(xt(d,(function(t){return c+"["+t+"]"})),");",xt(d,(function(t){return l+"["+t+"]="+c+"["+t+"];"})).join(""));n("if(",xt(d,(function(t){return c+"["+t+"]!=="+l+"["+t+"]"})).join("||"),"){",v,"}")}else{c=a.def(f,".",e);l=a.def(s,".",e);v(c,");",s,".",e,"=",c,";");n("if(",c,"!==",l,"){",v,"}")}r(v)}));return t.compile()}(),compile:st}}function Fu(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Bu=34918;var Du=34919;var Pu=35007;var Gu=function(t,n){if(!n.ext_disjoint_timer_query){return null}var r=[];function e(){return r.pop()||n.ext_disjoint_timer_query.createQueryEXT()}function i(t){r.push(t)}var a=[];function o(t){var r=e();n.ext_disjoint_timer_query.beginQueryEXT(Pu,r);a.push(r);d(a.length-1,a.length,t)}function u(){n.ext_disjoint_timer_query.endQueryEXT(Pu)}function f(){this.startQueryIndex=-1;this.endQueryIndex=-1;this.sum=0;this.stats=null}var s=[];function c(){return s.pop()||new f}function l(t){s.push(t)}var v=[];function d(t,n,r){var e=c();e.startQueryIndex=t;e.endQueryIndex=n;e.sum=0;e.stats=r;v.push(e)}var h=[];var b=[];function p(){var t,r;var e=a.length;if(e===0){return}b.length=Math.max(b.length,e+1);h.length=Math.max(h.length,e+1);h[0]=0;b[0]=0;var o=0;t=0;for(r=0;r<a.length;++r){var u=a[r];if(n.ext_disjoint_timer_query.getQueryObjectEXT(u,Du)){o+=n.ext_disjoint_timer_query.getQueryObjectEXT(u,Bu);i(u)}else{a[t++]=u}h[r+1]=o;b[r+1]=t}a.length=t;t=0;for(r=0;r<v.length;++r){var f=v[r];var s=f.startQueryIndex;var c=f.endQueryIndex;f.sum+=h[c]-h[s];var d=b[s];var p=b[c];if(p===d){f.stats.gpuTime+=f.sum/1e6;l(f)}else{f.startQueryIndex=d;f.endQueryIndex=p;v[t++]=f}}v.length=t}return{beginQuery:o,endQuery:u,pushScopeStats:d,update:p,getNumPendingQueries:function(){return a.length},clear:function(){r.push.apply(r,a);for(var t=0;t<r.length;t++){n.ext_disjoint_timer_query.deleteQueryEXT(r[t])}a.length=0;r.length=0},restore:function(){a.length=0;r.length=0}}};var Vu=16384;var Xu=256;var zu=1024;var Hu=34962;var Wu="webglcontextlost";var $u="webglcontextrestored";var Yu=1;var qu=2;var Ku=3;function Qu(t,n){for(var r=0;r<t.length;++r){if(t[r]===n){return r}}return-1}function Zu(t){var r=Rt(t);if(!r){return null}var e=r.gl;var i=e.getContextAttributes();var a=e.isContextLost();var o=Ot(e,r);if(!o){return null}var u=yt();var f=Fu();var s=o.extensions;var c=Gu(e,s);var l=mt();var v=e.drawingBufferWidth;var d=e.drawingBufferHeight;var h={tick:0,time:0,viewportWidth:v,viewportHeight:d,framebufferWidth:v,framebufferHeight:d,drawingBufferWidth:v,drawingBufferHeight:d,pixelRatio:r.pixelRatio};var b={};var p={elements:null,primitive:4,count:-1,offset:0,instances:-1};var m=Tn(e,s);var y=er(e,f,r,g);var w=la(e,s,m,f,y);function g(t){return w.destroyBuffer(t)}var E=_r(e,s,y,f);var A=pa(e,u,f,r);var _=vi(e,s,m,(function(){O.procs.poll()}),h,f,r);var T=Oi(e,s,m,f,r);var R=ua(e,s,m,_,T,f);var O=Uu(e,u,s,m,y,E,_,R,b,w,A,p,h,c,r);var x=Ea(e,R,O.procs.poll,h,i,s,m);var j=O.next;var S=e.canvas;var N=[];var I=[];var M=[];var C=[r.onDestroy];var L=null;function k(){if(N.length===0){if(c){c.update()}L=null;return}L=pt.next(k);$();for(var t=N.length-1;t>=0;--t){var n=N[t];if(n){n(h,null,0)}}e.flush();if(c){c.update()}}function U(){if(!L&&N.length>0){L=pt.next(k)}}function F(){if(L){pt.cancel(k);L=null}}function B(t){t.preventDefault();a=true;F();I.forEach((function(t){t()}))}function D(t){e.getError();a=false;o.restore();A.restore();y.restore();_.restore();T.restore();R.restore();w.restore();if(c){c.restore()}O.procs.refresh();U();M.forEach((function(t){t()}))}if(S){S.addEventListener(Wu,B,false);S.addEventListener($u,D,false)}function P(){N.length=0;F();if(S){S.removeEventListener(Wu,B);S.removeEventListener($u,D)}A.clear();R.clear();T.clear();_.clear();E.clear();y.clear();w.clear();if(c){c.clear()}C.forEach((function(t){t()}))}function G(t){et(!!t,"invalid args to regl({...})");et.type(t,"object","invalid args to regl({...})");function r(t){var r=n({},t);delete r.uniforms;delete r.attributes;delete r.context;delete r.vao;if("stencil"in r&&r.stencil.op){r.stencil.opBack=r.stencil.opFront=r.stencil.op;delete r.stencil.op}function e(t){if(t in r){var n=r[t];delete r[t];Object.keys(n).forEach((function(e){r[t+"."+e]=n[e]}))}}e("blend");e("depth");e("cull");e("stencil");e("polygonOffset");e("scissor");e("sample");if("vao"in t){r.vao=t.vao}return r}function e(t,n){var r={};var e={};Object.keys(t).forEach((function(i){var a=t[i];if(bt.isDynamic(a)){e[i]=bt.unbox(a,i);return}else if(n&&Array.isArray(a)){for(var o=0;o<a.length;++o){if(bt.isDynamic(a[o])){e[i]=bt.unbox(a,i);return}}}r[i]=a}));return{dynamic:e,static:r}}var i=e(t.context||{},true);var o=e(t.uniforms||{},true);var u=e(t.attributes||{},false);var f=e(r(t),false);var s={gpuTime:0,cpuTime:0,count:0};var c=O.compile(f,u,o,i,s);var l=c.draw;var v=c.batch;var d=c.scope;var h=[];function b(t){while(h.length<t){h.push(null)}return h}function p(t,n){var r;if(a){et.raise("context lost")}if(typeof t==="function"){return d.call(this,null,t,0)}else if(typeof n==="function"){if(typeof t==="number"){for(r=0;r<t;++r){d.call(this,null,n,r)}}else if(Array.isArray(t)){for(r=0;r<t.length;++r){d.call(this,t[r],n,r)}}else{return d.call(this,t,n,0)}}else if(typeof t==="number"){if(t>0){return v.call(this,b(t|0),t|0)}}else if(Array.isArray(t)){if(t.length){return v.call(this,t,t.length)}}else{return l.call(this,t)}}return n(p,{stats:s,destroy:function(){c.destroy()}})}var V=R.setFBO=G({framebuffer:bt.define.call(null,Yu,"framebuffer")});function X(t,n){var r=0;O.procs.poll();var i=n.color;if(i){e.clearColor(+i[0]||0,+i[1]||0,+i[2]||0,+i[3]||0);r|=Vu}if("depth"in n){e.clearDepth(+n.depth);r|=Xu}if("stencil"in n){e.clearStencil(n.stencil|0);r|=zu}et(!!r,"called regl.clear with no buffer specified");e.clear(r)}function z(t){et(typeof t==="object"&&t,"regl.clear() takes an object as input");if("framebuffer"in t){if(t.framebuffer&&t.framebuffer_reglType==="framebufferCube"){for(var r=0;r<6;++r){V(n({framebuffer:t.framebuffer.faces[r]},t),X)}}else{V(t,X)}}else{X(null,t)}}function H(t){et.type(t,"function","regl.frame() callback must be a function");N.push(t);function n(){var n=Qu(N,t);et(n>=0,"cannot cancel a frame twice");function r(){var t=Qu(N,r);N[t]=N[N.length-1];N.length-=1;if(N.length<=0){F()}}N[n]=r}U();return{cancel:n}}function W(){var t=j.viewport;var n=j.scissor_box;t[0]=t[1]=n[0]=n[1]=0;h.viewportWidth=h.framebufferWidth=h.drawingBufferWidth=t[2]=n[2]=e.drawingBufferWidth;h.viewportHeight=h.framebufferHeight=h.drawingBufferHeight=t[3]=n[3]=e.drawingBufferHeight}function $(){h.tick+=1;h.time=q();W();O.procs.poll()}function Y(){_.refresh();W();O.procs.refresh();if(c){c.update()}}function q(){return(mt()-l)/1e3}Y();function K(t,n){et.type(n,"function","listener callback must be a function");var r;switch(t){case"frame":return H(n);case"lost":r=I;break;case"restore":r=M;break;case"destroy":r=C;break;default:et.raise("invalid event, must be one of frame,lost,restore,destroy")}r.push(n);return{cancel:function(){for(var t=0;t<r.length;++t){if(r[t]===n){r[t]=r[r.length-1];r.pop();return}}}}}var Q=n(G,{clear:z,prop:bt.define.bind(null,Yu),context:bt.define.bind(null,qu),this:bt.define.bind(null,Ku),draw:G({}),buffer:function(t){return y.create(t,Hu,false,false)},elements:function(t){return E.create(t,false)},texture:_.create2D,cube:_.createCube,renderbuffer:T.create,framebuffer:R.create,framebufferCube:R.createCube,vao:w.createVAO,attributes:i,frame:H,on:K,limits:m,hasExtension:function(t){return m.extensions.indexOf(t.toLowerCase())>=0},read:x,destroy:P,_gl:e,_refresh:Y,poll:function(){$();if(c){c.update()}},now:q,stats:f});r.onDone(null,Q);return Q}return Zu}))}));var xc,jc,Sc,Nc,Ic,Mc,Cc,Lc,kc,Uc,Fc,Bc,Dc,Pc;xc={},wc(xc,Ac.POINTS,"points"),wc(xc,Ac.LINES,"lines"),wc(xc,Ac.LINE_LOOP,"line loop"),wc(xc,Ac.LINE_STRIP,"line strip"),wc(xc,Ac.TRIANGLES,"triangles"),wc(xc,Ac.TRIANGLE_FAN,"triangle fan"),wc(xc,Ac.TRIANGLE_STRIP,"triangle strip"),xc;jc={},wc(jc,Ac.STATIC_DRAW,"static"),wc(jc,Ac.DYNAMIC_DRAW,"dynamic"),wc(jc,Ac.STREAM_DRAW,"stream"),jc;Sc={},wc(Sc,Ac.BYTE,"int8"),wc(Sc,Ac.UNSIGNED_INT,"int16"),wc(Sc,Ac.INT,"int32"),wc(Sc,Ac.UNSIGNED_BYTE,"uint8"),wc(Sc,Ac.UNSIGNED_SHORT,"uint16"),wc(Sc,Ac.UNSIGNED_INT,"uint32"),wc(Sc,Ac.FLOAT,"float"),Sc;Nc={},wc(Nc,Ac.ALPHA,"alpha"),wc(Nc,Ac.LUMINANCE,"luminance"),wc(Nc,Ac.LUMINANCE_ALPHA,"luminance alpha"),wc(Nc,Ac.RGB,"rgb"),wc(Nc,Ac.RGBA,"rgba"),wc(Nc,Ac.RGBA4,"rgba4"),wc(Nc,Ac.RGB5_A1,"rgb5 a1"),wc(Nc,Ac.RGB565,"rgb565"),wc(Nc,Ac.DEPTH_COMPONENT,"depth"),wc(Nc,Ac.DEPTH_STENCIL,"depth stencil"),Nc;Ic={},wc(Ic,Ac.DONT_CARE,"dont care"),wc(Ic,Ac.NICEST,"nice"),wc(Ic,Ac.FASTEST,"fast"),Ic;Mc={},wc(Mc,Ac.NEAREST,"nearest"),wc(Mc,Ac.LINEAR,"linear"),wc(Mc,Ac.LINEAR_MIPMAP_LINEAR,"mipmap"),wc(Mc,Ac.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),wc(Mc,Ac.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),wc(Mc,Ac.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Mc;Cc={},wc(Cc,Ac.REPEAT,"repeat"),wc(Cc,Ac.CLAMP_TO_EDGE,"clamp"),wc(Cc,Ac.MIRRORED_REPEAT,"mirror"),Cc;Lc={},wc(Lc,Ac.NONE,"none"),wc(Lc,Ac.BROWSER_DEFAULT_WEBGL,"browser"),Lc;kc={},wc(kc,Ac.NEVER,"never"),wc(kc,Ac.ALWAYS,"always"),wc(kc,Ac.LESS,"less"),wc(kc,Ac.LEQUAL,"lequal"),wc(kc,Ac.GREATER,"greater"),wc(kc,Ac.GEQUAL,"gequal"),wc(kc,Ac.EQUAL,"equal"),wc(kc,Ac.NOTEQUAL,"notequal"),kc;Uc={},wc(Uc,Ac.FUNC_ADD,"add"),wc(Uc,Ac.MIN_EXT,"min"),wc(Uc,Ac.MAX_EXT,"max"),wc(Uc,Ac.FUNC_SUBTRACT,"subtract"),wc(Uc,Ac.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Uc;Fc={},wc(Fc,Ac.ZERO,"zero"),wc(Fc,Ac.ONE,"one"),wc(Fc,Ac.SRC_COLOR,"src color"),wc(Fc,Ac.ONE_MINUS_SRC_COLOR,"one minus src color"),wc(Fc,Ac.SRC_ALPHA,"src alpha"),wc(Fc,Ac.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),wc(Fc,Ac.DST_COLOR,"dst color"),wc(Fc,Ac.ONE_MINUS_DST_COLOR,"one minus dst color"),wc(Fc,Ac.DST_ALPHA,"dst alpha"),wc(Fc,Ac.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),wc(Fc,Ac.CONSTANT_COLOR,"constant color"),wc(Fc,Ac.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),wc(Fc,Ac.CONSTANT_ALPHA,"constant alpha"),wc(Fc,Ac.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),wc(Fc,Ac.SRC_ALPHA_SATURATE,"src alpha saturate"),Fc;Bc={},wc(Bc,Ac.NEVER,"never"),wc(Bc,Ac.ALWAYS,"always"),wc(Bc,Ac.LESS,"less"),wc(Bc,Ac.LEQUAL,"lequal"),wc(Bc,Ac.GREATER,"greater"),wc(Bc,Ac.GEQUAL,"gequal"),wc(Bc,Ac.EQUAL,"equal"),wc(Bc,Ac.NOTEQUAL,"notequal"),Bc;Dc={},wc(Dc,Ac.ZERO,"zero"),wc(Dc,Ac.KEEP,"keep"),wc(Dc,Ac.REPLACE,"replace"),wc(Dc,Ac.INVERT,"invert"),wc(Dc,Ac.INCR,"increment"),wc(Dc,Ac.DECR,"decrement"),wc(Dc,Ac.INCR_WRAP,"increment wrap"),wc(Dc,Ac.DECR_WRAP,"decrement wrap"),Dc;Pc={},wc(Pc,Ac.FRONT,"front"),wc(Pc,Ac.BACK,"back"),Pc;var Gc=N((function(t){function n(t,n){if(n==null||n>t.length)n=t.length;for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}t.exports=n,t.exports.__esModule=true,t.exports["default"]=t.exports}));var Vc=N((function(t){function n(t){if(Array.isArray(t))return Gc(t)}t.exports=n,t.exports.__esModule=true,t.exports["default"]=t.exports}));var Xc=N((function(t){function n(t){if(typeof Symbol!=="undefined"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}t.exports=n,t.exports.__esModule=true,t.exports["default"]=t.exports}));var zc=N((function(t){function n(t,n){if(!t)return;if(typeof t==="string")return Gc(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor)r=t.constructor.name;if(r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Gc(t,n)}t.exports=n,t.exports.__esModule=true,t.exports["default"]=t.exports}));var Hc=N((function(t){function n(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}t.exports=n,t.exports.__esModule=true,t.exports["default"]=t.exports}));N((function(t){function n(t){return Vc(t)||Xc(t)||zc(t)||Hc()}t.exports=n,t.exports.__esModule=true,t.exports["default"]=t.exports}));var Wc=Function.prototype;var $c=Wc.toString;$c.call(Object);const Yc=".x6-graph-scroller{width:100vw !important;height:calc(100vh - 64px) !important}.x6-graph-scroller.x6-graph-scroller-pannable[data-panning=false]{cursor:default}.x6-widget-selection-box{box-sizing:content-box !important;margin-top:-4px;margin-left:-4px;padding-right:4px;padding-bottom:4px;border:2px dashed #34D399;box-shadow:none}.x6-widget-selection-inner{box-sizing:content-box !important;margin-top:-8px;margin-left:-8px;padding-right:12px;padding-bottom:12px;border:2px solid #34D399;box-shadow:none}";const qc="Elsa.Flowchart";const Kc=class{constructor(r){t(this,r);this.activitySelected=n(this,"activitySelected",7);this.activityDeleted=n(this,"activityDeleted",7);this.containerSelected=n(this,"containerSelected",7);this.childActivitySelected=n(this,"childActivitySelected",7);this.graphUpdated=n(this,"graphUpdated",7);this.getFlowchartDescriptor=()=>this.getActivityDescriptor(qc,1);this.createFlowchart=async()=>{const t=this.getFlowchartDescriptor();const n=await this.generateUniqueActivityName(t);return{type:t.typeName,version:t.version,id:n,start:null,activities:[],connections:[],metadata:{},variables:[],customProperties:{},canStartWorkflow:false}};this.createAndInitializeGraph=async()=>{const t=this.graph=U(this.container,{nodeMovable:()=>this.interactiveMode,edgeMovable:()=>this.interactiveMode,arrowheadMovable:()=>this.interactiveMode,edgeLabelMovable:()=>this.interactiveMode,magnetConnectable:()=>this.interactiveMode,useEdgeTools:()=>this.interactiveMode,toolsAddable:()=>this.interactiveMode,stopDelegateOnDragging:()=>this.interactiveMode,vertexAddable:()=>this.interactiveMode,vertexDeletable:()=>this.interactiveMode,vertexMovable:()=>this.interactiveMode},this.getAllActivities);t.on("blank:click",this.onGraphClick);t.on("node:selected",this.onNodeSelected);t.on("node:contextmenu",this.onNodeContextMenu);t.on("edge:connected",this.onEdgeConnected);t.on("node:moved",this.onNodeMoved);t.on("node:moved",this.onGraphChanged);t.on("node:added",this.onNodeAdded);t.on("node:removed",this.onNodeRemoved);t.on("edge:added",this.onGraphChanged);t.on("edge:removed",this.onGraphChanged);t.on("edge:connected",this.onGraphChanged);await this.updateLayout()};this.getCurrentActivity=()=>{const t=this.activityLookup;const n=this.path;if(n.length>0){const r=n[n.length-1];return t[r.activityId]}return this.rootActivity};this.getCurrentFlowchartActivity=async()=>{const t=this.path;let n=this.getCurrentActivity();if(t.length>0){const r=t[t.length-1];return this.resolvePort(n,r.portName)}return n};this.resolvePort=(t,n)=>{const r=this.portProviderRegistry.get(t.type);const e=R.activityDescriptors.find((n=>n.typeName==t.type));const i=r.resolvePort(n,{activity:t,activityDescriptor:e});return i};this.setPort=(t,n,r)=>{const e=this.portProviderRegistry.get(t.type);const i=R.activityDescriptors.find((n=>n.typeName==t.type));e.assignPort(n,r,{activity:t,activityDescriptor:i});this.updateLookups()};this.updateModel=async()=>{const t=this.getFlowchartModel();const n=await this.getCurrentFlowchartActivity();n.activities=t.activities;n.connections=t.connections;n.start=t.start;this.updateLookups()};this.exportInternal=()=>this.rootActivity;this.getActivityDescriptor=(t,n)=>R.activityDescriptors.find((r=>r.typeName==t&&r.version==n));this.setupGraph=async t=>{const n=t.activities;const r=t.connections;this.updateGraphInternal(n,r);if(this.isReadonly){this.graph.disableSelectionMovable();this.graph.disableKeyboard()}};this.updateGraphInternal=(t,n)=>{const r=[];console.log(t);const e=t===null||t===void 0?void 0:t.map((t=>{var n;const r=((n=t.metadata.designer)===null||n===void 0?void 0:n.position)||{x:100,y:100};const{x:e,y:i}=r;const a=this.getActivityDescriptor(t.type,t.version);return this.nodeFactory.createNode(a,t,e,i)}));for(const t of n){const n=this.createEdge(t);r.push(n)}const i={nodes:e,edges:r};this.graph.freeze();this.graph.fromJSON(i,{silent:false});this.graph.unfreeze();w(this.graph);this.graph.scrollToContent()};this.getFlowchartModel=()=>{const t=this.graph;const n=t.toJSON();const r=n.cells.filter((t=>t.shape=="activity")).map((t=>t.data));const e=n.cells.filter((t=>t.shape=="elsa-edge"&&!!t.data)).map((t=>t.data));let i=r.filter((t=>{const n=e.find((n=>n.target.activity==t.id))!=null;return!n}));const o=i.find((t=>t.canStartWorkflow))||a.first(i);return{activities:r,connections:e,start:o===null||o===void 0?void 0:o.id}};this.createEdge=t=>({shape:"elsa-edge",zIndex:-1,data:t,source:t.source.activity,target:t.target.activity,sourcePort:t.source.port,targetPort:t.target.port});this.syncEdgeData=(t,n)=>{const r=this.graph;const e=r.model.getEdges().filter((t=>t.shape=="elsa-edge"&&!!t.data));for(const r of e){const e=r.data;if(e.target.activity!=t&&e.source.activity!=t)continue;if(e.target.activity==t)e.target.activity=n.id;if(e.source.activity==t)e.source.activity=n.id;r.data=e}};this.updateLookups=()=>{const t=O(this.rootActivity);const n=x(t);this.activities=n.map((t=>t.activity));this.activityLookup=j(n)};this.generateUniqueActivityName=async t=>await l(this.activities,t);this.getAllActivities=()=>this.activities;this.onGraphClick=async t=>{const n=await this.getCurrentFlowchartActivity();const r={activity:n};return this.containerSelected.emit(r)};this.onNodeSelected=async t=>{const n=t.node;const r=n.activity;const e=this.activityLookup[r.id];const i={activity:e};this.activitySelected.emit(i)};this.onNodeContextMenu=async t=>{const n=t.node;const r=t.node.data;const e=[{text:"Startable",handler:()=>this.onToggleCanStartWorkflowClicked(n),isToggle:true,checked:r.canStartWorkflow},{text:"Cut",handler:()=>this.onCutActivityClicked(n)},{text:"Copy",handler:()=>this.onCopyActivityClicked(n)},{text:"Delete",handler:()=>this.onDeleteActivityClicked(n)}];this.activityContextMenu.menuItems=this.isReadonly?[]:e;const i=this.graph.localToClient(t.x,t.y);const a=this.graph.getScrollbarPosition();this.activityContextMenu.style.top=`${i.y}px`;this.activityContextMenu.style.left=`${t.x-a.left}px`;await this.activityContextMenu.open()};this.onNodeMoved=t=>{const n=t.node;const r=n.data;const e=n.position({relative:false});r.metadata=Object.assign(Object.assign({},r.metadata),{designer:Object.assign(Object.assign({},r.metadata.designer),{position:{x:e.x,y:e.y}})})};this.onEdgeConnected=async t=>{const n=t.edge;const r=n.getSourceNode();const e=n.getTargetNode();const i=n.getSourceNode().data;const a=e.data;const o=r.getPort(n.getSourcePortId()).id;const u=e.getPort(n.getTargetPortId()).id;const f={source:{activity:i.id,port:o},target:{activity:a.id,port:u}};n.data=f;const s={graph:this.graph,connection:f,sourceNode:r,targetNode:e,sourceActivity:i,targetActivity:a,edge:n};await this.eventBus.emit(H.ConnectionCreated,this,s)};this.onGraphChanged=async t=>{await this.updateModel();this.graphUpdated.emit()};this.onNodeRemoved=async t=>{const n=t.node.data;this.activityDeleted.emit({activity:n});await this.onGraphChanged(t)};this.onNodeAdded=async t=>{const n=t.node;if(!n.isClone){const t=Object.assign({},n.getData());const r=this.getActivityDescriptor(t.type,t.version);t.id=await this.generateUniqueActivityName(r);n.activity=Object.assign({},t)}await this.onGraphChanged(t)};this.onToggleCanStartWorkflowClicked=t=>{const n=t.data;n.canStartWorkflow=!n.canStartWorkflow;t.activity=Object.assign({},n)};this.onDeleteActivityClicked=t=>{let n=this.graph.getSelectedCells();if(n.length==0)n=[t];this.graph.removeCells(n);for(const r of n){const n=t.data;this.activityDeleted.emit({activity:n})}};this.onCopyActivityClicked=t=>{let n=this.graph.getSelectedCells();if(n.length==0)n=[t];this.graph.copy(n)};this.onCutActivityClicked=t=>{let n=this.graph.getSelectedCells();if(n.length==0)n=[t];this.graph.cut(n);for(const r of n){const n=t.data;this.activityDeleted.emit({activity:n})}};this.onNavigateHierarchy=async t=>{const n=t.detail;const r=this.path;const e=r.indexOf(n);this.path=r.slice(0,e+1);const i=await this.getCurrentFlowchartActivity();await this.setupGraph(i);await this.scrollToStart()};this.updatePorts=(t,n)=>{const r=this.getActivityDescriptor(n.type,n.version);const e=this.nodeFactory.createPorts(r,n);const i=t.ports.items;const a=e.filter((t=>!i.some((n=>g(n.id)==g(t.id)))));const o=i.filter((t=>!e.some((n=>g(n.id)==g(t.id)))));if(a.length>0)t.addPorts(a);if(o.length>0)t.removePorts(o)};this.rootActivity=undefined;this.interactiveMode=true;this.silent=false;this.isReadonly=false;this.activityLookup={};this.activities=[];this.path=[];this.eventBus=s.get(E);this.nodeFactory=s.get(z);this.portProviderRegistry=s.get(p)}async handleChildActivitySelected(t){this.childActivitySelected.emit(t.detail)}async newRoot(){const t=await this.createFlowchart();await this.setupGraph(t);await this.scrollToStart();return t}async updateGraph(){const t=await this.getCurrentFlowchartActivity();await this.setupGraph(t)}async getGraph(){return this.graph}async reset(){const t={nodes:[],edges:[]};this.graph.freeze();this.graph.fromJSON(t,{silent:false});this.graph.unfreeze()}async updateLayout(){const t=this.el.clientWidth;const n=this.el.clientHeight;this.graph.resize(t,n);this.graph.updateBackground()}async zoomToFit(){const t=this.graph;t.zoomToFit()}async scrollToStart(){const t=this.getFlowchartModel();const n=t.activities.find((n=>n.id==t.start));if(n!=null){this.graph.scrollToCell(this.graph.getCells()[0])}}async autoLayout(t){const n=new qe({type:"dagre",rankdir:t,align:"UL",ranksep:30,nodesep:15,controlPoints:true});const r=this.getFlowchartModel();const e=[];const i=[];r.activities.forEach((t=>{const n=document.querySelectorAll('[activity-id="'+t.id+'"]')[0].getBoundingClientRect();e.push({id:t.id,size:{width:n.width,height:n.height},x:t.metadata.designer.position.x,y:t.metadata.designer.position.y})}));r.connections.forEach(((t,n)=>{i.push({id:n,source:t.source,target:t.target})}));let a={nodes:e,edges:i};let o=n.layout(a);o.nodes.forEach((t=>{let n=t;let e=r.activities.find((n=>n.id==t.id));e.metadata.designer.position.x=n.x;e.metadata.designer.position.y=n.y;this.updateActivity({id:e.id,originalId:e.id,activity:e})}));this.updateGraphInternal(r.activities,r.connections);this.graphUpdated.emit({})}async addActivity(t){var n;const r=this.graph;const{descriptor:e,x:i,y:a}=t;let o=(n=t.id)!==null&&n!==void 0?n:await this.generateUniqueActivityName(e);const u=r.pageToLocal(i,a);const f=u.x;const s=u.y;const c={id:o,type:e.typeName,version:e.version,customProperties:{},metadata:{designer:{position:{x:f,y:s}}}};const l=this.nodeFactory.createNode(e,c,f,s);r.addNode(l,{merge:true});const v=r.getNodes().find((t=>t.data.id==l.activity.id));A(v);await this.updateModel();return c}async updateActivity(t){var n;const r=t.id;const e=(n=t.originalId)!==null&&n!==void 0?n:r;const i=t.activity;const a=this.graph.getNodes().find((t=>t.data.id==e));const o=a;if(!!a){o.setData(i,{overwrite:true});o.activity=i;if(r!==e){this.syncEdgeData(e,i);await this.updateModel()}if(t.updatePorts){this.updatePorts(a,i)}}this.updateLookups()}async getActivity(t){return this.activityLookup[t]}async renameActivity(t){const n=t.originalId;const r=t.activity;const e=this.graph.getNodes().find((t=>t.data.id==n));if(!e)return;e.setData(r,{overwrite:true});e.activity=r;if(r.id!==n){this.syncEdgeData(n,r);await this.updateModel()}}async export(){return this.exportInternal()}onActivityChanged(t){this.updateLookups()}async onInteractiveModeChange(t){const n=this.graph;if(!t||this.isReadonly){n.disableSelectionMovable();n.disableKeyboard()}else{n.enableSelectionMovable();n.enableKeyboard()}}async editChildActivity(t){const n=t.detail.port.name;const r=t.detail.parentActivityId;const e={activityId:r,portName:n};this.path=[...this.path,e];const i=await this.getCurrentActivity();let a=await this.getCurrentFlowchartActivity();if(!a){a=await this.createFlowchart();this.setPort(i,n,a)}await this.setupGraph(a)}async componentWillLoad(){this.updateLookups()}async componentDidLoad(){await this.createAndInitializeGraph();await this.updateGraph()}render(){const t=this.path;const n={nodeMap:this.activityLookup};return r(C.Provider,{state:n},r("div",{class:"tw-relative "},r("div",{class:"tw-absolute tw-left-0 tw-top-3 tw-z-10"},r("elsa-workflow-navigator",{items:t,rootActivity:this.rootActivity,onNavigate:this.onNavigateHierarchy})),r("div",{class:"tw-absolute tw-left-0 tw-top-0 tw-right-0 tw-bottom-0 ",ref:t=>this.container=t}),r("elsa-context-menu",{ref:t=>this.activityContextMenu=t,hideButton:true,anchorPoint:S.TopLeft,class:"tw-absolute"})))}get el(){return e(this)}static get watchers(){return{rootActivity:["onActivityChanged"],interactiveMode:["onInteractiveModeChange"]}}};Kc.style=Yc;const Qc={[L.Right]:"LS/rightPanelWidth",[L.Left]:"LS/leftPanelWidth",[L.Bottom]:"LS/bottomPanelWidth"};const Zc={[L.Right]:"--workflow-editor-width",[L.Left]:"--activity-picker-width",[L.Bottom]:"--activity-editor-height"};const Jc={[L.Right]:580,[L.Left]:300,[L.Bottom]:200};function tl(t){return localStorage.getItem(Qc[t])||Jc[t]}function nl(t,n){return localStorage.setItem(Qc[t],n.toString())}function rl({position:t,isDefault:n,isHide:r,size:e}){const i=document.querySelector(":root");if(r){i.style.setProperty(Zc[t],"1px");return}if(n){if(t<0)t=t*-1;i.style.setProperty(Zc[t],`${tl(t)}px`);return}if(e<0){const t=document.querySelector("elsa-flowchart");e=window.innerHeight+e-t.getBoundingClientRect().y+55}i.style.setProperty(Zc[t],`${e}px`);nl(t,e);return}const el=".panel-state-collapsed.panel-position-bottom{right:var(--workflow-editor-width);left:var(--activity-picker-width)}.panel-position-bottom{right:var(--workflow-editor-width) !important;left:var(--activity-picker-width) !important}";const il=class{constructor(r){t(this,r);this.expandedStateChanged=n(this,"expandedStateChanged",7);this.dragging=false;this.onToggleClick=()=>{if(this.isExpanded){rl({position:this.position,isHide:true})}else{rl({position:this.position,isDefault:true})}this.isExpanded=!this.isExpanded;this.expandedStateChanged.emit({expanded:this.isExpanded})};this.onBodyMouseUp=()=>{if(this.dragging){this.clearJSEvents()}};this.resize=t=>{if(this.position===L.Right){rl({position:L.Right,size:document.body.clientWidth-t.pageX})}if(this.position===L.Left){rl({position:L.Left,size:t.pageX})}if(this.position===L.Bottom){rl({position:L.Bottom,size:document.body.offsetHeight-t.pageY})}};this.onDragBarMouseDown=t=>{t.preventDefault();const n=document.body;this.dragging=true;n.addEventListener("mousemove",this.resize)};this.position=L.Left;this.isExpanded=true}componentWillLoad(){document.addEventListener("mouseup",this.onBodyMouseUp);rl({position:this.position,isDefault:true})}disconnectedCallback(){document.removeEventListener("mouseup",this.onBodyMouseUp)}clearJSEvents(){const t=document.body;this.dragging=false;t.removeEventListener("mousemove",this.resize)}render(){const t=this.isExpanded;const n=this.position;const e=t?"panel-state-expanded":"panel-state-collapsed";const a=[];a[L.Left]="panel-position-left tw-left-0 tw-top-0 tw-bottom-0 tw-border-r";a[L.Top]="panel-position-top tw-left-0 tw-top-0 tw-right-0 tw-border-b";a[L.Bottom]="panel-position-bottom h-0 tw-bottom-0 tw-border-t";a[L.Right]="panel-position-right tw-right-0 tw-top-0 tw-bottom-0 tw-border-l";const o=a[n];const u={};u[L.Left]="elsa-panel-toggle-left";u[L.Top]="elsa-panel-toggle-top";u[L.Right]="elsa-panel-toggle-right";u[L.Bottom]="elsa-panel-toggle-bottom";const f=u[n];const s=t?"tw-rotate-180":"";const c={[L.Left]:"tw-right-0 tw-h-full tw-cursor-col-resize tw-w-1",[L.Right]:"tw-left-0 tw-h-full tw-cursor-col-resize tw-w-1",[L.Bottom]:"tw-top-0 tw-w-full tw-cursor-row-resize tw-h-1"};const l=c[this.position];return r(i,{class:`panel tw-absolute tw-bg-white tw-z-20 ${o} ${e}`},r("div",{class:`tw-absolute tw-opacity-0 tw-bg-blue-400 tw-transition tw-ease-in-out tw-duration-300 hover:tw-opacity-100 tw-z-10 ${l}`,onMouseDown:this.onDragBarMouseDown}),r("div",{class:"panel-content-container"},r("slot",null)),r("div",{class:`tw-text-white ${f}`,onClick:()=>this.onToggleClick()},r("svg",{class:`tw-h-6 tw-w-6 tw-text-gray-700 ${s}`,width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},r("path",{stroke:"none",d:"M0 0h24v24H0z"}),r("polyline",{points:"9 6 15 12 9 18"}))))}get element(){return e(this)}};il.style=el;const al=class{constructor(e){t(this,e);this.navigate=n(this,"navigate",7);this.renderPathItem=(t,n,e)=>{const i=t.activityId;const a=e.find((t=>t.activity.id==i)).activity;const o=R.activityDescriptors.find((t=>t.typeName==a.type));const u=this.iconRegistry.getOrDefault(a.type)();const f=[];const s=n==this.items.length-1;const c=(t,n)=>{t.preventDefault();this.onItemClick(n)};let l=null;if(!!t.portName){const n=this.portProviderRegistry.get(a.type);const r=n.getOutboundPorts({activity:a,activityDescriptor:o});if(r.length>1)l=r.find((n=>n.name==t.portName))}if(s){f.push(r("li",null,r("div",{class:"tw-flex tw-items-center"},r("span",{class:"tw-block tw-flex tw-items-center tw-text-gray-500"},r("div",{class:"tw-bg-blue-500 tw-rounded"},u),r("span",{class:"tw-ml-4 tw-text-sm tw-font-medium tw-text-gray-500"},i)),!!l?r("svg",{class:"tw-ml-2 tw-flex-shrink-0 tw-h-5 tw-w-5 tw-text-gray-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},r("path",{"fill-rule":"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule":"evenodd"})):undefined)))}else{f.push(r("li",null,r("div",{class:"tw-flex tw-items-center"},r("a",{onClick:n=>c(n,t),href:"#",class:"tw-block tw-flex tw-items-center tw-text-gray-400 hover:tw-text-gray-500"},r("div",{class:"tw-bg-blue-500 tw-rounded"},u),r("span",{class:"tw-ml-4 tw-text-sm tw-font-medium tw-text-gray-500 hover:tw-text-gray-700"},i)),r("svg",{class:"tw-ml-2 tw-flex-shrink-0 tw-h-5 tw-w-5 tw-text-gray-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},r("path",{"fill-rule":"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule":"evenodd"})))))}if(!!l){f.push(r("li",null,r("div",{class:"tw-flex tw-items-center"},r("span",{class:"tw-text-sm tw-font-medium tw-text-gray-500","aria-current":"page"},l.displayName))))}return f};this.onItemClick=t=>this.navigate.emit(t);this.items=[];this.rootActivity=undefined;this.iconRegistry=s.get(_);this.portProviderRegistry=s.get(p)}render(){let t=this.items;if(t.length<=0)return null;if(!this.rootActivity)return;const n=x(O(this.rootActivity));return r("div",{class:"tw-ml-8"},r("nav",{class:"tw-flex","aria-label":"Breadcrumb"},r("ol",{role:"list",class:"tw-flex tw-items-center tw-space-x-3"},t.length>0&&r("li",null,r("div",{class:"tw-flex tw-items-center"},r("a",{onClick:t=>this.onItemClick(null),href:"#",class:"tw-block tw-flex tw-items-center tw-text-gray-400 hover:tw-text-gray-500"},r("div",{class:"tw-bg-blue-500 tw-rounded"},r(T,null)),r("span",{class:"tw-ml-4 tw-text-sm tw-font-medium tw-text-gray-500 hover:tw-text-gray-700"},this.rootActivity.id)),r("svg",{class:"tw-ml-2 tw-flex-shrink-0 tw-h-5 tw-w-5 tw-text-gray-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true"},r("path",{"fill-rule":"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z","clip-rule":"evenodd"})))),t.map(((t,r)=>this.renderPathItem(t,r,n))))))}};export{Kc as elsa_flowchart,il as elsa_panel,al as elsa_workflow_navigator};
//# sourceMappingURL=p-36e8552d.entry.js.map