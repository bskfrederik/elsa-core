import{r as t,a as e,h as i,c as n,H as s}from"./p-a7a3baa1.js";import{l as r}from"./p-e71312f9.js";import{t as o,e as a,l as c}from"./p-3ff104be.js";import{R as l,C as u,a as h,m as d,o as f,aW as w}from"./p-691e5295.js";import{H as p}from"./p-ec4413cd.js";import"./p-219f806a.js";import"./p-b6964c5d.js";import{I as m}from"./p-e7fbf459.js";import"./p-72dc819a.js";import"./p-144a434e.js";import"./p-ddecd487.js";import"./p-37e9f5c1.js";const v=class{constructor(e){t(this,e);this.context={};this.renderer=()=>null}connectedCallback(){if(this.subscribe!=null){this.unsubscribe=this.subscribe(this.el,"context")}}disconnectedCallback(){if(this.unsubscribe!=null){this.unsubscribe()}}render(){return this.renderer(Object.assign({},this.context))}get el(){return e(this)}};const g=()=>i("svg",{class:"tw-h-5 tw-w-5 tw-text-gray-400",width:"24",height:"24",viewBox:"0 0 24 24","stroke-width":"2",stroke:"currentColor",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},i("path",{stroke:"none",d:"M0 0h24v24H0z"}),i("circle",{cx:"12",cy:"12",r:"9"}),i("line",{x1:"8",y1:"12",x2:"8",y2:"12.01"}),i("line",{x1:"12",y1:"12",x2:"12",y2:"12.01"}),i("line",{x1:"16",y1:"12",x2:"16",y2:"12.01"}));const y=class{constructor(e){t(this,e);this.syntaxChanged=n(this,"syntaxChanged",7);this.expressionChanged=n(this,"expressionChanged",7);this.shouldRenderMonaco=()=>!!this.syntax&&this.syntax!="Literal"&&!!this.supportedSyntaxes.find((t=>t===this.syntax));this.renderContextMenuButton=()=>this.shouldRenderMonaco()?i("span",null,this.syntax):i(g,null);this.renderEditor=()=>{const t=this.syntax;const e=d(t);const n=this.expression;const s=!!t&&t!="Literal"&&!!this.supportedSyntaxes.find((e=>e===t));const r=s?"tw-block":"hidden";const o=s?"hidden":"tw-block";return i("div",null,i("div",{class:r},i("elsa-monaco-editor",{value:n,language:e,"editor-height":this.codeEditorHeight,"single-line":this.codeEditorSingleLineMode,onValueChanged:t=>this.onExpressionChangedDebounced(t.detail),ref:t=>this.monacoEditor=t})),i("div",{class:o},i("slot",null)),i(p,{text:this.hint}))};this.workflowDefinitionId=undefined;this.activityType=undefined;this.propertyName=undefined;this.label=undefined;this.hideLabel=undefined;this.hint=undefined;this.fieldName=undefined;this.syntax=undefined;this.expression=undefined;this.defaultSyntax=l.Literal;this.supportedSyntaxes=["JavaScript","Liquid"];this.isReadOnly=undefined;this.codeEditorHeight="16em";this.codeEditorSingleLineMode=false;this.context=undefined;this.currentExpression=undefined;this.onExpressionChangedDebounced=r.debounce(this.onExpressionChanged,10)}onWindowClicked(t){const e=t.target;if(!this.contextMenuWidget||!this.contextMenuWidget.contains(e))this.closeContextMenu()}async componentWillLoad(){this.currentExpression=this.expression}async componentDidLoad(){const t=await u.get(h).getElsaClient();const e=this.workflowDefinitionId;const i=this.activityType;const n=this.propertyName;const s=await t.scripting.javaScriptApi.getTypeDefinitions({workflowDefinitionId:e,activityTypeName:i,propertyName:n});const r="defaultLib:lib.es6.d.ts";await this.monacoEditor.addJavaScriptLib(s,r)}render(){if(this.hideLabel&&!this.shouldRenderMonaco()){return i("div",{class:"tw-p-4"},i("div",{class:"tw-flex"},i("div",{class:"tw-flex-1"},this.renderEditor()),this.renderContextMenuWidget()))}return i("div",{class:"tw-p-4"},i("div",{class:"tw-mb-1"},i("div",{class:"tw-flex"},i("div",{class:"tw-flex-1"},this.renderLabel()),this.renderContextMenuWidget())),this.renderEditor())}renderLabel(){const t=this.fieldName;const e=this.label||t;return i("label",{htmlFor:t,class:"tw-block tw-text-sm tw-font-medium tw-text-gray-700"},e)}renderContextMenuWidget(){if(this.supportedSyntaxes.length==0)return undefined;const t=this.syntax;const e=t?"tw-text-blue-500":"tw-text-gray-300";return i("div",{class:"tw-relative",ref:t=>this.contextMenuWidget=t},i("button",{type:"button",class:`tw-border-0 focus:tw-outline-none tw-text-sm ${e}`,onClick:t=>this.onSettingsClick(t)},!this.isReadOnly?this.renderContextMenuButton():""),i("div",null,i("div",{ref:t=>this.contextMenu=t,"data-transition-enter":"tw-transition tw-ease-out tw-duration-100","data-transition-enter-start":"tw-transform tw-opacity-0 tw-scale-95","data-transition-enter-end":"tw-transform tw-opacity-100 tw-scale-100","data-transition-leave":"tw-transition tw-ease-in tw-duration-75","data-transition-leave-start":"tw-transform tw-opacity-100 tw-scale-100","data-transition-leave-end":"tw-transform tw-opacity-0 tw-scale-95",class:"hidden tw-origin-top-right tw-absolute tw-right-1 tw-mt-1 tw-w-56 tw-rounded-md tw-shadow-lg tw-bg-white tw-ring-1 tw-ring-black tw-ring-opacity-5 tw-divide-y tw-divide-gray-100 focus:tw-outline-none tw-z-10",role:"menu","aria-orientation":"vertical","aria-labelledby":"options-menu"},i("div",{class:"tw-py-1",role:"none"},i("a",{onClick:t=>this.selectSyntax(t,null),href:"#",class:`tw-block tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900 ${!t?"tw-text-blue-700":"tw-text-gray-700"}`,role:"menuitem"},"Default")),i("div",{class:"tw-py-1",role:"none"},this.supportedSyntaxes.map((e=>i("a",{onClick:t=>this.selectSyntax(t,e),href:"#",class:`tw-block tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900 ${t==e?"tw-text-blue-700":"tw-text-gray-700"}`,role:"menuitem"},e)))))))}toggleContextMenu(){o(this.contextMenu)}openContextMenu(){a(this.contextMenu)}closeContextMenu(){if(!!this.contextMenu)c(this.contextMenu)}selectDefaultEditor(t){t.preventDefault();this.syntax=undefined;this.closeContextMenu()}async selectSyntax(t,e){t.preventDefault();this.syntax=e;this.syntaxChanged.emit(e);this.expressionChanged.emit({expression:this.currentExpression,syntax:e});this.closeContextMenu()}onSettingsClick(t){this.toggleContextMenu()}onExpressionChanged(t){const e=t.value;this.currentExpression=e;this.expressionChanged.emit({expression:e,syntax:this.syntax})}};m.injectProps(y,["workflowDefinitionId","activityType","propertyName"]);function b(t,e,i,n){function s(t){return t instanceof i?t:new i((function(e){e(t)}))}return new(i||(i=Promise))((function(i,r){function o(t){try{c(n.next(t))}catch(t){r(t)}}function a(t){try{c(n["throw"](t))}catch(t){r(t)}}function c(t){t.done?i(t.value):s(t.value).then(o,a)}c((n=n.apply(t,e||[])).next())}))}function x(t,e){var i={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},n,s,r,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(t){return function(e){return c([t,e])}}function c(a){if(n)throw new TypeError("Generator is already executing.");while(o&&(o=0,a[0]&&(i=0)),i)try{if(n=1,s&&(r=a[0]&2?s["return"]:a[0]?s["throw"]||((r=s["return"])&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;if(s=0,r)a=[a[0]&2,r.value];switch(a[0]){case 0:case 1:r=a;break;case 4:i.label++;return{value:a[1],done:false};case 5:i.label++;s=a[1];a=[0];continue;case 7:a=i.ops.pop();i.trys.pop();continue;default:if(!(r=i.trys,r=r.length>0&&r[r.length-1])&&(a[0]===6||a[0]===2)){i=0;continue}if(a[0]===3&&(!r||a[1]>r[0]&&a[1]<r[3])){i.label=a[1];break}if(a[0]===6&&i.label<r[1]){i.label=r[1];r=a;break}if(r&&i.label<r[2]){i.label=r[2];i.ops.push(a);break}if(r[2])i.ops.pop();i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t];s=0}finally{n=r=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}}var k=new Error("request for lock canceled");var C=function(){function t(t,e){if(e===void 0){e=k}this._value=t;this._cancelError=e;this._weightedQueues=[];this._weightedWaiters=[]}t.prototype.acquire=function(t){var e=this;if(t===void 0){t=1}if(t<=0)throw new Error("invalid weight ".concat(t,": must be positive"));return new Promise((function(i,n){if(!e._weightedQueues[t-1])e._weightedQueues[t-1]=[];e._weightedQueues[t-1].push({resolve:i,reject:n});e._dispatch()}))};t.prototype.runExclusive=function(t,e){if(e===void 0){e=1}return b(this,void 0,void 0,(function(){var i,n,s;return x(this,(function(r){switch(r.label){case 0:return[4,this.acquire(e)];case 1:i=r.sent(),n=i[0],s=i[1];r.label=2;case 2:r.trys.push([2,,4,5]);return[4,t(n)];case 3:return[2,r.sent()];case 4:s();return[7];case 5:return[2]}}))}))};t.prototype.waitForUnlock=function(t){var e=this;if(t===void 0){t=1}if(t<=0)throw new Error("invalid weight ".concat(t,": must be positive"));return new Promise((function(i){if(!e._weightedWaiters[t-1])e._weightedWaiters[t-1]=[];e._weightedWaiters[t-1].push(i);e._dispatch()}))};t.prototype.isLocked=function(){return this._value<=0};t.prototype.getValue=function(){return this._value};t.prototype.setValue=function(t){this._value=t;this._dispatch()};t.prototype.release=function(t){if(t===void 0){t=1}if(t<=0)throw new Error("invalid weight ".concat(t,": must be positive"));this._value+=t;this._dispatch()};t.prototype.cancel=function(){var t=this;this._weightedQueues.forEach((function(e){return e.forEach((function(e){return e.reject(t._cancelError)}))}));this._weightedQueues=[]};t.prototype._dispatch=function(){var t;for(var e=this._value;e>0;e--){var i=(t=this._weightedQueues[e-1])===null||t===void 0?void 0:t.shift();if(!i)continue;var n=this._value;var s=e;this._value-=e;e=this._value+1;i.resolve([n,this._newReleaser(s)])}this._drainUnlockWaiters()};t.prototype._newReleaser=function(t){var e=this;var i=false;return function(){if(i)return;i=true;e.release(t)}};t.prototype._drainUnlockWaiters=function(){for(var t=this._value;t>0;t--){if(!this._weightedWaiters[t-1])continue;this._weightedWaiters[t-1].forEach((function(t){return t()}));this._weightedWaiters[t-1]=[]}};return t}();var j=function(){function t(t){this._semaphore=new C(1,t)}t.prototype.acquire=function(){return b(this,void 0,void 0,(function(){var t,e;return x(this,(function(i){switch(i.label){case 0:return[4,this._semaphore.acquire()];case 1:t=i.sent(),e=t[1];return[2,e]}}))}))};t.prototype.runExclusive=function(t){return this._semaphore.runExclusive((function(){return t()}))};t.prototype.isLocked=function(){return this._semaphore.isLocked()};t.prototype.waitForUnlock=function(){return this._semaphore.waitForUnlock()};t.prototype.release=function(){if(this._semaphore.isLocked())this._semaphore.release()};t.prototype.cancel=function(){return this._semaphore.cancel()};return t}();const _=window;const L=_.require;var S=[];let M;const $=new j;async function E(t){return await $.runExclusive((async()=>{if(M){return _.monaco}if(f(t)){return new Promise(((t,e)=>{const i=Date.now();const n=3e3;const s=()=>{if(_.monaco){t(_.monaco);return}if(Date.now()-i>n){e("Monaco editor not loaded.");return}requestAnimationFrame(s)};s()}))}const e=document.location.origin;const i=t.startsWith("http")?t:`${e}/${t}`;L.config({paths:{vs:`${i}/vs`}});_.MonacoEnvironment={getWorkerUrl:()=>n};let n=URL.createObjectURL(new Blob([`\n\tself.MonacoEnvironment = {\n\t\tbaseUrl: '${i}'\n\t};\n\timportScripts('${i}/vs/base/worker/workerMain.js');\n`],{type:"text/javascript"}));return new Promise((t=>{L(["vs/editor/editor.main"],(()=>{M=true;D(_.monaco);N(_.monaco);t(_.monaco)}))}))}))}function D(t){t.languages.register({id:"liquid"});t.languages.registerCompletionItemProvider("liquid",{provideCompletionItems:()=>{const e=[];const i=["assign","capture","endcapture","increment","decrement","if","else","elsif","endif","for","endfor","break","continue","limit","offset","range","reversed","cols","case","endcase","when","tw-block","endblock","true","false","in","unless","endunless","cycle","tablerow","endtablerow","contains","startswith","endswith","comment","endcomment","raw","endraw","editable","endentitylist","endentityview","endinclude","endmarker","entitylist","entityview","forloop","image","include","marker","outputcache","plugin","style","text","widget","abs","append","at_least","at_most","capitalize","ceil","compact","concat","date","default","divided_by","downcase","escape","escape_once","first","floor","join","last","lstrip","map","minus","modulo","newline_to_br","plus","prepend","remove","remove_first","replace","replace_first","reverse","round","rstrip","size","slice","sort","sort_natural","split","strip","strip_html","strip_newlines","times","truncate","truncatewords","uniq","upcase","url_decode","url_encode"];for(let n=0;n<i.length;n++){e.push({label:i[n],kind:t.languages.CompletionItemKind.Keyword})}return{suggestions:e}}})}function N(t){t.languages.registerCompletionItemProvider("sql",{triggerCharacters:["@"],provideCompletionItems:(e,i)=>{e.getWordUntilPosition(i);const n=[];for(const e of S){n.push({label:`${e.variableName}: ${e.type}`,kind:t.languages.CompletionItemKind.Variable,insertText:e.variableName})}return{suggestions:n}}})}const q=".monaco-editor-host{display:block;position:relative;min-height:12em}.monaco-editor-container{position:absolute;left:0;top:0;width:100%;height:100%;max-height:100% !important;margin:0;padding:0}";const I=class{constructor(e){t(this,e);this.valueChanged=n(this,"valueChanged",7);this.editorHeight="5em";this.value=undefined;this.language=undefined;this.singleLineMode=false;this.padding=undefined}async languageChangeHandler(t){if(!this.editor)return;const e=this.editor.getModel();const i=await this.getMonaco();i.editor.setModelLanguage(e,this.language)}async setValue(t){if(!this.editor)return;const e=this.editor.getModel();e.setValue(t||"")}async addJavaScriptLib(t,e){const i=await this.getMonaco();i.languages.typescript.javascriptDefaults.setExtraLibs([{filePath:"lib.es5.d.ts"},{content:t,filePath:e}]);const n=i.editor.getModel(e);if(n)n.dispose();i.editor.createModel(t,"typescript",i.Uri.parse(e));const s=t.matchAll(/declare const (\w+): (string|number)/g);S.splice(0,S.length);for(const t of s){S.push({variableName:t[1],type:t[2]})}}async componentDidLoad(){const t=await this.getMonaco();const e=this.language;t.languages.typescript.javascriptDefaults.setDiagnosticsOptions({noSemanticValidation:true,noSyntaxValidation:false});t.languages.typescript.javascriptDefaults.setCompilerOptions({target:t.languages.typescript.ScriptTarget.ES2020,lib:[],allowNonTsExtensions:true});t.languages.typescript.javascriptDefaults.setEagerModelSync(true);const i={value:this.value,language:e,fontFamily:"Roboto Mono, monospace",renderLineHighlight:"none",minimap:{enabled:false},automaticLayout:true,lineNumbers:"on",theme:"vs",roundedSelection:true,scrollBeyondLastLine:false,readOnly:false,overviewRulerLanes:0,overviewRulerBorder:false,lineDecorationsWidth:0,hideCursorInOverviewRuler:true,glyphMargin:false};let n=i;if(this.singleLineMode){n=Object.assign(Object.assign({},i),{wordWrap:"off",lineNumbers:"off",lineNumbersMinChars:0,folding:false,scrollBeyondLastColumn:0,scrollbar:{horizontal:"hidden",vertical:"hidden"},find:{addExtraSpaceOnTop:false,autoFindInSelection:"never",seedSearchStringFromSelection:false}})}this.editor=t.editor.create(this.container,n);this.editor.onDidChangeModelContent((i=>{const n=this.editor.getValue();const s=t.editor.getModelMarkers({owner:e});this.valueChanged.emit({value:n,markers:s})}));if(this.singleLineMode){this.editor.onKeyDown((e=>{if(e.keyCode==t.KeyCode.Enter){if(this.editor.getContribution("editor.contrib.suggestController").model.state==0){e.preventDefault()}}}));this.editor.onDidPaste((t=>{if(t.range.endLineNumber>1){let t="";const e=this.editor.getModel();let i=e.getLineCount();for(let n=0;n<i;n++){t+=e.getLineContent(n+1)}e.setValue(t)}}))}}async getMonaco(){if(!!this.monaco)return this.monaco;const t=w.monacoLibPath;return this.monaco=await E(t)}disconnectedCallback(){const t=this.editor;if(!!t)t.dispose()}render(){const t=this.padding||"tw-pt-1.5 tw-pl-1";return i(s,{class:"monaco-editor-host tw-border focus:tw-ring-blue-500 focus:tw-border-blue-500 tw-block tw-w-full tw-min-w-0 tw-rounded-md sm:tw-text-sm tw-border-gray-300 tw-p-4",style:{"min-height":this.editorHeight}},i("div",{ref:t=>this.container=t,class:`monaco-editor-container ${t}`}))}static get watchers(){return{language:["languageChangeHandler"]}}};I.style=q;export{v as context_consumer,y as elsa_input_control_switch,I as elsa_monaco_editor};
//# sourceMappingURL=p-7d61f7bb.entry.js.map